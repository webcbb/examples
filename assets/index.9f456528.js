var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,u=(t,e)=>{for(var n in e||(e={}))s.call(e,n)&&i(t,n,e[n]);if(r)for(var n of r(e))o.call(e,n)&&i(t,n,e[n]);return t},c=(t,r)=>e(t,n(r)),a=(t,e)=>{var n={};for(var i in t)s.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&r)for(var i of r(t))e.indexOf(i)<0&&o.call(t,i)&&(n[i]=t[i]);return n};import{_ as h}from"./vendor.be95cfba.js";class l extends ReferenceError{constructor(t,e=`The ${t} has no value`,n){super(void 0===n?e:`${e}. ${n}`),this.entry=t,this.reason=n}get name(){return"CxReferenceError"}}function d(t,e,n){return()=>{throw new l(t,e||`The ${t} is unavailable`,n)}}function f(t,e){const n=t.lazy(e);return t=>{const e=n();null!=e&&t(e)}}function p({byDefault:t=g}={}){return e=>({assign:f(e,y),assignDefault:f(e,t)})}function g(t){return[]}function y(t){const e=[];return t.eachAsset((t=>{e.push(t)})),e.length?e:null}function _({to:t},e){return t}function m(t,e,n){const r=t.supply.derive(),s=n?(t,{supply:s}={})=>e(((e,r)=>{null!=r?t(e,r):t(n(),-1)}),r.derive(s)):(t,{supply:n}={})=>e(t,r.derive(n));let o,i;const u=()=>s(((e,n)=>{null!=n?(o=()=>e,i=t=>t(e,n)):(o=d(t.entry),i=b)}),r);return o=()=>(u(),o()),i=t=>{u(),i(t)},r.whenOff((e=>{o=i=d(t.entry,`The ${t.entry} is no longer available`,e)})),{supply:r,get:()=>o(),to:t=>i(t),track:s}}function w(t,e){return m(t,((e,{supply:n}={})=>((n=t.supply.derive(n)).isOff||e(),n)),e)}function b(t){}function v({create:t,byDefault:e,assign:n=_}={}){return r=>{e||t||(e=S),t||(t=x);const s=e&&r.lazy(e),o=m(r,(e=>r.trackAssetList((n=>{const s=[];for(const t of n)t.eachAsset((t=>{s.push(t)}));return s.length?e(t(s,r),1):e()}))),s),i=w(r,s);return{assign:n(o,r),assignDefault:n(i,r)}}}function x(t,e){return t}function S(){return[]}function A(t,{byDefault:e=(()=>null)}={}){return n=>({assign:f(n,t),assignDefault:f(n,e)})}function C({byDefault:t}={}){return e=>({assign:f(e,$),assignDefault:t&&f(e,t)})}function $(t){return t.recentAsset}const k={perContext:C(),toString:()=>"[CxGlobal]"};function R({create:t=O,byDefault:e,assign:n=_}={}){return r=>{const s=e&&r.lazy(e),o=m(r,(e=>r.trackRecentAsset((n=>n?e(t(n.asset,r),1):e()))),s),i=w(r,s);return{assign:n(o,r),assignDefault:n(i,r)}}}function O(t,e){return t}function D(t,e){return n=>{const r=n.get(t);return r===n.context?e(n):{assign(t,e){e.by?r.get(n.entry,E(1,t,e)):r.get(n.entry,c(u({},e),{set:t}))},assignDefault(t,e){e.by&&r.get(n.entry,E(-1,t,e))}}}}function T(t,e){return n=>{const r=n.get(t);if(r===n.context)return e(n);const s=n.lazy(e);return{assign(t,e){var n,r;null===(r=(n=s()).assign)||void 0===r||r.call(n,t,e)},assignDefault(t,e){r.get(n.entry,E(-1,t,e))}}}}function E(t,e,n){let r,{or:s}=n;return void 0!==s?r=e:(s=null,r=(n,r=t)=>r&&e(n,r)),c(u({},n),{or:s,by:t,set:r})}function P(t){return Array.isArray(t)}function F(t){return P(t)?t:null!=t?[t]:[]}function B(t,e){return t===e}function M(t){return()=>t}function z(...t){return()=>t}function N(t){let e;const n=()=>{e=L;try{const n=t();return e=M(n),n}catch(r){throw e=n,r}};return e=n,()=>e()}function L(){throw new TypeError("Recurrent evaluation")}function U(t){return"function"==typeof t}function j(t,...e){return U(t)?t(...e):t}function q(t){return U(t)?t:M(t)}function W(t,e,n,r,s){let o,i;if(void 0!==s?(o=r?Math.max(r,0):0,i=null!=s?s:Math.max(t.length,e.length)):null!=r?(o=0,i=r):(o=0,i=Math.max(t.length,e.length)),(t.length<=i||e.length<=i)&&t.length!==e.length)return!1;for(let u=o;u<i;++u)if(!n(t[u],e[u],u))return!1;return!0}function I(t){const e=Array.from(t),{length:n}=e;if(n)return 1===n?e[0]:e}function V(t){return P(t)?new Set(t):null!=t?new Set([t]):new Set}function G(t,e){return P(e)?e.forEach((e=>t.add(e))):null!=e&&t.add(e),t}function H(t,e=(()=>!0)){const n=Reflect.getPrototypeOf(t.prototype);if(null==n)return;const r=n.constructor;return e(r)?r:H(r,e)}function K(t){return t}function Q(t){let e=t.length;for(;e>0;){const n=e-1;if(void 0!==t[n])break;e=n}return e}function J(t,e,n=((t,e)=>e)){return t?e?function(...r){return n(t.apply(this,r),e.apply(this,r))}:t:e}function Z(){}const X=Object.prototype.hasOwnProperty;function Y(t,e){return X.call(t,e)}function tt(t){return null!=t}function et(t){return void 0!==t}function nt(t){return rt(t)?t.applyAmendment:t}function rt(t){return"function"==typeof t.applyAmendment}function st(t){return!!t&&("object"==typeof t||"function"==typeof t)&&rt(t)}function ot(t){return ot}function it(t){if(Array.isArray(t)&&t.length<2){const[e=ot]=t;return nt(e)}return e=>{let n=t=>{const r=t=>{const s=e.amend(t);return n=t=>{const e=s();return nt(t)(c(u({},e),{amend:r})),e},()=>c(u({},s()),{amend:r})};nt(t)(c(u({},e),{amend:r}))};for(const r of t)n(r)}}function ut(t){const{base:e,amend:n}=t,r=t=>{const e=t();return c(u({},e),{amend(t){const s=N(n(e,t)||(()=>function(t,e){return u(u({},t),e)}(e,t)));return()=>r(s)}})};return r(M(e))}function ct(t){return ut({base:t,amend:at(t)})}function at({amend:t}){return t?(e,n)=>t(n):Z}function ht(...t){const e=it(t),n=t=>e(ct(t)),r=t=>{n({amendedClass:t})};return r.applyAmendment=e,r.decorateAmended=n,r}const lt=new WeakSet;function dt(t){if(lt.has(t))return t;lt.add(t);const e=H(t);return e&&dt(e),Y(t,"autoAmend")?(t.autoAmend(ct({amendedClass:t})),t):t}function ft(t,e){return n=>{throw new TypeError(`${t.kind.pName} ${t.cls.name}${yt(e)} is not readable`)}}function pt(t,e){return(n,r)=>{throw new TypeError(`${t.kind.pName} ${t.cls.name}${yt(e)} is not writable`)}}const gt=/^[a-z_$][a-z0-9_$]*$/i;function yt(t){return"string"==typeof t?gt.test(t)?`.${t}`:`[${JSON.stringify(t)}]`:`[${String(t)}]`}function _t(t,e,n){const r=it(n),s=(e,n,s)=>{const o=t(e),[i,h,l]=function(t,e,n){if(n){const{get:r,set:s}=n;if(r||s)return[r?t=>r.call(t):ft(t,e),s?(t,e)=>s.call(t,e):pt(t,e),Z]}const r=Symbol(t.kind.vDesc(e));let s=t=>t[e],o=(t,n)=>{t[e]=n};const i=(t,e)=>{t[r]=e};let u;if(n&&("value"in n||"writable"in n)){const{value:c,writable:a}=n;a?u=()=>{s=t=>r in t?t[r]:t[r]=c,o=i}:(o=pt(t,e),u=Z)}else u=()=>{const n=Reflect.getPrototypeOf(t.host);s=null!=n?t=>r in t?t[r]:t[r]=Reflect.get(n,e,t):t=>t[r],o=i};return[t=>s(t),(t,e)=>o(t,e),u]}(o,n,s),d={enumerable:!s||!!s.enumerable,configurable:!s||!!s.configurable,readable:!s||!!s.get,writable:!s||!!s.set||!!s.writable,get:t=>i(t),set:(t,e)=>h(t,e)},f=function(t,e,n,r){return s=>{const o=u({},r);return e(ut({base:u(c(u({},s),{key:n}),r),amend(e,r={}){const i=r,{key:h,enumerable:l=o.enumerable,configurable:d=o.configurable,readable:f,writable:p,get:g,set:y}=i,_=a(i,["key","enumerable","configurable","readable","writable","get","set"]),m=s.amend(_);let w,b,{get:v,set:x}=r;return x?v?(w=!0,b=!0):(v=ft(t,n),w=!1,b=!0):v?(x=pt(t,n),b=!1,w=!0):({readable:w,writable:b,get:v,set:x}=o),o.configurable=d,o.enumerable=l,o.readable=w,o.writable=b,o.get=v,o.set=x,()=>c(u({},m()),{key:n,enumerable:l,configurable:d,readable:w,writable:b,get:v,set:x})}})),o}}(o,r,n,d);let p;ht((t=>{p=f(t)})).decorateAmended(e);const{enumerable:g,configurable:y,get:_,set:m}=p;let w;return m!==d.set||_!==d.get?(w={enumerable:g,configurable:y,get(){return _(this)},set(t){m(this,t)}},l()):g===d.enumerable&&y===d.configurable||(w=s&&(s.get||s.set)?c(u({},s),{enumerable:g,configurable:y}):c(u({},s),{enumerable:g,configurable:y,writable:p.writable})),w&&!s&&Reflect.defineProperty(o.host,n,w),w},o=(t,n,r)=>{const o={amendedClass:e(t)};return s(o,n,r)};return o.decorateAmended=s,o.applyAmendment=r,o}const mt={pName:"Property",vDesc:t=>`valueOf(${String(t)}`};function wt({amendedClass:t}){return{kind:mt,cls:t,host:t.prototype}}function bt(t){return t.constructor}class vt{name(t,e){if("string"==typeof t)return t;const[n,r]=t;return r.name(e(r),n,this)}}class xt extends vt{applyAlias(t,e){return`${e}-${t}`}}const St=new xt,At=new xt;class Ct extends vt{applyAlias(t,e){return`${t}@${e}`}}const $t=new Ct;class kt{constructor(t,...e){this.url=t,this.aliases=e}get alias(){return this.aliases[0]||"ns"}name(t,e,n=St){return n.applyAlias(e,t,this)}}function Rt(t){return Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&function(t){if(t instanceof kt)return!0;return"object"==typeof t&&"string"==typeof t.url&&"string"==typeof t.alias&&Array.isArray(t.aliases)&&"function"==typeof t.name}(t[1])}function Ot(t){return"string"==typeof t||Rt(t)}const Dt={perContext:D(k,R({create:(t,e)=>t,byDefault:t=>Tt(),assign:({get:t,to:e},n)=>{const r=e=>t()(e);return t=>e(((e,n)=>t(r,n)))}})),toString:()=>"[NamespaceAliaser]"};function Tt(){const t=new Map,e=new Map;return function(n){const r=t.get(n.url);if(r)return r;const s=n.alias;let o=0;for(const u of[s,...n.aliases]){const r=e.get(u);if(!r)return t.set(n.url,u),e.set(u,1),u;o||(o=r)}const i=`${s}${++o}`;return t.set(n.url,i),e.set(s,o),i}}class Et{constructor(t){this.reason=t}get isOff(){return!0}off(t,e){}whenOff(t,e){e(this.reason)}}const Pt=new Et(void 0);const Ft=Symbol("SupplyState");let Bt=Mt;function Mt(t){console.error("Supply aborted unexpectedly.",t)}let zt,Nt=0;class Lt{get isOff(){return!1}off(t,e){if(t[Ft]=function(t){return void 0===t?Pt:new Et(t)}(e),Nt)this.cb(e);else{Nt=1;try{this.cb(e)}finally{Nt=0,function(){const t=zt;if(t){zt=void 0;for(const e of t)Bt(e)}}()}}}}class Ut extends Lt{constructor(t){super(),this.cbs=t}whenOff(t,e){this.cbs.push(e)}cb(t){for(const e of this.cbs)e(t)}}class jt extends Lt{constructor(t){super(),this.cb=t}whenOff(t,e){t[Ft]=new Ut([this.cb,e])}}class qt extends Lt{whenOff(t,e){t[Ft]=new jt(e)}cb(t){!function(t){void 0!==t&&(zt||(zt=new Set),zt.add(t))}(t)}}const Wt=new qt;class It{constructor(t){this[Ft]=t?new jt(t):Wt}static onUnexpectedAbort(t){!function(t=Mt){Bt=t}(t)}get supply(){return this}get isOff(){return this[Ft].isOff}off(t){return this[Ft].off(this,t),this}whenOff(t){return this[Ft].whenOff(this,t),this}whenDone(){return new Promise(((t,e)=>this.whenOff((n=>void 0===n?t():e(n)))))}cuts(t){return t.supply.needs(this),this}derive(t){return(t?t.supply:new It).needs(this)}needs(t){return t.supply.whenOff((t=>this.off(t))),this}require(t){return(t?t.supply:new It).cuts(this)}as(t){return this.needs(t).cuts(t)}}class Vt extends It{get isOff(){return!1}off(t){return this}whenOff(t){return this}cuts(t){return this}needs(t){return this}}const Gt=new Vt;function Ht(){return Gt}function Kt(t){return t===Gt}class Qt extends It{get isOff(){return!0}off(){return this}whenOff(t){return t(),this}cuts(t){return t.supply.off(),this}needs(t){return this}}const Jt=new Qt;function Zt(){return Jt}const Xt=Symbol("after-event");function Yt(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t[Xt]}function te(t){let e,n;return"function"==typeof t?(e=new It,n=(e,...n)=>t(...n)):(e=t.supply||new It,n=(n,...r)=>{e.isOff||t.receive(n,...r)}),e.whenOff((()=>n=ee)),{supply:e,receive:(t,...e)=>n(t,...e)}}function ee(t,...e){}function ne(t){let e=function n(r){let s=t;const o=[];e=t=>o.push(t);try{for(;;){s=re(s,r);const t=o.shift();if(!t)break;r=t}}finally{e=n}};return(...t)=>e(t)}function re(t,e){const n=[];for(const r of t){const t=n.length;n.push(r);const s={onRecurrent(e){n[t]=te({supply:r.supply,receive(t,...n){e(...n)}})}};r.receive(s,...e)}return n}class se{constructor(){const t=this._rcs=new Set;this.send=ne(t),this.supply=new It((()=>{t.clear(),delete this._rcs}))}get size(){return this._rcs?this._rcs.size:0}on(t){const e=te(t),n=e.supply.needs(this),r=this._rcs;return r&&!n.isOff&&(r.add(e),n.whenOff((()=>r.delete(e)))),n}}const oe=Symbol("on-event");function ie(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t[oe]}class ue extends TypeError{constructor(t="No events to send"){super(t)}}function ce(t){const e=te(t);let n=ne([e]);return e.supply.whenOff((()=>n=Z)),(...t)=>n(...t)}function ae(){throw new ue}function he(t,e){return({supply:n,receive:r})=>{let s=Zt();t({supply:n,receive:(t,...o)=>{const i=s,u=e(...o);s=u?u({supply:new It((t=>{t!==he&&n.off(t)})).needs(n),receive:r}):Zt(),i.off(he)}})}}function le(...t){return t.reduce(((t,e)=>e(t)),this)}function de(){return this}function fe(t){return({supply:e,receive:n})=>{t({supply:e,receive:(t,...r)=>{n(t,...r),e.off()}})}}function pe(t,e){return new Promise(((n,r)=>{fe(this)({supply:new It(e?t=>{try{n(e(t))}catch(s){r(s)}}:r),receive:t?(e,...s)=>{try{n(t(...s))}catch(o){r(o)}}:(t,e)=>n(e)})}))}function ge(t){const e=new ye(t);return e.on.bind(e)}class ye extends se{constructor(t){super(),this.supplier=t,this._on=this._onInit()}on(t){return this._on.on(t),t.supply}_onInit(){return{on:t=>{const e=[],n=new It((()=>this._on=this._onInit())),r=this._on=this._onFirst(n,e);try{r.on(t),this.supplier({supply:n,receive:(t,...e)=>this._on.dispatch(...e)})}finally{this._on===r&&(this._on=this._onNext(n,e))}},dispatch:null}}_onFirst(t,e){return{on:n=>this._addReceiver(n,t,e),dispatch:(...t)=>{e.push(t),this.send(...t)}}}_onNext(t,e){return{on:n=>this._addReceiver(n,t,e),dispatch:(...t)=>{e.length=0,this.send(...t)}}}_addReceiver(t,e,n){if(e.cuts(t),super.on(t).whenOff((t=>{this.size||e.off(t)})),n.length){const e=ce(t);n.forEach((t=>e(...t)))}}}function _e(t,e,n){return r=>{n?t({supply:(new It).needs(e).cuts(n),receive:r.receive}):(r.supply.needs(e),t(r))}}function me(t,e){return n=>{const r=ce(n);t({supply:n.supply,receive:(t,...n)=>{e(r,...n)}})}}function we({supply:t}){t.off()}function be(t){const e=e=>{const n=te(e),{supply:r}=n;if(!r.isOff)try{t(n)}catch(s){r.off(s)}return r};return e[oe]=de,e.do=le,e.then=pe,e}function ve(t,e=ae,n=xe){let r,s=0;const o=o=>{let i=Z;const u=te(o);if(u.supply.isOff)return u.supply;const c=new It(Z).needs(u);let a=!1;++s;try{t({supply:c,receive:(t,...e)=>{a=!0,r=e,i(t,...e)}})}catch(h){c.off(h)}if(!c.isOff||a){if(!r)try{r=e()}catch(h){c.off(h)}r&&(u.receive({onRecurrent(t){i=(e,...n)=>t(...n)}},...r),i=(t,...e)=>u.receive(t,...e))}return c.whenOff((t=>{--s||(r=void 0),u.supply.off(t),s||n(t)}))};return o[oe]=de,o.do=le,o.then=pe,o[Xt]=de,o}function xe(t){}function Se(t){return function(t){return"function"==typeof t&&t[oe]===de&&t.do===le&&t.then===pe}(t)&&t[Xt]===de}function Ae(t){const e=Object.keys(t);return ve(ge(ve((n=>{const{supply:r}=n,s=ce(n);let o=Z;const i={};e.forEach((e=>{r.needs(t[e][Xt]()(((...t)=>{i[e]=t,o()})).needs(r))})),r.isOff||(o=()=>s(i))}),(()=>{const n={};return e.forEach((e=>fe(t[e][Xt]())({supply:new It,receive:(t,...r)=>n[e]=r}))),[n]}))))}function Ce(...t){return ve(ge(ve((e=>{const{supply:n}=e,r=ce(e);let s=Z;const o=[];t.forEach(((t,e)=>{n.needs(t[Xt]()(((...t)=>{o[e]=t,s()})).needs(n))})),n.isOff||(s=()=>r(...o))}),(()=>{const e=[];return t.forEach((t=>fe(t[Xt]())({supply:new It,receive:(t,...n)=>e.push(n)}))),e}))))}function $e(t,e){return ve((e=>t[oe]()(e)),e)}function ke(t,e){return Yt(t)?t[Xt]():$e(t,e)}function Re(...t){return ve(Z,M(t))}function Oe(t){return Se(t)?t:Re(t)}function De(t){return e=>{let n=Zt();const r=new It((t=>n.off(t)));return e({supply:r,receive(e,...r){const s=n;try{n=(t(...r)||Zt()).supply}finally{n!==s&&s.off()}}}),r}}function Te(t){return ve(ge(t))}let Ee,Pe;function Fe(t,e){return t||e?Be(t,e):Ee||(Ee=Be())}function Be(t,e){const n=Me(t,e);return t=>Te(n(t))}function Me(t,e){return t||e?Ne(t,e):Pe||(Pe=Ne())}const ze={};function Ne(t=Le,e=K){return n=>{let r=ze;return ve((({supply:s,receive:o})=>n({supply:s,receive(n,...s){const i=e(s);r!==ze&&t(r,i)||(r=i,o(n,...s))}})),void 0,(t=>r=ze))}}function Le(t,e){return n=t,r=e,"function"==typeof(s=Math.max(Q(t),Q(e)))?W(n,r,s,o,i):W(n,r,B,s,o);var n,r,s,o,i}function Ue(t,e){const n=je(t,e);return t=>Te(n(t))}function je(t,e){const n=(...e)=>{const n=t(...e);return n&&ke(n)};return t=>ve(he(t,n),e)}class qe extends se{constructor(){super(...arguments),this.on=be((t=>super.on(t)))}[oe](){return this.on}}const We=be(we);function Ie(t){return ie(t)?t[oe]():t[Xt]()}function Ve(...t){return t.length?be(ge(be((({supply:e,receive:n})=>{let r=t.length;const s=t=>{--r||e.off(t)};t.forEach((t=>Ie(t)({supply:new It(s).needs(e),receive:n})))})))):We}function Ge(t){let e=n=>{t.then((()=>e(n)),(()=>e(n)))};return t.then((t=>{e=function(t){return e=>{try{ce(e)(t),e.supply.off()}catch(n){e.supply.off(n)}}}(t)})).catch((t=>{var n;n=t,e=({supply:t})=>t.off(n)})),be((t=>e(t)))}function He(t){return be(ge(t))}function Ke(t){const e=(...e)=>{const n=t(...e);return n&&Ie(n)};return t=>be(he(t,e))}function Qe(t){const e=Je(t);return t=>He(e(t))}function Je(t){return e=>be(me(e,t))}function Ze(t,e){const n=Xe(t,e);return t=>Te(n(t))}function Xe(t,e){return n=>ve(me(n,((e,...n)=>e(t(...n)))),e&&(()=>[e()]))}function Ye(t){const e=tn(t);return t=>He(e(t))}function tn(t){return e=>be(me(e,((e,...n)=>e(t(...n)))))}function en(t){return ve(fe(t))}function nn(t){return be(fe(t))}function rn(t,e){return Kt(t.supply)?K:n=>be(_e(n,t,e))}function sn(t){return be((e=>{const{supply:n}=e,r=ce(e),s=new It;let o=0;const i=t.do(rn(n,s),Ye((t=>(++o,t))));let u=[],c=1,a=0;s.whenOff((t=>{o||n.off(t)})),function(t){return be((e=>{const{supply:n}=e,r=ce(e);let s=0;t({supply:n,receive(t,e){const o=++s;Promise.resolve().then((()=>e)).then((t=>r(t,o)),(t=>n.off(t)))}})}))}(i)({supply:n,receive(t,e,i){const h=i-c;if(u[h]=e,++a,a>h){let t;a===u.length?(t=u,u=[]):t=u.splice(0,h+1),c+=t.length,a-=t.length,o-=t.length,r(...t),!o&&s.isOff&&n.needs(s)}}})}))}function on(t,e){return Kt(t.supply)?K:n=>ve(_e(n,t,e))}function un(t,e){const n=cn(t,e);return t=>Te(n(t))}function cn(t,e){return n=>ve(me(n,t),e)}function an(t){const e=hn(t);return t=>He(e(t))}function hn(t){return Je(((e,...n)=>{const r=t(...n);null!=r&&!1!==r&&e(r)}))}function ln(t){return Array.isArray(t)?t:[t]}class dn{constructor(t){this._drop=t,this.emitter=new qe,this._nested=new Map,this.emitter.on(((t,e,n)=>{const r=t[0],s=this._nested.get(r);s&&s.emitter.send(t.slice(1),e,n)}))}on(t){const e=this.emitter.on(t);return new It((t=>{e.off(t),this._dropIfEmpty()})).needs(e)}nest(t,e){const n=this._nested.get(t);if(n||e)return n;const r=new dn((()=>this._remove(t)));return this._nested.set(t,r),r}done(t){for(const e of this._nested.values())e.done(t);this.emitter.supply.off(t)}_remove(t){this._nested.delete(t),this._dropIfEmpty()}_dropIfEmpty(){!this._nested.size&&this.emitter.size<=1&&this._drop()}}class fn{constructor(){this._root=new dn(Z)}on(t,e){return this._entry(t).on(e)}send(t,e,n){this._root.emitter.send(t,e,n)}done(t,e){const n=this._entry(t,!0);n&&n.done(e)}_entry(t,e){let n=this._root;for(const r of t){const t=n.nest(r,e);if(!t)return;n=t}return n}}class pn{constructor(t,e){this._trackers=t,this._path=e,this.onUpdate=be((t=>this._trackers.on(this._path,t))),this.update=(t,e,n)=>{this._trackers.send([...this._path,...ln(t)],e,n)}}get _tracker(){return this}[oe](){return this.onUpdate}track(t){return(t=ln(t)).length?new pn(this._trackers,[...this._path,...t]):this}done(t){this._trackers.done(this._path,t)}}class gn{constructor(){this._tracker=new pn(new fn,[])}get onUpdate(){return this._tracker.onUpdate}[oe](){return this.onUpdate}get update(){return this._tracker.update}track(t){const e=this._tracker.track(t);return e===this._tracker?this:e}done(t){this._tracker.done(t)}}class yn{constructor(){this._by=Zt(),this.read=ve((t=>{return this.on({supply:(e=t).supply,receive(t,n){e.receive({onRecurrent(e){t.onRecurrent((t=>e(t)))}},n)}});var e}),(()=>[this.it]))}[oe](){return this.on}[Xt](){return this.read}by(t,e){const n=t=>(Yt(t)?t[Xt]():t[oe]())((t=>this.it=t));if(this.byNone(),e){const r=t;this._by=Ie(r).do(De(((...t)=>{const r=e(...t);if(r)return n(r)})))}else{const e=t;this._by=n(e)}return this._by.whenOff((()=>this._by=Zt())),this}byNone(t){return this._by.off(t),this}}class _n extends yn{constructor(t){super(),this._it=t,this._on=new qe}get supply(){return this._on.supply}get on(){return this._on.on}get it(){return this._it}set it(t){const e=this._it;e!==t&&(this._it=t,this._on.send(t,e))}}function mn(t){return new _n(t)}class wn extends yn{constructor(t){super(),this._on=new qe,this._it=t}get on(){return this._on.on}get supply(){return this._on.supply}get it(){return this._it}set it(t){const e=this.it;e!==t&&(this._it=t,this._on.send(t,e))}sync(t,e,n){let r,s,o=t=>c(this,t);"string"==typeof t?("in"===t&&(o=t=>c(t,this)),r=e,s=n):(r=t,s=e);const i=s;if(!i)return o(r);const u=r;return(Yt(u)?ke(u):Ie(u)).do(De(((...t)=>{const e=i(...t);return e&&o(e)})));function c(t,e){const n=t.read((t=>{e.it=t})),r=e.on((e=>{t.it=e}));return new It((t=>{r.off(t),n.off(t)})).needs(n).needs(r)}}}const bn=be(Z);const vn={onRecurrent:Z};class xn{constructor(t){this.supply=new It,this._target=t}on(t){return function(t){const e=(e,n)=>{const r=te(e),{supply:s}=r;return s.isOff||t(r,n),s};return e[oe]=bn[oe],e.do=bn.do,e.then=bn.then,e}(((e,n)=>{const{supply:r}=e;if(r.needs(this),!r.isOff){const r=t=>e.receive(vn,t);this._target.addEventListener(t,r,n),e.supply.whenOff((()=>this._target.removeEventListener(t,r)))}}))}dispatch(t){return!this.supply.isOff&&this._target.dispatchEvent(t)}}function Sn(t){return t.ownerDocument||t}function An(t){return 1===t.nodeType}function Cn(t,e,n,r=$n){let s;"function"==typeof n?(r=n,s=null):s=n||null;const o=Sn(e);if(An(t)){const n=o.createElement(t.tagName.toLowerCase());return t.getAttributeNames().forEach((e=>n.setAttribute(e,t.getAttribute(e)))),r(t,n),e.insertBefore(n,s),n}const i=o.importNode(t,!1);return e.insertBefore(i,s),i}function $n(t,e){for(let n=0;n<t.childNodes.length;++n)Cn(t.childNodes[n],e)}function kn(t){const{parentNode:e}=t;return e&&An(e)&&e||t.getRootNode().host||void 0}function Rn(t){return Sn(t).defaultView||window}const On={by(t={}){let e;const{error:n=console.error}=t;return{get node(){return t.node},get window(){return e||(e=t.window||(t.node?Rn(t.node):window))},error:n}}},Dn=Symbol("render-q");class Tn{constructor(t,e){this.q=t,this.schedule=this.doSchedule,this.ref=e||[this,this],this.execute=t.recur?this.execRecurring:this.execNonRecurring}static by(t,e){return t[Dn]||(t[Dn]=new Tn(t,e))}add(t){this.q.add(t)}doSchedule(t){this.schedule=En;const e=[],n={get config(){return t},postpone(t){e.unshift(t)}};this.q.schedule((()=>{const t=this.reset();t.suspend(),this.execute(n,(()=>{this.ref[1]=this.ref[0],e.forEach((t=>this.q.add(t))),n.postpone=t=>this.q.post(t),this.exec(n),t.resume()}))}))}exec(t){for(;;){const e=this.q.pull();if(!e)break;e(t)}}execNonRecurring(t,e){this.exec(t),e()}execRecurring(t,e){const n=()=>{this.exec(t),this.q.recur(n)||e()};n()}reset(){return this.ref[0]=Tn.by(this.q.reset(),this.ref)}suspend(){this.schedule=t=>{this.scheduled=t,this.schedule=En}}resume(){this.scheduled?this.doSchedule(this.scheduled):this.schedule=this.doSchedule}}function En(t){}function Pn(t){return e=>{const n=On.by(e),r=Tn.by(t.newQueue(n)).ref;let s=[];return t=>{const[e,,o]=s,[i,u]=r;let c=e||u;if(e===u&&!o||e===i)s[1]=t;else{const e=s=[c=!o||c.q.recur?u:i,t];c.add((t=>{e[2]=!0;try{e[1]({get config(){return n},postpone(e){t.postpone(e)}})}catch(r){n.error(r)}}))}c.schedule(n)}}}const Fn={by(t){const{schedule:e,recur:n}=t;let r,{replace:s=Bn}=t,o=[],i=o;if(n){r=t=>o.length?(i=o,o=[],n(t),!0):(o=i,!1);const t=s;s=e=>{o=[],t(e)}}return{add(t){o.push(t)},post(t){o.unshift(t)},pull:()=>i.shift(),schedule:e,recur:r,reset(){const e=Fn.by(t);return s(e),e}}}};function Bn(t){}const Mn=new WeakMap,zn=Pn({newQueue({window:t}){const e=Mn.get(t);if(e)return e;const n=Fn.by({schedule:e=>t.requestAnimationFrame(e),replace:e=>Mn.set(t,e)});return Mn.set(t,n),n}});function Nn(t){Promise.resolve().then(t)}let Ln=Fn.by({schedule:Nn,recur:Nn,replace:t=>Ln=t});const Un=Pn({newQueue:()=>Ln}),jn={perContext:C({byDefault:()=>window}),toString:()=>"[CxWindow]"};let qn=zn;function Wn(t){return qn(t)}function In(t){}const Vn=t=>In;function Gn({byDefault:t=(t=>Wn)}={}){return R({create:(t,e)=>t,byDefault:t,assign({track:t,to:e},n){const r=n.get(jn),s=function(t){const e=e=>{let n=t,r=t(e);return s=>{n!==t&&(n=t,r=t(e)),r(s)}};return e.scheduleBy=n=>(t=n,e),e}(Vn);t((t=>s.scheduleBy(t))).whenOff((t=>s.scheduleBy(d(n.entry,void 0,t))));const o=(t={})=>{const{node:e,window:n=(e?Rn(e):r)}=t;return s(c(u({},t),{window:n}))};return t=>e(((e,n)=>t(o,n)))}})}const Hn=t=>{const e=On.by(t);return t=>{const n=[],r={get config(){return e},postpone(t){n.push(t)}};for(s(t);;){const t=n.pop();if(!t)break;s(t)}function s(t){try{t(r)}catch(n){e.error(n)}}}},Kn={perContext:D(k,Gn({byDefault:t=>Un})),toString:()=>"[PreRenderScheduler]"};let Qn=Fn.by({schedule:t=>t(),replace:t=>Qn=t});const Jn=Pn({newQueue:()=>Qn}),Zn={perContext:D(k,Gn()),toString:()=>"[RenderScheduler]"},Xn=Symbol("push-iterator");function Yn(t){return!!t[Xn]}function tr(t){return t[Symbol.iterator]()}function er(t){return{[Symbol.iterator]:nr,[Xn]:t}}function nr(){return this[Xn]()}function rr(t,e){return!t[Xn](e).isOver()}function sr(t){let e=!1,n=r=>{r&&!t(r)&&(e=!0,n=cr)};return{[Symbol.iterator]:or,[Xn](t){return n(t),this},next:ir,isOver:()=>e}}function or(){return this}function ir(){for(;;){let t;const e=!rr(this,(e=>(t={value:e},!0)));if(t)return t;if(e)return{done:!0}}}function ur(){return{done:!0}}function cr(t){}const ar={[Symbol.iterator]:or,[Xn](t){return this},next:()=>({done:!0}),isOver:()=>!0};function hr(t,e){return t[Xn](e)}function lr(t,e){return n=>{let r=0;const s=n=>{if(r>=t.length)return!1;for(;;){const s=n(e(t,r++));if(r>=t.length||!1===s)return!1;if(!0===s)return!0}};if(n&&!s(n))return ar;let o=!1,i=t=>{t&&!s(t)&&(o=!0,i=cr,u=ur)},u=()=>r<t.length?{value:e(t,r++)}:(o=!0,i=cr,u=ur,{done:!0});return{[Symbol.iterator]:or,[Xn](t){return i(t),this},next:()=>u(),isOver:()=>o}}}function dr(t,e){return t[e]}function fr(t){return lr(t,dr)}function pr(t){return er(fr(t))}function gr(t,e){if(Yn(t))return rr(t,e);const n=tr(t);if(Yn(n))return rr(n,e);for(;;){const t=n.next();if(t.done)return!1;const r=e(t.value);if("boolean"==typeof r)return r}}function yr(t,e){gr(t,(t=>{e(t)}))}const _r=t=>t;function mr(t,e=_r){if(Yn(t))return wr(t,e);const n=tr(t);return Yn(n)?wr(n,e):Array.from(t,e)}function wr(t,e){const n=[];return rr(t,(t=>{n.push(e(t))})),n}function br(t,e){let n=!0;return gr(t,(t=>{if(n=!!e(t),!n)return!1})),n}function vr(t){let e;return rr(t,(t=>(e=t,!1))),e}function xr(t,e){let n=!1,r=t=>{(n=!!t&&!e(t))&&(r=cr,s=ur)},s=()=>{const e=t.next();return e.done&&(n=!0,r=cr,s=ur),e};return{[Symbol.iterator]:or,[Xn](t){return r(t),this},next:()=>s(),isOver:()=>n}}function Sr(t){return e=>{for(;;){const n=t.next();if(n.done)return!1;const r=e(n.value);if("boolean"==typeof r)return r}}}function Ar(t,e){return Yn(t)?hr(t,e):Array.isArray(t)?function(t,e){return t.length?fr(t)(e):ar}(t,e):function(t,e){const n=tr(t);if(Yn(n))return hr(n,e);const r=Sr(n);return r(e)?xr(n,r):ar}(t,e)}function Cr(t){const e=tr(t);return Yn(e)?e:xr(e,Sr(e))}function $r(t,e,n){let r=n;return gr(t,(t=>{r=e(r,t)})),r}function kr(){return ar}function Rr(t){return er(function(t){return e=>{const n=t();if(Yn(n))return n[Xn](e);const r=Sr(n);return e&&!r(e)?kr():xr(n,r)}}(t))}function Or(...t){return t.length>1?er(function(t){return e=>{let n=0,r=t[0];const s=e=>{for(;;){let s;const o=Ar(r,(t=>s=e(t)));if(o.isOver()){if(++n>=t.length)return!1;r=t[n]}else r=o;if("boolean"==typeof s)return s}};return e&&!s(e)?kr():sr(s)}}(t)):t.length?(e=t[0],Array.isArray(e)?pr(e):Rr((()=>tr(e)))):kr();var e}function Dr(t){return er(function(t){return e=>{if(e)return e(t),kr();let n=!1;return{[Symbol.iterator]:or,[Xn](e){return n?kr():e?(n=!0,e(t),kr()):this},next:()=>n?{done:n}:(n=!0,{value:t}),isOver:()=>n}}}(t))}function Tr(t){return er(function(t){return e=>{let n=t.length-1;const r=e=>{if(n<0)return!1;for(;;){const r=e(t[n--]);if(n<0)return!1;if("boolean"==typeof r)return!0}};if(e&&!r(e))return kr();let s=!1,o=t=>{t&&!r(t)&&(s=!0,o=cr,i=ur)},i=()=>n<0?(s=!0,o=cr,i=ur,{done:!0}):{value:t[n--]};return{[Symbol.iterator]:or,[Xn](t){return o(t),this},next:()=>i(),isOver:()=>s}}}(t))}function Er(t){return pr(Reflect.ownKeys(t))}function Pr(t,e){return er(function(t,e,n){return r=>{let s=0;const o=r=>{for(;;){if(s>=t.length)return!1;const o=e(t,s++);if(n(o)){const t=r(o);if("boolean"==typeof t)return t}}};if(r&&!o(r))return kr();let i=!1,u=t=>{t&&!o(t)&&(i=!0,u=cr,c=ur)},c=()=>{for(;;){if(s>=t.length)return i=!0,u=cr,c=ur,{done:!0};const r=e(t,s++);if(n(r))return{value:r}}};return{[Symbol.iterator]:or,[Xn](t){return u(t),this},next:()=>c(),isOver:()=>i}}}(t,dr,e))}function Fr(t,e){return er((n=>{const r=Yn(t)?Br(t,e):function(t,e){const n=tr(t);if(Yn(n))return Br(n,e);return t=>{for(;;){const r=n.next();if(r.done)return!1;const s=r.value;if(e(s)){const e=t(s);if("boolean"==typeof e)return e}}}}(t,e);return n&&!r(n)?kr():sr(r)}))}function Br(t,e){return n=>{const r=hr(t,(t=>{if(e(t))return n(t)}));return t=r,!r.isOver()}}function Mr(t,e){return er((n=t,r=e?(t,n)=>e(t[n]):zr,t=>{let e,s=0;const o=t=>{if(s>=n.length)return!1;for(e||(e=r(n,s));;){let o;const i=Ar(e,(e=>o=t(e)));if(i.isOver()){if(++s>=n.length)return!1;e=r(n,s)}else e=i;if("boolean"==typeof o)return o}};return t&&!o(t)?kr():sr(o)}));var n,r}function zr(t,e){return t[e]}function Nr(t,e=Ur){return er((n=>{const r=Yn(t)?Lr(t,e):function(t,e){const n=tr(t);if(Yn(n))return Lr(n,e);let r;return t=>{for(;;){if(!r){const t=n.next();if(t.done)return!1;r=e(t.value)}let s;const o=Ar(r,(e=>s=t(e)));if(r=o.isOver()?void 0:o,"boolean"==typeof s)return s}}}(t,e);return n&&!r(n)?kr():sr(r)}))}function Lr(t,e){let n,r=!1;return s=>{for(;;){for(;!n;){const s=hr(t,(t=>(n=e(t),!0)));if(t=s,s.isOver()){if(!n)return!1;r=!0}}let o;const i=Ar(n,(t=>o=s(t)));if(i.isOver()){if(n=void 0,r)return!1}else n=i;if("boolean"==typeof o)return o}}}function Ur(t){return t}function jr(t,e){return er((n=>{const r=Yn(t)?qr(t,e):function(t,e){const n=tr(t);if(Yn(n))return qr(n,e);return t=>{for(;;){const r=n.next();if(r.done)return!1;const s=t(e(r.value));if("boolean"==typeof s)return s}}}(t,e);return n&&!r(n)?kr():sr(r)}))}function qr(t,e){return n=>{const r=hr(t,(t=>n(e(t))));return t=r,!r.isOver()}}function Wr(t,e){return er((n=>{const r=Yn(t)?Ir(t,e):function(t,e){const n=tr(t);if(Yn(n))return Ir(n,e);return t=>{for(;;){const r=n.next();if(r.done)return!1;const s=e(r.value);if(null!=s&&!1!==s){const e=t(s);if("boolean"==typeof e)return e}}}}(t,e);return n&&!r(n)?kr():sr(r)}))}function Ir(t,e){return n=>{const r=hr(t,(t=>{const r=e(t);if(null!=r&&!1!==r)return n(r)}));return t=r,!r.isOver()}}function Vr(t){return jr(Er(t),(e=>[e,t[e]]))}function Gr(t,e,n){return{entry:t,buildAsset(t){const n=e(t);return null!=n&&(t=>t(n))},supply:n}}function Hr(t,e,n){return{entry:t,placeAsset:null!=e?(t,n)=>n(e):Kr,supply:n}}function Kr(t,e){}function Qr(t,e,n=new It){return{entry:t,buildAsset(t,r){let s=[],o=Z;return e(t,((...t)=>{s=t,o()}),(new It).needs(n).needs(t)),o=r,t=>{for(const e of s)if(!1===t(e))break}},supply:n}}class Jr{constructor(t,e){this._cb=t,this._cache=e}get supply(){return this._cb.supply}get rankCount(){return this._cb.rankCount}eachAsset(t,e,n){const r=this._cb._record(t.entry);r.eachAsset(r.target,this._cache,n)}eachRecentAsset(t,e,n){const r=this._cb._record(t.entry);r.eachRecentAsset(r.target,this._cache,n)}trackAssets(t,e,n,r){const s=this._cb._record(t.entry);return s.trackAssets(s.target,this._cache,n,r)}}class Zr{constructor(){this._=new Map}get(t){return this._.get(t)}put(t,e,n){this._.set(t,e),n.whenOff((()=>this._.delete(t)))}}const Xr={get:Z,put:Z};function Yr(t){}class ts{constructor(t,e,n,r){this._target=t,this._cache=e,this._placer=n,this.supply=r,this._getRecent=this._evalRecent(),this._getRecent=this._evalRecent()}get rank(){return 0}get recentAsset(){return this._getRecent()}eachAsset(t){this._placer.place(this._target,this._cache,t)}eachRecentAsset(t){const e=[];this.eachAsset((t=>{e.push(t)}));for(let n=e.length-1;n>=0&&!1!==t(e[n]);--n);}onUpdate(t,{supply:e=new It}={}){return this._placer.onUpdate({receive:e=>{this._getRecent=this._evalRecent(),t()},supply:e.needs(this.supply)})}_evalRecent(){return N((()=>{let t;return this.eachRecentAsset((e=>(t={asset:e,rank:this.rank,supply:this.supply},!1))),t}))}}class es{constructor(t,e){this.$=t,this.rank=e}get supply(){return this.$.supply}get recentAsset(){return this.$.recentAsset}eachAsset(t){return this.$.eachAsset(t)}eachRecentAsset(t){return this.$.eachRecentAsset(t)}onUpdate(t,e){return this.$.onUpdate(t,e)}}function ns(t,e){const n=mn([]);n.supply.needs(e).needs(t);const r=()=>n.it=[...n.it];return t.trackAssets((t=>{const{supply:e,rank:s}=t,o=[...n.it];for(let n=o.length;n<=s;++n)o[n]||(o[n]=new Map);o[s].set(e,t),n.it=o,e.whenOff((()=>((t,e)=>{const r=[...n.it];r[e].delete(t),n.it=r})(e,s))),t.onUpdate(r)}),n),n}function rs(t){for(const e of t){const t=mr(e.values());for(let e=t.length-1;e>=0;--e){const n=t[e].recentAsset;if(n)return n}}}class ss{constructor(t,e){this._record=t,this.supply=e}get entry(){return this._record.entry}get context(){return this._record.builder.context}get recentAsset(){let t;return this.eachRecentAsset((e=>(t=e,!1))),t}get(t,e){return this.context.get(t,e)}provide(t){return this._record.builder.provide(t).needs(this)}eachAsset(t){this._record.builder.eachAsset(this,this._record.cache,t)}eachRecentAsset(t){this._record.builder.eachRecentAsset(this,this._record.cache,t)}trackAssets(t,e){return this._record.builder.trackAssets(this,this._record.cache,t,e)}trackRecentAsset(t,{supply:e=new It}={}){return ns(this,e).read.do(Xe(rs),Me())(t)}trackAssetList(t,{supply:e=new It}={}){return ns(this,e).read.do(Xe((t=>mr(Nr(Tr(t),(t=>t.values()))))))(t)}lazy(t){return N((()=>t(this)))}}class os{constructor(t,e,n){this.builder=t,this.cache=e,this.entry=n,this.placers=new Map,this.senders=new Map,this.supply=(new It).needs(t.supply),this.target=new ss(this,(new It).needs(t.supply)),this.define=N((()=>n.perContext(this.target)))}provide(t){var e;const{supply:n=new It}=t;if(n.needs(this).isOff)return n;const r=function(t,e){if(t.placeAsset)return{onUpdate:We,place(e,n,r){t.placeAsset(e,r)}};if(t.buildAsset){const n={asset:t},r=new qe;return{onUpdate:r.on,place(s,o,i){let u=o.get(n);void 0===u&&(u=t.buildAsset(s,(()=>r.send()))||Yr,o.put(n,u,e)),u(i)}}}}(t,n);if(r){const t=(new It).as(n);this.placers.set(t,r),t.whenOff((()=>this.placers.delete(t)));for(const[e,s]of this.senders)this.sendAssets(s,r,(new It).needs(n).needs(e))}return null===(e=t.setupAsset)||void 0===e||e.call(t,new ss(this,n)),n}get(t={}){var e,n;const{by:r=0,or:s,set:o=is}=t,i=this.define();let u,c;if(r>=0){if(null===(e=i.assign)||void 0===e||e.call(i,((t,e=1)=>{u=e,c=t}),t),null!=u){if(u>=0)return o(c,u),c;if(r&&void 0===s)throw new l(this.entry,`No value provided for ${this.entry}`)}if(void 0!==s)return o(s,0),s}if(null==u&&(i.assignDefault?i.assignDefault(((t,e=-1)=>{u=e,c=t}),t):r<0&&(null===(n=i.assign)||void 0===n||n.call(i,((t,e=1)=>{u=e,c=t}),t))),null!=u){if(u<=0)return o(c,u),c;if(void 0===s){if(r<0)throw new l(this.entry,`The ${this.entry} has no default value`);return o(c,u),c}}if(r<0&&void 0!==s)return o(s,0),s;throw new l(this.entry)}eachAsset(t,e,n){if(t.supply.isOff)return;let r=!0;const s=e=>r=!t.supply.isOff&&!1!==n(e)&&!t.supply.isOff;for(const o of this.builder._peers)if(o.eachAsset(t,e,s),!r)return;for(const o of this.placers.values())if(o.place(t,e,s),!r)break}eachRecentAsset(t,e,n){if(t.supply.isOff)return;let r=!0;const s=e=>r=!t.supply.isOff&&!1!==n(e)&&!t.supply.isOff;for(const i of[...this.placers.values()].reverse())if(i.place(t,e,s),!r)return;const o=this.builder._peers;for(let i=o.length-1;i>=0;--i)if(o[i].eachRecentAsset(t,e,s),!r)return}trackAssets(t,e,n,{supply:r=new It}={}){const s={supply:r,receive(t,e){n(e)}},o=new qe;o.supply.needs(t),o.on(s);const i=[t,e,o];this.senders.set(r,i),r.whenOff((()=>this.senders.delete(r)));let u=1;const c=this.builder._peers;for(let a=c.length-1;a>=0;--a){const s=c[a],o=u;u+=s.rankCount,s.trackAssets(t,e,(t=>n(new es(t,o+t.rank))),r)}for(const[a,h]of this.placers)this.sendAssets(i,h,(new It).needs(a).needs(r));return r}sendAssets([t,e,n],r,s){n.send(new ts(t,e,r,s))}}function is(t,e){}class us{constructor(...t){this._records=new Map,this._supply=new It,this._rankCount=0,this._peers=t}get context(){throw new TypeError("Peer context is not available")}get rankCount(){return this._rankCount||(this._rankCount=this._peers.reduce(((t,e)=>t+e.rankCount),1))}get supply(){return this._supply}get cache(){return Xr}provide(t){return this._record(t.entry).provide(t)}eachAsset(t,e,n){this._record(t.entry).eachAsset(t,e,n)}eachRecentAsset(t,e,n){this._record(t.entry).eachRecentAsset(t,e,n)}trackAssets(t,e,n,r){return this._record(t.entry).trackAssets(t,e,n,r)}_record(t){let e=this._records.get(t);return e||this._records.set(t,e=new os(this,this.cache,t)),e}}class cs extends us{constructor(t,...e){super(...e),this._cache=new Zr,this._bound=N((()=>new Jr(this,this.cache))),this._cx=N((()=>t(((t,e)=>this.get(t,e)),this)))}get context(){return this._cx()}get cache(){return this._cache}get boundPeer(){return this._bound()}get(t,e){return this._record(t).get(e)}}let as=ds;function hs(t){}let ls=function t(e){const n=[e];ls=function(t){return e=>t.push(e)}(n),Promise.resolve().then((()=>{ls=t;for(const t of n)t.lift()})).catch(console.error)};function ds(t){ls(t)}function fs(t){const e=[],n=function(t){const e=as;return as=t,e===ds?()=>(as=e,hs):()=>as=e}((t=>e.push(t)));try{return t()}finally{const t=n();for(const n of e){n.lift()===n&&t(n)}}}const ps=Symbol("DrekPlacement.status");class gs{constructor(t){this.placement=t}onceConnected(){return(this.onceConnected=M(this.placement.readStatus.do((t=({connected:t})=>t,e=>be((n=>{let r=!1;e({supply:n.supply,receive(e,...s){const o=t(...s);(o||r!==o)&&(r=o,n.receive(e,...s))}})}))))))();var t}whenConnected(){return(this.whenConnected=M(this.onceConnected().do(nn)))()}}class ys{constructor(){this[ps]=new gs(this)}[Xt](){return this.readStatus}get onceConnected(){return this[ps].onceConnected()}get whenConnected(){return this[ps].whenConnected()}}class _s extends ys{get whenSettled(){return this.whenConnected}}const ms=Symbol("DrekContext");class ws{constructor({nsAlias:t,scheduler:e}){this._nsAlias=t,this.nsAlias=t=>this._nsAlias(t),this._scheduler=e,this.scheduler=t=>{let e=this._scheduler,n=e(t);return r=>(e!==this._scheduler&&(e=this._scheduler,n=e(t)),n(r))}}set({nsAlias:t,scheduler:e}){this._nsAlias=t,this._scheduler=e}}function bs(t){const e=t[ms];if(e)return e;const n=new ws({nsAlias:Tt(),scheduler:Wn}),r=t.defaultView||window,s=t=>n.scheduler(u({window:r},t)),o=Re({connected:!0});return t[ms]=new class extends _s{get fragment(){}get window(){return r}get document(){return t}get nsAlias(){return n.nsAlias}get scheduler(){return s}get readStatus(){return o}lift(){return this}update({nsAlias:t=n._nsAlias,scheduler:e=n._scheduler}){return n.set({nsAlias:t,scheduler:e}),this}}}function vs(t){return 9===t.nodeType?bs(t):function(t){const e=t[ms];if(e)return e.lift();const n=mn({connected:!1}),r=new qe;let s=bs(t.ownerDocument);const o=new ws(s);let i=()=>s.fragment,u=e=>{const c=t.getRootNode({composed:!0});if(c===t)return e;const a=vs(c);return t[ms]=void 0,i=()=>a.fragment,o.set(a),a.whenSettled((t=>r.send(t))).cuts(r),n.by(a),u=t=>a,s=a,a};class c extends _s{get fragment(){return i()}get window(){return s.window}get document(){return s.document}get nsAlias(){return s.nsAlias}get scheduler(){return o.scheduler}get readStatus(){return n.read}get whenSettled(){return r.on}lift(){return u(this)}}const a=t[ms]=new c;return function(t){as(t)}(a),a}(t)}function xs(t){for(;;){const e=t.getRootNode({composed:!0});if(e===t)return vs(t);t=e}}const Ss=Symbol("DrekCssClasses");class As{constructor(t){this._element=t,this._uses=new Map,this._context=xs(t)}add(t,e){return this._add(this._context,t,e)}_add({nsAlias:t,scheduler:e},n,r){const s=r?r.supply:new It;if(s.isOff)return s;const o=$t.name(n,t),i=e({node:this._element}),u=this._use(o),c=()=>{u.n?u.s||(this._element.classList.add(o),u.s=1):(u.s&&!u.i&&(this._element.classList.remove(o),u.s=0),this._uses.delete(o))};return 1===u.n&&i(c),s.whenOff((()=>{--u.n||i(c)}))}_use(t){let e=this._uses.get(t);return e?++e.n:(e=this._element.classList.contains(t)?{i:1,n:1,s:1}:{i:0,n:1,s:0},this._uses.set(t,e)),e}has(t){return this._has(this._context,t)}_has({nsAlias:t},e){const n=$t.name(e,t),r=this._uses.get(n);return r?!!r.n||!!r.i:this._element.classList.contains(n)}renderIn(t){return t!==this._context?{add:e=>this._add(t,e),has:e=>this._has(t,e),renderIn:t=>this.renderIn(t)}:this}}const Cs={perContext:T(k,C({byDefault:function(t){const e=new WeakMap;return{contextOf(n){var r;return r=Sn(n),e.get(r)||(e.set(r,1),xs(r).update({nsAlias:t.get(Dt),scheduler:t.get(Zn)})),xs(n)}}}})),toString:()=>"[DocumentRenderKit]"};const $s=Symbol("DrekFragment.context");class ks extends _s{constructor(t,e,n,r,s){super(),this._fragment=t,this._target=e,this._content=n,this._status=mn([{connected:!1,withinFragment:"added"}]),this._settled=new qe,this._rendered=new qe,this._getFragment=()=>t,this._lift=this,this.readStatus=this._status.read.do(cn(((t,e)=>t(...e)))),this._state=new ws({nsAlias:r,scheduler:s}),this.scheduler=this._createSchedule.bind(this),this.whenConnected(((...t)=>{this._whenSettled=this.whenConnected,this._settled.send(...t)}))}static attach(t,e,{nsAlias:n=e.context.nsAlias,scheduler:r=Jn,content:s}){if(s){if(s.getRootNode({composed:!0})!==s)throw new TypeError("Not a standalone DocumentFragment");if(s[ms])throw new TypeError("Can not render content of another fragment")}else s=e.context.document.createDocumentFragment();return s[ms]=new ks(t,e,s,n,r)}get fragment(){return this._getFragment()}get window(){return this._target.context.window}get document(){return this._target.context.document}get nsAlias(){return this._state.nsAlias}get whenSettled(){return this._whenSettled||(this._whenSettled=this._settled.on.do(nn))}lift(){return this._lift}_settle(){this.scheduler()((t=>{this._settled.send(...this._status.it)}))}_render(){this._lift=this._target.context,this._status.it=[{connected:!1,withinFragment:"rendered"}];const t=this._state._scheduler();return this._state.set(this._target.context),t((({postpone:t})=>{t((()=>{this._target.context.scheduler()((()=>{const t=this._target.placeContent(this._content);this._getFragment=()=>t.fragment,this._content[ms]=this._fragment[$s]=new ks(this._fragment,this._target,this._content,this.nsAlias,this.scheduler),this._status.by(t,((...t)=>Re(t))),this._rendered.send(t)}))}))})),this}_whenRendered(){return(this._whenRendered=M(this._rendered.on.do(nn)))()}_createSchedule(t={}){const e=this._state.scheduler(c(u({},t),{window:this.window}));return t=>e((e=>t(this._createExecution(e))))}_createExecution(t){const e=c(u({},t),{fragment:this._fragment,content:this._content,postpone(n){t.postpone((t=>n(e)))}});return e}}class Rs{constructor(t,e={}){this[$s]=ks.attach(this,t,e)}get target(){return this[$s]._target}get innerContext(){return this[$s]}get content(){return this[$s]._content}get whenRendered(){return this[$s]._whenRendered()}settle(){return this[$s]._settle(),this}render(){return this[$s]._render()}}function Os(t,e=xs(t)){return{context:e,host:t,placeContent:n=>(t.appendChild(n),e)}}function Ds(t,e){const n=Ts(t,e);return{context:t.context,host:t.host,placeContent:e=>n.charge(e,t)}}function Ts(t,e){return"function"==typeof e?Ts(t,e(t)):"string"==typeof e?Es(t,e):e||Es(t,Math.random().toString(32).substr(2))}function Es({context:{document:t}},e){let n=(r,s)=>{const o=t.createComment(` [[ ${e} [[ `),i=t.createComment(` ]] ${e} ]] `);let u;n=(e,n)=>{const r=t.createRange();return r.setStartAfter(o),r.setEndBefore(i),r.deleteContents(),r.insertNode(e),u};const c=t.createDocumentFragment();return c.append(o,r,i),u=s.placeContent(c)};return{charge:(t,e)=>n(t,e)}}class Ps extends TypeError{constructor(t,e,n,r=t.workName(e)+(void 0!==n?` already terminated (${n})`:" already done")){super(r),this.workload=t,this.work=e,this.reason=n}}class Fs{constructor(t,e){this.name=t,this.allocator=e}workName(t){return`The work of ${this.name}`}toString(){return`Workload(${this.name})`}}class Bs{constructor(t){this._allotment=t,this._queues=new Map}runAfter(t,e){let n=this._queues.get(t);return n||(n=new Ms(this._allotment),this._queues.set(t,n)),n.enqueue(e)}}class Ms{constructor(t){this._allotment=t,this._tasks=[]}enqueue(t){return new Promise((e=>{const n={task:t,run:()=>{e(this._allotment.run(t).finally((()=>{this._tasks.shift(),this._runNext()})))}};this._tasks.push(n),1===this._tasks.length&&this._runNext()}))}_runNext(){const[t]=this._tasks;t&&t.run()}}class zs extends Fs{constructor(){super("ordering",{start:t=>new Bs(t)})}}zs.$=new zs;class Ns extends Fs{constructor(t,e={}){super(t,{start(t){const{workbench:n,workload:r,supply:s}=t,o=new Ls(t,e);return{workbench:n,stage:r,supply:s,async run(t){return await o.run(this,t)}}}})}workName(t){return`The ${this.name} stage`}toString(){return`WorkStage(${this.name})`}}class Ls{constructor(t,e){this.allotment=t,this.allocator=e,this._whenTaskDone=Promise.resolve();const{supply:n}=t;this._whenAllDone=new Promise((t=>this._end=t)).then((()=>n.off())).catch((t=>n.off(t))),n.whenOff((e=>{void 0===e?this._end():this._end(Promise.reject(e)),this.run=(n,r)=>Promise.reject(new Ps(t.workload,n,e))}))}run(t,e){const n=this._start(t).then((()=>this.allotment.run(e)));return this._addTask(n),n}_addTask(t){const e=this._whenTaskDone=Promise.all([this._whenTaskDone,t.catch(Z)]);e.finally((()=>{e===this._whenTaskDone&&this._end(e)}))}_start(t){let e=this._awaitDeps();return this.allocator.start&&(e=e.then((async()=>{await this.allocator.start(t)}))),this._start=M(e),this._addTask(e),e}_awaitDeps(){const t=[],e=e=>{t.push(new Promise((t=>{this.allotment.workbench.work(zs.$).runAfter(e,(()=>(t(),this._whenAllDone))).catch(Z)})))},{after:n}=this.allocator;return n&&e(n),e(this.allotment.workload),Promise.all(t)}}const Us=Symbol("Workbench.impl");class js{constructor(t,e){this.workbench=t,this._works=new Map;const{supply:n=Ht(),run:r}=e;this.supply=new It((t=>{this.work=e=>{throw new Ps(e,void 0,t,"The workbench is stopped")}})).as(n),this._run=r?r.bind(e):qs}work(t){if(this._works.has(t))return this._works.get(t);let e=Z;const n=async(n,r)=>{const s=await this._run(r,n,t);return e(),s},r=(new It).needs(this.supply);let s,o,i;const u=new Promise((e=>{s=r=>(o=r,this._works.set(t,r),i=async t=>await n(r,t),e(r),r)}));return i=async t=>await n(await u,t),r.whenOff((n=>{i=e=()=>{throw new Ps(t,o,n)},this._works.delete(t)})),s(t.allocator.start({workbench:this.workbench,workload:t,supply:r,run:async t=>await i(t)}))}}async function qs(t,e,n){return await t()}class Ws{constructor(t={}){this[Us]=new js(this,t)}get supply(){return this[Us].supply}work(t){return this[Us].work(t)}}class Is extends ReferenceError{constructor(t,e=[],n=function(t,e){const n=e.reduce(((t,[e,n])=>(t?t+=", ":t=": ",t+=void 0!==n?`${e} failed to load (${n})`:`${e} not loaded`)),"");return`Failed to load ${t}${n}`}(t,e)){super(n),this.module=t,this.reasons=e}get name(){return"CxDependencyError"}}const Vs=Symbol("CxModule.impl");class Gs{constructor(t,e,n){this.module=t,this.name=e,this.options=n;const{needs:r,has:s,setup:o}=n;this.has=V(s).add(t),this.needs=V(r),this._setup=o?o.bind(n):Z}async setup(t){const e=function(t){const{module:e,supply:n}=t;return mr(Wr(e.needs,(r=>r!==e&&t.provide(r).needs(n)&&{dep:r,use:t.get(r).use(t)})))}(t);await Ks(t,e,Qs)&&(t.initBy((async()=>{await Ks(t,e,Js)})),await this._setup(t))}}function Hs(t,e){return{entry:t,placeAsset(t,n){n(e)}}}function Ks(t,e,n){const{module:r,supply:s}=t,o=M(!1),i=s.whenDone().then(o,o);return Promise.race([i,Promise.all(e.map((({dep:t,use:e})=>n(e).then(Z,(e=>[t,e]))))).then((t=>{const e=t.filter(et);return!e.length||new Is(r,e)}))]).then((t=>"boolean"!=typeof t?Promise.reject(t):t))}function Qs(t){return t.whenSettled}function Js(t){return t.whenReady}class Zs{constructor(t,e){this.module=e,this._useCounter=0,this._impl=mn(),this._rev=mn({status:{module:this.module,provided:!1,used:!1,settled:!1,ready:!1},supply:Zt()});const n=t.supply;n.cuts(this._impl),n.cuts(this._rev),this._impl.read((t=>{const e=this._rev.it.supply;t&&this._load(t),e.off()}))}createHandle(){const t=this._rev.read.do(Xe((({status:t})=>t))),e={read:t,[Xt]:M(t),use:t=>this._use(e,t)};return e}setup(t){this._setup=()=>{const e=this._rev.it,{status:{module:n},supply:r}=e;n!==this.module?t.get(n).use(r).read({supply:r,receive:(t,{settled:n,ready:r,error:s})=>{this._updateStatus(e,n,r,s)}}):async function(t,{status:{module:e},supply:n}){const r=new Xs(e);return await e.setup({context:t.context,module:e,supply:n,get:(e,n)=>t.get(e,n),provide:e=>t.provide(e).needs(n),initBy(t){r.initBy(t)}}),r}(t,e).then((({whenReady:t})=>(this._updateStatus(e,!0,!1),t))).then((()=>this._updateStatus(e,!0,!0))).catch((t=>e.supply.off(t)))}}implementBy(t){this._impl.by(t)}_updateStatus(t,e,n,r){this._rev.it.supply!==t.supply?t.supply.off():this._rev.it=t={status:{module:t.status.module,provided:t.status.provided,used:!0,settled:e,ready:n,error:r},supply:t.supply}}_load(t){const e=new It(Z).needs(this._rev).whenOff((t=>{this._rev.it.supply===e&&(this._rev.it={status:c(u({},this._rev.it.status),{provided:!1,settled:!1,ready:!1,error:t}),supply:e})})),n=!!this._useCounter;this._rev.it={status:{module:t,provided:!0,used:n,settled:!1,ready:!1},supply:e},n&&this._setup()}_use(t,e){const n=new It(Z);e&&n.needs(e);const r=t.read.do(on(n)),s=c(u({},t),{read:r,whenSettled:Ys(r,to),whenReady:Ys(r,eo),supply:n});if(!n.isOff&&(n.whenOff((t=>{if(!--this._useCounter){const e=this._rev.it;this._rev.it={status:c(u({},e.status),{used:!1,settled:!1,ready:!1,error:t}),supply:new It(Z).off(t)},e.supply.off(t)}})),!this._useCounter++)){const t=this._rev.it;this._rev.it={status:c(u({},t.status),{used:!0}),supply:t.supply},this._setup()}return s}}class Xs{constructor(t){this._module=t,this._whenDone=Promise.resolve(),this.whenReady=new Promise((t=>this._ready=t))}initBy(t){const e=this._whenDone=this._whenDone.then(t).finally((()=>this._done(e)))}_done(t){this._whenDone===t&&(this._ready(t),this.initBy=t=>{throw new TypeError(`${this._module} initialized already, and does not accept new initializers`)})}}function Ys(t,e){return be((n=>t({supply:n.supply,receive:(t,r)=>{e(r)?(n.receive(t,r),n.supply.off()):r.error&&n.supply.off(r.error)}})))}function to({settled:t}){return t}function eo({ready:t}){return t}class no{constructor(t,e={}){this[Vs]=new Gs(this,t,e)}get name(){return this[Vs].name}get[Symbol.toStringTag](){return this.name}get entry(){return this}get needs(){return this[Vs].needs}get has(){return this[Vs].has}perContext(t){const e=N((()=>{const e=new Zs(t,this);return[e,e.createHandle()]}));let n=()=>{const[r,s]=e();return n=M(s),r.setup(t),r.implementBy(function(t){const e=t.entry;return ve((n=>{const r=ce(n);t.trackAssetList((t=>{let n;for(let r=t.length-1;r>=0;--r){const s=t[r].recentAsset;if(s&&(n=s.asset,n!==e))break}r(n)}),n.supply)}))}(t)),s};return{assign(t){t(n())}}}placeAsset(t,e){e(this)}setupAsset(t){for(const e of this.has)e!==this&&e!==t.entry&&t.provide(Hs(e,this))}setup(t){return this[Vs].setup(t)}toString(){return`[CxModule ${this[Symbol.toStringTag]}]`}}const ro=/[A-Z]+/g;function so(t,e,n){const r=t.toLowerCase();return r.length>1&&e+r.length<n.length?`-${r.slice(0,-1)}-${r.slice(-1)}`:"-"+r}const oo=new Map;function io(t){return t.replace(ro,so)}function uo(t){const e=io(t);return e.startsWith("-")?e.substr(1):e}const co={perContext:C(),toString:()=>"[BootstrapContext]"};function ao(t,e,n,r){const s=e&&e.bind(t),o=r&&r.bind(n);return o?s?async(...t)=>{await s(...t),await o(...t)}:o:s}class ho{constructor(t){this.symbol=t}own(t,e){return Y(t,this.symbol)?Reflect.get(t,this.symbol,e):void 0}of(t,e=t){const n=this.own(t,e),r=H(t),s=r&&this.of(r,e);return n?s?this.merge([s,n]):n:s}define(t,e){const n=this.own(t),r=this.merge(n?[n,...e]:e);return Reflect.defineProperty(t,this.symbol,{configurable:!0,value:r}),t}}const lo=Symbol("FeatureDef");class fo extends ho{constructor(){super(lo)}merge(t){return t.reduce(((t,e)=>({needs:I(G(V(t.needs),e.needs)),has:I(G(V(t.has),e.has)),setup:ao(t,t.setup,e,e.setup),init:ao(t,t.init,e,e.init)})),{})}}const po=new fo,go={of:t=>po.of(dt(t))||{},merge:(...t)=>po.merge(t),define:(t,...e)=>po.define(t,e)};function yo(...t){const e=function(t){const e=[],n=[];for(const s of t)_o(s)?n.push(s):e.push(s);e.length&&n.push((r=e,({amend:t})=>t({featureDef:go.merge(...r)})));var r;return it(n)}(t);return ht((t=>{let n={};e(ut({base:c(u({},t),{featureDef:{}}),amend(e,r={}){const s=r,{featureDef:o={}}=s,i=a(s,["featureDef"]),h=t.amend(i),l=n=go.merge(n,o);return()=>c(u({},h()),{featureDef:l})}})),go.define(t.amendedClass,n)}))}function _o(t){return"function"==typeof t||st(t)}const mo={perContext:C(),toString:()=>"[FeatureContext]"},wo={perContext:T(co,C({byDefault:()=>new Ws})),toString:()=>"[BootstrapWorkbench]"},bo=new Ns("feature setup"),vo=new Ns("feature init",{after:bo}),xo=new Ns("component definition",{after:vo}),So=Symbol("ComponentDef");class Ao extends ho{constructor(){super(So)}merge(t){return t.reduce(((t,e)=>{const n=this.meta(e);return c(u(u({},t),n),{setup:J(t.setup,n.setup),define:J(t.define,n.define),feature:t.feature?n.feature?go.merge(t.feature,n.feature):t.feature:n.feature})}),{})}meta(t){return Ot(t)?{name:t}:t}}const Co=new Ao,$o={of:t=>Co.of(dt(t))||{},merge:(...t)=>Co.merge(t),define:(t,...e)=>Co.define(t,e)};function ko(...t){const e=function(t){const e=[],n=[];for(const s of t)Ro(s)?n.push(s):e.push(s);e.length&&n.push((r=e,({amend:t})=>t({componentDef:$o.merge(...r)})));var r;return it(n)}(t);return yo((t=>{let n={};e(ut({base:c(u({},t),{componentDef:{}}),amend(e,r={}){const s=r,{componentDef:o={}}=s,i=a(s,["componentDef"]),h=t.amend(i),l=n=$o.merge(n,o);return()=>c(u({},h()),{componentDef:l})}})),$o.define(t.amendedClass,n)}))}function Ro(t){return"function"==typeof t||st(t)}const Oo=Symbol("ComponentContext"),Do={perContext:C(),of(t){if("function"!=typeof t[Oo])throw new TypeError(`No component context found in ${String(t)}`);return t[Oo]()},toString:()=>"[ComponentContext]"},To={perContext:C({byDefault(t){const e=t.get(Do),n=new xn(e.element);return n.supply.needs(e),{dispatch:t=>n.dispatch(t),on:t=>n.on(t)}}}),toString:()=>"[ComponentEventDispatcher]"};function Eo(...t){return function(...t){return _t(wt,bt,t)}(ko(it(t)))}const Po={get:Z,unbind:Z,rebind:Z,drop:Z};class Fo{constructor(){this._provider=mn(Po),this.read=this._provider.read.do(Ze((t=>t.get()))),this.whenReady=this.read.do(Ke((t=>t&&t.whenReady)),nn)}get context(){return this._provider.it.get()}[Xt](){return this.read}bind(t){this._provider.it.drop(),this._provider.it=function(t,e){e.supply.whenOff((()=>{t.context===e&&t.unbind()}));const n=()=>e;return{get:n,unbind(){t._provider.it=Po},rebind:n,drop:Z}}(this,t)}bindBy(t){this._provider.it.drop(),this._provider.it=function(t,e){let n=Zt(),r=Z;const s=()=>r(),o=()=>n=new It((()=>{r=Z}));let i=e=>(r=M(e),e.supply.whenOff((()=>{t.context===e&&t.unbind()})),o());const u=()=>{i=t=>Zt(),n.off()},c=()=>{n.off(),t._provider.it={get:s,unbind:c,rebind:h,drop:u}},a=()=>e({bind:t=>i(t)});r=()=>(a(),i=e=>(n.off(),r=M(e),t._provider.it={get:s,unbind:c,rebind:h,drop:u},o()),r());const h=()=>(a(),r());return{get:s,unbind:c,rebind:h,drop:u}}(this,t)}unbind(){this._provider.it.unbind()}rebind(){return this.context||this._provider.it.rebind()}}const Bo=Symbol("ComponentSlot"),Mo={of(t){const e=t[Bo];return e||(t[Bo]=new Fo)}},zo={perContext:C({byDefault:t=>t.get(Do).element}),toString:()=>"[ContentRoot]"},No={perContext:v({create:K,byDefault:z(),assign:({get:t,to:e},{supply:n})=>{let r=(e,n,r)=>{e=ln(e);const s=t();for(let t=s.length-1;t>=0;--t)s[t](e,n,r)};const s=(t,e,n)=>r(t,e,n);let o=t=>e(((e,n)=>t(s,n)));return n.whenOff((()=>{r=Uo,o=Lo})),t=>o(t)}}),toString:()=>"[StateUpdater]"};function Lo(t){t(Uo)}function Uo(t,e,n){}const jo=C();class qo extends cs{static perContext(t){return jo(t)}static toString(){return"[BootstrapContextBuilder]"}constructor(t){super(t),this.provide(Hr(qo,this)),this.provide(Hr(k,this.context)),this.provide(Hr(co,this.context))}}const Wo=Symbol("PostDefSetup");function Io(t){if(Y(t,Wo))return t[Wo];const e=mn(),n=new qe,r=Ve(e.read.do(an(K)),n),s=H(t,(t=>So in t));if(s){const t=Io(s);r((e=>t.send(e)))}const o={on:r,send(t){n.send(t)},setup(t){e.it=t}};return Reflect.defineProperty(t,Wo,{value:o}),o}const Vo={perContext:D(co,C({byDefault:function(t){const e=t.get(jn),n=t.get(Dt);return{elementOf(t){const{name:r,extend:s}=$o.of(t);let o;const i={get type(){return s&&s.type||e.HTMLElement},get name(){return s&&s.name}};return{get name(){return r},get tagName(){return o||r&&(o=At.name(r,n))},get extend(){return i}}}}}})),toString:()=>"[ElementNaming]"};const Go=new kt("https://wesib.github.io/ns","b","wesib"),Ho=Symbol("DefinitionContext");function Ko(t){if(!Y(t,Ho))throw new TypeError(`Component is not defined: ${t}`);return t[Ho]}const Qo={perContext:T(co,C({byDefault:function(t){const e=t.get(jn).customElements,n=t.get(Dt);return new class{define(t,r){if(Ot(t))return void e.define(At.name(t,n),r);const s=Ko(t),{tagName:o,extend:i}=s.elementDef;o?i&&i.name?e.define(o,r,{extends:i.name}):e.define(o,r):Zo(t).resolve(void 0)}whenDefined(t){if(Ot(t))return e.whenDefined(At.name(t,n));const r=Ko(t),{name:s}=r.elementDef;return s?e.whenDefined(At.name(s,n)):Zo(t).promise()}}}})),toString:()=>"[CustomElements]"};const Jo=Symbol("CustomComponent.resolver");function Zo(t){return Y(t,Jo)?t[Jo]:t[Jo]=function(){let t,e,n=N((()=>new Promise(((n,r)=>{t=n,e=r}))));const r=r=>{n=N(r),t=Z,e=Z};return t=t=>{r((()=>Promise.resolve(t)))},e=t=>{r((()=>Promise.reject(t)))},{resolve(e){t(e)},reject(t){e(t)},promise:()=>n()}}()}const Xo={perContext:C(),toString:()=>"[DefinitionContext]"},Yo=Symbol("newComponent");function ti(t){const e=t.componentType;return e[Yo]||(e[Yo]=function(t){const e=Symbol("ComponentContext");let n;return t.prototype[Oo]=function(){return this[e]||(this[e]=n)},function(t){const r=n;n=t;try{const s=new this(t);return s[e]=t,s}finally{n=r}}}(e)),e[Yo](t)}class ei{constructor(t){this._ctx=t,this._val=mn(0),this._canSettle=0,this.supply.cuts(this._val)}get supply(){return this._ctx.supply}read(){return(this.read=M(this._val.read.do(Xe(M(this._ctx)))))()}isReady(){return!!this._val.it&&!this._val.supply.isOff}onceReady(){return(this.onceReady=M(this.read().do(ni((({ready:t})=>t)))))()}whenReady(){return(this.whenReady=M(this.onceReady().do(nn)))()}isSettled(){return this._val.it>=2&&!this._val.supply.isOff}onceSettled(){return(this.onceSettled=M(this.read().do(ni((({settled:t})=>t)))))()}whenSettled(){return(this.whenSettled=M(this.onceSettled().do(nn)))()}isConnected(){return this._val.it>=3&&!this._val.supply.isOff}onceConnected(){return(this.onceConnected=M(this.read().do((t=({connected:t})=>t,Je(((e,...n)=>t(...n)&&e(...n)))))))();var t}whenConnected(){return(this.whenConnected=M(this.onceConnected().do(nn)))()}ready(){this._val.it=1}settle(){this._canSettle&&this._val.it<2&&(this._val.it=2)}connect(){this._val.it=3}create(){this._canSettle=1}}function ni(t){return e=>be((n=>{let r=!1;e({supply:n.supply,receive(e,s){const o=t(s);o&&!r&&(r=o,n.receive(e,s))}})}))}const ri={perContext:D(co,A((t=>new us))),toString:()=>"[PerComponentCxPeer]"};class si{constructor(t,e,n,r){this._defContext=t,this._builder=e,this.element=n,this.get=r,this.updateState=(t,e,n)=>{this.get(No)(t,e,n)},this._status=new ei(this),this.supply.whenOff((()=>{delete this.component[Oo],this._component=ii}))}get componentType(){return this._defContext.componentType}get component(){return this._component()}get supply(){return this._builder.supply}get ready(){return this._status.isReady()}get onceReady(){return this._status.onceReady()}get whenReady(){return this._status.whenReady()}get settled(){return this._status.isSettled()}get onceSettled(){return this._status.onceSettled()}get whenSettled(){return this._status.whenSettled()}get connected(){return this._status.isConnected()}get onceConnected(){return this._status.onceConnected()}get whenConnected(){return this._status.whenConnected()}get readStatus(){return this._status.read()}get contentRoot(){return this.get(zo)}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){this._status.settle()}on(t){return this.get(To).on(t)}dispatchEvent(t){this.get(To).dispatch(t)}_createComponent(){const t=this._defContext._whenComponent;let e=0;t.readNotifier.do(nn)((t=>e=t(this,e))),this.whenConnected((()=>{t.readNotifier({supply:(new It).needs(this),receive:(t,n)=>{e=n(this,e)}})})),this._defContext._elementBuilder.components.send(this);const n=ti(this);return this._component=M(n),this._status.ready(),this}_connect(){this._status.connect()}_created(){this._status.create()}}class oi extends si{static create(t,e){return t._newComponentContext(((n,r)=>new oi(t,r,e,n)))}get mounted(){return!0}}function ii(){throw new TypeError("Component destroyed already")}class ui extends si{static create(t,e){return t._newComponentContext(((n,r)=>new ui(t,r,e,n)))}get mounted(){return!1}}class ci{constructor(){const t=mn(0),e=new qe;this.onCreated=be((n=>{const r=t.it+1;e.on({supply:n.supply,receive:(t,e,s)=>{s<r&&n.receive({onRecurrent(e){t.onRecurrent((t=>e(t)))}},e)}}),++t.it})),this.readNotifier=t.read.do(Xe((t=>(n,r)=>(e.send(n,r),t))))}}const ai={perContext:D(co,A((t=>new us))),toString:()=>"[PerDefinitionCxPeer]"};class hi{constructor(t,e,n,r,s){var o,i;this._bsContext=t,this._elementBuilder=e,this.componentType=n,this._cxBuilder=r,this.get=s,this._whenComponent=new ci,this._ready=mn(!1),this._whenReady=this._ready.read.do(Qe(((t,e)=>e&&t()))),this._def=$o.of(n),this.elementDef=t.get(Vo).elementOf(n),this._perComponentCxPeer=new us(t.get(ri)),this.whenReady=this._whenReady.do(tn(M(this)),nn);const u={get componentType(){return n},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:t=>r.provide(t),perComponent:t=>this._perComponentCxPeer.provide(t)};null===(i=(o=this._def).setup)||void 0===i||i.call(o,u),Io(n).setup(u)}static create(t,e,n){const r=new cs(((r,s)=>new hi(t,e,n,s,r)),t.get(qo).boundPeer,t.get(ai)),s=r.context;return r.provide(Hr(Xo,s)),s}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(t){const e=oi.create(this,t);Mo.of(t).bind(e),e._createComponent();const n=e.get(Cs).contextOf(t);return n.whenSettled((t=>e.settle())).needs(e),n.whenConnected((t=>e._connect())).needs(e),e._created(),e}perComponent(t){return this._perComponentCxPeer.provide(t)}_newComponentContext(t){const e=new cs(t,this._cxBuilder.boundPeer,this._perComponentCxPeer),n=e.context;return e.provide(Hr(Do,n)),n}_elementType(){throw new TypeError("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var t,e;null===(e=(t=this._def).define)||void 0===e||e.call(t,this),this._elementBuilder.definitions.send(this),this._elementType=M(function(t){const{elementDef:e}=t,n=t.get(Cs);class r extends e.extend.type{constructor(){super();const e=Mo.of(this);let r=Z;e.bindBy((({bind:e})=>{const s=ui.create(t,this),o=e(s);s._createComponent(),s._created(),s.supply.needs(o).whenOff((()=>{n.contextOf(this).whenSettled((t=>r()))}))})),n.contextOf(this).whenSettled((t=>r())),r=()=>e.rebind().settle()}connectedCallback(){var t;null===(t=super.connectedCallback)||void 0===t||t.call(this),Mo.of(this).rebind()._connect()}disconnectedCallback(){var t;Mo.of(this).context.supply.off(),null===(t=super.disconnectedCallback)||void 0===t||t.call(this)}}return r}(this)),this.componentType[Ho]=this,this._ready.it=!0}}const li={perContext:T(co,C({byDefault:function(t){return{definitions:new qe,components:new qe,buildElement(e){const n=hi.create(t.get(co),this,e);return n._define(),n}}}})),toString:()=>"[ElementBuilder]"};class di{constructor(t){this._setup=t,this._components=void 0}define(t){this._components?this._components.push(t):(this._components=[t],this._defineAll(this._components))}_defineAll(t){const e=this._setup.get(wo).work(xo).run((()=>{const e=this._setup.get(Qo),n=this._setup.get(li);t.forEach((t=>{const r=n.buildElement(t);e.define(t,r.elementType)})),this._components=void 0}));this._setup.initBy(M(e))}}class fi{constructor(t,e,n){this.feature=t,this.get=e,this._setup=n,this._bsContext=n.get(co);const r=n.get(n.module);this.whenReady=r.read.do(hn((({ready:t})=>t&&this)),nn),this._componentRegistry=new di(this._setup)}static create(t,e){const n=e.get(qo),r=new cs((n=>new fi(t,n,e)),n.boundPeer),s=r.context;return r.provide(Hr(mo,s)),s}get supply(){return this._setup.supply}get onDefinition(){return this._onDefinition||(this._onDefinition=this._setup.get(li).definitions.on.do(rn(this)))}get onComponent(){return this._onComponent||(this._onComponent=this._setup.get(li).components.on.do(rn(this)))}provide(t){return this._bsContext.get(qo).provide(t).needs(this)}perDefinition(t){return this._bsContext.get(ai).provide(t).needs(this)}perComponent(t){return this._bsContext.get(ri).provide(t).needs(this)}setupDefinition(t){return function(t,e){const{on:n}=Io(t);return be((t=>{n({supply:t.supply.needs(e),receive(n,r){const s=r.whenReady.do(rn(e)),o=r.whenComponent.do(rn(e));t.receive(n,{get componentType(){return r.componentType},get whenReady(){return s},get whenComponent(){return o},perDefinition:t=>r.perDefinition(t).needs(e),perComponent:t=>r.perComponent(t).needs(e)})}})}))}(t,this.supply)}define(t){this._componentRegistry.define(t)}whenDefined(t){return this.get(co).whenDefined(t)}load(t,e){return this.get(co).load(t,e?(new It).needs(this).needs(e):this)}}const pi=Symbol("FeatureModule");class gi extends no{constructor(t){super(t.name,function(t){const e=function(t){let e=go.of(t);if(So in t){e=go.merge(e,{init(e){e.define(t)}});const{feature:n}=$o.of(t);n&&(e=go.merge(e,n))}return e}(t),n=[],r=[];for(const s of V(e.has))n.push(gi.of(s));for(const s of V(e.needs))r.push(gi.of(s));return{needs:r,has:n,async setup(n){var r;const s=n.get(wo),o=fi.create(t,n);if(e.init){const t=s.work(vo).run((async()=>{await e.init(o)}));n.initBy(M(t))}await(null===(r=e.setup)||void 0===r?void 0:r.call(e,o))}}}(t)),this.feature=t}static of(t){return Y(t,pi)?t[pi]:t[pi]=new gi(t)}async setup(t){const e=t.get(wo);await e.work(bo).run((()=>super.setup(t)))}toString(){return`[Feature ${this.name}]`}}const yi=Symbol("WhenDefined");const _i=Symbol("attribute");function mi(t){return[_i,t]}function wi(t,e=!0){if(!1===e)return Z;if(!0===e||"function"==typeof e){const n=mi(t),r=!0===e?bi:e;return(t,e,s)=>r(t,n,e,s)}return(t,n,r)=>bi(t,e,n,r)}function bi(t,e,n,r){Do.of(t).updateState(e,n,r)}const vi={perContext:D(Xo,C({byDefault:t=>new xi(t.get(Xo))})),toString:()=>"[AttributeRegistry]"};class xi{constructor(t){this._defContext=t,this.attrs=new Map,t.whenReady((({elementType:t})=>this.define(t))),t.whenComponent((t=>{t.mounted&&this.mount(t)}))}declareAttribute({name:t,change:e}){this.attrs.set(t,J(this.attrs.get(t),e))}define(t){const{attrs:e}=this;e.size&&(Reflect.defineProperty(t,"observedAttributes",{configurable:!0,enumerable:!0,value:Si(t,[...e.keys()])}),Reflect.defineProperty(t.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:Ai(t,e)}))}mount(t){const{element:e}=t,{attrs:n}=this,r=[...n.keys()];if(!r.length)return;new(0,this._defContext.get(jn).MutationObserver)((r=>r.forEach((r=>{const s=r.attributeName;return n.get(s)(t.component,e.getAttribute(s),r.oldValue)})))).observe(e,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}function Si(t,e){const n=t.observedAttributes;if(Array.isArray(n)){const t=new Set(n);e.forEach((e=>t.add(e))),e=[...t]}return e}function Ai(t,e){const n=t.prototype.attributeChangedCallback;return n?function(t,r,s){const o=e.get(t);o?Mo.of(this).whenReady((({component:t})=>o(t,s,r))):n.call(this,t,r,s)}:function(t,n,r){Mo.of(this).whenReady((({component:s})=>{e.get(t)(s,r,n)}))}}function Ci(t){return Eo((({amendedClass:e,key:n,set:r,amend:s})=>{const{name:o,change:i}=function(t,e,n){let r,s;if("string"==typeof n)r=uo(n),s=wi(r);else{if(n&&n.name)r=uo(n.name);else{if("string"!=typeof e)throw new TypeError(`Attribute name is required as property key is not a string: ${t.constructor.name}.prototype.${String(e)}`);r=uo(e)}s=wi(r,n&&n.updateState)}return{name:r,change:s}}(e.prototype,n,t);s({componentDef:{define(t){t.get(vi).declareAttribute({name:o,change(t,e,n){r(t,e),i(t,e,n)}})}},get:t=>Do.of(t).element.getAttribute(o),set(t,e){const{element:n}=Do.of(t);null!=e?n.setAttribute(o,e):n.removeAttribute(o),r(t,e)}})}))}class $i extends gn{static perContext(t){return{assign:ki(t,(t=>t.recentAsset)),assignDefault:ki(t,(t=>new $i))}}static toString(){return"[ComponentState]"}}function ki(t,e){const n=t.lazy((t=>{const n=e(t);return n&&t.provide(Hr(No,n.update)),n}));return e=>{const r=n();return r&&(t.supply.whenOff((t=>r.done(t))),e(r)),r}}class Ri extends yn{constructor(t,e,n){super(),this._context=t,this._name=e,this.supply=new It,this.on=this._context.get($i).track(n).onUpdate.do(Qe(((t,e,n,r)=>t(n,r))),rn(this))}get it(){return this._context.element.getAttribute(this._name)}set it(t){this.supply.isOff||(null==t?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,t))}}function Oi(t,e,n=mi(e)){return new Ri(t,e,n)}const Di=Symbol("render"),Ti={trigger(t,e={}){const{on:n=[]}=e;if(("object"==typeof n||"function"==typeof n)&&ie(n))return Ie(n).do(rn(t));const r=t.get($i).track(n).onUpdate.do(rn(t));return Array.isArray(n)&&!n.length?r.do(Je(((t,e)=>e[0]!==Di&&t()))):r}};class Ei{constructor(t){this._context=t;const{element:e}=t;this._scheduler=t.get(Cs).contextOf(e).scheduler}renderBy(t,e){return new Fi(this,t,e).render()}preRenderBy(t,e){return new Mi(this,t,e).render()}}class Pi{constructor(t,e,n={}){this._ctl=t,this._renderer=e,this._status=1,this._spec=j(n,t._context)}render(){const t=this._ctl._context,e=Ti.trigger(t,this._spec);let n=t=>{n=this._createSchedule(),n(t)};const r="connected"===this._spec.when,s=r?()=>t.connected&&this._scheduleRenderer(n):()=>t.settled&&this._scheduleRenderer(n);return this._supply=e(s).needs(t).whenOff((()=>this._cancel(n))),(r?t.whenConnected:t.whenSettled)((()=>this._status&&this._scheduleRenderer(n))),this._supply}_scheduleRenderer(t){this._status=2,t((t=>this._render(t)))}_createSchedule(){return this._scheduleBy(this._ctl._scheduler)}_scheduleBy(t){const e=this._ctl._context.element,n=t(c(u({},this._spec),{node:e}));return t=>n((e=>fs((()=>t(e)))))}_render(t){const e=this._createExecution(t);this._status=0;do{const t=this._renderer;if(t(e),this._renderer===t){this._over();break}}while(this._status>=0)}_over(){}_cancel(t){2===this._status&&t(Z),this._status=-1}}class Fi extends Pi{_createExecution(t){const e=c(u({},t),{postpone(n){t.postpone((()=>n(e)))},supply:this._supply,renderBy:t=>{this._renderer=t}});return e}}const Bi={};class Mi extends Pi{constructor(){super(...arguments),this._nextRenderer=null}render(){return this._preSupply=new It,super.render().needs(this._preSupply).whenOff((t=>{t===Bi?this._preSupply.as(this._ctl.renderBy(this._nextRenderer)):this._preSupply.off(t)})),this._preSupply}_createSchedule(){const t=this._ctl._context.get(Kn);return this._scheduleBy(t)}_over(){this._nextRenderer&&this._supply.off(Bi)}_createExecution(t){const e=c(u({},t),{postpone:n=>{t.postpone((()=>{n(e),this._over()}))},supply:this._preSupply,renderBy:t=>{this._renderer=t,this._nextRenderer=t},preRenderBy:t=>{this._renderer=t}});return e}}const zi={perContext:C({byDefault:t=>new Ei(t.get(Do))}),toString:()=>"[ComponentRenderCtl]"},Ni={perContext:C({byDefault:function(t){const e=t.get(zi);return(t={})=>{const n=mn(Z);return e.renderBy((t=>{n.it(t)}),c(u({},t),{on:n.on})),t=>{n.it=e=>t(e)}}}}),toString:()=>"[ComponentRenderScheduler]"};const Li={perContext:D(Do,C()),toString:()=>"[ShadowContentRoot]"},Ui={perContext:R({create:(t,e)=>t,byDefault:t=>ji,assign({get:t,to:e},n){const r=(e,n)=>t()(e,n);return t=>e(((e,n)=>t(r,n)))}}),toString:()=>"[ShadowRootBuilder]"};function ji(t,e){return function(t,e){const n=t.shadowRoot;if(n)return n;if("attachShadow"in t)return t.attachShadow(e);return}(t.element,e)}const qi={mode:"open"};function Wi(t=qi){return ko({setup(e){e.perComponent(Gr(Li,(e=>e.get(Ui)(e.get(Do),t)))),e.perComponent(Gr(zo,(t=>t.get(Li,{or:null}))))}})}function Ii(){return v({create:Gi,byDefault:t=>Vi,assign:({get:t,to:e})=>{const n=(e,n)=>t()(e,n);return t=>e(((e,r)=>t(n,r)))}})}function Vi(t,e){return t(e)}function Gi(t,e){return(e,n)=>{const r=(n,s)=>{const o=t[n];return o?Ie(o(((t=s)=>r(n+1,t)),s)):e(s)};return r(0,n)}}const Hi={perContext:Ii(),toString:()=>"[HttpFetchAgent]"},Ki={perContext:R({create:K,byDefault:function(t){const e=t.get(jn),n=t.get(Hi);return(t,e)=>n(r,new Request(t,e));function r(t){return be((n=>{const r=new qe;let s;if("AbortController"in e){const o=new e.AbortController,{signal:i}=o;s=new It((t=>{t===Qi&&o.abort()})),n.supply.whenOff((()=>s.off(Qi))).needs(s),r.on({supply:s,receive(t,e){n.receive(t,e)}});const u=t.signal;u&&(new xn(u).on("abort").do(nn)((()=>o.abort())),u.aborted&&o.abort()),t=new Request(t,{signal:i})}else s=r.on(n);e.fetch(t).then((t=>{r.send(t),s.off()})).catch((t=>s.off(t)))}))}},assign:({get:t,to:e})=>{const n=(e,n)=>t()(e,n);return t=>e(((e,r)=>t(n,r)))}}),toString:()=>"[HttpFetch]"},Qi={};const Ji={perContext:C({byDefault:t=>new Xi(t.get(Do))}),toString:()=>"[FragmentRenderCtl]"},Zi={};class Xi{constructor(t){this._context=t}renderFragmentBy(t,e={}){const n=j(e,this._context),r=!1===n.settle?eu:tu,{target:s=Yi}=n,o=N((()=>s(this._context))),i=this._context.get(zi),a=this._context.get(Kn),h=new It,l=i.preRenderBy((e=>{const n=new Rs(o(),{scheduler:a});let s=!1;const i=c(u({},e),{supply:h,fragment:n,content:n.content,postpone(t){e.postpone((()=>t(i)))},renderBy(t){e.renderBy((e=>{e.renderBy(t)}))},retainContent(t=!0){s=t},done(){e.renderBy((({supply:t})=>{l.as(t).off(Zi)}))}});t(i),((t,e)=>{e||r(t)})(n,s)}),n).needs(h).whenOff((t=>{t!==Zi&&h.off(t)}));return h}}function Yi({contentRoot:t}){return Ds(Os(t))}function tu(t){const{innerContext:e}=t,{window:n}=e;e.scheduler()((()=>{n.customElements.upgrade(t.content)})),t.settle(),t.render()}function eu(t){t.render()}function nu(t){return Eo((({key:e,get:n,amend:r})=>r({componentDef:{define(r){r.whenComponent((r=>{r.whenReady((()=>{const{component:s}=r,o=n(s).bind(s);r.get(Ji).renderFragmentBy(o,function(t,e,n={}){const r=j(n,t),{target:s=(({contentRoot:t})=>Ds(Os(t),ru(e)))}=r;return c(u({},r),{target:s})}(r,e,t))}))}))}}})))}function ru(t){const e=String(t);return e.startsWith("render")?e.substr(6):e}const su=D(co,A((t=>new ou(t.get(Dt)))));class ou{constructor(t){this.nsAlias=t,this._sharers=new Map}static perContext(t){return su(t)}static toString(){return"[ShareRegistry]"}addSharer(t,e,n,r){let s=this._sharers.get(t);s?(cu(s,e,r),uu(s,n,r),s.it=u({},s.it)):(s=iu(),this._sharers.set(t,s),cu(s,e,r),uu(s,n,r))}sharers(t){let e=this._sharers.get(t);return e||(e=iu(),this._sharers.set(t,e)),e}}function iu(){return mn({names:new Map,sharers:new Map})}function uu(t,e,n){if(!e)return;const r=t.it,s=r.names.get(e)||0;r.names.set(e,s+1),n.whenOff((()=>{const n=r.names.get(e)-1;n>0?r.names.set(e,n):r.names.delete(e),t.it=u({},r)}))}function cu(t,e,n){const r=t.it,s=r.sharers.get(e)||0;r.sharers.set(e,s+1),n.whenOff((()=>{const n=r.sharers.get(e)-1;n>0?r.sharers.set(e,n):r.sharers.delete(e),t.it=u({},r)}))}const au=Symbol("Share.impl");class hu{constructor(t,e,n){this._share=t,this.name=e,this._aliases=F(n.as).map((t=>t.share))}addSharer(t,e={}){const{local:n,name:r=t.elementDef.name}=e,s=t.get(co).get(ou),o=new It,{componentType:i}=t,u=n?void 0:r&&At.name(r,s.nsAlias).toLowerCase();s.addSharer(this._share,i,u,o);for(const c of this._aliases)s.addSharer(c,i,u,o);return o}shareValue(t){t.shareAs(this._share);const e=t.priority+1;this._aliases.forEach(((n,r)=>{n.shareValue(t.withPriority(e+r))}))}}const lu=Symbol("SharedValue"),du={hasDetails:t=>!!t&&"object"==typeof t&&"object"==typeof t[lu]};function fu(t,e){return function(t){return("object"==typeof t&&!!t||"function"==typeof t)&&"function"==typeof t.sharedBy}(e)&&e.sharedBy(t),e}function pu(t,e){return gu(t,function(t){const e=t.priority?Math.max(0,t.priority):0,{supply:n=new It}=t;return{priority:e,supply:n,provide:e=>{const n=t.provide(e);return Se(n)?n.do(Ze((t=>fu(e.context,t)))):fu(e.context,n)}}}(e))}function gu(t,e){const{priority:n,supply:r,provide:s}=e;return{priority:n,supply:r,shareAs:({share:e},r=n)=>{r=Math.max(0,r),t.provide(r?function(t,e,n){return Qr(t,((t,r,s)=>{Oe(e(t))({receive(t,e){void 0!==e&&r({[lu]:{priority:n,value:e}})},supply:s})}))}(e,s,r):function(t,e){return Qr(t,((t,n,r)=>{Oe(e(t))({receive(t,e){void 0!==e&&n(e)},supply:r})}))}(e,s))},withPriority:n=>gu(t,c(u({},e),{priority:Math.max(0,n)}))}}class yu{constructor(t,e={}){this[au]=new hu(this,t,e)}get share(){return this}get name(){return this[au].name}get[Symbol.toStringTag](){return this.name}perContext(t){const e=t.lazy((t=>function(t,e){return ve((t=>{const n=ce(t);e.trackAssetList((t=>n(...t.flatMap((t=>{const e=[];return t.eachAsset((t=>{e.push(t)})),e})))))})).do(Xe(((...e)=>t.selectValue(...e))),on(e.supply))}(this,t)));return{assign(t){t(e())}}}addSharer(t,e){return this[au].addSharer(t,e)}shareValue(t){this[au].shareValue(t)}createRegistrar(t,e){return pu(t,e)}valueFor(t,e={}){const{host:n=kn,local:r}=e;return Ae({sharers:t.get(co).get(ou).sharers(this),status:t.readStatus.do(Me(((t,e)=>t===e),_u))}).do(je((({sharers:[e]})=>{if(r){if(e.sharers.has(t.componentType))return mu(this,t);if(!0===r)return Re()}let s=n(t.element);for(;s;){if(e.names.has(s.tagName.toLowerCase()))return Mo.of(s).read.do(je((t=>t?mu(this,t):Re())));s=n(s)}return Re()})),Fe())}selectValue(...t){let e;for(let n=t.length-1;n>=0;--n){const r=t[n];if(!du.hasDetails(r))return r;const s=r[lu];(!e||e.priority>s.priority)&&(e=s)}return e&&e.value}toString(){return`[Share ${this[Symbol.toStringTag]}]`}}function _u([{settled:t,connected:e}]){return e?2:t?1:0}function mu(t,e){return e.get(t).do(cn(((t,n)=>n?t(n,e):t())))}function wu(t,e={}){if(function(t){return"function"==typeof t&&!("share"in t)}(t)){const{host:n=kn,local:r=!1,share:s}=e;return(e,o={})=>{const{share:i=s,host:u=n,local:c=r}=o;return t(e,{share:i,host:u,local:c})}}const{share:n=e.share,host:r=e.host,local:s=e.local}=t||{},o=n.share;return(t,e={})=>{const{host:n=r,local:i=s}=e;return o.valueFor(t,{host:n,local:i})}}const bu=Symbol("Shareable.internals");class vu{constructor(t){this[bu]=new xu(this,t)}static provider(t){const e=q(t);return t=>Oe(e(t))}get sharer(){return this[bu].sharer()}get read(){return this[bu].get().read}sharedBy(t){this[bu].sharedBy(t)}[Xt](){return this.read}get body(){return this[bu].get().it}}class xu{constructor(t,e){this._source=t,this._get=vu.provider(e)}sharer(){this._notBound()}get(){this._notBound()}sharedBy(t){this.sharedBy=Z,this.sharer=M(t),this.get=()=>{const e=(n=this._get(t),mn().by(n,r));var n,r;return this.get=M(e),e}}_notBound(){throw new TypeError(`${String(this._source)} is not properly shared yet`)}}class Su{constructor(t,e){this._get=t.get.bind(void 0,e),this._set=t.writable?t.set.bind(void 0,e):Z,this._ctx=Do.of(e);const n=this._get();this.val=mn(n),this.val.supply.needs(this._ctx),this.val.read((t=>fu(this._ctx,t))),this._syncVal()}get(){return this.val.it}set(t){this.val.it=t,this._syncVal()}_syncVal(){this._valSupply||(this._valSupply=this.val.read((t=>this._set(t))))}}class Au extends Set{constructor(t){super(),this._added=new Set(t),this._removed=new Set,this._added.forEach((t=>this.add(t)))}add(t){return this.has(t)||(this._added.add(t),this._removed.delete(t),super.add(t)),this}delete(t){return!!super.delete(t)&&(this._added.delete(t),this._removed.add(t),!0)}clear(){this._added.clear(),this.forEach((t=>this._removed.add(t))),super.clear()}delta(t,e=[]){return Cu(this)(t,e),this}redelta(t){return("function"==typeof t?t:Cu(t))([...this._added],[...this._removed]),this}undelta(){return this._added.clear(),this._removed.clear(),this}}function Cu(t){return(e,n)=>{for(const r of n)t.delete(r);for(const r of e)t.add(r)}}const $u={instance:null,convertTo:Z};function ku(){return $u}function Ru(t){return{instance:t,convertTo(t){return this}}}function Ou(t,e,n=null){return Tu(t,e,M(null),n)}function Du(t,e,n){return Tu(t,e,n)}function Tu(t,e,n,r,s){return void 0===r&&(r=n(t,s)),{instance:r,convertTo:r=>Tu(r,e,n,void 0,t),attachTo:r=>Tu(r,e,n,t.aspect(e)||n(r))}}const Eu=Symbol("in-aspect"),Pu=new kt("https://surol.github.io/input-aspects/ns","inasp","input-aspects"),Fu={applyTo:()=>Ru(Tt())},Bu={get[Eu](){return Fu},to:t=>({applyAspect:e=>e===Fu?Ru(t):void 0})},Mu={applyTo:()=>Ru(Wn)},zu={get[Eu](){return Mu},to:t=>({applyAspect:e=>e===Mu?Ru(t):void 0})},Nu={applyTo:t=>({instance:new ju(t),convertTo:Z})};class Lu{static get[Eu](){return Nu}[Xt](){return this.read}}class Uu{constructor(t){this.roles=t,this._activate=Z,this.active={[Symbol.iterator]:()=>t.keys(),has:e=>t.has(e)}}static create(){const t=new Uu(new Map);return t.add("default",!0),t}modify(){const t=new Uu(this.roles);return t._defaultSupply=this._defaultSupply,t}add(t,e){const n=this.roles.get(t);if(n)return void++n.active;const r=new It;if(this.roles.set(t,{active:1,supply:r}),e)this._defaultSupply=r.whenOff((()=>{--this.roles.get(t).active||this.roles.delete(t)}));else{const t=this._defaultSupply;this.activateBy((()=>t.off()))}return r}remove(t,e){const n=this.roles.get(t);--n.active||(this.roles.delete(t),this.activateBy((()=>n.supply.off(e))))}activateBy(t){const e=this._activate;this._activate=()=>{e(),t()}}activate(){const t=this._activate;this._activate=Z,t()}}class ju extends Lu{constructor(t){super(),this._control=t,this._active=mn(Uu.create()),this._activators=new Map,this._active.on((t=>t.activate())),this._active.supply.needs(t),this.read=this._active.read.do(Xe((({active:t})=>t)))}add(t){const e=this._active.it.modify();return this._add(e,t),this._active.it=e,new It((e=>{const n=this._active.it.modify();n.remove(t,e),n.roles.size||this._add(n,"default",!0),this._active.it=n}))}when(t,e){let n=this._activators.get(t);n||(n=new Map,this._activators.set(t,n));const r=(new It).needs(this._control);n.set(r,((t,n,s)=>e(t,n,s).supply.needs(r))),r.whenOff((()=>{n.delete(r),n.size||this._activators.delete(t)}));const s=this._active.it.roles.get(t);return s&&s.supply.cuts(e(this._control,t,this._active.it.active)),r}_add(t,e,n=!1){const r=t.add(e,n);if(r){const t=this._activators.get(e);if(t)for(const n of t.values())r.cuts(n(this._control,e,this._active.it.active))}}}function qu(t){return Eu in t}const Wu={applyAspect(t){}};function Iu(){return Wu}function Vu(t,...e){if(!t)return Iu;const n=Ku(t);if(!e.length)return n;const r=e.map(Ku);return(t,e)=>{const s=n(t,e),o=$r(Or([s],Pr(r.map((n=>n(t,e))),tt)),((t,e)=>e.applyAspect?n=>t(n)||e.applyAspect(n):t),Z);return Hu(s)?{applyAspect:o}:{set:s.set.bind(s),get:s.get.bind(s),applyAspect:o}}}function Gu(t){return t?Vu(...F(t)):Vu()}function Hu(t){return!t.set}function Ku(t){return"function"==typeof t?t:M(t)}const Qu=Symbol("InBuilder.impl");class Ju{constructor(){this._aspectsByKey=new Map,this._commonAspects=void 0,this._setup=void 0}addAspect(t,e){const n=this._aspectsByKey.get(t);this._aspectsByKey.set(t,n?Vu(n,e):Vu(e))}addAspects(t){this._commonAspects=this._commonAspects?Vu(this._commonAspects,...t):Vu(...t)}setup(t){const e=this._setup;this._setup=e?n=>{e(n),t(n)}:t}build(t){const e=t({aspects:this._aspects()});return this._setup&&e.setup(this._setup),e}_aspects(){if(this._aspectsByKey.size){const t=function(t){return(e,n)=>({applyAspect(r){const s=t.get(r);return s&&s(e,n).applyAspect(r)}})}(this._aspectsByKey);return this._commonAspects?Vu(t,this._commonAspects):t}return this._commonAspects}}var Zu;class Xu{constructor(){this[Zu]=new Ju}addAspect(t,e){return this[Qu].addAspect(t[Eu],e),this}addAspects(...t){return t.length&&this[Qu].addAspects(t),this}setup(t,e){return qu(t)?this[Qu].setup((n=>n.setup(t,e))):this[Qu].setup(t),this}build(t){return this[Qu].build(t)}}Zu=Qu;const Yu=Symbol("InControl.aspects");class tc{constructor(t,e){this.control=t,this.aspects=e,this._byKey=new Map}aspect(t){const e=this._byKey.get(t);if(e)return e;const n=this.control._applyAspect(t)||t.applyTo(this.control);return this._byKey.set(t,n),n}}class ec extends yn{constructor({aspects:t}={}){super();const e=F(t);this[Yu]=new tc(this,e.length?Gu(e)(new nc(this),this):Wu)}aspect(t){return this[Yu].aspect(t[Eu]).instance}setup(t,e){return qu(t)?e(this.aspect(t),this):t(this),this}convert(t,...e){return new rc(this,Vu(t,...e))}_applyAspect(t){return this[Yu].aspects.applyAspect(t)}}class nc extends ec{constructor(t){super(),this._control=t}get supply(){return this._supply||(this._supply=new It(Z).needs(this._control))}get it(){return this._control.it}set it(t){this._control.it=t}get on(){return this._control.on}}class rc extends ec{constructor(t,e){super(),this._on=new qe,this.supply=(new It).needs(t);let n,r=0;const s=e(t,this);let o,i,u;Hu(s)?(o=K,i=K,u=e=>{const n=t[Yu].aspect(e);return n.attachTo?n.attachTo(this):n.convertTo(this)}):(o=s.set,i=s.get,u=e=>t[Yu].aspect(e).convertTo(this)),this._applyAspect=t=>{var e;return(null===(e=s.applyAspect)||void 0===e?void 0:e.call(s,t))||u(t)},this._it=mn([o(t.it),0]),this._it.supply.needs(this.supply),this._it.on((([t],[e])=>{t!==e&&this._on.send(t,e)})).cuts(this._on),t.on((t=>{t!==n&&(this._it.it=[o(t),++r])})).cuts(this),this._it.on((([e,s])=>{if(s!==r){r=s,n=i(e);try{t.it=n}finally{n=void 0}}}))}get it(){return this._it.it[0]}set it(t){const[e,n]=this._it.it;t!==e&&(this._it.it=[t,n+1])}get on(){return this._on.on}}const sc={applyTo:t=>Ou(t,oc)};class oc extends ec{static get[Eu](){return sc}_applyAspect(t){return t===sc?Ou(this,oc,this):super._applyAspect(t)}}const ic={applyTo:t=>Ru(new cc(t))};class uc{static get[Eu](){return ic}[oe](){return this.on}[Xt](){return this.read}}class cc extends uc{constructor(t){super(),this._control=t,this._map=new Map,this._on=new qe,this._on.supply.needs(this._control);const e=()=>({[Symbol.iterator]:()=>this._map.keys()});this.read=this.on.do(Ze(e,e))}add(t){const e=this._map.get(t);if(e)return e;const n=new It((()=>{this._map.delete(t),this._on.send([],[t])}));return this._map.set(t,n),this._on.send([t],[]),n.needs(this._control).needs(t.parent)}get on(){return this._on.on}}const ac={applyTo:t=>Ou(t,hc)};class hc extends ec{static get[Eu](){return ac}_applyAspect(t){return t===ac?Ou(this,hc,this):super._applyAspect(t)}}const lc={applyTo:t=>Du(t,dc,(t=>new gc(t)))};class dc{static get[Eu](){return lc}[oe](){return this.on}[Xt](){return this.read}static hasData(t){return"off"!==t&&"-"!==t[0]}done(t){return this.own.supply.off(t),this}}class fc extends yn{constructor(t){super(),this._tracker=mn(t?function(t){return null!=t.getAttribute("disabled")?"off":null!=t.getAttribute("readonly")?"ro":"on"}(t.element):"on")}get supply(){return this._tracker.supply}get it(){return this._tracker.it}set it(t){switch(t){case"off":case"ro":case"-on":case"-ro":break;default:t="on"}this._tracker.it=t}get on(){return this._tracker.on}}class pc{constructor(){this._all=new Set,this._on=new qe;const t=$e(this._on.on.do(Ye((()=>this._all))),z(this._all));this.read=t.do(je((t=>Ce(...t))),Ze(_c))}add(t){const e=new It((()=>{this._all.delete(t),this._on.send()}));return this._all.add(t),this._on.send(),e}}class gc extends dc{constructor(t){super(),this._control=t,this._derived=new pc;const e=t.aspect(hc);this.own=new fc(e),this.own.supply.needs(t),this.derive(t.aspect(uc).read.do(Ue(yc)));let n="on";this.read=Ae({derived:this._derived.read,own:this.own}).do(un(((t,{derived:[e],own:[r]})=>{let s;if("off"===r||"off"===e)s="off";else{let t=!1;"-"===r[0]&&(t=!0,r=r.substring(1)),"-"===e[0]&&(t=!0,e=e.substring(1)),s="ro"===e?"ro":r,t&&(s="-"+s)}n!==s&&t(n=s)}),z(n)));let r="on";this.on=this.read.do(Qe(((t,e)=>{const n=r;n!==e&&t(r=e,n)}))),e&&this.read((t=>function(t,e){switch(e){case"off":t.setAttribute("disabled","");break;case"ro":case"-ro":t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly","");break;default:t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly",""),t.removeAttribute("readonly")}}(e.element,t)))}derive(t){return this._derived.add(ke(Yt(t)?t:t(this._control)).do(on(this._control))).needs(this._control)}}function yc(t){const e=mr(t);if(!e.length)return Re("on");return Ce(...e.map((({parent:t})=>t.aspect(dc)))).do(Ze(_c))}function _c(...t){return mc(...Or(...t))}function mc(...t){let e=!1,n=!1;for(const r of t)switch(r){case"off":return"off";case"ro":e=!0;break;case"-on":n=!0;break;case"-ro":n=!0,e=!0}return n?e?"-ro":"-on":e?"ro":"on"}const wc={applyTo:t=>Du(t,bc,(t=>Ae({value:t,mode:t.aspect(dc)}).do(Ze((({value:[t],mode:[e]})=>dc.hasData(e)?t:void 0)))))},bc={get[Eu](){return wc}},vc={applyTo:t=>Ou(t,xc)};class xc extends oc{static get[Eu](){return vc}_applyAspect(t){return t===vc?Ou(this,xc,this):super._applyAspect(t)}}const Sc=Re();function Ac(){return Sc}const Cc={};class $c{constructor(t){const e=new qe,n=new Map,r=new Map;let s=Z,o=Z;this._messages=ve((t=>{const i=ke(e,z())(t).whenOff((()=>{s=Z,o=Z}));o=(t,e)=>{const n=t(((...e)=>{if(e.length)r.set(t,e);else if(!r.delete(t))return;s()})).needs(e).whenOff((n=>{n!==Cc&&e.off(n),r.delete(t)&&s()}));i.whenOff((()=>n.off(Cc)))},yr(n.entries(),(([t,e])=>o(t,e))),s=()=>{e.send(...Nr(r.values()))},r.size&&s()})).do(Te,on(t)),this.from=e=>{const r=function(t){return Yt(t)?M(ke(t)):"function"==typeof t?e=>ke(t(e)):e=>e.read.do(un((n=>n(...F(t.validate(e))))))}(e)(t),s=new It((()=>{n.delete(r)}));return n.set(r,s),o(r,s),s.needs(t)}}[Xt](){return this._messages}}const kc={applyTo:t=>Du(t,Rc,((t,e)=>{const n=new Ec(t);return e&&n.by(e.aspect(Rc).read.do(un(((t,e)=>t(...e.messages()))))),n}))};class Rc{static get[Eu](){return kc}[Xt](){return this.read}}const Oc={get ok(){return!0},messages:()=>[],has:()=>!1,hasBut:()=>!1,[Symbol.iterator]:()=>kr(),[Xn]:t=>kr()};class Dc{constructor(t){this._byCode=new Map,this._all=[],this._it=pr(this._all),t.forEach((t=>{let e=!1;yr(Vr(t),(([n,r])=>{if(r){e=!0;const r=this._byCode.get(n);r?r.push(t):this._byCode.set(n,[t])}})),e&&this._all.push(t)}))}get ok(){return!this._all.length}messages(t){return null==t?this._all:this._byCode.get(t)||[]}has(t){return null==t||this._byCode.has(t)}hasBut(...t){return this._all.some((e=>t.every((t=>!e[t]))))}[Symbol.iterator](){return this[Xn]()}[Xn](t){return this._it[Xn](t)}}function Tc(...t){return t.length?new Dc(t):Oc}class Ec extends Rc{constructor(t){super(),this._messages=new $c(t),this.read=ke(this._messages).do(Ze(Tc));const e=t.aspect(oc);e&&this._messages.from(function(t){return t.controls.read.do(je((t=>Ce(...jr(t,(t=>t.aspect(Rc)))))),un(((t,...e)=>t(...Mr(e,(([t])=>t))))))}(e))}by(...t){return this._messages.from(function(...t){const e=t.length;return 1===e?t[0]:e?e=>{const n=new $c(e);return t.forEach((t=>n.from(t))),n}:Ac}(...t))}}function Pc(t){return t?t.read.do(un(((t,e)=>e?t():t({missing:"missing"})))):Pc}const Fc={applyTo:t=>Du(t,zc,(t=>new Nc(t)))};class Bc extends Error{constructor(...t){super(),this.errors=Tc(...t.map((t=>t.submit?t:c(u({},t),{submit:!0}))))}}class Mc extends Bc{constructor(t){super({submit:"rejected",rejected:t,[t]:!0})}}class zc{static get[Eu](){return Fc}[Xt](){return this.read}}class Nc extends zc{constructor(t){super(),this._control=t,this._flags=mn({submitted:!1,busy:!1}),this._errors=mn([]),this.read=Ae({flags:this._flags,data:this._control.aspect(bc),messages:this._control.aspect(Rc)}).do(on(this._control),Ze((({flags:[t],data:[e],messages:[n]})=>({ready:void 0!==e&&(n.ok||br(n,(t=>t.submit))),submitted:t.submitted,busy:t.busy}))));t.aspect(Rc).by(this._errors.read.do(un(((t,e)=>t(...e)))))}async submit(t){if(this._control.supply.isOff)throw new Mc("noInput");if(this._flags.it.busy)throw new Mc("busy");const e=this,n=this._control;let r;this._flags.it=c(u({},this._flags.it),{submitted:!0,busy:!0});try{return this._errors.it.length&&(this._errors.it=[]),await t(await async function(){const{data:[t],flags:[{ready:r}]}=await Ae({data:n.aspect(bc),flags:e});return r?t:Promise.reject(new Mc("notReady"))}(),n)}catch(s){throw r=function(t){if(t instanceof Bc)return[...t.errors];return[{submit:t}]}(s),s}finally{this._flags.it=c(u({},this._flags.it),{busy:!1}),r&&(this._errors.it=r)}}reset(){const t=this._flags.it;t.submitted&&(this._flags.it=c(u({},t),{submitted:!1})),this._errors.it.length&&(this._errors.it=[])}}class Lc extends hc{constructor(t,{aspects:e,get:n,set:r}){super({aspects:e}),this.element=t,this._input=new qe;const s=this;this._get=n,this._set=r,this._value=this.it;const o=this._update=(t,e)=>i({value:t},e);function i(t,e){for(;;){let n;s._value=t.value,s._update=(e,r)=>{n=[c(u({},t),{value:e}),r]};try{s._input.send(t,e)}finally{s._update=o}if(!n)break;[t,e]=n}}this.events=new xn(t),this.events.supply.needs(this),this.listenForInput((t=>i(t,this._value))),this.on=this._input.on.do(Qe(((t,{value:e},n)=>e!==n&&t(e,n)))),this.input=this._input.on.do(Ze(K,(()=>({value:this.it}))))}get supply(){return this._input.supply}get it(){return this._get()}set it(t){const e=this.it;t!==e&&(this._set(t),this._update(this._get(),e))}listenForInput(t){const e=e=>t({value:this.it,event:e});this.events.on("input")(e),this.events.on("change")(e)}}function Uc(t,{aspects:e}={}){return new Lc(t,{get(){return this.element.value},set(t){this.element.value=t},aspects:e})}const jc={applyTo:t=>Du(t,qc,(t=>{const e=t.aspect(hc);return e&&new Wc(e)}))};class qc extends yn{static get[Eu](){return jc}}class Wc extends qc{constructor(t){super();const{element:e,events:n}=t,r=e.getRootNode?e.getRootNode():e.ownerDocument;this._it=mn(r.activeElement===e),this.supply.needs(t),n.on("focus")((()=>this._it.it=!0)),n.on("blur")((()=>this._it.it=!1)),this.on({receive(t,n){t.onRecurrent(Z),n?e.focus():e.blur()}})}get supply(){return this._it.supply}get it(){return this._it.it}set it(t){this._it.it=t}get on(){return this._it.on}}const Ic={applyTo:t=>Du(t,Vc,(t=>{const e=t.aspect(oc);return null!=e?new Kc(e):new Hc(t)}))};class Vc{static get[Eu](){return Ic}[Xt](){return this.read}}const Gc={hasFocus:!1,touched:!1,edited:!1};class Hc extends Vc{constructor(t){super(),this._flags=mn(Gc),this._flags.supply.needs(t),this._flags.by(function(t,e){const n=e.aspect(hc);return Ae({hasFocus:e.aspect(qc)||Re(!1),edited:n?n.input.do(Ze((({event:t})=>!!t))):Re(!1)}).do(Ze((({hasFocus:[e],edited:[n]})=>function(t,e,n){t=c(u({},t),e?{hasFocus:e,touched:!0}:{hasFocus:e});n&&(t=c(u({},t),{edited:n,touched:!0}));return t}(t.it,e,n))))}(this._flags,t))}get read(){return this._flags.read}markTouched(t=!0){const e=this._flags.it;return t?e.touched||(this._flags.it=c(u({},e),{touched:t})):e.touched&&(this._flags.it=c(u({},e),{touched:e.hasFocus,edited:!1})),this}markEdited(t=!0){const e=this._flags.it;return t?e.edited||(this._flags.it=c(u({},e),{touched:!0,edited:t})):e.edited&&(this._flags.it=c(u({},e),{edited:t})),this}}class Kc extends Vc{constructor(t){var e;super(),this._container=t,this.read=(e=this._container).controls.read.do(on(e),je((t=>Ce(...function(t){return jr(t,(t=>t.aspect(Vc)))}(t)))),Ze(Qc))}markEdited(t){return this._container.controls.read.do(en)((e=>yr(e,(e=>e.aspect(Vc).markEdited(t))))),this}markTouched(t){return this._container.controls.read.do(en)((e=>yr(e,(e=>e.aspect(Vc).markTouched(t))))),this}}function Qc(...t){const e={hasFocus:!1,touched:!1,edited:!1};return yr(t,(([{hasFocus:t,touched:n,edited:r}])=>{n&&(e.touched=!0),t&&(e.hasFocus=e.touched=!0),r&&(e.edited=e.touched=!0)})),e}function Jc(t,e){const{form:n,aspects:r,modes:s}=e,o=new Lc(t,{aspects:[Gu(r)],get:Z,set:Z});return o.supply.needs(n),o.setup(dc,(t=>t.derive(function(t,{notReady:e="on",invalid:n="on",busy:r="ro"}={}){return t.aspect(zc).read.do(Ze((t=>mc(t.busy?r:"on",t.ready?"on":t.submitted?n:e))))}(n,s))))}const Zc={applyTo(t){const e=t.aspect(hc);return e?Ru(e.element):ku()}},Xc={get[Eu](){return Zc},to:(t=null)=>({applyAspect:e=>e===Zc?Ru(t):void 0})},Yc={applyTo:t=>({instance:new ra(t),convertTo:Z})};class ta{static get[Eu](){return Yc}[Xt](){return this.read}}const ea=Symbol("reason");function na(t){return t&&"object"==typeof t&&ea in t}class ra extends ta{constructor(t){super(),this._control=t,this._sources=mn([new Map]),t.supply.whenOff((t=>this.done(t))),this.read=this._sources.read.do(on(this._control),je((([t])=>Ce(...t.keys()))),Xe(((...t)=>{const e={};return t.forEach((([t])=>sa(t,e))),e}))),this.track=ve((t=>{t.supply.needs(this._control);const e=new Au,n=new se;let r=!1;return n.on(t),this.read((t=>{const s=new Set(e),o=[];yr(Fr(Vr(t),(([,t])=>!!t)),(([t])=>{s.delete(t)||o.push(t)})),(!r||o.length||s.size)&&(e.delta(o,s),r=!0,e.redelta(((t,e)=>n.send(t,e))).undelta())}))}));const e=t.aspect(Xc);e&&this.applyTo(e,this.schedule)}get schedule(){return this._schedule||(this._schedule=oa(this._control,this._control.aspect(Xc)))}specs(t){return ke(Yt(t)?t:t(this._control))}resolve(t){const e=this._control.aspect(Bu);return this.specs(t).do(Ze(((...t)=>{const n={};return t.forEach((t=>{Ot(t)?n[$t.name(t,e)]=!0:sa(t,n)})),n})))}add(t){const e=this._control.supply;if(e.isOff)return e;const n=new It,r=ve((e=>{const r=this.resolve(t)({receive(t,...n){e.receive(t,...n)}});e.supply.whenOff((t=>{n.off({[ea]:t})})),n.needs(r).whenOff((t=>{na(t)&&r.off(t[ea])}))})).do(Te),[s]=this._sources.it;return s.set(r,n),n.whenOff((t=>{na(t)||(s.delete(r),this._sources.it=[s])})),this._sources.it=[s],n.needs(e)}applyTo(t,e=oa(this._control,t)){const{classList:n}=t,r=new Au,s=()=>{r.redelta(((t,e)=>{n.remove(...e),n.add(...t)})).undelta()};return this.track(((t,n)=>{r.delta(t,n),e(s)})).whenOff((()=>{r.size&&(r.clear(),e(s))}))}done(t){return yr(this._sources.it[0].values(),(e=>e.off(t))),this._sources.supply.off(t),this}}function sa(t,e){yr(Vr(t),(([t,n])=>{null!=n&&(e[t]=n)}))}function oa(t,e){return t.aspect(zu)({node:e})}function ia({mark:t,when:e}={}){let n;return n=e?Array.isArray(e)?e.length?t=>e.every((e=>t.has(e))):ua:t=>t.has(e):ua,e=>e.aspect(Rc).read.do(un(((e,r)=>n(r)?e(...function(t){if(!t)return ca;const e=F(t);return e.length?e:ca}(t)):e())))}function ua(t){return!t.ok}const ca=[["has-error",Pu]];function aa({ns:t=Pu}={}){return e=>{const n=e=>[e,t];return Ae({md:e.aspect(dc),vl:e.aspect(Rc),st:e.aspect(Vc)}).do(un(((t,{md:[e],vl:[r],st:[{hasFocus:s,touched:o,edited:i}]})=>{const u=[];dc.hasData(e)||u.push(n("disabled")),"ro"!==e&&"-ro"!==e||u.push(n("readonly")),r.ok||u.push(n("invalid")),r.has("missing")&&u.push(n("missing")),r.has("incomplete")&&u.push(n("incomplete")),s&&u.push(n("has-focus")),o&&u.push(n("touched")),i&&u.push(n("edited")),t(...u)})))}}const ha={setupField({sharer:t,control:e}){la(t,e)},setupForm({sharer:t,control:e,element:n}){la(t,e),la(t,n)}};function la(t,e){const n=t.get(Dt),r=t.get(Ni);e.addAspect(Bu,{applyAspect:t=>Ru(n)}).addAspect(zu,{applyAspect:t=>Ru(r)})}function da(t){}function fa(t){}const pa={perContext:v({create:(t,e)=>pa.combine(...t,ha),byDefault:t=>ha,assign:({get:t,to:e,track:n},r)=>{const s={track:ve((t=>n(ce(t),t))),setupField(e){t().setupField(e)},setupForm(e){t().setupForm(e)}};return t=>e(((e,n)=>t(s,n)))}}),combine:(...t)=>({setupField:ga(t),setupForm:ya(t)}),toString:()=>"[FormPreset]"};function ga(t){return t.reduce(((t,e)=>e.setupField?n=>{t(n),e.setupField(n)}:t),da)}function ya(t){return t.reduce(((t,e)=>e.setupForm?n=>{t(n),e.setupForm(n)}:t),fa)}class _a extends vu{constructor(t){super(t)}get control(){var t;return null===(t=this.body)||void 0===t?void 0:t.control}sharedBy(t){super.sharedBy(t),this.read(Z).needs(t)}}class ma extends _a{static by(t){return new this(this.providerBy(t))}static providerBy(t){return e=>({control:e.control.build(t)})}constructor(t){var e,n;super((e=()=>this,n=q(t),t=>t.get(pa).track.do(je((r=>{const s={sharer:t,field:e(),control:new Xu};return r.setupField(s),Oe(n(s))})),Me(wa,(([t])=>t)),Ze((t=>t&&{field:e(),control:t.control})))))}toString(){return"[Field]"}}function wa(t,e){return(null==t?void 0:t.control)===(null==e?void 0:e.control)||(null==t||t.control.supply.off(),!1)}const ba=new WeakMap;class va extends yu{static get share(){let t=ba.get(this);return t||(t=new this("field"),ba.set(this,t)),t}}const xa=new WeakMap;class Sa extends yu{static get share(){let t=xa.get(this);return t||(t=new this("form"),xa.set(this,t)),t}}function Aa(t,e){return new ma((n=q(t),r=wu(e,{local:"too"}),t=>r(t.sharer).do(Ue(((e,r)=>e?e.read.do(Ue((r=>r?Oe(n(c(u({},t),{adjacentTo:e,adjusted:r}))):Re()))):Re())))));var n,r}function Ca(t){return"string"==typeof t?t:null}function $a(t={}){return function(t={}){return({key:e,share:n,locateForm:r,name:s,amend:o})=>{const{name:i=s}=t;let u;if(i)u=i;else{if(null!=i)return;{const t=Ca(e);if(!t)return;u=t}}const c=wu(t.form||r,{share:Sa});o({componentDef:{setup(t){t.whenComponent((t=>{Ae({unit:t.get(n).do(je(K,z())),form:c(t).do(je(((t,e)=>t),z()))}).do(De((({unit:[t],form:[e]})=>{if(!e||!t)return;const n=e.control.aspect(xc);return n?n.controls.set(u,t.control):void 0})))}))}}})}}(t)}const ka={applyTo:t=>ku()};class Ra extends _a{static forElement(t,e,n){return{control:t,element:Jc(e,c(u({},n),{form:t}))}}static by(t,e){return new this(this.providerBy(t,e))}static providerBy(t,e){return n=>{let r=()=>n.control.build((e=>(r=N((()=>t(e))))())),s=()=>n.element.build((t=>(s=N((()=>e(u({form:r()},t)))))()));return{get control(){return r()},get element(){return s()}}}}static get[Eu](){return ka}constructor(t){super(function(t,e){const n=e=>({applyAspect:n=>Ou(e,Ra,t())});return r=>r.get(pa).track.do(je((s=>{const o={sharer:r,form:t(),control:(new Xu).addAspect(Ra,n),element:(new Xu).addAspect(Ra,n)};return s.setupForm(o),Oe(e(o))})),Me(Oa,(([t])=>t)),Ze((e=>e&&{get form(){return t()},get control(){return e.control},get element(){return e.element}})))}((()=>this),q(t)))}get element(){var t;return null===(t=this.body)||void 0===t?void 0:t.element}toString(){return"[Form]"}}function Oa(t,e){let n=!0;return(null==t?void 0:t.control)!==(null==e?void 0:e.control)&&(null==t||t.control.supply.off(),n=!1),(null==t?void 0:t.element)!==(null==e?void 0:e.element)&&(null==t||t.element.supply.off(),n=!1),n}const Da={createSetup(t,e,n="default"){if(!1===t)return t=>Zt();if(!0===t)return t=>e(t).supply;let r=F(t);return r.length||(r=[n]),1===r.length?t=>t.aspect(Lu).when(r[0],(()=>e(t))):t=>r.reduce(((n,r)=>t.aspect(Lu).when(r,(()=>e(t))).as(n)),new It)}},Ta=new WeakMap;class Ea{constructor(){this.entry=pa}static get[lo](){const t=Ta.get(this);if(t)return t;const e=new this,n={setup:t=>{t.provide(e)}};return Ta.set(this,n),n}placeAsset(t,e){e(this)}}const Pa={createSetup(t,e,n){let r,s;if(Array.isArray(t)){const[e,...n]=t;Fa(e)?(r=n.length>1?n:n[0],s=e):r=t}else Fa(t)?s=t:r=t;return Da.createSetup(r,e(s),n)}};function Fa(t){return null!=t&&"string"!=typeof t&&"boolean"!=typeof t}function Ba(t={},...e){let n,r,s;"function"==typeof t||st(t)?(n={},s=it([t,...e,$a()])):(n=t,r=t.name,s=it([...e,$a({name:r})]));const{share:o=va,form:i}=n,h=wu(i,{share:Sa});return function(t,...e){const{share:{share:n},local:r=!1}=t;return Eo((t=>{const s=Symbol(`${String(t.key)}:shared`);let o=t;const i=t=>t[s]||(t[s]=new Su(o,t)),h=t=>i(t).val.read;it([...e,t=>{o=t,t.amend({get:t=>i(t).get(),set:t.writable?(t,e)=>i(t).set(e):void 0,componentDef:{setup(e){e.perComponent(function(t,e){return{entry:t,setupAsset(n){const r=t.createRegistrar(n,e);return t.shareValue(r),r.supply}}}(t.share,{provide:({context:t})=>t.onceReady.do(je((({component:t})=>i(t).val),z()))}))},define(e){t.share.addSharer(e,{local:t.localShare})}}})}])(ut({base:c(u({},t),{share:n,localShare:r,getShared:h}),amend(e,n={}){const r=n,{share:s=e.share,localShare:o=e.localShare,getShared:i}=r,l=a(r,["share","localShare","getShared"]),d=t.amend(l);return()=>c(u({},d()),{share:s,localShare:o,getShared:h})}}))}))}(o,(t=>{var e,n;s(ut({base:c(u({},t),{locateForm:h,name:(e=t.key,n=r,""===n?null:n||Ca(e))}),amend(e,n={}){const r=n,{locateForm:s=e.locateForm,name:o=e.name}=r,i=a(r,["locateForm","name"]),h=t.amend(i);return()=>c(u({},h()),{locateForm:s,name:o})}}))}))}function Ma(t){return">"===t||"+"===t||"~"===t}function za(t){const e=t.length,n=t.charCodeAt(0);let r="",s=0;if(45===n){const n=t.charCodeAt(1);if(n>47&&n<58?(r+=`-\\${n.toString(16)} `,s=2):(r="-",s=1),1===e)return"\\-"}else n>47&&n<58&&(r+=`\\${n.toString(16)} `,s=1);for(;s<e;++s){const e=t.charCodeAt(s);r+=e>96&&e<123||45===e||95===e||e>47&&e<58||e>64&&e<91?t[s]:e>126?127===e?`\\${e.toString(16)} `:t[s]:e<32?e?`\\${e.toString(16)} `:"\ufffd":`\\${t[s]}`}return r}function Na(t){let e="";const n=t.length;for(let r=0;r<n;++r){const n=t.charCodeAt(r);e+=n<32||127===n?n?`\\${n.toString(16)} `:"\ufffd":34===n||92===n?`\\${t[r]}`:t[r]}return e}class La{name(t,e){if("string"==typeof t)return t;const[n,r]=t;return r.name(e(r),n,this)}}class Ua extends La{applyAlias(t,e){return`${e}-${t}`}}const ja=new Ua,qa=new Ua;class Wa extends La{applyAlias(t,e){return`${e}:${t}`}}const Ia=new Wa;class Va extends La{applyAlias(t,e){return`${t}@${e}`}}const Ga=new Va;function Ha(t){return Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&function(t){if(t instanceof class{constructor(t,...e){this.url=t,this.aliases=e}get alias(){return this.aliases[0]||"ns"}name(t,e,n=ja){return n.applyAlias(e,t,this)}})return!0;return"object"==typeof t&&"string"==typeof t.url&&"string"==typeof t.alias&&Array.isArray(t.aliases)&&"function"==typeof t.name}(t[1])}function Ka(t,e){if("string"==typeof t)return"string"==typeof e?Qa(t,e):e[1].url?-1:Qa(t,e[0]);const[n,{url:r}]=t;return"string"==typeof e?r?1:Qa(n,e):Qa(r,e[1].url)||Qa(n,e[0])}function Qa(t,e){return t<e?-1:t>e?1:0}function Ja(){const t=new Map,e=new Map;return function(n){const r=t.get(n.url);if(r)return r;const s=n.alias;let o=0;for(const u of[s,...n.aliases]){const r=e.get(u);if(!r)return t.set(n.url,u),e.set(u,1),u;o||(o=r)}const i=`${s}${++o}`;return t.set(n.url,i),e.set(s,o),i}}function Za(t){return Array.isArray(t)}const Xa=Symbol("push-iterator");function Ya(t){return!!t[Xa]}function th(t){return t[Symbol.iterator]()}function eh(){return this[Xa]()}function nh(){return this}function rh(){for(;;){let e;const n=(t=t=>(e={value:t},!0),!!this[Xa](t).isOver());if(e)return e;if(n)return{done:!0}}var t}function sh(){return{done:!0}}function oh(t){}const ih={[Symbol.iterator]:nh,[Xa](t){return this},next:()=>({done:!0}),isOver:()=>!0};function uh(t,e){return t[Xa](e)}function ch(t,e){return t[e]}function ah(t){return e=t,n=ch,t=>{let r=0;const s=t=>{if(r>=e.length)return!1;for(;;){const s=t(n(e,r++));if(r>=e.length||!1===s)return!1;if(!0===s)return!0}};if(t&&!s(t))return ih;let o=!1,i=t=>{t&&!s(t)&&(o=!0,i=oh,u=sh)},u=()=>r<e.length?{value:n(e,r++)}:(o=!0,i=oh,u=sh,{done:!0});return{[Symbol.iterator]:nh,[Xa](t){return i(t),this},next:()=>u(),isOver:()=>o}};var e,n}function hh(t,e){return Ya(t)?uh(t,e):Array.isArray(t)?function(t,e){return t.length?ah(t)(e):ih}(t,e):function(t,e){const n=th(t);if(Ya(n))return uh(n,e);const r=function(t){return e=>{for(;;){const n=t.next();if(n.done)return!1;const r=e(n.value);if("boolean"==typeof r)return r}}}(n);return r(e)?function(t,e){let n=!1,r=t=>{(n=!!t&&!e(t))&&(r=oh,s=sh)},s=()=>{const e=t.next();return e.done&&(n=!0,r=oh,s=sh),e};return{[Symbol.iterator]:nh,[Xa](t){return r(t),this},next:()=>s(),isOver:()=>n}}(n,r):ih}(t,e)}function lh(t,e=fh){return n=n=>{const r=Ya(t)?dh(t,e):function(t,e){const n=th(t);if(Ya(n))return dh(n,e);let r;return t=>{for(;;){if(!r){const t=n.next();if(t.done)return!1;r=e(t.value)}let s;const o=hh(r,(e=>s=t(e)));if(r=o.isOver()?void 0:o,"boolean"==typeof s)return s}}}(t,e);return n&&!r(n)?ih:function(t){let e=!1,n=r=>{r&&!t(r)&&(e=!0,n=oh)};return{[Symbol.iterator]:nh,[Xa](t){return n(t),this},next:rh,isOver:()=>e}}(r)},{[Symbol.iterator]:eh,[Xa]:n};var n}function dh(t,e){let n,r=!1;return s=>{for(;;){for(;!n;){const s=uh(t,(t=>(n=e(t),!0)));if(t=s,s.isOver()){if(!n)return!1;r=!0}}let o;const i=hh(n,(t=>o=s(t)));if(i.isOver()){if(n=void 0,r)return!1}else n=i;if("boolean"==typeof o)return o}}}function fh(t){return t}const ph=Symbol("DoqryPicker");class gh extends Array{get[ph](){return this}}function yh(t){const e=t[ph];if(e)return e;if(!Za(t))return new gh(_h(t));const n=new gh;let r;for(const s of t){const t=r;let e;if(r&&(n.push(r),r=void 0),Ma(s)){if(r=s,!t)continue;e={}}else e=_h(s);n.push(e)}return r&&n.push(r,{}),n}function _h(t){return"string"==typeof t?t?{s:t}:{}:mh(t)}function mh(t){const e=t.ns||void 0,n=t.i||void 0,r=function(t){if(!t)return;if(e=t,"string"==typeof e||Ha(e))return[t];var e;const n=t.filter((t=>!!t));return n.length?n.sort(Ka):void 0}(t.c),s=function(t){if(!t)return;if(function(t){return"string"!=typeof t[0]}(t)){const e=t.map(wh);return e.length?e:void 0}return[wh(t)]}(t.u);return{ns:e,e:("*"!==t.e||!e&&!n&&!r&&s&&bh(s[0]))&&t.e||void 0,i:n,c:r,u:s,s:t.s||void 0,$:vh(t.$)}}function wh(t){if(!bh(t))return t;if(t.length<3)return t;const[e,n,...r]=t;return Za(r[0])?[e,n,...r.map(yh)]:[e,n,yh(r)]}function bh(t){return t.length>1&&(":"===t[0]||"::"===t[0])}function vh(t){if(t)return(t=Za(t)?[...new Set(lh(t,Sh))].sort():[...Sh(t)]).length?t:void 0}const xh=new Set;function Sh(t){if(!t)return xh;const e=t.indexOf("="),n=e<0?t:t.substring(0,e),r=new Set;let s;for(const o of n.split(":"))s?s+=":"+o:s=o,r.add(s);return e>=0&&r.add(t),r}function Ah(t){return yh(t)}const Ch={};function $h(t,{qualify:e,nsAlias:n=Ja()}=Ch){const r={qualify:e,nsAlias:n};return t.reduce(((t,e)=>Ma(e)?t+e:(t&&!Ma(t[t.length-1])&&(t+=" "),t+function(t,{qualify:e,nsAlias:n}){const{ns:r,e:s,i:o,c:i,s:u,u:c,$:a}=t;let h=!1,l="";o&&(h=!0,l+=`#${za(Ia.name(o,n))}`);i&&(h=!0,l=i.reduce(((t,e)=>`${t}.${za(Ga.name(e,n))}`),l));if(c){h=!0;const t={nsAlias:n};l=c.reduce(((e,n)=>function(t,e,n){if(bh(e)){t+=e[0]+e[1];if(e.length>2){t+="("+$h(e[2],n);for(let r=3;r<e.length;++r)t+=","+$h(e[r],n);t+=")"}return t}const[r,s,o,i]=e;t+="["+za(r),s&&(t+=`${s}"${Na(o)}"`);i&&(t+=" "+i);return t+"]"}(e,n,t)),l)}u&&(h=!0,l+=u);e&&a&&(l=a.reduce(((t,n)=>t+e(n)),l));if(r){const t=function(t,e){return"string"==typeof t?t:t.url?e(t):void 0}(r,n);l=t?`${t}|${s||"*"}${l}`:d()}else l=d();return l;function d(){return h?`${s?qa.name(s,n):""}${l}`:`${s?qa.name(s,n):"*"}${l}`}}(e,r))),"")}const kh={qualify(t){const e=t.indexOf("=");if(e<0)return Rh(t);return`${Rh(t.substr(0,e))}(${Na(t.substr(e+1))})`}};function Rh(t){return"@"===t[0]?"@"+Oh(t.substr(1)):"$"+Oh(t)}function Oh(t){return t.split(":").map(za).join(":")}function Dh(t){return Array.isArray(t)}class Th{constructor(t){this.priority=t&&t.priority||0}important(){return this.prioritize(1)}usual(){return this.prioritize(0)}}function Eh(t,e){return t===e||("object"==typeof t?t.is(e):"object"==typeof e&&e.is(t))}class Ph extends Th{}class Fh extends Ph{constructor(t,e){super(e),this.r=zh(t.r,255),this.g=zh(t.g,255),this.b=zh(t.b,255),this.a=null!=t.a?Nh(t.a,1):1}get type(){return"rgb"}get rgb(){return this}get hsl(){const{a:t}=this,e=100*this.r/255,n=100*this.g/255,r=100*this.b/255,s=Math.max(e,n,r),o=Math.min(e,n,r),i=Math.round((s+o)/2);if(s===o)return new Bh({h:0,s:0,l:i,a:t},this);const u=s-o,c=Math.round(i>50?100*u/(200-s-o):100*u/(s+o));let a;switch(s){case e:a=(n-r)/u+(n<r?6:0);break;case n:a=(r-e)/u+2;break;default:a=(e-n)/u+4}return a*=60,a=Math.round(a),new Bh({h:a,s:c,l:i,a:t},this)}by(t){return Mh.by(t)||this}is(t){return"object"==typeof t&&t.type===this.type&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a&&t.priority===this.priority}prioritize(t){return this.priority===t?this:new Fh(this,{priority:t})}set(t){"function"==typeof t&&(t=t(this));const{r:e=this.r,g:n=this.g,b:r=this.b,a:s=this.a}=t;return new Fh({r:e,g:n,b:r,a:s},this)}toString(){const t=`${this.r}, ${this.g}, ${this.b}`;return 1===this.a?`rgb(${t})`:`rgba(${t}, ${this.a})`}}class Bh extends Ph{constructor(t,e){var n;super(e),this.h=(n=t.h,(n%=360)<0?360+n:n),this.s=Nh(t.s,100),this.l=Nh(t.l,100),this.a=null!=t.a?Nh(t.a,1):1}get type(){return"hsl"}get rgb(){const{a:t}=this,e=this.s/100,n=this.l/100;if(!e){const e=255*n;return new Fh({r:e,g:e,b:e,a:t},this)}const r=n<.5?n*(1+e):n+e-n*e,s=2*n-r,o=this.h/360;return new Fh({r:Lh(s,r,o+1/3),g:Lh(s,r,o),b:Lh(s,r,o-1/3),a:t},this)}get hsl(){return this}by(t){return Mh.by(t)||this}is(t){return"object"==typeof t&&t.type===this.type&&t.h===this.h&&t.s===this.s&&t.l===this.l&&t.a===this.a&&t.priority===this.priority}prioritize(t){return this.priority===t?this:new Bh(this,{priority:t})}set(t){"function"==typeof t&&(t=t(this));const{h:e=this.h,s:n=this.s,l:r=this.l,a:s=this.a}=t;return new Bh({h:e,s:n,l:r,a:s},this)}toString(){const t=`${this.h}, ${this.s}%, ${this.l}%`;return 1===this.a?`hsl(${t})`:`hsla(${t}, ${this.a})`}}const Mh={by(t){if("object"==typeof t&&("rgb"===t.type||"hsl"===t.type))return t}};function zh(t,e){return Nh(Math.round(t),e)}function Nh(t,e){return Math.max(Math.min(t,e),0)}function Lh(t,e,n){let r,s=n;return s<0?s+=1:s>1&&(s-=1),r=s<1/6?t+6*s*(e-t):s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t,255*r}function Uh(t,e,n){const r=2*n-1,s=t.rgb,o=e.rgb,i=s.a-o.a,u=((r*i==-1?r:(r+i)/(1+r*i))+1)/2,c=1-u;return new Fh({r:s.r*u+o.r*c,g:s.g*u+o.g*c,b:s.b*u+o.b*c,a:s.a*n+o.a*(1-n)},t)}class jh extends Th{constructor(t){super(t),this.dim=t.dim}by(t){return this.dim.by(t)||this}toString(){return this.toFormula()}}const qh={map(t,e){const n={},r={from:e,get(r){if(r in n)return n[r];const s=function(t){switch(typeof t){case"function":return t;case"object":return t.by.bind(t)}const e=typeof t;return n=>typeof n===e?n:t}(t[r])(e[r],this,r);return n[r]=s,s}};return yr(Er(t),(t=>r.get(t))),n},by:t=>qh.map.bind(void 0,t)};function Wh(t){if(null==t)return[void 0,0];switch(typeof t){case"object":return[t,t.priority];case"string":if(t.endsWith("!important"))return[t.substring(0,t.length-"!important".length).trim(),1]}return[t,0]}class Ih extends jh{constructor(t,e,n){super(n),this.val=t,this.unit=e}get type(){return"dimension"}toDim(t){const e=this.dim;if(t===e||t===e.pt||t===("%"===this.unit?t.pt:e.noPt))return this}is(t){return t===this||"object"==typeof t&&t.type===this.type&&this.unit===t.unit&&this.val===t.val&&this.priority===t.priority}prioritize(t){return this.priority===t?this:new Ih(this.val,this.unit,{dim:this.dim,priority:t})}add(t,e){return"number"==typeof t&&(t=Vh(t,e||this.unit,this)),"dimension"===t.type&&this.unit===t.unit?Vh(this.val+t.val,this.unit,this):Kh(this,"+",t)}sub(t,e){return"number"==typeof t&&(t=Vh(t,e||this.unit,this)),"dimension"===t.type&&this.unit===t.unit?Vh(this.val-t.val,this.unit,this):Kh(this,"-",t)}mul(t){return 1===t?this:Vh(this.val*t,this.unit,this)}div(t){return 1===t?this:Vh(this.val/t,this.unit,this)}negate(){return Vh(-this.val,this.unit,this)}toFormula(){return`${this.val}${this.unit}`}}function Vh(t,e,n){return t?new Ih(t,e,n):n.dim.zero.prioritize(n.priority||0)}class Gh extends jh{constructor(t,e,n,r){super(r),this.left=t.usual(),this.op=e,this.right=n}get type(){return"calc"}is(t){return this===t||"object"==typeof t&&t.type===this.type&&(this.op===t.op&&this.left.is(t.left)&&Eh(this.right,t.right)&&this.priority===t.priority)}add(t,e){return"number"==typeof t&&(t=Vh(t,e,this)),Kh(this,"+",t)}sub(t,e){return"number"==typeof t&&(t=Vh(t,e,this)),Kh(this,"-",t)}mul(t){return Jh(this,t)}div(t){return Zh(this,t)}toString(){return"calc"+super.toString()}}class Hh extends Gh{constructor(t,e,n,r){super(t,e,n.usual(),r)}prioritize(t){return this.priority===t?this:new Hh(this.left,this.op,this.right,{dim:this.dim,priority:t})}toDim(t){const e=this.left.toDim(t);if(!e)return;const n=this.right.toDim(t);return n?e===this.left&&n===this.right?this:new Hh(e,this.op,n,{dim:t,priority:this.priority}):void 0}negate(){return"-"===this.op?new Hh(this.right,this.op,this.left,this):new Hh(this.left.negate(),"-",this.right,this)}toFormula(){return`(${this.left.toFormula()} ${this.op} ${this.right.toFormula()})`}}function Kh(t,e,n){return n.type?new Hh(t,e,n,t):t}class Qh extends Gh{prioritize(t){return this.priority===t?this:new Qh(this.left,this.op,this.right,{dim:this.dim,priority:t})}toDim(t){const e=this.left.toDim(t);if(e)return e===this.left?this:new Qh(e,this.op,this.right,{dim:t,priority:this.priority})}mul(t){return("*"===this.op?Jh(this.left,this.right*t):Zh(this.left,this.right/t)).prioritize(this.priority)}div(t){return("/"===this.op?Zh(this.left,this.right*t):Jh(this.left,this.right/t)).prioritize(this.priority)}negate(){return new Qh(this.left,this.op,-this.right,this)}toFormula(){return`(${this.left.toFormula()} ${this.op} ${this.right})`}}function Jh(t,e){return e?1===e?t.prioritize(t.priority):new Qh(t,"*",e,t):t.dim.zero.prioritize(t.priority)}function Zh(t,e){return 1===e?t.prioritize(t.priority):new Qh(t,"/",e,t)}class Xh extends jh{constructor(t,e){super(e),this._byPriority=t}get type(){return 0}toDim(t){return t.zero.prioritize(this.priority)}is(t){return this===t||("object"==typeof t?t.type===this.type&&t.priority===this.priority:0===t||"0"===t?0===this.priority:"0 !important"===t&&1===this.priority)}add(t,e){return"number"==typeof t&&(t=Vh(t,e,this)),t.prioritize(this.priority)}sub(t,e){return"number"==typeof t&&(t=Vh(t,e,this)),t.negate().prioritize(this.priority)}mul(){return this}div(){return this}negate(){return this}prioritize(t){return this._byPriority.get(t)}important(){return this._byPriority.important}usual(){return this._byPriority.usual}toFormula(){return"0"}}class Yh{constructor(t){this.dim=t,this.usual=new Xh(this,{dim:t}),this.important=new Xh(this,{dim:t,priority:1})}get(t){switch(t){case 0:return this.usual;case 1:return this.important}return new Xh(this,{dim:this.dim,priority:t})}}function tl({pt:t,noPt:e}){const n={get zero(){return r},get pt(){return t()},get noPt(){return e()},of(t,e){return t?new Ih(t,e,{dim:this}):r},by(t){if(function(t){return"object"==typeof t&&("dimension"===t.type||"calc"===t.type||0===t.type)}(t))return t.toDim(this)}},r=new Yh(n).usual;return n}const el=tl({pt:()=>nl,noPt:()=>el}),nl=tl({pt:()=>nl,noPt:()=>el});class rl extends Th{constructor(t,e){super(e),this.url=t}get type(){return"url"}static by(t){switch(typeof t){case"string":{const[e,n]=Wh(t);return new rl(e,{priority:n})}case"object":if("url"===t.type)return t}}by(t){return rl.by(t)||this}prioritize(t){return t===this.priority?this:new rl(this.url,{priority:t})}is(t){return"object"==typeof t&&"url"===t.type&&t.url===this.url&&t.priority===this.priority}toString(){return`url("${function(t){let e="";const n=t.length;for(let r=0;r<n;++r){const n=t.charCodeAt(r);e+=n<32||127===n?n?`\\${n.toString(16)} `:"\ufffd":34===n||92===n?`\\${t[r]}`:t[r]}return e}(this.url)}")`}}const sl=Re({});function ol(){return sl}function il(t,e){if(!e)return sl;if("string"!=typeof e){if(Yt(e))return cl(e);if(ie(e))return cl(ul(e));if("function"==typeof e){const n=e(t);if("string"!=typeof n){if(Yt(n))return cl(n);if(ie(n))return cl(ul(n))}return Re(al(n))}}return Re(al(e))}function ul(t){return ke(t,z({}))}function cl(t){return ke(t).do(Xe(al),Fe(hl,ll))}function al(t){return"string"==typeof t?{$$css:t}:t}function hl(t,e){const n=Cr(dl(e));for(const[r,s]of dl(t)){const{value:t}=n.next();if(!t||r!==t[0]||!Eh(s,t[1]))return!1}return!n.next().value}function ll([t]){return u({},t)}function dl(t){return Fr(Vr(t),(([,t])=>tt(t)))}function fl(t,e){return cl(Ae({base:t,addendum:e}).do(Ze((({base:[t],addendum:[e]})=>function(t,e){return $r(Vr(e),((t,[e,n])=>function(t,e,n){pl(t[e])<=pl(n)&&(delete t[e],t[e]=n);return t}(t,e,n)),u({},t))}(t,e)))))}function pl(t){switch(typeof t){case"string":return t.endsWith("!important")?1:0;case"object":return t.priority;default:return 0}}class gl{constructor(t){this._rule=t}read(t){let e=this._rule.outer;for(;e;)t=fl(e.read.do(Ze(ml)),t),e=e.outer;return t}render(t,e){const{selector:n}=t;let{writer:r}=t;if(!r.isGroup)return void t.render(e);let s=r;const o=function(t){const e=new Map,n=[];for(const r of t)Ma(r)?n.push(r):n.push(bl(r,e));if(!e.size)return;return[e,Ah(n)]}(n);if(!o)return void t.render(e);const[i,u]=o;for(const c of i){const[t,n]=yl(e,c);if(!n){r=s.addStyle(t);break}r=s=s.addGroup(t,n)}t.render(e,{writer:r,selector:u})}}function yl(t,[e,[n,r]]){let s="";const o=t=>{t&&(s&&(s+=" and "),s+=t)};for(const i of n){const[e]=Wh(t[i]);o(e)}return o(r),s?[e,s]:[e]}const _l={order:-65535,create:t=>new gl(t)};function ml(t){return $r(Fr(Vr(t),wl),((t,[e,n])=>(t[e]=n,t)),{})}function wl(t){return"@"===String(t[0])[0]}function bl(t,e){const n=t.$;if(!n)return t;const r=[];for(const s of n)"@"===s[0]?vl(e,s):r.push(s);return r.length===n.length?t:r.length?c(u({},t),{$:r}):c(u({},t),{$:void 0})}function vl(t,e){const n=e.indexOf("=");let r,s;n<0?r=e:(r=e.substring(0,n),s=e.substring(n+1));const o=r.indexOf(":"),i=o<0?r:r.substring(0,o),u=t.get(i);if(u){const[t,e]=u;t.add(r),s&&(u[1]=e?`${e} and ${s}`:s)}else t.set(i,[(new Set).add(r),s])}const xl={order:-65534,needs:_l,render(t,e){const n=!t.rule.selector.length,{sheet:r}=t;let s=0,o=0;for(const[i,u]of Vr(e)){const t=String(i);if("@"===t[0]){const[e]=Wh(u),i=n?Sl(r,s,t,e):0;s+=i,o+=i;const c=rl.by(e);c&&(o+=Al(r,o,t,c),o+=Cl(r,o,t,c))}}t.render(e)}};function Sl(t,e,n,r){if(!n.startsWith("@import:"))return 0;const s=new rl(n.substring("@import:".length));let o=String(s);return r&&(o+=` ${r}`),t.addGlobal("@import",o,e),1}function Al(t,e,n,r){return"@namespace"!==n?0:(t.addGlobal("@namespace",String(r),e),1)}function Cl(t,e,n,r){if(!n.startsWith("@namespace:"))return 0;const s=n.substring("@namespace:".length);return t.addGlobal("@namespace",`${s} ${r}`,e),1}function $l(t,e){const n=t.addStyle();yr(Fr(Vr(e),kl),(([t,e])=>{const[r,s]=Wh(e);n.set(function(t){const e=oo.get(t);if(e)return e;let n=io(t);return n.startsWith("ms-")&&(n="-"+n),oo.set(t,n),n}(t),`${r}`,s)})),t.render(e,{writer:n})}function kl(t){const[e,n]=t;if(null==n)return!1;const r=String(e)[0];return r>="a"&&r<="z"||r>="A"&&r<="Z"}function Rl(t,e){const n=e.$$css;if(n){const r=t.addStyle();r.replace(n),t.render(e,{writer:r})}else t.render(e)}const Ol={order:-65535,needs:xl,render(t,e){const n=t.selector.map((t=>!Ma(t)&&t.ns&&"string"!=typeof t.ns?t.ns:null)).filter(tt);if(n.length){const r=(e,n)=>(e[`@namespace:${t.nsAlias(n)}`]=new rl(n.url),e);t.render(n.reduce(r,u({},e)))}else t.render(e)}};function Dl(t){if("function"==typeof t)return{create:()=>({render:t})};if(function(t){return"create"in t}(t))return{order:t.order,needs:t.needs,create:e=>function(t){return"function"==typeof t?{render:t}:t}(t.create(e))};const e=t.render.bind(t);return{order:t.order,needs:t.needs,create:()=>({render:e})}}function Tl(t,e){const n=t.order||0,r=e.order||0;return n>r?1:n<r?-1:0}function El(t,e=Wn){return(n={})=>{const{node:r=t}=n;return e(c(u({},n),{node:r}))}}function Pl(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}const Fl={indent:"  "},Bl={nv:"",eol:"",pre:"",indent(){return this}};class Ml{constructor(t,e=""){this._config=t,this.pre=e}get nv(){return" "}get eol(){return"\n"}indent(){return new Ml(this._config,this.pre+this._config.indent)}}class zl{constructor(t,e){this.f=t,this.selector=e,this.body="",this.nf=t.indent()}get isGroup(){return!1}set(t,e,n){const r=n>=1?" !important":"",{pre:s,nv:o,eol:i}=this.nf;this.body&&(this.body+=`;${i}`),this.body+=`${s}${t}:${o}${e}${r}`}replace(t){this.body=t.trim(),this.body.endsWith(";")&&(this.body=this.body.substr(0,this.body.length-1))}toString(){const{pre:t,nv:e,eol:n}=this.f;if(this.body){const r=n?`;${n}`:"";return`${t}${this.selector}${e}{${n}${this.body}${r}${t}}`}return""}}class Nl{constructor(t){this.nf=t,this._nested=[]}get isGroup(){return!0}addGroup(t,e,n){return this._add(new Ll(this.nf,t,e),n)}addStyle(t,e){return this._add(new zl(this.nf,t),e)}toString(){let t="";for(const e of this._nested){const n=String(e);n&&(t&&(t+=this.nf.eol),t+=n)}return t}_add(t,e=this._nested.length){return this._nested.splice(e,0,t),t}}class Ll extends Nl{constructor(t,e,n){super(t.indent()),this.f=t,this.name=e,this.params=n}toString(){const t=super.toString();if(!t)return"";const{pre:e,nv:n,eol:r}=this.f;return`${e}${this.name} ${this.params}${n}{${r}${t}${r}${e}}`}}class Ul extends Nl{constructor(t,e,n){super(e),this.id=t,this.f=e,this.sender=n}addGlobal(t,e,n){this._add(`${this.f.pre}${t} ${e};`,n)}clear(){this._nested.length=0}remove(){this.clear(),this.sender.send({id:this.id})}done(){this.sender.send({id:this.id,css:this.toString()})}}function jl(t={}){var e;const{document:n=(null===(e=t.parent)||void 0===e?void 0:e.ownerDocument)||window.document,parent:r=n.head}=t,s=function(t={}){const e=!0===t.pretty||null==t.pretty?Fl:t.pretty||!1,{scheduler:n=Hn}=t,r=new qe,s=e?new Ml(e):Bl;let o=0;return c(u({},t),{pretty:e,scheduler:n,onSheet:r.on,addSheet:()=>new Ul(String(++o),s,r)})}(t),o=El(r,t.scheduler),i=o(),a=new Map,h=s.onSheet((({id:t,css:e})=>{let s=a.get(t);null==e?(a.delete(t),Pl(s)):s?s.textContent=e:(s=n.createElement("style"),s.setAttribute("type","text/css"),s.textContent=e,r.appendChild(s),a.set(t,s),h.whenOff((()=>i((()=>Pl(s))))))}));return c(u({},t),{scheduler:o,addSheet(t){return h.needs(t),this.addSheet=s.addSheet.bind(s),this.addSheet(t)}})}class ql{constructor(t){this._target=t}get isGroup(){return!1}set(t,e,n){this._target.style.setProperty(t,e,n>=1?"important":void 0)}replace(t){this._target.style.cssText=t}}class Wl{constructor(t){this._target=t}get isGroup(){return!0}addGroup(t,e,n){return new Wl(this._add(`${t} ${e}{}`,n))}addStyle(t,e){return new ql(this._add(`${t}{}`,e))}_add(t,e=this._target.cssRules.length){const n=this._target.insertRule(t,e);return this._target.cssRules[n]}}class Il extends Wl{constructor(t){super(t.sheet),this._element=t}addGlobal(t,e,n){this._add(`${t} ${e};`,n)}clear(){const{cssRules:t}=this._target;for(;t.length;)this._target.deleteRule(t.length-1)}remove(){Pl(this._element)}done(){}}function Vl(t,e){const{rootSelector:n={e:"body"},scheduler:r=Wn,nsAlias:s=Tt()}=e,o=new It,i={nsAlias:s},u=function(t){const e=new Map;return n(t.renderer),e.delete($l),[...e.values(),Dl($l)].sort(Tl);function n(t){t&&(Dh(t)?t.forEach(r):r(t))}function r(t){if(e.has(t))return;const r=Dl(t);e.set(t,r),n(r.needs)}}(e),c=$r(jr(t,l),((t,e)=>(new It).cuts(e).cuts(t)),new It);const a=function(){const e=new It;return Ie(t)({supply:e,receive:(t,n)=>{n.forEach((t=>l(t).needs(e)))}})}();return o.as(c).as(a);function h(t,e,n){return new class{get supply(){return o}get rule(){return t}get sheet(){return n.sheet}get writer(){return n.writer}get selector(){return n.selector}nsAlias(t){return s(t)}render(r,s){e(s?h(t,e,{sheet:n.sheet,writer:s.writer||n.writer,selector:s.selector||n.selector}):this,r)}addStyle(t=n.selector){const{writer:e}=n;return e.isGroup?e.addStyle(function(t,e){return $h(Ah(t),e)}(t,i)):e}}}function l(t){const[s,o]=function(t){const e=u.map((e=>e.create(t)));return[e.reduce(((t,e)=>e.read?ke(e.read(t)):t),t.read),n(0)];function n(t){return(r,s)=>{const o=t+1;let i;i=o===u.length?Z:n(o);const c=h(r.rule,i,r);e[t].render(c,s)}}}(t);let i;const c=function(t){const e=t.selector;if(!e.length)return Ah(n);if(Ma(e[0]))return[...Ah(n),...e];return e}(t),a=r();return s((function(n){a((()=>{null==i||i.clear();const r=h(t,o,{get sheet(){return i||(i=e.addSheet(r)),i},get writer(){return this.sheet},selector:c});r.render(n),null==i||i.done()}))})).whenOff((function(){a((()=>{const t=i;if(t)return i=void 0,t.remove()}))}))}}function Gl(t){const e=[_l,Ol,xl,Rl];return t&&(Dh(t)?e.push(...t):e.push(t)),e}function Hl(t,e){return Vl(t,c(u({},e),{renderer:Gl(e.renderer)}))}const Kl=Symbol("StypQuery");class Ql{constructor(t){this[Kl]=t}get ns(){return this[Kl].ns}get e(){return this[Kl].e}get i(){return this[Kl].i}get c(){return this[Kl].c}get $(){return this[Kl].$}}function Jl(t){return t[Kl]?t:new Ql(mh(t))}function Zl(t,e){return t&&e.every((e=>t.find((t=>function(t,e){if("string"==typeof t)return"string"==typeof e?t===e:!e[1].url&&e[0]===t;const[n,{url:r}]=t;return"string"==typeof e?!r&&n===e:n===e[0]&&r===e[1].url}(e,t)))))}const Xl=[[]];function Yl(t){if(!t.length)return Xl;let e,n=0;for(;;){const r=t[n++];if(Ma(r)){e=r;continue}return[e?[e,r]:[r],t.slice(n)]}}const td=[];function ed(t){return $h(Ah(t),kh)}class nd{[Xt](){return this.read}add(t){return this.rules.add([],t)}clear(){return this.set()}}class rd{[Xt](){return this.read}[oe](){return this.onUpdate}}class sd extends rd{}class od extends rd{constructor(t,e){let n;super(),this._list=t,e?(this._buildList=()=>Fr(t,e),n=t=>t.filter(e)):(this._buildList=M(t),n=K),this.onUpdate=be((t=>{const e=this._ruleSet||(this._ruleSet=new Set(this._buildList()));Ie(this._list)({supply:t.supply.whenOff((()=>this._ruleSet=void 0)),receive:(r,s,o)=>{s=n(s),((o=n(o)).length||s.length)&&(o.forEach((t=>e.delete(t))),s.forEach((t=>e.add(t))),t.receive(r,s,o))}})})).do(He);const r=M(this);this.read=this.onUpdate.do(Ze(r,r))}[Symbol.iterator](){return this._ruleSet?this._ruleSet.values():Cr(this._buildList())}grab(t){return id(this,t)}}function id(t,e){const n=Jl(e);return new od(t,(t=>function(t,e){const n=Ah(t);if(!n.length)return!1;const r=n[n.length-1],s=Jl(e);return!(s.ns&&r.ns!==s.ns||s.e&&r.e!==s.e||s.i&&r.i!==s.i||s.c&&!Zl(r.c,s.c)||s.$&&!Zl(r.$,s.$))}(t.selector,n)))}class ud extends sd{constructor(t,e){super(),this._root=t,this.nested=e,this._updates=new qe,this.self=function(t,e){const n=new qe,r=[t];e.onUpdate(((e,s)=>{s[0]===t&&(r.length=0,n.send([],[t]))})).cuts(n);class s{[oe](){return n.on}[Symbol.iterator](){return Cr(r)}}return new od(new s)}(t,this),this._it=N((()=>cd(t)));const n=M(this);this.read=this._updates.on.do(Ze(n,n))}get onUpdate(){return this._updates.on}[Symbol.iterator](){return this[Xn]()}[Xn](t){return this._it()[Xn](t)}grab(t){return id(this,t)}add(t,e){return ld(this._root,Ah(t),e,!0)}get(t){return this._get(Ah(t))}_get(t){const[e,n]=Yl(t);if(!n)return this._root;const r=this.nested._rule(ed(e));return r?r.rules.get(n):void 0}watch(t){const e=Ah(t);return ve((t=>{const n=mn({}),r=this.read.do(De((()=>{const t=this._get(e);return t&&t.read((t=>n.it=t)).whenOff((()=>n.it={}))})));return n.read(t).cuts(r)})).do(Te)}_add(t,e){t.rules.onUpdate(((t,e)=>this._updates.send(t,e))),e&&this._updates.send(mr(t.rules),[])}_remove(t){const e=mr(this);this._updates.send([],e),e.forEach((e=>{e.rules._updates.supply.off(t),e._spec.supply.off(t)}))}}function cd(t){return Or(Dr(t),Nr(t.rules.nested,(t=>cd(t))))}class ad extends rd{constructor(t){super(),this._updates=new qe,this._byKey=new Map,this._all=new ud(t,this);const e=M(this);this.read=this._updates.on.do(Ze(e,e))}get onUpdate(){return this._updates.on}[Symbol.iterator](){return this._byKey.values()}grab(t){return id(this,t)}_rule(t){return this._byKey.get(t)}_add(t,e,n){this._byKey.set(t,e),e.rules.onUpdate(((n,r)=>{r[0]===e&&(this._byKey.delete(t),this._updates.send([],[e]))})),n&&this._updates.send([e],[]),this._all._add(e,n)}}class hd extends nd{constructor(t,e,n,r=ol){super(),this._root=t||this,this._selector=e,this._key=n,this._spec=mn(r),this.read=this._spec.read.do(Ue((t=>t(this)))),this._nested=new ad(this)}get root(){return this._root}get outer(){if(void 0!==this._outer)return this._outer;const t=function(t){let e=t.length-1;if(e<=0)return e?void 0:td;do{switch(--e,t[e]){case">":return t.slice(0,e);case"+":case"~":--e;continue;default:return t.slice(0,e+1)}}while(e>0)}(this.selector);return this._outer=t&&this.root.rules.get(t)||null}get selector(){return this._selector}get key(){return this._key}get empty(){return this._spec.it===ol}get rules(){return this._nested._all}set(t){return this._spec.it=t?e=>il(e,t):ol,this}remove(t){return this.rules._remove(t),this}}function ld(t,e,n,r){const[s,o]=Yl(e);if(!o)return t._spec.it=function(t,e){const n=t._spec.it;if(!e)return n;if(t.empty)return t=>il(t,e);return t=>fl(n(t),il(t,e))}(t,n),t;const i=ed(s),u=t.rules.nested._rule(i);if(u)return ld(u,o,n,r);const c=new hd(t.root,[...t.selector,...s],s),a=ld(c,o,n,!1);return t.rules.nested._add(i,c,r),a}const dd=[];class fd{[Xt](){return this.read}clear(){return this.set()}}class pd extends fd{constructor(t,e,n){super(),this._root=t,this._selector=e,this._map=n,this.read=Ae({ms:this._map(this._root),ps:this._root.rules.watch(this._selector)}).do(Ze((({ms:[t],ps:[e]})=>qh.map(t,e))))}add(t){return this._root.rules.add(this._selector,t),this}set(t){return this._root.rules.add(this._selector).set(t),this}}const gd={by(t,e){let n;return n="function"==typeof e?t=>yd(e(t)):M(yd(e)),e=>new pd(e,t,n)}};function yd(t){return Yt(t)?t:Re(t)}class _d{constructor(t){this.refs=t;const e=Ae(this.refs);this.read=e.do(Ze(md))}static by(t,e){const n={};for(const r of Object.keys(t))n[r]=t[r](e);return new _d(n)}[Xt](){return this.read}}function md(t){const e={};for(const n of Object.keys(t))e[n]=t[n][0];return e}const wd=new od({[oe]:()=>We,[Symbol.iterator]:()=>[][Symbol.iterator]()});function bd(...t){return t.length?Ad(t.map(vd)):wd}function vd(t){return"function"==typeof t?function(t){let e;const n=()=>e||(e=Cd(t()));return{[Symbol.iterator]:()=>n()[Symbol.iterator](),[oe]:()=>n()[oe]()}}(t):Cd(t)}function xd(...t){return t.length?Ad(t.map(Sd)):wd}function Sd(t){return"function"==typeof t?function(t){const e=new Set,n=be((n=>{const r=Cd(t());$d(r,e,n),r[oe]()({supply:n.supply.whenOff((()=>e.clear())),receive(t,r,s){s.forEach((t=>e.delete(t))),r.forEach((t=>e.add(t))),n.receive(t,r,s)}})})).do(He);return{[oe]:()=>n,[Symbol.iterator]:()=>e.values()}}(t):Cd(t)}function Ad(t){if(1===t.length){const e=t[0];return e instanceof rd?e:new od(e)}return new od({*[Symbol.iterator](){for(const e of t)yield*e},[oe]:()=>be((e=>{t.forEach((t=>Ie(t)({supply:(new It).needs(e.supply),receive(t,n,r){e.receive(t,n,r)}})))})).do(He)})}function Cd(t){return t instanceof nd?t.rules.self:ie(t)?t:function(t){const e=new Set,n=be((n=>{let r=Zt();const{supply:s}=n;s.cuts(r).whenOff((()=>e.clear())),t.then((t=>{if(!s.isOff){const o=t instanceof nd?t.rules:t;$d(o,e,n),r=Ie(o)({receive(t,r,s){s.forEach((t=>e.delete(t))),r.forEach((t=>e.add(t))),n.receive(t,r,s)}}).needs(s)}})).catch((t=>s.off(t)))})).do(He);return{[oe]:()=>n,[Symbol.iterator]:()=>e.values()}}(t)}function $d(t,e,n){const r=[];if(yr(t,(t=>{r.push(t),e.add(t)})),r.length){const t=new se;t.on(n),t.send(r,[])}}const kd={perContext:T(co,C({byDefault:t=>Vl})),toString:()=>"[ComponentStyleProducer]"};function Rd(t,e={},n){const{context:r}=t;return c(u({},e),{document:e.document||Sn(r.element),parent:e.parent||r.contentRoot,rootSelector:[],scheduler:e.scheduler||Od(r,n),nsAlias:e.nsAlias||r.get(Dt),renderer:t.renderer(e)})}function Od(t,e={}){const n=t.get(Ni);return(t={})=>n(u(u({},t),e))}const Dd={perContext:p(),toString:()=>"[ComponentStypRenderer]"},Td=new kt("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Ed={perContext:C({byDefault:function(t){const e=t.get(Dt),n=t.get(Do),{tagName:r="component"}=n.get(Xo).elementDef,s=`${r}#${++Pd}`,o=Td.name(e(Td),s,$t);return n.element.classList.add(o),o}}),toString:()=>"[ElementIdClass]"};let Pd=0;const Fd=C({byDefault:t=>new Nd(t.get(Do))});class Bd{static perContext(t){return Fd(t)}static toString(){return"[ComponentStypFormat]"}produce(t,e){const n=this.newProducer(t,e),r=new It;return this.context.whenSettled((()=>n().as(r))),r}newProducer(t,e){const n=xd(t);let r;const s=this.context.supply;return r=()=>this.context.get(kd)(n,this.format(e)).needs(s),s.whenOff((()=>{r=M(s)})),()=>r()}renderer(t){const e=this.context.get(Li,{or:null}),{renderer:n}=t,r=G(V(n),this.context.get(Dd)),s=t.hostSelector?Ah(t.hostSelector)[0]:void 0;return r.add(e?function(t){return{order:-100,render(e,n){let{selector:r}=e;if(r.length){if(t){const[e,n]=Md(r);n&&(r=n.length?[{u:[[":","host",zd(n,t)]]},...e]:[{u:[[":","host",[t]]]},...e])}}else r=[t||{u:[[":","host"]]}];e.render(n,{selector:r})}}}(s):function(t){return{order:-100,render(e,n){let{selector:r}=e;if(r.length){const[e,n]=Md(r);r=n&&n.length?[...zd(n,t),...e]:[t,...e]}else r=[t];e.render(n,{selector:r})}}}(s||{c:[this.context.get(Ed)]})),I(r)}}function Md(t){if("string"!=typeof t[0]){const[{ns:e,e:n,i:r,c:s,u:o,s:i,$:u},...c]=t;if(!e&&!n&&!r&&!s&&!i&&o){const[[t,e,...n]]=o;if(":"===t&&"host"===e){let t;return n.length?(t=n[0].slice(),t[0].$=u):t=u?[{$:u}]:[],[c,t]}}}return[t]}function zd(t,{ns:e,e:n,i:r,c:s,u:o,s:i}){const[u,...c]=t;return[{ns:u.e||u.ns?u.ns:e,e:u.e||u.ns?u.e:n,i:u.i||r,c:u.c?s?[...u.c,...s]:u.c:s,u:u.u?o?[...u.u,...o]:u.u:o,s:(u.s||"")+(i||"")||void 0,$:u.$},...c]}class Nd extends Bd{constructor(t){super(),this.context=t}format(t){return function(t={}){const{parent:e=document.head}=t,n=e.ownerDocument;return c(u({},t),{scheduler:El(e,t.scheduler),addSheet(){const t=n.createElement("style");return t.setAttribute("type","text/css"),t.append(n.createTextNode("")),e.appendChild(t),new Il(t)}})}(this.config(t))}config(t){return Rd(this,t,{when:"connected"})}}class Ld extends Bd{constructor(t,{when:e="settled"}={}){super(),this.context=t,this.when=e}format(t){return jl(this.config(t))}config(t){return Rd(this,t,{when:this.when})}}function Ud(t){return Eo((({get:e,amend:n})=>n({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((({component:r})=>{const s=e(r),o="function"==typeof s?s.bind(r):s;n.get(Bd).produce(o,t)}))}))}}})))}const jd={setup(t){t.provide({entry:kd,placeAsset(t,e){e(Hl)}})}};const qd={perContext:T(co,v({create:function(t,e){const n=new Map;for(const r of t){let t,e,s;"function"==typeof r?(t=e=r,s=!0):(t=r.style,e=r.provide.bind(r),s=!1);const o=n.get(t);if(o){const[r,i]=o;n.set(t,[s?Wd(e,r):Wd(r,e),s||i])}else n.set(t,[e,s])}return function(t){const e=n.get(t);if(!e)return t;const[r,s]=e;return s?r:Wd(t,r)}},byDefault:t=>K,assign:({get:t,to:e},n)=>{const r=e=>t()(e);return t=>e(((e,n)=>t(r,n)))}})),toString:()=>"[ThemeStyle]"};function Wd(t,e){return n=>bd(t(n),e(n))}const Id=T(co,C({byDefault:t=>new Gd(t.get(qd))}));class Vd{static perContext(t){return Id(t)}static toString(){return"[Theme]"}ref(t){return t(this.root)}}class Gd extends Vd{constructor(t){var e;super(),this._styles=t,this.root=new hd(void 0,dd,[],e?t=>il(t,e):void 0),this._rules=new Map}style(...t){const e=this;return xd(...t.reduce((function(t,n){const r=e._rules.get(n);if(r)t.push(r);else{const r=e._styles(n)(e);e._rules.set(n,r),t.push(r)}return t}),[]))}}const Hd=new kt("https://wesib.github.io/examples","bex","wesib-examples"),Kd=gd.by({$:"settings"},{$color:new Fh({r:161,g:185,b:142}),$bgColor:new Fh({r:40,g:43,b:36}),$fontFace:"'Exo 2', sans-serif",$fontSize:nl.of(1,"em"),$lineHeight:1.2,$fontWeight:"400",$linkFontWeight:"600",$layoutBreakpoint:el.of(576,"px")});function Qd({$layoutBreakpoint:t}){return{"@media:sm":`(max-width: ${t})`}}function Jd(t){const e=t.ref(Kd).read,{root:{rules:n}}=t;return bd(n.add({e:"a"},e.do(Ze(Zd))),n.add({e:"a",s:":visited"},e.do(Ze(Zd))),n.add({e:"a",s:":hover"},{textDecoration:"underline"}),n.add({e:"a",s:":active"},{textDecoration:"underline dotted"}),n.add({e:"a",s:":focus"},{textDecoration:"underline dotted"}))}function Zd({$color:t,$linkFontWeight:e}){return{color:t,fontWeight:e,textDecoration:"none"}}function Xd(t){const e=t.ref(Kd).read;return bd(t.root.add(e.do(Ze(Yd))).add(e.do(Ze(Qd))),t.style(Jd))}function Yd({$color:t,$fontFace:e,$fontSize:n,$lineHeight:r,$fontWeight:s}){return{color:t,font:`normal ${s} ${n}/${r} ${e}`}}function tf(t){const e=t.ref(Kd).read,{root:{rules:n}}=t;return bd(n.add({e:"html"},{height:"100%",margin:0,padding:0}),n.add({e:"body"},e.do(Ze(ef))),t.style(Xd))}function ef({$bgColor:t}){return{backgroundColor:t,height:"100%",margin:0,padding:0}}const nf=gd.by({$:"settings:form"},(t=>_d.by({global:Kd},t).read.do(Ze(rf))));function rf({global:{$color:t,$bgColor:e,$fontFace:n,$fontSize:r,$lineHeight:s,$fontWeight:o}}){return{$color:t,$bgColor:e.hsl.set((({l:t})=>({l:.8*t}))),$roBgColor:e.hsl.set((({l:t})=>({l:.94*t}))),$fontFace:n,$fontSize:r,$errorFontSize:r.mul(.8),$lineHeight:s,$fontWeight:o,$borderColor:e,$marginV:r.div(4),$marginH:r.div(4),$paddingV:r.div(2),$paddingH:r,$borderW:el.of(1,"px")}}let sf=class{constructor(t){this._context=t,this._code=mn();const e=this._code.read.do(cn(((t,e)=>e?t(...e.trim().split(/\s+/)):t())));this.indicator=function(t,e=va){return Aa(t,e)}((n=>e.do(Xe(((...e)=>({control:n.adjusted.control.convert(Xc.to(t.element)).setup(ta,(t=>t.add(aa()))).setup(ta,(t=>t.add(ia({when:e}))))}))))))}get code(){return this._code.it}set code(t){this._code.it=t}style(){return this._context.get(Vd).style(uf)}};h([Ba({share:{share:class extends va{constructor(){super("field-error")}},local:!0},name:""})],sf.prototype,"indicator",void 0),h([Ci({updateState:!1})],sf.prototype,"code",null),h([Ud()],sf.prototype,"style",null),sf=h([ko(["field-error",Hd])],sf);const of=["has-error",Pu];function uf(t){const e=t.ref(nf).read,{root:{rules:n}}=t,r=nl.of(4,"px");return bd(n.add({u:[":","host"],$:"bex:in-error"},e.do(Ze((({$color:t,$errorFontSize:e})=>({display:"none",fontSize:e,padding:e.div(2),borderLeft:`${r} dotted ${t}`,paddingLeft:e.sub(r)}))))),n.add({u:[":","host",{c:[of,["touched",Pu]],u:[":","not",{c:["has-focus",Pu]}]}],$:"bex:in-error"},{display:"block"}),n.add({u:[":","host",{c:of,u:[[":","not",{u:["code","~=","missing"]}],[":","not",{u:["code","~=","incomplete"]}]]}],$:"bex:in-error"},{display:"block"}))}let cf=class{};function af({$:t="raw",n:e,t:n,v:r,x:s=[],p:o={},pl:i=[]}){return e&&(o[e]={$:t,n:e,v:r,x:[],p:{},pl:[]}),{$:t,n:e,t:n,v:r,x:s,p:o,pl:i}}function hf({p:t,pl:e},n){const r=n.n||n.v,s=t[r];(!s||!s.n&&n.n)&&(t[r]=n),e.push(n)}cf=h([yo({needs:[class extends Ea{constructor(t={}){super(),this._byValidity=Pa.createSetup(t.byValidity,(t=>{const e=function({invalid:t="-on",ignore:e="submit"}={}){return n=>n.aspect(Rc).read.do(Ze((n=>n.hasBut(..."string"==typeof e?[e]:e)?t:"on")))}(t);return t=>t.aspect(dc).derive(e)})),this._byForm=Da.createSetup(t.byForm,(t=>t.aspect(uc).read.do(De((e=>{const n=new It;return yr(e,(({parent:e})=>{const r=e.aspect(Ra);r&&t.aspect(dc).derive(r.element.aspect(dc)).as(n)})),n})))))}setupField(t){t.control.setup(this._byForm)}setupForm(t){t.control.setup(this._byValidity)}},class extends Ea{constructor(t={}){super(),this._info=Pa.createSetup(t.info,(t=>{const e=aa(t);return t=>t.aspect(ta).add(e)})),this._error=Pa.createSetup(t.error,(t=>{const e=ia(t);return t=>t.aspect(ta).add(e)}))}setupField(t){t.control.setup(this._info).setup(this._error)}setupForm(t){t.control.setup(this._info),t.element.setup(ta,((t,e)=>t.add(e.aspect(Ra).control.aspect(ta))))}},sf]})],cf);const lf=()=>!1,df=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function ff(t,e){return t.s=t.s.substring(t.i),t.i=0,!!df.test(t.s)&&(e(t.s.substring(t.i,t.i+=29)),!0)}function pf({delimiterOf:t}){return e=>{const n=e.s[e.i];return e.d=t(n),n}}function gf(t,{named:e=!0,tagged:n=!0,extra:r=!0,next:s=pf(t)}={}){const o=function({delimiterOf:t}){return(e,n)=>{if(!(262144&t(e.s[e.i])))return!1;let r="";for(++e.i;e.i<e.s.length;){const n=e.s[e.i++];if(524288&t(n))break;r+=n}return n(r),!0}}(t),i=function({dateTime:t}){return t?ff:lf}(t),u=function({delimiterOf:t}){return(e,n)=>{let r="";for(++e.i;e.i<e.s.length;++e.i){const s=e.s[e.i];if("\\"===s){r+=e.s[++e.i]||s}else{if(65536&t(s))return++e.i,void n(r);r+=s}}n(r)}}(t),c=r?gf(t,{next:s,tagged:!1,named:!1,extra:!1}):lf;return(t,r)=>{let a,h,l,d="",f="raw";for(;t.i<t.s.length;){const r=s(t);if(t.d){if(12&t.d)break;if(null==h){if(16&t.d){h=d?"":r,++t.i;continue}if(65536&t.d){!n&&d||u(t,(t=>{d?(f="tagged-string",a=d):f="quoted-string",d="",h=t}));break}if(!d&&o(t,(t=>{f="angle-bracketed-string",h=t})))break;h=d,d=""}else{if(65536&t.d){!n&&h||u(t,(t=>{h?(f="tagged-string",a=h):f="quoted-string",h=t}));break}if(!h&&o(t,(t=>{f="angle-bracketed-string",h=t})))break}}if(null==h){if(!d&&i(t,(t=>h=t))){f="date-time";break}e?d+=r:h=r}else{if(!h&&i(t,(t=>h=t))){f="date-time";break}h+=r}++t.i}if(null==h){if(!d)return!1;l=af({$:f,v:d})}else l=af({$:f,n:d||void 0,t:a,v:h});for(;c(t,(t=>l.x.push(t))););return r(l),!0}}function yf({delimiterOf:t}){return e=>{let n=e.s[e.i];return"\\"!==n?(e.d=t(n),n):(++e.i,e.i<e.s.length?(n=e.s[e.i],e.d=t(n)?1:0):e.d=1,n)}}function _f({delimiterOf:t}){return e=>{const n=e.i;do{const n=e.s[e.i];if(!(2&t(n)))break;e.i++}while(e.i<e.s.length);return e.i!==n}}function mf(t,e={}){const{delimiterOf:n}=t,r=_f(t),s=gf(t,c(u({},e),{tagged:!1}));return(t,e)=>!!(8&n(t.s[t.i]))&&(++t.i,r(t),s(t,e))}const wf={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function bf({delimit:t,dateTime:e}={}){const n=t?u(u({},wf),t):wf;return{dateTime:e,delimiterOf:t=>n[t]||(t>="\0"&&t<=" "||"\x7f"===t?1:0)}}const vf=bf(),xf=bf({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Sf(t){const e=t?bf(t):vf,n=function(t){const{delimiterOf:e}=t,n=_f(t);return t=>!!(4&e(t.s[t.i]))&&(t.i++,n(t),!0)}(e),r=mf(e),s=gf(e),o=(null==t?void 0:t.comments)?function(t){const{delimiterOf:e}=t,n=_f(t),r={next:yf(t)},s=gf(t,r),o=mf(t,r);return(t,r)=>{if(!(131072&e(t.s[t.i])))return!1;let i;for(++t.i;n(t)||o(t,(t=>{i||(i=af({$:"raw",v:""})),hf(i,t)}))||s(t,(t=>i=t)););return++t.i,r(i||af({$:"raw",v:""})),!0}}(xf):lf;return t=>{const e=[],i={i:0,s:t};for(;i.i<i.s.length&&(n(i)||r(i,(t=>{e.length||e.push(af({$:"raw",v:""})),hf(e[e.length-1],t)}))||o(i,(t=>e.push(t)))||s(i,(t=>e.push(t)))););return e}}const Af=Sf();function Cf(t){if(!t)return'""';const{delimiterOf:e}=vf;let n,r=!1;for(let s=0;s<t.length;++s){const o=t[s],i=e(o);i?(32&i&&(n||(n=t.substring(0,s)),n+="\\"+o),r=!0):n&&(n+=o)}return r?`"${n||t}"`:t}function $f(t){return new URL(t.hash.substring(1),t.origin)}const kf=Symbol("PageParam");class Rf{get[kf](){return this}byDefault(t,e){}}const Of={perContext:v({create:function(t,e){const{document:n}=e.get(jn);return function(e,r,s,o){return i(0,o);function i(o,u){const c=t[o];if(!c)return e(u);c((({url:t=u.url,title:e=u.title,data:r=u.data}=u)=>i(o+1,{url:new URL(String(t),n.baseURI),title:e,data:r,get visited(){return u.visited},get current(){return u.current},get:t=>u.get(t),put(t,e){u.put(t,e)}})),r,s,u)}}},byDefault:t=>Df,assign:({get:t,to:e})=>{const n=(e,n,r,s)=>t()(e,n,r,s);return t=>e(((e,r)=>t(n,r)))}}),toString:()=>"[NavigationAgent]"};function Df(t,e,n,r){t(r)}function Tf(t){return null==t||"object"!=typeof t?{data:t}:t["wesib:navigation:data"]}const Ef=D(co,C({byDefault:t=>new Pf(t.get(co))}));class Pf{constructor(t){this._context=t,this._entries=new Map,this._lastId=0;const e=t.get(jn);this._document=e.document,this._location=e.location,this._history=e.history,this._uid=btoa(String(Math.random()))}static perContext(t){return Ef(t)}static toString(){return"[NavHistory]"}init(){const{data:t}=Tf(this._history.state),e=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(e.id,e),e.schedule((()=>{e.enter("init"),this._history.replaceState(this._historyState(e),"")})),e}newEntry(t){return new Ff(this._context,++this._lastId,t)}open(t,e){const{page:{title:n="",url:r}}=t;this._history.pushState(this._historyState(t),n,r.href),this._enter("open",t,e)}_enter(t,e,n){const r=n.it;this._entries.set(e.id,e);try{for(let t=r.next;t;t=t.next)this._forget(t)}finally{e.prev=r,r.next=e,e.schedule((()=>{try{r.leave()}finally{e.enter(t)}})),n.it=e}}replace(t,e){const n=e.it,{page:{title:r="",url:s}}=t;this._history.replaceState(this._historyState(t),r,s.href),this._entries.set(t.id,t);const o=n.prev;o&&(t.prev=o,o.next=t),t.schedule((()=>{try{n.leave()}finally{try{this._forget(n)}finally{t.enter("replace")}}})),e.it=t}popState(t,e){const{state:n}=t;if(null==n)return null==this._history.state?this._changeHash(e):void 0;const r=e.it,{uid:s,data:o,id:i}=Tf(n);let u;const c=s===this._uid&&null!=i?this._entries.get(i):void 0;return c?u=c:(u=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),r.transfer(u,"return"),this._entries.set(u.id,u),this._history.replaceState(this._historyState(u),"")),u.schedule((()=>{try{r.leave()}finally{u.enter("return")}})),e.it=u,u}hashChange(t){if(null==this._history.state)return this._changeHash(t)}update(t,e){const n=t.it,r=new Ff(this._context,++this._lastId,c(u({},n.page),{url:e}),n);return this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"",e.href),this._entries.delete(n.id),t.it=r}_changeHash(t){const e=t.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{e.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,t)}return n}_forget(t){this._entries.delete(t.id),t.forget()}_historyState({id:t,page:{data:e}}){return{"wesib:navigation:data":{uid:this._uid,id:t,data:e}}}}class Ff{constructor(t,e,n,r){this._bsContext=t,this.id=e,this._status=0,this._update=Z,this._params=r?r._params:new Map;const s=this;this.page={get url(){return n.url},get title(){return n.title},get data(){return n.data},get visited(){return!!s._status},get current(){return 2===s._status},get:t=>s.get(t),put(t,e){s.put(t,e)}}}get(t){const e=t[kf],n=this._params.get(e);if(n)return n.get();const r=e.byDefault(this.page,this._bsContext);return r&&this._init(e,r)}put(t,e){const n=t[kf],r=this._params.get(n);return r?(r.put(e),r.get()):this._init(n,n.create(this.page,e,this._bsContext))}_init(t,e){return this._params.set(t,e),this.page.current&&e.enter&&e.enter(this.page,"init"),e.get()}transfer(t,e){yr(this._params.entries(),(([n,r])=>{if(r.transfer){const s=r.transfer(t.page,e);s&&t._params.set(n,s)}}))}stay(t){yr(this._params.values(),(e=>e.stay&&e.stay(t)))}enter(t){this._status=2,yr(this._params.values(),(e=>e.enter&&e.enter(this.page,t)))}leave(){this._status=1,yr(this._params.values(),(t=>t.leave&&t.leave()))}forget(){yr(this._params.values(),(t=>t.forget&&t.forget())),this._params.clear()}schedule(t){this._update=t}apply(){const t=this._update;this._update=Z,t()}}class Bf extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!1})),this.when=e.when,this.to=e.to}}class Mf extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!0})),this.when=e.when,this.from=e.from,this.to=e.to}}class zf extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!0})),this.from=e.from,this.to=e.to,this.reason=e.reason}get when(){return"stay"}}const Nf=D(co,C({byDefault:function(t){const e=t.get(jn),{document:n,history:r}=e,s=new xn(e),o=t.get(Pf),i=t.get(Of),a=mn(o.init());a.read((t=>t.apply()));let h=Promise.resolve();s.on("popstate")((t=>{const e=o.popState(t,a);e&&s.dispatch(new Bf("wesib:enterPage",{when:null!=t.state?"return":"enter",to:e.page}))})),s.on("hashchange")((()=>{const t=o.hashChange(a);t&&s.dispatch(new Bf("wesib:enterPage",{when:"enter",to:t.page}))}));return new class extends Lf{constructor(){super(),this.onEnter=s.on("wesib:enterPage"),this.onLeave=s.on("wesib:leavePage"),this.onStay=s.on("wesib:stayOnPage"),this.on=Ve(Ie(this.onEnter),Ie(this.onLeave),Ie(this.onStay)),this.read=a.read.do(Ze((({page:t})=>t)))}get page(){return a.it.page}get length(){return r.length}go(t){r.go(t)}open(t){return p("pre-open","open",t)}replace(t){return p("pre-replace","replace",t)}update(t){return o.update(a,d(t)).page}with(t,e){return l((n=>n.put(t,e)))}};function l(t){return{with:(e,n)=>l(J(t,(t=>t.put(e,n)))),open:e=>p("pre-open","open",e,t),replace:e=>p("pre-replace","replace",e,t),pretend(e,n=((t,e)=>e)){let r;"function"==typeof e?(n=e,r=void 0):r=e;const s=f(r),o=a.it,i=g("pretend",o,s,t);try{return y("pretend",o,s,i)?n(o.page,i.page):void 0}finally{i.stay(a.it.page)}}}}function d(t){return"string"==typeof t?new URL(t,n.baseURI):t||a.it.page.url}function f(t){return null==t||"string"==typeof t||t instanceof URL?{url:d(t)}:t.url instanceof URL?t:c(u({},t),{url:d(t.url)})}function p(t,e,n,r=Z){const i=f(n),u=h=h.then(c,c);return u;function c(){let n;try{const c=function(){if(h!==u)return l();const e=a.it,n=g(t,e,i,r),o=new Mf("wesib:leavePage",{when:t,from:e.page,to:n.page});if(!s.dispatch(o)||h!==u||!y(t,e,i,n))return l(n);return n}();return c?(n=c,o[e](n,a),s.dispatch(new Bf("wesib:enterPage",{when:e,to:n.page})),n.page):c}catch(c){throw l(n,c),c}}function l(t,e){return t&&t.stay(a.it.page),s.dispatch(new zf("wesib:stayOnPage",{from:a.it.page,to:i,reason:e})),null}}function g(t,e,n,r){const s=o.newEntry(n);try{e.transfer(s,t),r(s.page)}catch(i){throw s.stay(a.it.page),i}return s}function y(t,e,n,r){let s=!1;return i((({url:t,data:e,title:r})=>{s=!0,n.url=t,n.data=e,n.title=r}),t,e.page,r.page),s}}}));class Lf{static perContext(t){return Nf(t)}static toString(){return"[Navigation]"}[oe](){return this.on}[Xt](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}const Uf=["active",Go];function jf(t,e){const n=e.href.bind(e),r=V(e.event||"click"),{active:s=Uf}=e;let o;return e=>{const i=j(t,e);if(!i)return;const{context:u,supply:c=u.supply}=e;o=$t.name(s,u.get(Dt));const a=u.get(Lf),h=u.get(Ni)({node:i}),l=(new It).needs(c),d={supply:l,receive(t,e){const r=n(i),s=a.page.url,o=new URL(r,i.ownerDocument.baseURI);o.origin===s.origin&&(e.preventDefault(),s.href!==o.href&&a.open(r).catch(console.error))}},f=new xn(i);l.cuts(f);for(const t of r)f.on(t)(d);const p=function(t){return t[Ss]||(t[Ss]=new As(t))}(i).renderIn(function(t,e={}){const{nsAlias:n=t.nsAlias,scheduler:r=t.scheduler}=e;if(n===t.nsAlias&&r===t.scheduler)return t;const s=new ws({nsAlias:n,scheduler:r});let o=e=>{const n=t.lift();return n===t?e:(s.set(n),o=t=>n,n)};return new class extends _s{get fragment(){return t.fragment}get window(){return t.window}get document(){return t.document}get nsAlias(){return s.nsAlias}get scheduler(){return s.scheduler}get readStatus(){return t.readStatus}lift(){return o(this)}}}(xs(i),{scheduler:t=>h}));return{get href(){return n(i)},supply:l,activate:()=>p.add(o)}}}const qf=Symbol("NavMenu.links");class Wf{constructor(t,e){this[qf]=new If(this,t,e)}get supply(){return this[qf].supply}bindTo(t){return this[qf].bindTo(t),this}}class If{constructor(t,e,n={}){this._menu=t,this._navLinks=e,this._links=mn([new Set]),this._active=new Map,this.supply=(new It).cuts(this._links);const{activate:r=!0,weigh:s}=n;this._activate=r,this._weigh=s?s.bind(n):Vf}bindTo(t){this.bindTo=Z,t.whenConnected((t=>{let e;if(Se(this._navLinks))e=this._navLinks;else{const n=j(this._navLinks,t,this._menu);e=Se(n)?n:Re(n).do(cn(((t,e)=>t(...e))))}const n={context:t,supply:this.supply};if(e(((...t)=>{this._replace(n,t)})),this._activate){Ae({page:t.get(Lf),links:this._links})((({page:[e],links:[[n]]})=>{this._updateActive(t,e,n)}))}}))}_replace(t,e){var n;const r=new Set;for(const i of e){const e=j(i,t);e&&r.add(e)}const[s]=this._links.it,o=[];for(const i of s.keys())r.delete(i)||o.push(i);if(r.size||o.length){for(const t of o)s.delete(t),this._deactivate(t),null===(n=t.supply)||void 0===n||n.off();for(const t of r){const{supply:e}=t;if(e){if(e.isOff)continue;e.needs(this).whenOff((()=>{const[e]=this._links.it;e.delete(t)&&(this._links.it=[e])}))}s.add(t)}this._links.it=[s]}}_updateActive(t,e,n){const r=[],s=this._selectActive(t,e,n);for(const o of this._active.keys())s.delete(o)||r.push(o);for(const o of r)this._deactivate(o);for(const o of s)o.activate&&this._active.set(o,o.activate())}_selectActive(t,e,n){let r=0,s=new Set;for(const o of n){const n=this._weigh({link:o,menu:this._menu,context:t,page:e});n>r?(r=n,s=(new Set).add(o)):n===r&&s.add(o)}return s}_deactivate(t){const e=this._active.get(t);e&&(this._active.delete(t),e.off())}}function Vf({link:t,context:e,page:n}){const r=t.href;return Gf(new URL(r,e.get(jn).document.baseURI),n.url)}function Gf(t,e){if(t.origin!==e.origin)return-1;const n=Hf(t),r=Hf(e);if(t.hash){if(n!==r)return-1;const s=Kf(t,e);return s<0||Kf(e,t)<0?-1:t.pathname.length+s+Gf($f(t),$f(e))}const s=Kf(t,e);return s?s<0||n!==r?-1:t.pathname.length+s:r.startsWith(n)?t.pathname.length:-1}function Hf(t){const e=t.pathname;return e.endsWith("/")?e:e+"/"}function Kf({searchParams:t},{searchParams:e}){let n=0;return t.forEach(((t,r)=>{(function(t){return t.startsWith("__")&&t.endsWith("__")})(r)||n>=0&&(e.getAll(r).includes(t)?n+=1:n=-1)})),n}const Qf={perContext:Ii(),toString:()=>"[PageLoadAgent]"};function Jf(t){let e;return n=>{const r=function(t){return new URL("",t.url).href}(n);if(e){if(e.url===r)return e.on;e.sup.off()}let s;const o=new It((()=>{e=void 0,s=void 0})),i=be((e=>{if(!s){const e=t(n),r=mn(),i=e((t=>{r.it=t})).whenOff((t=>{null!=t&&o.off(t)}));o.cuts(i).cuts(r),s={on:r.read.do(hn(K)),num:0}}const r=s;return++r.num,r.on.do(rn(o))(e).whenOff((t=>{--r.num||Promise.resolve().then((()=>{r.num||r!==s||o.off(t)})).catch(console.error)}))}));return e={url:r,on:i,sup:o},i}}class Zf extends Error{}const Xf=new class extends Rf{create(t,e){return{get:()=>e,put:Z}}};class Yf{constructor(t,e){this._navigation=t,this._loader=e,this._map=new Map,this._requests=Nr(Rr((()=>this._map.values())))}get fragments(){const t=[];return br(this._requests,(e=>!!e.fragment&&(t.push(e.fragment),!0)))?t:[]}handle(){const t=this,e=new It(Z);let n=Zt();return{get(){},put(e){t._add(e)},transfer(e,n){if("pretend"===n)return;const r=t._transfer();return e.put(Xf,r),r.handle()},enter(r,s){if("init"===s)return;n=new It(Z).needs(e);const o=be((e=>{const s=new qe,o=s.on(e);return t._loader(r).do(rn(n))((t=>s.send(t))).whenOff((t=>{void 0===t||t instanceof Zf||s.send({ok:!1,page:r,error:t})})),o})).do(He);yr(t._requests,(({fragment:t,receiver:e})=>function(t,e){return e?t.do(tn((t=>t.ok?c(u({},t),{fragment:(null!=e.tag?t.document.getElementsByTagName(e.tag)[0]:t.document.getElementById(e.id))||void 0}):t))):t}(o,t)({supply:(new It).needs(e.supply),receive(t,n){e.receive(t,n)}})))},leave(){n.off(new Zf("page left"))},stay(){e.off(new Zf("navigation cancelled"))},forget(){e.off(new Zf("page forgotten"))}}}_add(t){const e=c(u({},t),{receiver:te(t.receiver)}),{supply:n}=e.receiver,r=this._map.get(n);r?r.push(e):(this._map.set(n,[e]),n.whenOff((()=>this._map.delete(n))))}_transfer(){const t=new Yf(this._navigation,this._loader);for(const[e,n]of this._map.entries())t._map.set(e,n.slice());return t}}const tp={perContext:D(co,R({create:K,byDefault:M(Z),assign:({get:t,to:e})=>{const n=e=>t()(e);return t=>e(((e,r)=>t(n,r)))}})),toString:()=>"[PageLoadURLModifier]"},ep={perContext:D(co,C({byDefault:function(t){const e=t.get(jn),n=t.get(Ki),r=t.get(tp),s=t.get(Qf),o=new e.DOMParser;return t=>{const e=new URL(t.url.href);r(e);const i=new Request(e.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return be((t=>s(u,i)(t)));function u(r){return function(t,e){var n;const r=null===(n=t.get(Xf))||void 0===n?void 0:n.fragments;r&&r.length&&e.headers.set("Accept-Fragment",r.reduce(((t,e)=>(t?t+", ":"")+(null!=e.tag?"tag="+Cf(e.tag):"id="+Cf(e.id))),""))}(t,r),be((s=>{const i=new se;i.on(s),i.send({page:t}),n(r).do(tn((t=>Promise.all([t,t.text()]))),sn,Ke(((...t)=>Re(...t))),tn((([n,r])=>{if(!n.ok)return{ok:!1,page:t,response:n,error:n.status};try{return{ok:!0,page:t,response:n,document:np(o,e,n,r)}}catch(s){return{ok:!1,page:t,response:n,error:s}}})))(s)}))}}}})),toString:()=>"[PageLoader]"};function np(t,e,n,r){const s=t.parseFromString(r,Af(n.headers.get("Content-Type")||"text/html")[0].v);if(s.head){const t=s.head.querySelector("base");if(t)t.href=new URL(t.getAttribute("href"),e).href;else{const t=s.createElement("base");t.href=e.href,s.head.appendChild(t)}}return s}class rp extends Rf{create(t,e,n){const r=new Yf(n.get(Lf),Jf(n.get(ep))),s=r.handle();return t.put(Xf,r),s.put(e),s}}const sp=new rp,op=D(co,C({byDefault:t=>new ip(t)}));class ip{constructor(t){const e=up(t.get(jn).document);if(e){const n=t.get(Lf);this.urlModifier=t=>t.searchParams.set("__wesib_app_rev__",e),this.agent=(t,r)=>t(new Request(r.url,r)).do(tn((t=>{if(t.ok){const r=up(t.document);if(r&&r!==e){const e=new URL(t.page.url.href);e.searchParams.set("__wesib_app_rev__",r),n.update(e),n.reload()}}return t})))}else this.urlModifier=void 0,this.agent=void 0}static perContext(t){return op(t)}static toString(){return"[PageCacheBuster]"}}function up(t){var e;return null===(e=t.querySelector("meta[name=wesib-app-rev]"))||void 0===e?void 0:e.getAttribute("content")}function cp(t,e){return jr(Pr(e,(({src:t})=>!!t)),(e=>[new URL(e.src,t.baseURI).href,e]))}function ap(t){const e=t.get(jn).document;return t=>t().do(tn((t=>{if(!t.ok)return t;const n=t.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return t;let r=e.head,s=null;const o=e.querySelectorAll("link[rel=stylesheet]"),i=new Map,u=o.item(0);return u&&(r=u.parentNode,s=u,yr(pr(o),(t=>i.set(new URL(t.href,e.baseURI).href,t)))),yr(pr(n),(t=>{const n=new URL(t.href,e.baseURI).href,o=i.get(n);o?(function(t){if(Yn(t))return vr(t);const e=tr(t);return Yn(e)?vr(e):function(t){const e=t.next();return e.done?void 0:e.value}(e)}(i.keys())===n?(r=o.parentNode,s=o.nextSibling):r.insertBefore(o,s),i.delete(n)):Cn(t,r,s,((t,e)=>e.href=n))})),yr(i.values(),(t=>t.parentNode.removeChild(t))),t})))}const hp={setup(t){t.provide({entry:tp,buildAsset(t){const{urlModifier:e}=t.get(ip);return e&&(t=>t(e))}}),t.provide({entry:Qf,buildAsset(t){const{agent:e}=t.get(ip);return e&&(t=>t(e))}}),t.provide({entry:Qf,buildAsset(t){const e=function(t){const e=t.get(jn).document;return t=>t().do(tn((t=>{if(t.ok){const n=new Set(jr(cp(e,e.scripts),(([t])=>t)));yr(Fr(cp(t.document,t.document.querySelectorAll("script")),(([t])=>!n.has(t))),(([t,r])=>{Cn(r,e.head,((e,n)=>n.src=t)),n.add(t)}))}return t})))}(t);return t=>t(e)}}),t.provide({entry:Qf,buildAsset(t){const e=ap(t);return t=>t(e)}}),t.provide({entry:Qf,buildAsset(t){const e=function(t){const e=t.get(jn).document;return t=>t().do(tn((t=>{if(t.ok){const n=t.document.getElementsByTagName("title").item(0);n&&n.textContent&&(e.title=n.textContent)}return t})))}(t);return t=>t(e)}})}};class lp{static get[lo](){return hp}}const dp={perContext:C({byDefault:t=>new fp(t.get(Do))}),toString:()=>"[PageRenderCtl]"};class fp{constructor(t){this._context=t}renderPageBy(t,e={}){const n=j(e,this._context),{contentKey:r=pp}=n,s=function({fragment:t}){if(t)return e=>t;return({element:{id:t,tagName:e}})=>t?{id:t}:{tag:e.toLowerCase()}}(n),o=this._context.get(Lf),i=this._context.get(Ji);let a;const h=mn(),l=i.renderFragmentBy((e=>{const n=h.it;if(!n)return void e.retainContent();const[r,s]=n,o=c(u({},e),{postpone(t){e.postpone((()=>t(o)))},response:r});if(r.ok){a=s;const{fragment:t}=r;t&&$n(t,e.content)}t(o)}),c(u({},n),{when:"connected",on:h.on}));return this._context.whenConnected((t=>{a=r(o.page),o.read.do(en)((e=>{e.put(sp,{fragment:s(t),receiver:{supply:(new It).needs(l),receive:(t,e)=>(t=>{const e=r(t.page);e!==a&&(h.it=[t,e])})(e)}})}))})),l}}function pp({url:t}){return new URL("",t).href}let gp=class{renderPage({content:t,response:e}){if(!e.ok){const n=Sn(t);null==e.ok?t.appendChild(n.createTextNode("Loading...")):t.appendChild(n.createTextNode(`Error. ${e.error}`))}}};var yp;function _p({$fontSize:t}){return{flex:"1 1 auto",padding:0,margin:`0 0 0 ${t.div(2)}`}}h([(yp={target:({contentRoot:t})=>function(t,e=xs(t)){return{context:e,host:t,placeContent:n=>(t.textContent=null,t.appendChild(n),e)}}(t)},Eo((({get:t,amend:e})=>e({componentDef:{feature:{needs:[lp]},define(e){e.whenComponent((e=>{e.whenReady((e=>{const{component:n}=e,r=t(n).bind(n);e.get(dp).renderPageBy(r,yp)}))}))}}}))))],gp.prototype,"renderPage",null),gp=h([ko(["main",Hd])],gp);let mp=class{constructor(t){this._theme=t.get(Vd),new Wf((({element:t})=>{return e=t.querySelectorAll("a"),n=t=>function(t,e={}){return jf(t,c(u({},e),{href:t=>t.href}))}(t),er(lr(e,((t,e)=>n(t.item(e)))));var e,n})).bindTo(t)}style(){return this._theme.style(wp)}};h([Ud()],mp.prototype,"style",null),mp=h([ko(["nav",Hd])],mp);function wp(t){const e=t.ref(Kd).read,{root:{rules:n}}=t;return bd(n.add({u:[":","host"],$:"bex:nav"},e.do(Ze(bp))),n.add({u:[":","host"],$:"bex:nav"},e.do(Ze((t=>({flex:"0 1 200px",height:"100%",background:vp(t)}))))),n.add({u:[":","host"],$:["bex:nav","@media:sm"]},{flex:"0 1 100%"}),n.add([{u:[":","host"],$:"bex:nav"},{e:"a",$:"bex:nav"}],e.do(Ze(xp))),n.add([{u:[":","host"],$:"bex:nav"},{e:"a",c:["active",Go],$:"bex:nav"}],e.do(Ze(Sp))))}function bp({$fontSize:t}){return{padding:0,margin:`0 ${t.div(2)} 0 0`}}function vp({$bgColor:t}){return t.hsl.set((({l:t})=>({l:.8*t})))}function xp(t){const{$fontSize:e}=t;return{display:"block",margin:0,padding:`${e.div(2)} ${e}`,border:0,outline:0,background:vp(t)}}function Sp({$fontSize:t,$color:e,$bgColor:n}){const r=nl.of(4,"px");return{background:n,borderLeft:`${r} solid ${e}`,paddingLeft:t.sub(r)}}let Ap=class{constructor(t){this._context=t}async style(){const{elementDef:{name:t}}=await this._context.get(co).whenDefined(gp);return this._context.get(Vd).style(function(t){return e=>{const n=e.ref(Kd).read,{root:{rules:r}}=e;return bd(r.add({u:[":","host"],$:"bex:container"},{height:"100%",display:"flex",flexFlow:"row wrap",alignItems:"stretch",alignContent:"flex-start"}).add(n.do(Ze(Qd))),r.add({u:[":","host"],$:["bex:container","@media:sm"]},{height:"auto"}),r.add([{u:[":","host"],$:"bex:container"},{e:t,$:"bex:container"}],n.do(Ze(_p))))}}(t))}};h([Ud()],Ap.prototype,"style",null),Ap=h([ko({name:["container",Hd],feature:{needs:[gp,mp]}})],Ap);let Cp=class{};Cp=h([yo({needs:[Ap,lp,class{static get[lo](){return jd}}]})],Cp);let $p=class{};$p=h([yo({setup(t){t.perComponent(Gr(Bd,(t=>new Ld(t.get(Do)))))},init(t){t.whenReady((()=>{Vl(t.get(Vd).style(tf),jl())}))}})],$p);let kp=class{};kp=h([yo({needs:[$p,cf,Cp]})],kp);const Rp=function(...t){const{bsContext:e,complete:n}=function(){const t=mn(0),e=new qo((n=>{class r{constructor(){this.whenReady=t.read.do(an((t=>!!t&&this)),nn)}get(t,e){return n(t,e)}whenDefined(t){return function(t,e){if(Y(e,yi))return e[yi];const n=Ge(Promise.resolve(t.whenReady).then((()=>t.get(Qo).whenDefined(e))).then((()=>Ko(e))));return e[yi]=n}(this,t)}load(t,n){const r=gi.of(t),s=e.provide(r);n?s.needs(n):n=s;const o=function(t,e){const n=mn({feature:t,ready:!1});return e.read((({module:t,ready:e})=>{const r=t.feature,s=n.it;s&&s.feature===r&&s.ready===e||(n.it={feature:r,ready:e})})).needs(e),n.supply.needs(e),n.read}(t,this.get(r).use(n));return{read:o,whenReady:o.do(hn((t=>t.ready&&t)),nn),[Xt]:M(o),supply:s}}}return new r}));return{bsContext:e.context,complete(){t.it=1}}}(),r=1===t.length?t[0]:(s=t,go.define(class{},{needs:s}));var s;return e.load(r).read.do(hn((({ready:t})=>t)),nn).then(n).catch(console.error),e}(kp);export{kp as A,co as B,ko as C,Xd as D,Hd as E,nf as F,Pu as I,Ud as P,nu as R,Ba as S,Vd as T,wn as V,Uh as a,Ci as b,Wi as c,Kd as d,ma as e,Rc as f,Mo as g,Rp as h,Uc as i,Ze as m,Sn as n,Pc as r,bd as s,Oi as t};
//# sourceMappingURL=index.9f456528.js.map
