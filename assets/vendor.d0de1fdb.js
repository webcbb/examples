var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(e,n,s)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,u=(t,e)=>{for(var n in e||(e={}))r.call(e,n)&&o(t,n,e[n]);if(s)for(var n of s(e))i.call(e,n)&&o(t,n,e[n]);return t},c=(t,s)=>e(t,n(s)),a=(t,e)=>{var n={};for(var o in t)r.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&s)for(var o of s(t))e.indexOf(o)<0&&i.call(t,o)&&(n[o]=t[o]);return n};function h(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o}function l(t){return Array.isArray(t)}function d(t){return l(t)?t:null!=t?[t]:[]}function f(t,e){return t===e}function p(t){return()=>t}function y(...t){return()=>t}function g(t){let e=()=>{e=_;const n=t();return e=p(n),n};return()=>e()}function _(){throw new TypeError("Recurrent evaluation")}function m(t){return"function"==typeof t}function w(t,...e){return m(t)?t(...e):t}function b(t){return m(t)?t:p(t)}function v(t,e,n,s,r){let i,o;if(void 0!==r?(i=s?Math.max(s,0):0,o=null!=r?r:Math.max(t.length,e.length)):null!=s?(i=0,o=s):(i=0,o=Math.max(t.length,e.length)),(t.length<=o||e.length<=o)&&t.length!==e.length)return!1;for(let u=i;u<o;++u)if(!n(t[u],e[u],u))return!1;return!0}function x(t){const e=Array.from(t),{length:n}=e;if(n)return 1===n?e[0]:e}function S(t){return l(t)?new Set(t):null!=t?new Set([t]):new Set}function k(t,e){return l(e)?e.forEach((e=>t.add(e))):null!=e&&t.add(e),t}function A(t,e=(()=>!0)){const n=Reflect.getPrototypeOf(t.prototype);if(null==n)return;const s=n.constructor;return e(s)?s:A(s,e)}function C(t){return t}function O(t){let e=t.length;for(;e>0;){const n=e-1;if(void 0!==t[n])break;e=n}return e}function $(t,e,n=((t,e)=>e)){return t?e?function(...s){return n(t.apply(this,s),e.apply(this,s))}:t:e}function R(){}const D=Object.prototype.hasOwnProperty;function F(t,e){return D.call(t,e)}function E(t){return null!=t}function T(t){return void 0!==t}const P=Symbol("push-iterator");function M(t){return!!t[P]}function B(t){return t[Symbol.iterator]()}function K(t){return{[Symbol.iterator]:N,[P]:t}}function N(){return this[P]()}function j(t,e){return!t[P](e).isOver()}function U(t){let e=!1,n=s=>{s&&!t(s)&&(e=!0,n=I)};return{[Symbol.iterator]:z,[P](t){return n(t),this},next:L,isOver:()=>e}}function z(){return this}function L(){for(;;){let t;const e=!j(this,(e=>(t={value:e},!0)));if(t)return t;if(e)return{done:!0}}}function q(){return{done:!0}}function I(t){}const V={[Symbol.iterator]:z,[P](t){return this},next:()=>({done:!0}),isOver:()=>!0};function W(t,e){return t[P](e)}function G(t,e){return n=>{let s=0;const r=n=>{if(s>=t.length)return!1;for(;;){const r=n(e(t,s++));if(s>=t.length||!1===r)return!1;if(!0===r)return!0}};if(n&&!r(n))return V;let i=!1,o=t=>{t&&!r(t)&&(i=!0,o=I,u=q)},u=()=>s<t.length?{value:e(t,s++)}:(i=!0,o=I,u=q,{done:!0});return{[Symbol.iterator]:z,[P](t){return o(t),this},next:()=>u(),isOver:()=>i}}}function H(t,e){return t[e]}function J(t){return G(t,H)}function Q(t){return K(J(t))}function Z(t,e){if(M(t))return j(t,e);const n=B(t);if(M(n))return j(n,e);for(;;){const t=n.next();if(t.done)return!1;const s=e(t.value);if("boolean"==typeof s)return s}}function X(t,e){Z(t,(t=>{e(t)}))}const Y=t=>t;function tt(t,e=Y){if(M(t))return et(t,e);const n=B(t);return M(n)?et(n,e):Array.from(t,e)}function et(t,e){const n=[];return j(t,(t=>{n.push(e(t))})),n}function nt(t){let e=!0;return j(t,(t=>e=!1)),e}function st(t,e){let n=!0;return Z(t,(t=>{if(n=!!e(t),!n)return!1})),n}function rt(t){let e;return j(t,(t=>(e=t,!1))),e}function it(t,e){let n=!1,s=t=>{(n=!!t&&!e(t))&&(s=I,r=q)},r=()=>{const e=t.next();return e.done&&(n=!0,s=I,r=q),e};return{[Symbol.iterator]:z,[P](t){return s(t),this},next:()=>r(),isOver:()=>n}}function ot(t){return e=>{for(;;){const n=t.next();if(n.done)return!1;const s=e(n.value);if("boolean"==typeof s)return s}}}function ut(t,e){return M(t)?W(t,e):Array.isArray(t)?function(t,e){return t.length?J(t)(e):V}(t,e):function(t,e){const n=B(t);if(M(n))return W(n,e);const s=ot(n);return s(e)?it(n,s):V}(t,e)}function ct(t){const e=B(t);return M(e)?e:it(e,ot(e))}function at(t,e,n){let s=n;return Z(t,(t=>{s=e(s,t)})),s}function ht(){return V}function lt(t){return K(function(t){return e=>{const n=t();if(M(n))return n[P](e);const s=ot(n);return e&&!s(e)?ht():it(n,s)}}(t))}function dt(...t){return t.length>1?K(function(t){return e=>{let n=0,s=t[0];const r=e=>{for(;;){let r;const i=ut(s,(t=>r=e(t)));if(i.isOver()){if(++n>=t.length)return!1;s=t[n]}else s=i;if("boolean"==typeof r)return r}};return e&&!r(e)?ht():U(r)}}(t)):t.length?(e=t[0],Array.isArray(e)?Q(e):lt((()=>B(e)))):ht();var e}function ft(t){return K(function(t){return e=>{if(e)return e(t),ht();let n=!1;return{[Symbol.iterator]:z,[P](e){return n?ht():e?(n=!0,e(t),ht()):this},next:()=>n?{done:n}:(n=!0,{value:t}),isOver:()=>n}}}(t))}function pt(t){return Q(Reflect.ownKeys(t))}function yt(t,e){return K(function(t,e,n){return s=>{let r=0;const i=s=>{for(;;){if(r>=t.length)return!1;const i=e(t,r++);if(n(i)){const t=s(i);if("boolean"==typeof t)return t}}};if(s&&!i(s))return ht();let o=!1,u=t=>{t&&!i(t)&&(o=!0,u=I,c=q)},c=()=>{for(;;){if(r>=t.length)return o=!0,u=I,c=q,{done:!0};const s=e(t,r++);if(n(s))return{value:s}}};return{[Symbol.iterator]:z,[P](t){return u(t),this},next:()=>c(),isOver:()=>o}}}(t,H,e))}function gt(t,e){return K((n=>{const s=M(t)?_t(t,e):function(t,e){const n=B(t);if(M(n))return _t(n,e);return t=>{for(;;){const s=n.next();if(s.done)return!1;const r=s.value;if(e(r)){const e=t(r);if("boolean"==typeof e)return e}}}}(t,e);return n&&!s(n)?ht():U(s)}))}function _t(t,e){return n=>{const s=W(t,(t=>{if(e(t))return n(t)}));return t=s,!s.isOver()}}function mt(t,e){return K((n=t,s=e?(t,n)=>e(t[n]):wt,t=>{let e,r=0;const i=t=>{if(r>=n.length)return!1;for(e||(e=s(n,r));;){let i;const o=ut(e,(e=>i=t(e)));if(o.isOver()){if(++r>=n.length)return!1;e=s(n,r)}else e=o;if("boolean"==typeof i)return i}};return t&&!i(t)?ht():U(i)}));var n,s}function wt(t,e){return t[e]}function bt(t,e=xt){return K((n=>{const s=M(t)?vt(t,e):function(t,e){const n=B(t);if(M(n))return vt(n,e);let s;return t=>{for(;;){if(!s){const t=n.next();if(t.done)return!1;s=e(t.value)}let r;const i=ut(s,(e=>r=t(e)));if(s=i.isOver()?void 0:i,"boolean"==typeof r)return r}}}(t,e);return n&&!s(n)?ht():U(s)}))}function vt(t,e){let n,s=!1;return r=>{for(;;){for(;!n;){const r=W(t,(t=>(n=e(t),!0)));if(t=r,r.isOver()){if(!n)return!1;s=!0}}let i;const o=ut(n,(t=>i=r(t)));if(o.isOver()){if(n=void 0,s)return!1}else n=o;if("boolean"==typeof i)return i}}}function xt(t){return t}function St(t,e){return K(G(t,((t,n)=>e(t.item(n)))))}function kt(t,e){return K((n=>{const s=M(t)?At(t,e):function(t,e){const n=B(t);if(M(n))return At(n,e);return t=>{for(;;){const s=n.next();if(s.done)return!1;const r=t(e(s.value));if("boolean"==typeof r)return r}}}(t,e);return n&&!s(n)?ht():U(s)}))}function At(t,e){return n=>{const s=W(t,(t=>n(e(t))));return t=s,!s.isOver()}}function Ct(t,e){return K((n=>{const s=M(t)?Ot(t,e):function(t,e){const n=B(t);if(M(n))return Ot(n,e);return t=>{for(;;){const s=n.next();if(s.done)return!1;const r=e(s.value);if(null!=r&&!1!==r){const e=t(r);if("boolean"==typeof e)return e}}}}(t,e);return n&&!s(n)?ht():U(s)}))}function Ot(t,e){return n=>{const s=W(t,(t=>{const s=e(t);if(null!=s&&!1!==s)return n(s)}));return t=s,!s.isOver()}}function $t(t){return kt(pt(t),(e=>[e,t[e]]))}let Rt=Dt;function Dt(t){console.error("Supply aborted unexpectedly.",t)}let Ft,Et=!1;function Tt(){const t=Et;return Et=!0,t}function Pt(t){if(Et=t,!t){const t=Ft;if(t){Ft=void 0;for(const e of t)Rt(e)}}}const Mt=Symbol("SupplyState"),Bt={isOff:!0,off:Nt,whenOff(t,e){e()}};function Kt(t){return void 0===t?Bt:{isOff:!0,off:Nt,whenOff(e,n){n(t)}}}function Nt(t,e){}const jt={isOff:!1,off(t,e){const n=Tt();try{t[Mt]=Kt(e),function(t){void 0!==t&&(Ft||(Ft=new Set),Ft.add(t))}(e)}finally{Pt(n)}},whenOff(t,e){t[Mt]=Ut(e)}};function Ut(t){return{isOff:!1,off(e,n){const s=Tt();try{e[Mt]=Kt(n),t(n)}finally{Pt(s)}},whenOff(e,n){const s=t;t=t=>{s(t),n(t)}}}}class zt{constructor(t){this[Mt]=t?Ut(t):jt}static onUnexpectedAbort(t){!function(t=Dt){Rt=t}(t)}get supply(){return this}get isOff(){return this[Mt].isOff}off(t){return this[Mt].off(this,t),this}whenOff(t){return this[Mt].whenOff(this,t),this}whenDone(){return new Promise(((t,e)=>this.whenOff((n=>void 0===n?t():e(n)))))}cuts(t){return t.supply.needs(this),this}needs(t){return t.supply.whenOff((t=>this.off(t))),this}as(t){return this.needs(t).cuts(t)}}class Lt extends zt{get isOff(){return!1}off(t){return this}whenOff(t){return this}cuts(t){return this}needs(t){return this}}const qt=new Lt;function It(){return qt}function Vt(t){return t===qt}class Wt extends zt{get isOff(){return!0}off(){return this}whenOff(t){return t(),this}cuts(t){return t.supply.off(),this}needs(t){return this}}const Gt=new Wt;function Ht(){return Gt}class Jt extends Error{constructor(t,e=`There is no value with key ${t}`){super(e),this.key=t}}const Qt=Symbol("ContextKey");class Zt{constructor(t){this.name=t}get[Qt](){return this}toString(){return`ContextKey(${this.name})`}}class Xt extends Zt{constructor(t){super(`${t.name}:seed`)}get seedKey(){return this}grow(t){const{seeder:e,seed:n}=t;e.isEmpty(n)&&t.hasFallback||t.insert(n)}}class Yt{}const te=Symbol("Contextual");function ee(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t[te]}class ne{constructor(){this._providers=new Map}provide(t){const e=new zt;return this._providers.set(e,t),e.whenOff((()=>this._providers.delete(e)))}seed(t,e=ht()){return dt(e,function(t,e){return Ct(tt(lt((()=>e.values())),(e=>g(e.bind(void 0,t)))),(t=>t()))}(t,this._providers))}isEmpty(t){return function(t){if(M(t))return nt(t);const e=B(t);return M(e)?nt(e):!!e.next().done}(t)}combine(t,e){return dt(t,e)}}class se extends Xt{seeder(){return new ne}}class re extends Zt{constructor(t,{seedKey:e}={}){super(t),this.seedKey=e||new se(this)}}class ie extends re{constructor(t,{seedKey:e,byDefault:n=y()}={}){super(t,e),this.byDefault=n}grow(t){const e=tt(t.seed);if(e.length)t.insert(e);else if(!t.hasFallback){const e=this.byDefault(t.context,this);e&&t.insert(Array.from(e))}}}class oe{constructor(){this._providers=[]}provide(t){const e=[t];return this._providers.unshift(e),new zt((()=>this._providers.splice(this._providers.lastIndexOf(e),1)))}seed(t,e){const{length:n}=this._providers;if(!n)return e||R;const s=([e])=>g(e.bind(void 0,t));if(!e&&1===n)return s(this._providers[0]);const r=this._providers.map(s);return e&&r.push(e),ue(r)}isEmpty(t){return null==t()}combine(t,e){return t===R?e:e===R?t:ue([e,t])}}function ue(t){return g((()=>{for(const e of t){const t=e();if(null!=t)return t}}))}class ce extends Xt{seeder(){return new oe}}class ae extends Zt{constructor(t,{seedKey:e}={}){super(t),this.seedKey=e||new ce(this)}}class he extends ae{constructor(t,{seedKey:e,byDefault:n=R}={}){super(t,{seedKey:e}),this.byDefault=n}grow(t){const e=t.seed();null!=e?t.insert(e):t.hasFallback||t.insert(this.byDefault(t.context,this))}}class le extends ae{constructor(){super("context-supply")}grow(t){t.insert(t.seed()||t.context.supply||(t.hasFallback?t.or:It()))}}const de=new le,fe=Symbol("ContextBuilder");class pe{constructor(t){this._initial=t,this._issuers=new Map}issuer(t){const e=this._issuers.get(t);if(e)return e;const n=t.seeder(),s=[n,e=>n.seed(e,this._initial(t,e))];return this._issuers.set(t,s),s}newSeed(t,e){const{seedKey:n}=e,[s,r]=this.issuer(n);return n!==e?[s,t.get(n)]:[s,r(t)]}}function ye(t){if(function(t){return"by"in t}(t)){if(!ge(t))return t;const{a:e,by:n,with:s}=t;return{a:e,by:t=>n(...s.map((e=>t.get(e))))}}if(function(t){return"is"in t}(t)){const{a:e,is:n}=t;return{a:e,by:p(n)}}if(function(t){return"via"in t}(t)){const{a:e,via:n}=t;return{a:e,by:t=>t.get(n)}}if(function(t){return"as"in t}(t)){if(function(t){return!("a"in t)}(t)&&(t=function(t){return c(u({},t),{a:t.as})}(t)),!ge(t)){const{as:e}=t;return{a:t.a,by:t=>new e(t)}}const{as:e,with:n}=t;return{a:t.a,by:t=>new e(...n.map((e=>t.get(e))))}}throw new TypeError(`Malformed context value specifier: ${JSON.stringify(t)}`)}function ge(t){return"with"in t}class _e{constructor(t,e,n,s={}){this.context=e,this.key=n,this._opts=s,this._constructed=null,this._setup=R;const[r,i]=t.newSeed(e,n);this.seeder=r,this.seed=i,this.hasFallback="or"in s}get or(){return this._opts.or}insert(t){this._constructed=t}fillBy(t){return t(this),this._constructed}setup(t){const e=this._setup;this._setup=n=>{e(n),t(n)}}_grow(){if(this.key.grow(this),null!=this._constructed)return[this._constructed,this._setup];if(!this.hasFallback)throw new Jt(this.key);return[this.or]}}class me{constructor(t){this._seeders=new pe(t?"function"==typeof t?t:e=>t.get(e):R)}provide(t){if(function(t){return"function"==typeof t[fe]}(t))return t[fe](this);const{a:{[Qt]:{seedKey:e}},by:n}=ye(t),[s]=this._seeders.issuer(e);return s.provide(n)}seed(t,e){const[,n]=this._seeders.issuer(e);return n(t)}seeds(){return(t,e)=>this.seed(e,t)}seedIn(t){return this.newValues().get.bind(t)}newValues(){return function(t,e){const n=new Map;return new class extends Yt{get({[Qt]:s},r){const i=n.get(s);if(null!=i)return i;const[o,u]=new _e(e,this,s,r)._grow();return u&&(n.set(s,o),u({key:s,context:this,registry:t})),o}}}(this,this._seeders)}append(t){const e="function"==typeof t?t:t.seeds();return new me(((t,n)=>{const s=e(t,n),[r,i]=this._seeders.issuer(t),o=i(n);return s?r.combine(o,s,n):o}))}}function we(t){return be(t)?t.applyAmendment:t}function be(t){return"function"==typeof t.applyAmendment}function ve(t){return!!t&&("object"==typeof t||"function"==typeof t)&&be(t)}function xe(t){return xe}function Se(t){if(Array.isArray(t)&&t.length<2){const[e=xe]=t;return we(e)}return e=>{let n=t=>{const s=t=>{const r=e.amend(t);return n=t=>{const e=r();return we(t)(c(u({},e),{amend:s})),e},()=>c(u({},r()),{amend:s})};we(t)(c(u({},e),{amend:s}))};for(const s of t)n(s)}}function ke(t){const{base:e,amend:n}=t,s=t=>{const e=t();return c(u({},e),{amend(t){const r=g(n(e,t)||(()=>function(t,e){return u(u({},t),e)}(e,t)));return()=>s(r)}})};return s(p(e))}function Ae(t){return ke({base:t,amend:Ce(t)})}function Ce({amend:t}){return t?(e,n)=>t(n):R}function Oe(...t){const e=Se(t),n=t=>e(Ae(t)),s=t=>{n({amendedClass:t})};return s.applyAmendment=e,s.decorateAmended=n,s}const $e=new WeakSet;function Re(t){if($e.has(t))return t;$e.add(t);const e=A(t);return e&&Re(e),F(t,"autoAmend")?(t.autoAmend(Ae({amendedClass:t})),t):t}function De(t,e){return n=>{throw new TypeError(`${t.kind.pName} ${t.cls.name}${Te(e)} is not readable`)}}function Fe(t,e){return(n,s)=>{throw new TypeError(`${t.kind.pName} ${t.cls.name}${Te(e)} is not writable`)}}const Ee=/^[a-z_$][a-z0-9_$]*$/i;function Te(t){return"string"==typeof t?Ee.test(t)?`.${t}`:`[${JSON.stringify(t)}]`:`[${String(t)}]`}function Pe(t,e,n){const s=Se(n),r=(e,n,r)=>{const i=t(e),[o,h,l]=function(t,e,n){if(n){const{get:s,set:r}=n;if(s||r)return[s?t=>s.call(t):De(t,e),r?(t,e)=>r.call(t,e):Fe(t,e),R]}const s=Symbol(t.kind.vDesc(e));let r=t=>t[e],i=(t,n)=>{t[e]=n};const o=(t,e)=>{t[s]=e};let u;if(n&&("value"in n||"writable"in n)){const{value:c,writable:a}=n;a?u=()=>{r=t=>s in t?t[s]:t[s]=c,i=o}:(i=Fe(t,e),u=R)}else u=()=>{const n=Reflect.getPrototypeOf(t.host);r=null!=n?t=>s in t?t[s]:t[s]=Reflect.get(n,e,t):t=>t[s],i=o};return[t=>r(t),(t,e)=>i(t,e),u]}(i,n,r),d={enumerable:!r||!!r.enumerable,configurable:!r||!!r.configurable,readable:!r||!!r.get,writable:!r||!!r.set||!!r.writable,get:t=>o(t),set:(t,e)=>h(t,e)},f=function(t,e,n,s){return r=>{const i=u({},s);return e(ke({base:u(c(u({},r),{key:n}),s),amend(e,s={}){const o=s,{key:h,enumerable:l=i.enumerable,configurable:d=i.configurable,readable:f,writable:p,get:y,set:g}=o,_=a(o,["key","enumerable","configurable","readable","writable","get","set"]),m=r.amend(_);let w,b,{get:v,set:x}=s;return x?v?(w=!0,b=!0):(v=De(t,n),w=!1,b=!0):v?(x=Fe(t,n),b=!1,w=!0):({readable:w,writable:b,get:v,set:x}=i),i.configurable=d,i.enumerable=l,i.readable=w,i.writable=b,i.get=v,i.set=x,()=>c(u({},m()),{key:n,enumerable:l,configurable:d,readable:w,writable:b,get:v,set:x})}})),i}}(i,s,n,d);let p;Oe((t=>{p=f(t)})).decorateAmended(e);const{enumerable:y,configurable:g,get:_,set:m}=p;let w;return m!==d.set||_!==d.get?(w={enumerable:y,configurable:g,get(){return _(this)},set(t){m(this,t)}},l()):y===d.enumerable&&g===d.configurable||(w=r&&(r.get||r.set)?c(u({},r),{enumerable:y,configurable:g}):c(u({},r),{enumerable:y,configurable:g,writable:p.writable})),w&&!r&&Reflect.defineProperty(i.host,n,w),w},i=(t,n,s)=>{const i={amendedClass:e(t)};return r(i,n,s)};return i.decorateAmended=r,i.applyAmendment=s,i}const Me={pName:"Property",vDesc:t=>`valueOf(${String(t)}`};function Be({amendedClass:t}){return{kind:Me,cls:t,host:t.prototype}}function Ke(t){return t.constructor}class Ne{name(t,e){if("string"==typeof t)return t;const[n,s]=t;return s.name(e(s),n,this)}}class je extends Ne{applyAlias(t,e){return`${e}-${t}`}}const Ue=new je,ze=new je;class Le extends Ne{applyAlias(t,e){return`${e}:${t}`}}const qe=new Le;class Ie extends Ne{applyAlias(t,e){return`${t}@${e}`}}const Ve=new Ie;class We{constructor(t,...e){this.url=t,this.aliases=e}get alias(){return this.aliases[0]||"ns"}name(t,e,n=Ue){return n.applyAlias(e,t,this)}}function Ge(t){return"string"==typeof t||function(t){return Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&t[1]instanceof We}(t)}function He(t,e){if("string"==typeof t)return"string"==typeof e?Je(t,e):e[1].url?-1:Je(t,e[0]);const[n,{url:s}]=t;return"string"==typeof e?s?1:Je(n,e):Je(s,e[1].url)||Je(n,e[0])}function Je(t,e){return t<e?-1:t>e?1:0}function Qe(){const t=new Map,e=new Map;return function(n){const s=t.get(n.url);if(s)return s;const r=n.alias;let i=0;for(const u of[r,...n.aliases]){const s=e.get(u);if(!s)return t.set(n.url,u),e.set(u,1),u;i||(i=s)}const o=`${r}${++i}`;return t.set(n.url,o),e.set(r,i),o}}const Ze=Symbol("after-event");function Xe(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t[Ze]}function Ye(t){let e,n;return"function"==typeof t?(e=new zt,n=(e,...n)=>t(...n)):(e=t.supply||new zt,n=(n,...s)=>{e.isOff||t.receive(n,...s)}),e.whenOff((()=>n=tn)),{supply:e,receive:(t,...e)=>n(t,...e)}}function tn(t,...e){}function en(t){let e=function n(s){let r=t;const i=[];e=t=>i.push(t);try{for(;;){r=nn(r,s);const t=i.shift();if(!t)break;s=t}}finally{e=n}};return(...t)=>e(t)}function nn(t,e){const n=[];for(const s of t){const t=n.length;n.push(s);const r={onRecurrent(e){n[t]=Ye({supply:s.supply,receive(t,...n){e(...n)}})}};s.receive(r,...e)}return n}class sn{constructor(){const t=this._rcs=new Set;this.send=en(t),this.supply=new zt((()=>{t.clear(),delete this._rcs}))}get size(){return this._rcs?this._rcs.size:0}on(t){const e=Ye(t),n=e.supply.needs(this),s=this._rcs;return s&&!n.isOff&&(s.add(e),n.whenOff((()=>s.delete(e)))),n}}const rn=Symbol("on-event");function on(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t[rn]}class un extends TypeError{constructor(t="No events to send"){super(t)}}function cn(t){const e=Ye(t);let n=en([e]);return e.supply.whenOff((()=>n=R)),(...t)=>n(...t)}function an(){throw new un}function hn(t,e){return({supply:n,receive:s})=>{let r=Ht();t({supply:n,receive:(t,...i)=>{const o=r,u=e(...i);r=u?u({supply:new zt((t=>{t!==hn&&n.off(t)})).needs(n),receive:s}):Ht(),o.off(hn)}})}}function ln(...t){return t.reduce(((t,e)=>e(t)),this)}function dn(){return this}function fn(t){return({supply:e,receive:n})=>{t({supply:e,receive:(t,...s)=>{n(t,...s),e.off()}})}}function pn(t,e){return new Promise(((n,s)=>{fn(this)({supply:new zt(e?t=>{try{n(e(t))}catch(r){s(r)}}:s),receive:t?(e,...r)=>{try{n(t(...r))}catch(i){s(i)}}:(t,e)=>n(e)})}))}function yn(t){const e=new gn(t);return e.on.bind(e)}class gn extends sn{constructor(t){super(),this.supplier=t,this._on=this._onInit()}on(t){return this._on.on(t),t.supply}_onInit(){return{on:t=>{const e=[],n=new zt((()=>this._on=this._onInit())),s=this._on=this._onFirst(n,e);try{s.on(t),this.supplier({supply:n,receive:(t,...e)=>this._on.dispatch(...e)})}finally{this._on===s&&(this._on=this._onNext(n,e))}},dispatch:null}}_onFirst(t,e){return{on:n=>this._addReceiver(n,t,e),dispatch:(...t)=>{e.push(t),this.send(...t)}}}_onNext(t,e){return{on:n=>this._addReceiver(n,t,e),dispatch:(...t)=>{e.length=0,this.send(...t)}}}_addReceiver(t,e,n){if(e.cuts(t),super.on(t).whenOff((t=>{this.size||e.off(t)})),n.length){const e=cn(t);n.forEach((t=>e(...t)))}}}function _n(t,e,n){return s=>{n?t({supply:(new zt).needs(e).cuts(n),receive:s.receive}):(s.supply.needs(e),t(s))}}function mn(t,e){return n=>{const s=cn(n);t({supply:n.supply,receive:(t,...n)=>{e(s,...n)}})}}function wn({supply:t}){t.off()}function bn(t){const e=e=>{const n=Ye(e),{supply:s}=n;if(!s.isOff)try{t(n)}catch(r){s.off(r)}return s};return e[rn]=dn,e.do=ln,e.then=pn,e}function vn(t,e=an,n=xn){let s,r=0;const i=i=>{let o=R;const u=Ye(i);if(u.supply.isOff)return u.supply;const c=new zt(R).needs(u);let a=!1;++r;try{t({supply:c,receive:(t,...e)=>{a=!0,s=e,o(t,...e)}})}catch(h){c.off(h)}if(!c.isOff||a){if(!s)try{s=e()}catch(h){c.off(h)}s&&(u.receive({onRecurrent(t){o=(e,...n)=>t(...n)}},...s),o=(t,...e)=>u.receive(t,...e))}return c.whenOff((t=>{--r||(s=void 0),u.supply.off(t),r||n(t)}))};return i[rn]=dn,i.do=ln,i.then=pn,i[Ze]=dn,i}function xn(t){}function Sn(t){return function(t){return"function"==typeof t&&t[rn]===dn&&t.do===ln&&t.then===pn}(t)&&t[Ze]===dn}function kn(t){const e=Object.keys(t);return vn(yn(vn((n=>{const{supply:s}=n,r=cn(n);let i=R;const o={};e.forEach((e=>{s.needs(t[e][Ze]()(((...t)=>{o[e]=t,i()})).needs(s))})),s.isOff||(i=()=>r(o))}),(()=>{const n={};return e.forEach((e=>fn(t[e][Ze]())({supply:new zt,receive:(t,...s)=>n[e]=s}))),[n]}))))}function An(...t){return vn(yn(vn((e=>{const{supply:n}=e,s=cn(e);let r=R;const i=[];t.forEach(((t,e)=>{n.needs(t[Ze]()(((...t)=>{i[e]=t,r()})).needs(n))})),n.isOff||(r=()=>s(...i))}),(()=>{const e=[];return t.forEach((t=>fn(t[Ze]())({supply:new zt,receive:(t,...n)=>e.push(n)}))),e}))))}function Cn(t,e){return vn((e=>t[rn]()(e)),e)}function On(t,e){return Xe(t)?t[Ze]():Cn(t,e)}function $n(...t){return vn(R,p(t))}function Rn(t){return Sn(t)?t:$n(t)}function Dn(t){return e=>{let n=Ht();const s=new zt((t=>n.off(t)));return e({supply:s,receive(e,...s){const r=n;try{n=(t(...s)||Ht()).supply}finally{n!==r&&r.off()}}}),s}}function Fn(t){return vn(yn(t))}let En,Tn;function Pn(t,e){return t||e?Mn(t,e):En||(En=Mn())}function Mn(t,e){const n=Bn(t,e);return t=>Fn(n(t))}function Bn(t,e){return t||e?Nn(t,e):Tn||(Tn=Nn())}const Kn={};function Nn(t=jn,e=C){return n=>{let s=Kn;return vn((({supply:r,receive:i})=>n({supply:r,receive(n,...r){const o=e(r);s!==Kn&&t(s,o)||(s=o,i(n,...r))}})),void 0,(t=>s=Kn))}}function jn(t,e){return n=t,s=e,"function"==typeof(r=Math.max(O(t),O(e)))?v(n,s,r,i,o):v(n,s,f,r,i);var n,s,r,i,o}function Un(t,e){const n=zn(t,e);return t=>Fn(n(t))}function zn(t,e){const n=(...e)=>{const n=t(...e);return n&&On(n)};return t=>vn(hn(t,n),e)}class Ln extends sn{constructor(){super(...arguments),this.on=bn((t=>super.on(t)))}[rn](){return this.on}}const qn=bn(wn);function In(t){return on(t)?t[rn]():t[Ze]()}function Vn(...t){return t.length?bn(yn(bn((({supply:e,receive:n})=>{let s=t.length;const r=t=>{--s||e.off(t)};t.forEach((t=>In(t)({supply:new zt(r).needs(e),receive:n})))})))):qn}function Wn(t){let e=n=>{t.then((()=>e(n)),(()=>e(n)))};return t.then((t=>{e=function(t){return e=>{try{cn(e)(t),e.supply.off()}catch(n){e.supply.off(n)}}}(t)})).catch((t=>{var n;n=t,e=({supply:t})=>t.off(n)})),bn((t=>e(t)))}function Gn(t){return bn(yn(t))}function Hn(t){const e=(...e)=>{const n=t(...e);return n&&In(n)};return t=>bn(hn(t,e))}function Jn(t){const e=Qn(t);return t=>Gn(e(t))}function Qn(t){return e=>bn(mn(e,t))}function Zn(t,e){const n=Xn(t,e);return t=>Fn(n(t))}function Xn(t,e){return n=>vn(mn(n,((e,...n)=>e(t(...n)))),e&&(()=>[e()]))}function Yn(t){const e=ts(t);return t=>Gn(e(t))}function ts(t){return e=>bn(mn(e,((e,...n)=>e(t(...n)))))}function es(t){return vn(fn(t))}function ns(t){return bn(fn(t))}function ss(t,e){return Vt(t.supply)?C:n=>bn(_n(n,t,e))}function rs(t){return bn((e=>{const{supply:n}=e,s=cn(e),r=new zt;let i=0;const o=t.do(ss(n,r),Yn((t=>(++i,t))));let u=[],c=1,a=0;r.whenOff((t=>{i||n.off(t)})),function(t){return bn((e=>{const{supply:n}=e,s=cn(e);let r=0;t({supply:n,receive(t,e){const i=++r;Promise.resolve().then((()=>e)).then((t=>s(t,i)),(t=>n.off(t)))}})}))}(o)({supply:n,receive(t,e,o){const h=o-c;if(u[h]=e,++a,a>h){let t;a===u.length?(t=u,u=[]):t=u.splice(0,h+1),c+=t.length,a-=t.length,i-=t.length,s(...t),!i&&r.isOff&&n.needs(r)}}})}))}function is(t,e){return Vt(t.supply)?C:n=>vn(_n(n,t,e))}function os(t,e){const n=us(t,e);return t=>Fn(n(t))}function us(t,e){return n=>vn(mn(n,t),e)}function cs(t){const e=as(t);return t=>Gn(e(t))}function as(t){return Qn(((e,...n)=>{const s=t(...n);null!=s&&!1!==s&&e(s)}))}function hs(t){return Array.isArray(t)?t:[t]}class ls{constructor(t){this._drop=t,this.emitter=new Ln,this._nested=new Map,this.emitter.on(((t,e,n)=>{const s=t[0],r=this._nested.get(s);r&&r.emitter.send(t.slice(1),e,n)}))}on(t){const e=this.emitter.on(t);return new zt((t=>{e.off(t),this._dropIfEmpty()})).needs(e)}nest(t,e){const n=this._nested.get(t);if(n||e)return n;const s=new ls((()=>this._remove(t)));return this._nested.set(t,s),s}done(t){for(const e of this._nested.values())e.done(t);this.emitter.supply.off(t)}_remove(t){this._nested.delete(t),this._dropIfEmpty()}_dropIfEmpty(){!this._nested.size&&this.emitter.size<=1&&this._drop()}}class ds{constructor(){this._root=new ls(R)}on(t,e){return this._entry(t).on(e)}send(t,e,n){this._root.emitter.send(t,e,n)}done(t,e){const n=this._entry(t,!0);n&&n.done(e)}_entry(t,e){let n=this._root;for(const s of t){const t=n.nest(s,e);if(!t)return;n=t}return n}}class fs{constructor(t,e){this._trackers=t,this._path=e,this.onUpdate=bn((t=>this._trackers.on(this._path,t))),this.update=(t,e,n)=>{this._trackers.send([...this._path,...hs(t)],e,n)}}get _tracker(){return this}[rn](){return this.onUpdate}track(t){return(t=hs(t)).length?new fs(this._trackers,[...this._path,...t]):this}done(t){this._trackers.done(this._path,t)}}class ps{constructor(){this._tracker=new fs(new ds,[])}get onUpdate(){return this._tracker.onUpdate}[rn](){return this.onUpdate}get update(){return this._tracker.update}track(t){const e=this._tracker.track(t);return e===this._tracker?this:e}done(t){this._tracker.done(t)}}class ys{constructor(){this._by=Ht(),this.read=vn((t=>{return this.on({supply:(e=t).supply,receive(t,n){e.receive({onRecurrent(e){t.onRecurrent((t=>e(t)))}},n)}});var e}),(()=>[this.it]))}[rn](){return this.on}[Ze](){return this.read}by(t,e){const n=t=>(Xe(t)?t[Ze]():t[rn]())((t=>this.it=t));if(this.byNone(),e){const s=t;this._by=In(s).do(Dn(((...t)=>{const s=e(...t);if(s)return n(s)})))}else{const e=t;this._by=n(e)}return this._by.whenOff((()=>this._by=Ht())),this}byNone(t){return this._by.off(t),this}}class gs extends ys{constructor(t){super(),this._it=t,this._on=new Ln}get supply(){return this._on.supply}get on(){return this._on.on}get it(){return this._it}set it(t){const e=this._it;e!==t&&(this._it=t,this._on.send(t,e))}}function _s(t){return new gs(t)}function ms(t,e){return _s().by(t,e)}class ws extends ys{constructor(t){super(),this._on=new Ln,this._it=t}get on(){return this._on.on}get supply(){return this._on.supply}get it(){return this._it}set it(t){const e=this.it;e!==t&&(this._it=t,this._on.send(t,e))}sync(t,e,n){let s,r,i=t=>c(this,t);"string"==typeof t?("in"===t&&(i=t=>c(t,this)),s=e,r=n):(s=t,r=e);const o=r;if(!o)return i(s);const u=s;return(Xe(u)?On(u):In(u)).do(Dn(((...t)=>{const e=o(...t);return e&&i(e)})));function c(t,e){const n=t.read((t=>{e.it=t})),s=e.on((e=>{t.it=e}));return new zt((t=>{s.off(t),n.off(t)})).needs(n).needs(s)}}}const bs=bn(R);const vs={onRecurrent:R};class xs{constructor(t){this.supply=new zt,this._target=t}on(t){return function(t){const e=(e,n)=>{const s=Ye(e),{supply:r}=s;return r.isOff||t(s,n),r};return e[rn]=bs[rn],e.do=bs.do,e.then=bs.then,e}(((e,n)=>{const{supply:s}=e;if(s.needs(this),!s.isOff){const s=t=>e.receive(vs,t);this._target.addEventListener(t,s,n),e.supply.whenOff((()=>this._target.removeEventListener(t,s)))}}))}dispatch(t){return!this.supply.isOff&&this._target.dispatchEvent(t)}}function Ss(t=new TypeError("Context destroyed")){return()=>{throw t}}const ks=os(((t,...e)=>t(...tt(dt(...e)))));class As{constructor(){this._providers=_s([new Map])}provide(t){const[e]=this._providers.it,n=new zt;return e.set(n,t),this._providers.it=[e],n.whenOff((()=>{const[t]=this._providers.it;t.delete(n),this._providers.it=[t]}))}seed(t,e=$n()){return this.combine(e,function(t,e){return e.read.do(zn((([e])=>e.size?An(...kt(kt(lt((()=>e.values())),(e=>e(t))),Cs)):$n())),ks)}(t,this._providers))}isEmpty(){return!1}combine(t,e){return An(t,e).do(ks)}}function Cs(t){return Sn(t)?t:null!=t?$n(t):$n()}class Os extends Xt{get upKey(){return this}seeder(){return new As}}class $s extends Zt{constructor(t,e){super(t.name+":up"),this._key=t,this.grow=t=>{const n=t.fillBy(e);null!=n&&t.insert(n.do(is(t.context.get(de))))}}get seedKey(){return this._key.seedKey}get upKey(){return this}}class Rs extends Zt{constructor(t,{seedKey:e}={}){super(t),this.seedKey=e||new Os(this)}createUpKey(t){return new $s(this,t)}}function Ds(t){const e=function(t){return us(((e,...n)=>e(...gt(kt(n,(e=>ee(e)?e[te](t):e)),E))))}(t);return t=>Fn(e(t))}class Fs extends Rs{constructor(t,{seedKey:e,byDefault:n=R}={}){super(t,e),this.byDefault=(t,e)=>n(t,e)||(()=>{throw new Jt(this)}),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(Un(((...e)=>e.length?$n(e[e.length-1]):t.hasFallback&&t.or?t.or:$n(this.byDefault(t.context,this))))))))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?$n(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=Ss(t))),t.insert(((...t)=>e(...t)))}}class Es extends Error{constructor(t,e=[],n=function(t,e){const n=e.reduce(((t,[e,n])=>(t?t+=", ":t=": ",t+=void 0!==n?`${e} failed to load (${n})`:`${e} not loaded`)),"");return`Failed to load ${t}${n}`}(t,e)){super(n),this.module=t,this.reasons=e,this.message=n}}class Ts{constructor(t,e){this.module=e,this._useCounter=0,this._impl=_s(),this._rev=_s({status:{module:this.module,provided:!1,used:!1,settled:!1,ready:!1},supply:Ht()});const n=t.get(de);n.cuts(this._impl),n.cuts(this._rev),this._impl.read((t=>{const e=this._rev.it.supply;t&&this._load(t),e.off()}))}createHandle(){const t=this._rev.read.do(Xn((({status:t})=>t))),e={read:t,[Ze]:p(t),use:t=>this._use(e,t)};return e}setup(t,e){this._setup=()=>{const n=this._rev.it,{status:{module:s},supply:r}=n;s!==this.module?t.get(s).use(r).read({supply:r,receive:(t,{settled:e,ready:s,error:r})=>{this._updateStatus(n,e,s,r)}}):async function(t,e,{status:{module:n},supply:s}){const r=new Ps(n);return await n.setup({module:n,supply:s,get:e=>t.get(e),provide:t=>e.provide(t).needs(s),initBy(t){r.initBy(t)}}),r}(t,e,n).then((({whenReady:t})=>(this._updateStatus(n,!0,!1),t))).then((()=>this._updateStatus(n,!0,!0))).catch((t=>n.supply.off(t)))}}implementBy(t){this._impl.by(t)}_updateStatus(t,e,n,s){this._rev.it.supply!==t.supply?t.supply.off():this._rev.it=t={status:{module:t.status.module,provided:t.status.provided,used:!0,settled:e,ready:n,error:s},supply:t.supply}}_load(t){const e=new zt(R).needs(this._rev).whenOff((t=>{this._rev.it.supply===e&&(this._rev.it={status:c(u({},this._rev.it.status),{provided:!1,settled:!1,ready:!1,error:t}),supply:e})})),n=!!this._useCounter;this._rev.it={status:{module:t,provided:!0,used:n,settled:!1,ready:!1},supply:e},n&&this._setup()}_use(t,e){const n=new zt(R);e&&n.needs(e);const s=t.read.do(is(n)),r=c(u({},t),{read:s,whenSettled:Ms(s,Bs),whenReady:Ms(s,Ks),supply:n});if(!n.isOff&&(n.whenOff((t=>{if(!--this._useCounter){const e=this._rev.it;this._rev.it={status:c(u({},e.status),{used:!1,settled:!1,ready:!1,error:t}),supply:new zt(R).off(t)},e.supply.off(t)}})),!this._useCounter++)){const t=this._rev.it;this._rev.it={status:c(u({},t.status),{used:!0}),supply:t.supply},this._setup()}return r}}class Ps{constructor(t){this._module=t,this._whenDone=Promise.resolve(),this.whenReady=new Promise((t=>this._ready=t))}initBy(t){const e=this._whenDone=this._whenDone.then(t).finally((()=>this._done(e)))}_done(t){this._whenDone===t&&(this._ready(t),this.initBy=t=>{throw new TypeError(`${this._module} initialized already, and does not accept new initializers`)})}}function Ms(t,e){return bn((n=>t({supply:n.supply,receive:(t,s)=>{e(s)?(n.receive(t,s),n.supply.off()):s.error&&n.supply.off(s.error)}})))}function Bs({settled:t}){return t}function Ks({ready:t}){return t}class Ns extends Rs{constructor(t,e){super(t),this._module=e}get upKey(){return this}grow(t){const e=new Ts(t.context,this._module);var n;t.insert(e.createHandle()),t.setup((({context:t,registry:n})=>e.setup(t,n))),e.implementBy((n=this._module,t.seed.do(Xn(((...t)=>{let e;for(let s=t.length-1;s>=0&&(e=t[s],e===n);--s);return e})))))}}const js=Symbol("ContextModule.impl");class Us{constructor(t,e,n){this.name=e,this.options=n,this.key=new Ns(`${e}:module`,t);const{needs:s,has:r,setup:i}=n;this.has=S(r).add(t),this.needs=S(s),this._setup=i?i.bind(n):R}replace(t,e,n){for(const s of t.has)s!==t&&e.provide({a:s,is:t}).needs(n)}async setup(t){const e=function(t){const{module:e,supply:n}=t;return tt(Ct(e.needs,(s=>s!==e&&t.provide(s).needs(n)&&{dep:s,use:t.get(s).use(t)})))}(t);await zs(t,e,Ls)&&(t.initBy((async()=>{await zs(t,e,qs)})),await this._setup(t))}}function zs(t,e,n){const{module:s,supply:r}=t,i=p(!1),o=r.whenDone().then(i,i);return Promise.race([o,Promise.all(e.map((({dep:t,use:e})=>n(e).then(R,(e=>[t,e]))))).then((t=>{const e=t.filter(T);return!e.length||new Es(s,e)}))]).then((t=>"boolean"!=typeof t?Promise.reject(t):t))}function Ls(t){return t.whenSettled}function qs(t){return t.whenReady}class Is{constructor(t,e={}){this[js]=new Us(this,t,e)}get[Qt](){return this[js].key}get name(){return this[js].name}get needs(){return this[js].needs}get has(){return this[js].has}[fe](t){const e=t.provide({a:this,is:this});return this[js].replace(this,t,e),e}setup(t){return this[js].setup(t)}toString(){return`ContextModule(${this.name})`}}function Vs(t){return t.ownerDocument||t}function Ws(t){return 1===t.nodeType}function Gs(t,e,n,s=Hs){let r;"function"==typeof n?(s=n,r=null):r=n||null;const i=Vs(e);if(Ws(t)){const n=i.createElement(t.tagName.toLowerCase());return t.getAttributeNames().forEach((e=>n.setAttribute(e,t.getAttribute(e)))),s(t,n),e.insertBefore(n,r),n}const o=i.importNode(t,!1);return e.insertBefore(o,r),o}function Hs(t,e){for(let n=0;n<t.childNodes.length;++n)Gs(t.childNodes[n],e)}function Js(t){const{parentNode:e}=t;return e&&Ws(e)&&e||t.getRootNode().host||void 0}const Qs={by(t={}){let e;const{error:n=console.error}=t;return{get node(){return t.node},get window(){return e||(e=t.window||(t.node?Vs(t.node).defaultView||window:window))},error:n}}},Zs=Symbol("render-q");class Xs{constructor(t,e){this.q=t,this.schedule=this.doSchedule,this.ref=e||[this,this],this.execute=t.recur?this.execRecurring:this.execNonRecurring}static by(t,e){return t[Zs]||(t[Zs]=new Xs(t,e))}add(t){this.q.add(t)}doSchedule(t){this.schedule=Ys;const e=[],n={get config(){return t},postpone(t){e.unshift(t)}};this.q.schedule((()=>{const t=this.reset();t.suspend(),this.execute(n,(()=>{this.ref[1]=this.ref[0],e.forEach((t=>this.q.add(t))),n.postpone=t=>this.q.post(t),this.exec(n),t.resume()}))}))}exec(t){for(;;){const e=this.q.pull();if(!e)break;e(t)}}execNonRecurring(t,e){this.exec(t),e()}execRecurring(t,e){const n=()=>{this.exec(t),this.q.recur(n)||e()};n()}reset(){return this.ref[0]=Xs.by(this.q.reset(),this.ref)}suspend(){this.schedule=t=>{this.scheduled=t,this.schedule=Ys}}resume(){this.scheduled?this.doSchedule(this.scheduled):this.schedule=this.doSchedule}}function Ys(t){}function tr(t){return e=>{const n=Qs.by(e),s=Xs.by(t.newQueue(n)).ref;let r=[];return t=>{const[e,,i]=r,[o,u]=s;let c=e||u;if(e===u&&!i||e===o)r[1]=t;else{const e=r=[c=!i||c.q.recur?u:o,t];c.add((t=>{e[2]=!0;try{e[1]({get config(){return n},postpone(e){t.postpone(e)}})}catch(s){n.error(s)}}))}c.schedule(n)}}}const er={by(t){const{schedule:e,recur:n}=t;let s,{replace:r=nr}=t,i=[],o=i;if(n){s=t=>i.length?(o=i,i=[],n(t),!0):(i=o,!1);const t=r;r=e=>{i=[],t(e)}}return{add(t){i.push(t)},post(t){i.unshift(t)},pull:()=>o.shift(),schedule:e,recur:s,reset(){const e=er.by(t);return r(e),e}}}};function nr(t){}const sr=new WeakMap,rr=tr({newQueue({window:t}){const e=sr.get(t);if(e)return e;const n=er.by({schedule:e=>t.requestAnimationFrame(e),replace:e=>sr.set(t,e)});return sr.set(t,n),n}});function ir(t){Promise.resolve().then(t)}let or=er.by({schedule:ir,recur:ir,replace:t=>or=t});const ur=tr({newQueue:()=>or}),cr=t=>{const e=Qs.by(t);return t=>{const n=[],s={get config(){return e},postpone(t){n.push(t)}};for(r(t);;){const t=n.pop();if(!t)break;r(t)}function r(t){try{t(s)}catch(n){e.error(n)}}}};let ar=er.by({schedule:t=>t(),replace:t=>ar=t});const hr=tr({newQueue:()=>ar});let lr=rr;function dr(t){return lr(t)}let fr=gr;function pr(t){}let yr=function t(e){const n=[e];yr=function(t){return e=>t.push(e)}(n),Promise.resolve().then((()=>{yr=t;for(const t of n)t.lift()})).catch(console.error)};function gr(t){yr(t)}function _r(t){const e=[],n=function(t){const e=fr;return fr=t,e===gr?()=>(fr=e,pr):()=>fr=e}((t=>e.push(t)));try{return t()}finally{const t=n();for(const n of e){n.lift()===n&&t(n)}}}const mr=Symbol("DrekPlacement.status");class wr{constructor(t){this.placement=t}onceConnected(){return(this.onceConnected=p(this.placement.readStatus.do((t=({connected:t})=>t,e=>bn((n=>{let s=!1;e({supply:n.supply,receive(e,...r){const i=t(...r);(i||s!==i)&&(s=i,n.receive(e,...r))}})}))))))();var t}whenConnected(){return(this.whenConnected=p(this.onceConnected().do(ns)))()}}class br{constructor(){this[mr]=new wr(this)}[Ze](){return this.readStatus}get onceConnected(){return this[mr].onceConnected()}get whenConnected(){return this[mr].whenConnected()}}class vr extends br{get whenSettled(){return this.whenConnected}}const xr=Symbol("DrekContext");class Sr{constructor({nsAlias:t,scheduler:e}){this._nsAlias=t,this.nsAlias=t=>this._nsAlias(t),this._scheduler=e,this.scheduler=t=>{let e=this._scheduler,n=e(t);return s=>(e!==this._scheduler&&(e=this._scheduler,n=e(t)),n(s))}}set({nsAlias:t,scheduler:e}){this._nsAlias=t,this._scheduler=e}}function kr(t){const e=t[xr];if(e)return e;const n=new Sr({nsAlias:Qe(),scheduler:dr}),s=t.defaultView||window,r=t=>n.scheduler(u({window:s},t)),i=$n({connected:!0});return t[xr]=new class extends vr{get fragment(){}get window(){return s}get document(){return t}get nsAlias(){return n.nsAlias}get scheduler(){return r}get readStatus(){return i}lift(){return this}update({nsAlias:t=n._nsAlias,scheduler:e=n._scheduler}){return n.set({nsAlias:t,scheduler:e}),this}}}function Ar(t){return 9===t.nodeType?kr(t):function(t){const e=t[xr];if(e)return e.lift();const n=_s({connected:!1}),s=new Ln;let r=kr(t.ownerDocument);const i=new Sr(r);let o=()=>r.fragment,u=e=>{const c=t.getRootNode({composed:!0});if(c===t)return e;const a=Ar(c);return t[xr]=void 0,o=()=>a.fragment,i.set(a),a.whenSettled((t=>s.send(t))).cuts(s),n.by(a),u=t=>a,r=a,a};class c extends vr{get fragment(){return o()}get window(){return r.window}get document(){return r.document}get nsAlias(){return r.nsAlias}get scheduler(){return i.scheduler}get readStatus(){return n.read}get whenSettled(){return s.on}lift(){return u(this)}}const a=t[xr]=new c;return function(t){fr(t)}(a),a}(t)}function Cr(t){for(;;){const e=t.getRootNode({composed:!0});if(e===t)return Ar(t);t=e}}const Or=Symbol("DrekCssClasses");class $r{constructor(t){this._element=t,this._uses=new Map,this._context=Cr(t)}add(t,e){return this._add(this._context,t,e)}_add({nsAlias:t,scheduler:e},n,s){const r=s?s.supply:new zt;if(r.isOff)return r;const i=Ve.name(n,t),o=e({node:this._element}),u=this._use(i),c=()=>{u.n?u.s||(this._element.classList.add(i),u.s=1):(u.s&&!u.i&&(this._element.classList.remove(i),u.s=0),this._uses.delete(i))};return 1===u.n&&o(c),r.whenOff((()=>{--u.n||o(c)}))}_use(t){let e=this._uses.get(t);return e?++e.n:(e=this._element.classList.contains(t)?{i:1,n:1,s:1}:{i:0,n:1,s:0},this._uses.set(t,e)),e}has(t){return this._has(this._context,t)}_has({nsAlias:t},e){const n=Ve.name(e,t),s=this._uses.get(n);return s?!!s.n||!!s.i:this._element.classList.contains(n)}renderIn(t){return t!==this._context?{add:e=>this._add(t,e),has:e=>this._has(t,e),renderIn:t=>this.renderIn(t)}:this}}const Rr=Symbol("DrekFragment.context");class Dr extends vr{constructor(t,e,n,s,r){super(),this._fragment=t,this._target=e,this._content=n,this._status=_s([{connected:!1,withinFragment:"added"}]),this._settled=new Ln,this._rendered=new Ln,this._getFragment=()=>t,this._lift=this,this.readStatus=this._status.read.do(us(((t,e)=>t(...e)))),this._state=new Sr({nsAlias:s,scheduler:r}),this.scheduler=this._createSchedule.bind(this),this.whenConnected(((...t)=>{this._whenSettled=this.whenConnected,this._settled.send(...t)}))}static attach(t,e,{nsAlias:n=e.context.nsAlias,scheduler:s=hr,content:r}){if(r){if(r.getRootNode({composed:!0})!==r)throw new TypeError("Not a standalone DocumentFragment");if(r[xr])throw new TypeError("Can not render content of another fragment")}else r=e.context.document.createDocumentFragment();return r[xr]=new Dr(t,e,r,n,s)}get fragment(){return this._getFragment()}get window(){return this._target.context.window}get document(){return this._target.context.document}get nsAlias(){return this._state.nsAlias}get whenSettled(){return this._whenSettled||(this._whenSettled=this._settled.on.do(ns))}lift(){return this._lift}_settle(){this.scheduler()((t=>{this._settled.send(...this._status.it)}))}_render(){this._lift=this._target.context,this._status.it=[{connected:!1,withinFragment:"rendered"}];const t=this._state._scheduler();return this._state.set(this._target.context),t((({postpone:t})=>{t((()=>{this._target.context.scheduler()((()=>{const t=this._target.placeContent(this._content);this._getFragment=()=>t.fragment,this._content[xr]=this._fragment[Rr]=new Dr(this._fragment,this._target,this._content,this.nsAlias,this.scheduler),this._status.by(t,((...t)=>$n(t))),this._rendered.send(t)}))}))})),this}_whenRendered(){return(this._whenRendered=p(this._rendered.on.do(ns)))()}_createSchedule(t={}){const e=this._state.scheduler(c(u({},t),{window:this.window}));return t=>e((e=>t(this._createExecution(e))))}_createExecution(t){const e=c(u({},t),{fragment:this._fragment,content:this._content,postpone(n){t.postpone((t=>n(e)))}});return e}}class Fr{constructor(t,e={}){this[Rr]=Dr.attach(this,t,e)}get target(){return this[Rr]._target}get innerContext(){return this[Rr]}get content(){return this[Rr]._content}get whenRendered(){return this[Rr]._whenRendered()}settle(){return this[Rr]._settle(),this}render(){return this[Rr]._render()}}function Er(t,e=Cr(t)){return{context:e,host:t,placeContent:n=>(t.appendChild(n),e)}}function Tr(t,e){const n=Pr(t,e);return{context:t.context,host:t.host,placeContent:e=>n.charge(e,t)}}function Pr(t,e){return"function"==typeof e?Pr(t,e(t)):"string"==typeof e?Mr(t,e):e||Mr(t,Math.random().toString(32).substr(2))}function Mr({context:{document:t}},e){let n=(s,r)=>{const i=t.createComment(` [[ ${e} [[ `),o=t.createComment(` ]] ${e} ]] `);let u;n=(e,n)=>{const s=t.createRange();return s.setStartAfter(i),s.setEndBefore(o),s.deleteContents(),s.insertNode(e),u};const c=t.createDocumentFragment();return c.append(i,s,o),u=r.placeContent(c)};return{charge:(t,e)=>n(t,e)}}function Br(t,e=Cr(t)){return{context:e,host:t,placeContent:n=>(t.textContent=null,t.appendChild(n),e)}}class Kr extends TypeError{constructor(t,e,n,s=t.workName(e)+(void 0!==n?` already terminated (${n})`:" already done")){super(s),this.workload=t,this.work=e,this.reason=n}}class Nr{constructor(t,e){this.name=t,this.allocator=e}workName(t){return`The work of ${this.name}`}toString(){return`Workload(${this.name})`}}class jr{constructor(t){this._allotment=t,this._queues=new Map}runAfter(t,e){let n=this._queues.get(t);return n||(n=new Ur(this._allotment),this._queues.set(t,n)),n.enqueue(e)}}class Ur{constructor(t){this._allotment=t,this._tasks=[]}enqueue(t){return new Promise((e=>{const n={task:t,run:()=>{e(this._allotment.run(t).finally((()=>{this._tasks.shift(),this._runNext()})))}};this._tasks.push(n),1===this._tasks.length&&this._runNext()}))}_runNext(){const[t]=this._tasks;t&&t.run()}}class zr extends Nr{constructor(){super("ordering",{start:t=>new jr(t)})}}zr.$=new zr;class Lr extends Nr{constructor(t,e={}){super(t,{start(t){const{workbench:n,workload:s,supply:r}=t,i=new qr(t,e);return{workbench:n,stage:s,supply:r,async run(t){return await i.run(this,t)}}}})}workName(t){return`The ${this.name} stage`}toString(){return`WorkStage(${this.name})`}}class qr{constructor(t,e){this.allotment=t,this.allocator=e,this._whenTaskDone=Promise.resolve();const{supply:n}=t;this._whenAllDone=new Promise((t=>this._end=t)).then((()=>n.off())).catch((t=>n.off(t))),n.whenOff((e=>{void 0===e?this._end():this._end(Promise.reject(e)),this.run=(n,s)=>Promise.reject(new Kr(t.workload,n,e))}))}run(t,e){const n=this._start(t).then((()=>this.allotment.run(e)));return this._addTask(n),n}_addTask(t){const e=this._whenTaskDone=Promise.all([this._whenTaskDone,t.catch(R)]);e.finally((()=>{e===this._whenTaskDone&&this._end(e)}))}_start(t){let e=this._awaitDeps();return this.allocator.start&&(e=e.then((async()=>{await this.allocator.start(t)}))),this._start=p(e),this._addTask(e),e}_awaitDeps(){const t=[],e=e=>{t.push(new Promise((t=>{this.allotment.workbench.work(zr.$).runAfter(e,(()=>(t(),this._whenAllDone))).catch(R)})))},{after:n}=this.allocator;return n&&e(n),e(this.allotment.workload),Promise.all(t)}}const Ir=Symbol("Workbench.impl");class Vr{constructor(t,e){this.workbench=t,this._works=new Map;const{supply:n=It(),run:s}=e;this.supply=new zt((t=>{this.work=e=>{throw new Kr(e,void 0,t,"The workbench is stopped")}})).as(n),this._run=s?s.bind(e):Wr}work(t){if(this._works.has(t))return this._works.get(t);let e=R;const n=async(n,s)=>{const r=await this._run(s,n,t);return e(),r},s=(new zt).needs(this.supply);let r,i,o;const u=new Promise((e=>{r=s=>(i=s,this._works.set(t,s),o=async t=>await n(s,t),e(s),s)}));return o=async t=>await n(await u,t),s.whenOff((n=>{o=e=()=>{throw new Kr(t,i,n)},this._works.delete(t)})),r(t.allocator.start({workbench:this.workbench,workload:t,supply:s,run:async t=>await o(t)}))}}async function Wr(t,e,n){return await t()}class Gr{constructor(t={}){this[Ir]=new Vr(this,t)}get supply(){return this[Ir].supply}work(t){return this[Ir].work(t)}}function Hr(t){const e=t.length,n=t.charCodeAt(0);let s="",r=0;if(45===n){const n=t.charCodeAt(1);if(n>47&&n<58?(s+=`-\\${n.toString(16)} `,r=2):(s="-",r=1),1===e)return"\\-"}else n>47&&n<58&&(s+=`\\${n.toString(16)} `,r=1);for(;r<e;++r){const e=t.charCodeAt(r);s+=e>96&&e<123||45===e||95===e||e>47&&e<58||e>64&&e<91?t[r]:e>126?127===e?`\\${e.toString(16)} `:t[r]:e<32?e?`\\${e.toString(16)} `:"\ufffd":`\\${t[r]}`}return s}function Jr(t){let e="";const n=t.length;for(let s=0;s<n;++s){const n=t.charCodeAt(s);e+=n<32||127===n?n?`\\${n.toString(16)} `:"\ufffd":34===n||92===n?`\\${t[s]}`:t[s]}return e}const Qr=/[A-Z]+/g;function Zr(t,e,n){const s=t.toLowerCase();return s.length>1&&e+s.length<n.length?`-${s.slice(0,-1)}-${s.slice(-1)}`:"-"+s}const Xr=new Map;function Yr(t){return t.replace(Qr,Zr)}function ti(t){const e=Yr(t);return e.startsWith("-")?e.substr(1):e}const ei=new he("bootstrap-context");class ni extends Yt{static get[Qt](){return ei}}function si(t){return(e,n)=>{const s=e.get(ni);return e===s?t(s,n):s.get(n)}}class ri{constructor(t){this.symbol=t}own(t,e){return F(t,this.symbol)?Reflect.get(t,this.symbol,e):void 0}of(t,e=t){const n=this.own(t,e),s=A(t),r=s&&this.of(s,e);return n?r?this.merge([r,n]):n:r}define(t,e){const n=this.own(t),s=this.merge(n?[n,...e]:e);return Reflect.defineProperty(t,this.symbol,{configurable:!0,value:s}),t}}function ii(t,e,n,s){const r=e&&e.bind(t),i=s&&s.bind(n);return i?r?async(...t)=>{await r(...t),await i(...t)}:i:r}const oi=Symbol("FeatureDef");class ui extends ri{constructor(){super(oi)}merge(t){return t.reduce(((t,e)=>({needs:x(k(S(t.needs),e.needs)),has:x(k(S(t.has),e.has)),setup:ii(t,t.setup,e,e.setup),init:ii(t,t.init,e,e.init)})),{})}}const ci=new ui,ai={of:t=>ci.of(Re(t))||{},merge:(...t)=>ci.merge(t),define:(t,...e)=>ci.define(t,e)};function hi(...t){const e=function(t){const e=[],n=[];for(const r of t)li(r)?n.push(r):e.push(r);e.length&&n.push((s=e,({amend:t})=>t({featureDef:ai.merge(...s)})));var s;return Se(n)}(t);return Oe((t=>{let n={};e(ke({base:c(u({},t),{featureDef:{}}),amend(e,s={}){const r=s,{featureDef:i={}}=r,o=a(r,["featureDef"]),h=t.amend(o),l=n=ai.merge(n,i);return()=>c(u({},h()),{featureDef:l})}})),ai.define(t.amendedClass,n)}))}function li(t){return"function"==typeof t||ve(t)}const di=new he("feature-context");class fi extends ni{static get[Qt](){return di}whenDefined(t){return this.get(ni).whenDefined(t)}load(t,e){return this.get(ni).load(t,e?(new zt).needs(this).needs(e):this)}}const pi=new he("bootstrap-workbench",{byDefault:si((()=>new Gr))}),yi=new Lr("feature setup"),gi=new Lr("feature init",{after:yi}),_i=new Lr("component definition",{after:gi}),mi=Symbol("ComponentDef");class wi extends ri{constructor(){super(mi)}merge(t){return t.reduce(((t,e)=>{const n=this.meta(e);return c(u(u({},t),n),{setup:$(t.setup,n.setup),define:$(t.define,n.define),feature:t.feature?n.feature?ai.merge(t.feature,n.feature):t.feature:n.feature})}),{})}meta(t){return Ge(t)?{name:t}:t}}const bi=new wi,vi={of:t=>bi.of(Re(t))||{},merge:(...t)=>bi.merge(t),define:(t,...e)=>bi.define(t,e)};function xi(...t){const e=function(t){const e=[],n=[];for(const r of t)Si(r)?n.push(r):e.push(r);e.length&&n.push((s=e,({amend:t})=>t({componentDef:vi.merge(...s)})));var s;return Se(n)}(t);return hi((t=>{let n={};e(ke({base:c(u({},t),{componentDef:{}}),amend(e,s={}){const r=s,{componentDef:i={}}=r,o=a(r,["componentDef"]),h=t.amend(o),l=n=vi.merge(n,i);return()=>c(u({},h()),{componentDef:l})}})),vi.define(t.amendedClass,n)}))}function Si(t){return"function"==typeof t||ve(t)}const ki=new he("component-context"),Ai=new he("component-event-dispatcher",{byDefault(t){const e=t.get(ki),n=new xs(e.element);return n.supply.needs(e),{dispatch:t=>n.dispatch(t),on:t=>n.on(t)}}}),Ci=new he("content-root",{byDefault:t=>t.get(ki).element});class Oi extends Rs{constructor(){super("state-updater"),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(Un(((...e)=>{if(e.length){const t=e.reduce(((t,e)=>$(e,t)),R);return $n(((e,n,s)=>t(hs(e),n,s)))}return t.hasFallback&&t.or?t.or:$n(R)}))))))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?$n(t.or):t.or}:void 0)((t=>e=t)).whenOff((()=>e=R)),t.insert(((t,n,s)=>e(t,n,s)))}}const $i=new Oi,Ri=Symbol("ComponentContext");class Di extends Yt{constructor(){super(),this.updateState=(t,e,n)=>{this.get($i)(t,e,n)}}static get[Qt](){return ki}static of(t){if("function"!=typeof t[Ri])throw new TypeError(`No component context found in ${String(t)}`);return t[Ri]()}get contentRoot(){return this.get(Ci)}on(t){return this.get(Ai).on(t)}dispatchEvent(t){this.get(Ai).dispatch(t)}}function Fi(...t){return function(...t){return Pe(Be,Ke,t)}(xi(Se(t)))}const Ei={get:R,unbind:R,rebind:R,drop:R};class Ti{constructor(){this._provider=_s(Ei),this.read=this._provider.read.do(Zn((t=>t.get()))),this.whenReady=this.read.do(Hn((t=>t&&t.whenReady)),ns)}get context(){return this._provider.it.get()}[Ze](){return this.read}bind(t){this._provider.it.drop(),this._provider.it=function(t,e){e.supply.whenOff((()=>{t.context===e&&t.unbind()}));const n=()=>e;return{get:n,unbind(){t._provider.it=Ei},rebind:n,drop:R}}(this,t)}bindBy(t){this._provider.it.drop(),this._provider.it=function(t,e){let n=Ht(),s=R;const r=()=>s(),i=()=>n=new zt((()=>{s=R}));let o=e=>(s=p(e),e.supply.whenOff((()=>{t.context===e&&t.unbind()})),i());const u=()=>{o=t=>Ht(),n.off()},c=()=>{n.off(),t._provider.it={get:r,unbind:c,rebind:h,drop:u}},a=()=>e({bind:t=>o(t)});s=()=>(a(),o=e=>(n.off(),s=p(e),t._provider.it={get:r,unbind:c,rebind:h,drop:u},i()),s());const h=()=>(a(),s());return{get:r,unbind:c,rebind:h,drop:u}}(this,t)}unbind(){this._provider.it.unbind()}rebind(){return this.context||this._provider.it.rebind()}}const Pi=Symbol("ComponentSlot"),Mi={of(t){const e=t[Pi];return e||(t[Pi]=new Ti)}},Bi=new he("bootstrap-context-registry");class Ki extends me{constructor(){super(),this.provide({a:Ki,is:this}),this.values=this.newValues()}static get[Qt](){return Bi}static create(){return new Ki}}const Ni=new he("per-component-registry",{byDefault:si((()=>new ji))});class ji extends me{}const Ui=new he("per-definition-registry",{byDefault:si((t=>new zi(t)))});class zi extends me{}const Li=Symbol("PostDefSetup");function qi(t){if(F(t,Li))return t[Li];const e=_s(),n=new Ln,s=Vn(e.read.do(cs(C)),n),r=A(t,(t=>mi in t));if(r){const t=qi(r);s((e=>t.send(e)))}const i={on:s,send(t){n.send(t)},setup(t){e.it=t}};return Reflect.defineProperty(t,Li,{value:i}),i}const Ii=new he("window",{byDefault:()=>window}),Vi=new he("default-namespace-aliaser");class Wi extends Rs{constructor(t,e){super(t),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(Un(((...n)=>n.length?$n(Gi(t.context,n[n.length-1])):t.hasFallback&&t.or?t.or:$n(Gi(t.context,e))))))))}grow(t){const{context:e}=t,n=e.get(ni);if(e!==n)return t.insert(n.get(this,t.hasFallback?t:void 0));let s;e.get(this.upKey,t.hasFallback?{or:null!=t.or?$n(t.or):t.or}:void 0)((t=>s=Gi(e,t))),t.insert(((...t)=>s(...t)))}}function Gi(t,e){return(n={})=>e(c(u({},n),{window:n.window||t.get(Ii)}))}const Hi=new Wi("default-pre-render-scheduler",ur),Ji=new Wi("default-render-scheduler",dr),Qi=new he("document-render-kit",{byDefault:si((function(t){const e=new WeakMap;return{contextOf(n){var s;return s=Vs(n),e.get(s)||(e.set(s,1),Cr(s).update({nsAlias:t.get(Vi),scheduler:t.get(Ji)})),Cr(n)}}}))});const Zi=Symbol("DefinitionContext");function Xi(t){if(!F(t,Zi))throw new TypeError(`Component is not defined: ${t}`);return t[Zi]}const Yi=new he("custom-elements",{byDefault:si((function(t){const e=t.get(Ii).customElements,n=t.get(Vi);return new class extends to{define(t,s){if(Ge(t))return void e.define(ze.name(t,n),s);const r=Xi(t),{tagName:i,extend:o}=r.elementDef;i?o&&o.name?e.define(i,s,{extends:o.name}):e.define(i,s):no(t).resolve(void 0)}whenDefined(t){if(Ge(t))return e.whenDefined(ze.name(t,n));const s=Xi(t),{name:r}=s.elementDef;return r?e.whenDefined(ze.name(r,n)):no(t).promise()}}}))});class to{static get[Qt](){return Yi}}const eo=Symbol("ComponentResolver");function no(t){return F(t,eo)?t[eo]:t[eo]=function(){let t,e,n=g((()=>new Promise(((n,s)=>{t=n,e=s}))));const s=s=>{n=g(s),t=R,e=R};return t=t=>{s((()=>Promise.resolve(t)))},e=t=>{s((()=>Promise.reject(t)))},{resolve(e){t(e)},reject(t){e(t)},promise:()=>n()}}()}const so=new he("definition-context");class ro extends Yt{static get[Qt](){return so}}const io=new he("element-naming",{byDefault:si((function(t){const e=t.get(Ii),n=t.get(Vi);return{elementOf(t){const{name:s,extend:r}=vi.of(t);let i;const o={get type(){return r&&r.type||e.HTMLElement},get name(){return r&&r.name}};return{get name(){return s},get tagName(){return i||s&&(i=ze.name(s,n))},get extend(){return o}}}}}))});const oo=Symbol("newComponent");function uo(t){const e=t.componentType;return e[oo]||(e[oo]=function(t){const e=Symbol("ComponentContext");let n;return t.prototype[Ri]=function(){return this[e]||(this[e]=n)},function(t){const s=n;n=t;try{const r=new this(t);return r[e]=t,r}finally{n=s}}}(e)),e[oo](t)}class co{constructor(t){this._ctx=t,this._val=_s(0),this._canSettle=0}get supply(){return this._val.supply}read(){return(this.read=p(this._val.read.do(Xn(p(this._ctx)))))()}isReady(){return!!this._val.it&&!this._val.supply.isOff}onceReady(){return(this.onceReady=p(this.read().do(ao((({ready:t})=>t)))))()}whenReady(){return(this.whenReady=p(this.onceReady().do(ns)))()}isSettled(){return this._val.it>=2&&!this._val.supply.isOff}onceSettled(){return(this.onceSettled=p(this.read().do(ao((({settled:t})=>t)))))()}whenSettled(){return(this.whenSettled=p(this.onceSettled().do(ns)))()}isConnected(){return this._val.it>=3&&!this._val.supply.isOff}onceConnected(){return(this.onceConnected=p(this.read().do((t=({connected:t})=>t,Qn(((e,...n)=>t(...n)&&e(...n)))))))();var t}whenConnected(){return(this.whenConnected=p(this.onceConnected().do(ns)))()}ready(){this._val.it=1}settle(){this._canSettle&&this._val.it<2&&(this._val.it=2)}connect(){this._val.it=3}create(){this._canSettle=1}}function ao(t){return e=>bn((n=>{let s=!1;e({supply:n.supply,receive(e,r){const i=t(r);i&&!s&&(s=i,n.receive(e,r))}})}))}class ho extends Di{constructor(t,e){super(),this._definitionContext=t,this.element=e;const n=t._newComponentRegistry();n.provide({a:Di,is:this}),this.get=n.newValues().get,this._status=new co(this),this.supply.whenOff((()=>{delete this.component[Ri],this._component=fo}))}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get supply(){return this._status.supply}get ready(){return this._status.isReady()}get onceReady(){return this._status.onceReady()}get whenReady(){return this._status.whenReady()}get settled(){return this._status.isSettled()}get onceSettled(){return this._status.onceSettled()}get whenSettled(){return this._status.whenSettled()}get connected(){return this._status.isConnected()}get onceConnected(){return this._status.onceConnected()}get whenConnected(){return this._status.whenConnected()}get readStatus(){return this._status.read()}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){this._status.settle()}_createComponent(){const t=this._definitionContext._whenComponent;let e=0;t.readNotifier.do(ns)((t=>e=t(this,e))),this.whenConnected((()=>{t.readNotifier({supply:(new zt).needs(this),receive:(t,n)=>{e=n(this,e)}})})),this._definitionContext._elementBuilder.components.send(this);const n=uo(this);return this._component=p(n),this._status.ready(),this}_connect(){this._status.connect()}_created(){this._status.create()}}class lo extends ho{get mounted(){return!0}}function fo(){throw new TypeError("Component destroyed already")}class po extends ho{get mounted(){return!1}}class yo{constructor(){const t=_s(0),e=new Ln;this.onCreated=bn((n=>{const s=t.it+1;e.on({supply:n.supply,receive:(t,e,r)=>{r<s&&n.receive({onRecurrent(e){t.onRecurrent((t=>e(t)))}},e)}}),++t.it})),this.readNotifier=t.read.do(Xn((t=>(n,s)=>(e.send(n,s),t))))}}class go extends ro{constructor(t,e,n){var s,r;super(),this._bsContext=t,this._elementBuilder=e,this.componentType=n,this._whenComponent=new yo,this._ready=_s(!1),this._whenReady=this._ready.read.do(Jn(((t,e)=>e&&t()))),this._def=vi.of(n),this.elementDef=t.get(io).elementOf(n);const i=new zi(t.get(Ui).seeds());i.provide({a:ro,is:this}),this.get=i.newValues().get;const o=t.get(Ni).append((t=>this.get(t)));this._perComponentRegistry=new ji(o.seeds()),this.whenReady=this._whenReady.do(ts(p(this)),ns);const u={get componentType(){return n},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:t=>i.provide(t),perComponent:t=>this._perComponentRegistry.provide(t)};null===(r=(s=this._def).setup)||void 0===r||r.call(s,u),qi(n).setup(u)}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(t){const e=new lo(this,t);Mi.of(t).bind(e),e._createComponent();const n=e.get(Qi).contextOf(t);return n.whenSettled((t=>e.settle())).needs(e),n.whenConnected((t=>e._connect())).needs(e),e._created(),e}perComponent(t){return this._perComponentRegistry.provide(t)}_newComponentRegistry(){return new ji(this._perComponentRegistry.seeds())}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var t,e;null===(e=(t=this._def).define)||void 0===e||e.call(t,this),this._elementBuilder.definitions.send(this),this._elementType=p(function(t){const{elementDef:e}=t,n=t.get(Qi);class s extends e.extend.type{constructor(){super();const e=Mi.of(this);let s=R;e.bindBy((({bind:e})=>{const r=new po(t,this),i=e(r);r._createComponent(),r._created(),r.supply.needs(i).whenOff((()=>{n.contextOf(this).whenSettled((t=>s()))}))})),n.contextOf(this).whenSettled((t=>s())),s=()=>e.rebind().settle()}connectedCallback(){var t;null===(t=super.connectedCallback)||void 0===t||t.call(this),Mi.of(this).rebind()._connect()}disconnectedCallback(){var t;Mi.of(this).context.supply.off(),null===(t=super.disconnectedCallback)||void 0===t||t.call(this)}}return s}(this)),this.componentType[Zi]=this,this._ready.it=!0}}const _o=new he("element-builder",{byDefault:si((function(t){return{definitions:new Ln,components:new Ln,buildElement(e){const n=new go(t,this,e);return n._define(),n}}}))});class mo{constructor(t){this._setup=t,this._components=void 0}define(t){this._components?this._components.push(t):(this._components=[t],this._defineAll(this._components))}_defineAll(t){const e=this._setup.get(pi).work(_i).run((()=>{const e=this._setup.get(to),n=this._setup.get(_o);t.forEach((t=>{const s=n.buildElement(t);e.define(t,s.elementType)})),this._components=void 0}));this._setup.initBy(p(e))}}class wo extends fi{constructor(t,e){super(),this.feature=t,this._setup=e,this._bsContext=e.get(ni);const n=e.get(e.module),s=new me(this._bsContext);s.provide({a:fi,is:this}),this.get=s.newValues().get,this.whenReady=n.read.do(as((({ready:t})=>t&&this)),ns),this._componentRegistry=new mo(this._setup)}get supply(){return this._setup.supply}get onDefinition(){return this._onDefinition||(this._onDefinition=this._setup.get(_o).definitions.on.do(ss(this)))}get onComponent(){return this._onComponent||(this._onComponent=this._setup.get(_o).components.on.do(ss(this)))}provide(t){return this._bsContext.get(Ki).provide(t).needs(this)}perDefinition(t){return this._bsContext.get(Ui).provide(t).needs(this)}perComponent(t){return this._bsContext.get(Ni).provide(t).needs(this)}setupDefinition(t){return function(t,e){const{on:n}=qi(t);return bn((t=>{n({supply:t.supply.needs(e),receive(n,s){const r=s.whenReady.do(ss(e)),i=s.whenComponent.do(ss(e));t.receive(n,{get componentType(){return s.componentType},get whenReady(){return r},get whenComponent(){return i},perDefinition:t=>s.perDefinition(t).needs(e),perComponent:t=>s.perComponent(t).needs(e)})}})}))}(t,this.supply)}define(t){this._componentRegistry.define(t)}}const bo=Symbol("FeatureModule");class vo extends Is{constructor(t){super(t.name,function(t){const e=function(t){let e=ai.of(t);if(mi in t){e=ai.merge(e,{init(e){e.define(t)}});const{feature:n}=vi.of(t);n&&(e=ai.merge(e,n))}return e}(t),n=[],s=[];for(const r of S(e.has))n.push(vo.of(r));for(const r of S(e.needs))s.push(vo.of(r));return{needs:s,has:n,async setup(n){var s;const r=n.get(pi),i=new wo(t,n);if(e.init){const t=r.work(gi).run((async()=>{await e.init(i)}));n.initBy(p(t))}await(null===(s=e.setup)||void 0===s?void 0:s.call(e,i))}}}(t)),this.feature=t}static of(t){return F(t,bo)?t[bo]:t[bo]=new vo(t)}async setup(t){const e=t.get(pi);await e.work(yi).run((()=>super.setup(t)))}}const xo=Symbol("WhenDefined");function So(...t){const e=Ki.create(),{bootstrapContext:n,complete:s}=function(t){const e=_s(0),n=t.values;class s extends ni{constructor(){super(),this.get=n.get,this.whenReady=e.read.do(cs((t=>!!t&&this)),ns),t.provide({a:Vi,by:Qe}),t.provide({a:ni,is:this})}whenDefined(t){return function(t,e){if(F(e,xo))return e[xo];const n=Wn(Promise.resolve(t.whenReady).then((()=>t.get(to).whenDefined(e))).then((()=>Xi(e))));return e[xo]=n}(this,t)}load(e,n){const s=vo.of(e),r=t.provide(s);n?r.needs(n):n=r;const i=function(t,e){const n=_s({feature:t,ready:!1});return e.read((({module:t,ready:e})=>{const s=t.feature,r=n.it;r&&r.feature===s&&r.ready===e||(n.it={feature:s,ready:e})})).needs(e),n.supply.needs(e),n.read}(e,this.get(s).use(n));return{read:i,whenReady:i.do(as((t=>t.ready&&t)),ns),[Ze]:p(i),supply:r}}}return{bootstrapContext:new s,complete(){e.it=1}}}(e),r=1===t.length?t[0]:(i=t,ai.define(class{},{needs:i}));var i;return n.load(r).read.do(as((({ready:t})=>t)),ns).then(s).catch(console.error),n}const ko=Symbol("attribute");function Ao(t){return[ko,t]}function Co(t,e=!0){if(!1===e)return R;if(!0===e||"function"==typeof e){const n=Ao(t),s=!0===e?Oo:e;return(t,e,r)=>s(t,n,e,r)}return(t,n,s)=>Oo(t,e,n,s)}function Oo(t,e,n,s){Di.of(t).updateState(e,n,s)}const $o=new he("attribute-registry",{byDefault:t=>new Ro(t.get(ro))});class Ro{constructor(t){this._context=t,this.attrs=new Map,t.whenReady((({elementType:t})=>this.define(t))),t.whenComponent((t=>{t.mounted&&this.mount(t)}))}declareAttribute({name:t,change:e}){this.attrs.set(t,$(this.attrs.get(t),e))}define(t){const{attrs:e}=this;e.size&&(Reflect.defineProperty(t,"observedAttributes",{configurable:!0,enumerable:!0,value:Do(t,[...e.keys()])}),Reflect.defineProperty(t.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:Fo(t,e)}))}mount(t){const{element:e}=t,{attrs:n}=this,s=[...n.keys()];if(!s.length)return;new(0,this._context.get(Ii).MutationObserver)((s=>s.forEach((s=>{const r=s.attributeName;return n.get(r)(t.component,e.getAttribute(r),s.oldValue)})))).observe(e,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}function Do(t,e){const n=t.observedAttributes;if(Array.isArray(n)){const t=new Set(n);e.forEach((e=>t.add(e))),e=[...t]}return e}function Fo(t,e){const n=t.prototype.attributeChangedCallback;return n?function(t,s,r){const i=e.get(t);i?Mi.of(this).whenReady((({component:t})=>i(t,r,s))):n.call(this,t,s,r)}:function(t,n,s){Mi.of(this).whenReady((({component:r})=>{e.get(t)(r,s,n)}))}}function Eo(t){return Fi((({amendedClass:e,key:n,set:s,amend:r})=>{const{name:i,change:o}=function(t,e,n){let s,r;if("string"==typeof n)s=ti(n),r=Co(s);else{if(n&&n.name)s=ti(n.name);else{if("string"!=typeof e)throw new TypeError(`Attribute name is required as property key is not a string: ${t.constructor.name}.prototype.${String(e)}`);s=ti(e)}r=Co(s,n&&n.updateState)}return{name:s,change:r}}(e.prototype,n,t);r({componentDef:{define(t){t.get($o).declareAttribute({name:i,change(t,e,n){s(t,e),o(t,e,n)}})}},get:t=>Di.of(t).element.getAttribute(i),set(t,e){const{element:n}=Di.of(t);null!=e?n.setAttribute(i,e):n.removeAttribute(i),s(t,e)}})}))}class To extends ae{constructor(){super("component-state")}grow(t){const e=t.seed();let n;if(null!=e)n=e,t.insert(n);else{if(t.hasFallback)return;n=new Mo,t.context.get(Di).supply.whenOff((t=>n.done(t))),t.insert(n)}t.setup((({registry:t})=>{t.provide({a:$i,is:n.update})}))}}const Po=new To;class Mo extends ps{static get[Qt](){return Po}}class Bo extends ys{constructor(t,e,n){super(),this._context=t,this._name=e,this.supply=new zt,this.on=this._context.get(Mo).track(n).onUpdate.do(Jn(((t,e,n,s)=>t(n,s))),ss(this))}get it(){return this._context.element.getAttribute(this._name)}set it(t){this.supply.isOff||(null==t?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,t))}}function Ko(t,e,n=Ao(e)){return new Bo(t,e,n)}const No=Symbol("render"),jo={trigger(t,e={}){const{on:n=[]}=e;if(("object"==typeof n||"function"==typeof n)&&on(n))return In(n).do(ss(t));const s=t.get(Mo).track(n).onUpdate.do(ss(t));return Array.isArray(n)&&!n.length?s.do(Qn(((t,e)=>e[0]!==No&&t()))):s}};class Uo{constructor(t){this._context=t;const{element:e}=t;this._scheduler=t.get(Qi).contextOf(e).scheduler}renderBy(t,e){return new Lo(this,t,e).render()}preRenderBy(t,e){return new Io(this,t,e).render()}}class zo{constructor(t,e,n={}){this._ctl=t,this._renderer=e,this._status=1,this._spec=w(n,t._context)}render(){const t=this._ctl._context,e=jo.trigger(t,this._spec);let n=t=>{n=this._createSchedule(),n(t)};const s="connected"===this._spec.when,r=s?()=>t.connected&&this._scheduleRenderer(n):()=>t.settled&&this._scheduleRenderer(n);return this._supply=e(r).needs(t).whenOff((()=>this._cancel(n))),(s?t.whenConnected:t.whenSettled)((()=>this._status&&this._scheduleRenderer(n))),this._supply}_scheduleRenderer(t){this._status=2,t((t=>this._render(t)))}_createSchedule(){return this._scheduleBy(this._ctl._scheduler)}_scheduleBy(t){const e=this._ctl._context.element,n=t(c(u({},this._spec),{node:e}));return t=>n((e=>_r((()=>t(e)))))}_render(t){const e=this._createExecution(t);this._status=0;do{const t=this._renderer;if(t(e),this._renderer===t){this._over();break}}while(this._status>=0)}_over(){}_cancel(t){2===this._status&&t(R),this._status=-1}}class Lo extends zo{_createExecution(t){const e=c(u({},t),{postpone(n){t.postpone((()=>n(e)))},supply:this._supply,renderBy:t=>{this._renderer=t}});return e}}const qo={};class Io extends zo{constructor(){super(...arguments),this._nextRenderer=null}render(){return this._preSupply=new zt,super.render().needs(this._preSupply).whenOff((t=>{t===qo?this._preSupply.as(this._ctl.renderBy(this._nextRenderer)):this._preSupply.off(t)})),this._preSupply}_createSchedule(){const t=this._ctl._context.get(Hi);return this._scheduleBy(t)}_over(){this._nextRenderer&&this._supply.off(qo)}_createExecution(t){const e=c(u({},t),{postpone:n=>{t.postpone((()=>{n(e),this._over()}))},supply:this._preSupply,renderBy:t=>{this._renderer=t,this._nextRenderer=t},preRenderBy:t=>{this._renderer=t}});return e}}const Vo=new he("component-render-ctl",{byDefault(t){const e=t.get(Di);return new Uo(e)}});const Wo=new he("component-render-scheduler",{byDefault:function(t){const e=t.get(Vo);return(t={})=>{const n=_s(R);return e.renderBy((t=>{n.it(t)}),c(u({},t),{on:n.on})),t=>{n.it=e=>t(e)}}}}),Go=new he("shadow-content-root"),Ho=new Fs("shadow-root-builder",{byDefault:()=>Jo});function Jo(t,e){return function(t,e){const n=t.shadowRoot;if(n)return n;if("attachShadow"in t)return t.attachShadow(e);return}(t.element,e)}const Qo={mode:"open"};function Zo(t=Qo){return xi({setup(e){e.perComponent({a:Go,by:e=>e.get(Ho)(e,t)}),e.perComponent({a:Ci,by:t=>t.get(Go,{or:null})})}})}const Xo=new We("https://wesib.github.io/ns","b","wesib");class Yo extends Rs{constructor(t){super(t),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(Un(((...e)=>e.length?$n(function(t){return(e,n)=>{const s=(n,r)=>{const i=t[n];return i?In(i(((t=r)=>s(n+1,t)),r)):e(r)};return s(0,n)}}(e)):t.hasFallback&&t.or?t.or:$n(tu)))))))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?$n(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=Ss(t))),t.insert(((t,n)=>e(t,n)))}}function tu(t,e){return t(e)}const eu=new Yo("http-fetch-agent"),nu={};const su=new Fs("http-fetch",{byDefault:si((function(t){const e=t.get(Ii),n=t.get(eu);return(t,e)=>n(s,new Request(t,e));function s(t){return bn((n=>{const s=new Ln;let r;if("AbortController"in e){const i=new e.AbortController,{signal:o}=i;r=new zt((t=>{t===nu&&i.abort()})),n.supply.whenOff((()=>r.off(nu))).needs(r),s.on({supply:r,receive(t,e){n.receive(t,e)}});const u=t.signal;u&&(new xs(u).on("abort").do(ns)((()=>i.abort())),u.aborted&&i.abort()),t=new Request(t,{signal:o})}else r=s.on(n);e.fetch(t).then((t=>{s.send(t),r.off()})).catch((t=>r.off(t)))}))}}))}),ru=new he("fragment-render-ctl",{byDefault:t=>new ou(t.get(Di))}),iu={};class ou{constructor(t){this._context=t}renderFragmentBy(t,e={}){const n=w(e,this._context),s=!1===n.settle?au:cu,{target:r=uu}=n,i=g((()=>r(this._context))),o=this._context.get(Vo),a=this._context.get(Hi),h=new zt,l=o.preRenderBy((e=>{const n=new Fr(i(),{scheduler:a});let r=!1;const o=c(u({},e),{supply:h,fragment:n,content:n.content,postpone(t){e.postpone((()=>t(o)))},renderBy(t){e.renderBy((e=>{e.renderBy(t)}))},retainContent(t=!0){r=t},done(){e.renderBy((({supply:t})=>{l.as(t).off(iu)}))}});t(o),((t,e)=>{e||s(t)})(n,r)}),n).needs(h).whenOff((t=>{t!==iu&&h.off(t)}));return h}}function uu({contentRoot:t}){return Tr(Er(t))}function cu(t){const{innerContext:e}=t,{window:n}=e;e.scheduler()((()=>{n.customElements.upgrade(t.content)})),t.settle(),t.render()}function au(t){t.render()}function hu(t){return Fi((({key:e,get:n,amend:s})=>s({componentDef:{define(s){s.whenComponent((s=>{s.whenReady((()=>{const{component:r}=s,i=n(r).bind(r);s.get(ru).renderFragmentBy(i,function(t,e,n={}){const s=w(n,t),{target:r=(({contentRoot:t})=>Tr(Er(t),lu(e)))}=s;return c(u({},s),{target:r})}(s,e,t))}))}))}}})))}function lu(t){const e=String(t);return e.startsWith("render")?e.substr(6):e}const du=Symbol("Share");function fu(t){return!(!t||"object"!=typeof t&&"function"!=typeof t||!t[du])}const pu=new he("share-registry",{byDefault:si((t=>new yu(t.get(Vi))))});class yu{constructor(t){this.nsAlias=t,this._sharers=new Map}static get[Qt](){return pu}addSharer(t,e,n,s){let r=this._sharers.get(t);r?(mu(r,e,s),_u(r,n,s),r.it=u({},r.it)):(r=gu(),this._sharers.set(t,r),mu(r,e,s),_u(r,n,s))}sharers(t){let e=this._sharers.get(t);return e||(e=gu(),this._sharers.set(t,e)),e}}function gu(){return _s({names:new Map,sharers:new Map})}function _u(t,e,n){if(!e)return;const s=t.it,r=s.names.get(e)||0;s.names.set(e,r+1),n.whenOff((()=>{const n=s.names.get(e)-1;n>0?s.names.set(e,n):s.names.delete(e),t.it=u({},s)}))}function mu(t,e,n){const s=t.it,r=s.sharers.get(e)||0;s.sharers.set(e,r+1),n.whenOff((()=>{const n=s.sharers.get(e)-1;n>0?s.sharers.set(e,n):s.sharers.delete(e),t.it=u({},s)}))}class wu extends Rs{constructor(t,e){super(`${t}:share`),this._share=e}get upKey(){return this}grow(t){t.insert(t.seed.do(Un(((...t)=>this._share.selectValue(...t)))))}}const bu=Symbol("Share.impl");class vu{constructor(t,e,n){this._share=t,this.name=e,this.key=new wu(e,t),this._aliases=d(n.as).map((t=>t[du]))}addSharer(t,e={}){const{local:n,name:s=t.elementDef.name}=e,r=t.get(ni).get(yu),i=new zt,{componentType:o}=t,u=n?void 0:s&&ze.name(s,r.nsAlias).toLowerCase();r.addSharer(this._share,o,u,i);for(const c of this._aliases)r.addSharer(c,o,u,i);return i}shareValue(t){t.shareAs(this._share);const e=t.priority+1;this._aliases.forEach(((n,s)=>{n.shareValue(t.withPriority(e+s))}))}}const xu=Symbol("SharedValue"),Su={hasDetails:t=>!!t&&"object"==typeof t&&"object"==typeof t[xu]};function ku(t,e){return Au(t,function(t){const e=t.priority?Math.max(0,t.priority):0,{supply:n=new zt}=t;return{priority:e,supply:n,provide:e=>{const n=t.provide(e);return Sn(n)?n.do(Ds(e)):function(t){return ee(t)?e=>t[te](e):p(t)}(n)(e)}}}(e))}function Au(t,e){const{priority:n,supply:s,provide:r}=e;return{priority:n,supply:s,shareAs:(e,i=n)=>{i=Math.max(0,i),t.provide({a:e[du],by:i?Ou(r,i):Cu(r)}).as(s)},withPriority:n=>Au(t,c(u({},e),{priority:Math.max(0,n)}))}}function Cu(t){return e=>{const n=t(e);return Sn(n)?n.do(os(((t,e)=>void 0!==e?t(e):t()))):n}}function Ou(t,e){return n=>({[xu]:{priority:e,get:()=>t(n)}})}class $u{constructor(t,e={}){this[bu]=new vu(this,t,e)}get[du](){return this}get name(){return this[bu].name}get[Qt](){return this[bu].key}addSharer(t,e){return this[bu].addSharer(t,e)}shareValue(t){this[bu].shareValue(t)}createRegistrar(t,e){return ku(t,e)}valueFor(t,e={}){const{host:n=Js,local:s}=e;return kn({sharers:t.get(ni).get(yu).sharers(this),status:t.readStatus.do(Bn(((t,e)=>t===e),Ru))}).do(zn((({sharers:[e]})=>{if(s){if(e.sharers.has(t.componentType))return Du(this,t);if(!0===s)return $n()}let r=n(t.element);for(;r;){if(e.names.has(r.tagName.toLowerCase()))return Mi.of(r).read.do(zn((t=>t?Du(this,t):$n())));r=n(r)}return $n()})),Pn())}selectValue(...t){let e;for(let n=t.length-1;n>=0;--n){const s=t[n];if(!Su.hasDetails(s))return $n(s);const r=s[xu];(!e||e.priority>r.priority)&&(e=r)}return e?vn((t=>{const n=e.get();Sn(n)?n(t):cn(t)(n)})).do(Fn):$n()}}function Ru([{settled:t,connected:e}]){return e?2:t?1:0}function Du(t,e){return e.get(t).do(us(((t,n)=>n?t(n,e):t())))}function Fu(t,e={}){if(fu(t)){const n=t[du];return(t,s={})=>{const{host:r=e.host,local:i=e.local}=s;return n.valueFor(t,{host:r,local:i})}}if("function"==typeof t){const{host:n=Js,local:s=!1,share:r}=e;return(e,i={})=>{const{share:o=r,host:u=n,local:c=s}=i;return t(e,{share:o,host:u,local:c})}}const{share:n=e.share,host:s=e.host,local:r=e.local}=t||{},i=n[du];return(t,e={})=>{const{host:n=s,local:o=r}=e;return i.valueFor(t,{host:n,local:o})}}const Eu=Symbol("Shareable.internals");class Tu{constructor(t){this[Eu]=new Pu(this,t)}static provider(t){const e=b(t);return t=>Rn(e(t))}get sharer(){return this[Eu].sharer()}get read(){return this[Eu].get().read}[te](t){return this[Eu].bind(t),this}[Ze](){return this.read}get body(){return this[Eu].get().it}}class Pu{constructor(t,e){this._source=t,this._get=Tu.provider(e)}sharer(){this._notBound()}get(){this._notBound()}bind(t){this.bind=R,this.sharer=p(t),this.get=()=>{const e=ms(this._get(t));return this.get=p(e),e}}_notBound(){throw new TypeError(`${String(this._source)} is not properly shared yet`)}}class Mu{constructor(t,e){this._get=t.get.bind(void 0,e),this._set=t.writable?t.set.bind(void 0,e):R,this._ctx=Di.of(e);const n=this._get();let s=!1;Sn(n)?(s=!0,this.val=ms(n)):this.val=_s(n),this.val.supply.needs(this._ctx),this.val.read((t=>ee(t)&&t[te](this._ctx))),s?this._syncDyn():this._syncVal()}get(){return this._valSupply?this.val.it:this.val.read}set(t){Sn(t)?(this.val.by(t),this._syncDyn()):(this.val.it=t,this._syncVal())}_syncVal(){this._valSupply||(this._valSupply=this.val.read((t=>this._set(t))))}_syncDyn(){this._valSupply&&(this._valSupply.off(),this._valSupply=void 0,this._set(this.val.read))}}function Bu(t,...e){const{share:{[du]:n},local:s=!1}=fu(r=t)?{share:r}:r;var r;return Fi((t=>{const r=Symbol(`${String(t.key)}:shared`);let i=t;const o=t=>t[r]||(t[r]=new Mu(i,t)),h=t=>o(t).val.read;Se([...e,t=>{i=t,t.amend({get:t=>o(t).get(),set:t.writable?(t,e)=>o(t).set(e):void 0,componentDef:{setup(e){e.perComponent(function(t,e){return{[fe]:n=>{const s=t.createRegistrar(n,e);return t.shareValue(s),s.supply}}}(t.share,{provide:t=>t.onceReady.do(zn((({component:t})=>o(t).val),y()))}))},define(e){t.share.addSharer(e,{local:t.localShare})}}})}])(ke({base:c(u({},t),{share:n,localShare:s,getShared:h}),amend(e,n={}){const s=n,{share:r=e.share,localShare:i=e.localShare,getShared:o}=s,l=a(s,["share","localShare","getShared"]),d=t.amend(l);return()=>c(u({},d()),{share:r,localShare:i,getShared:h})}}))}))}class Ku extends Set{constructor(t){super(),this._added=new Set(t),this._removed=new Set,this._added.forEach((t=>this.add(t)))}add(t){return this.has(t)||(this._added.add(t),this._removed.delete(t),super.add(t)),this}delete(t){return!!super.delete(t)&&(this._added.delete(t),this._removed.add(t),!0)}clear(){this._added.clear(),this.forEach((t=>this._removed.add(t))),super.clear()}delta(t,e=[]){return Nu(this)(t,e),this}redelta(t){return("function"==typeof t?t:Nu(t))([...this._added],[...this._removed]),this}undelta(){return this._added.clear(),this._removed.clear(),this}}function Nu(t){return(e,n)=>{for(const s of n)t.delete(s);for(const s of e)t.add(s)}}const ju={instance:null,convertTo:R};function Uu(){return ju}function zu(t){return{instance:t,convertTo(t){return this}}}function Lu(t,e,n=null){return Iu(t,e,p(null),n)}function qu(t,e,n){return Iu(t,e,n)}function Iu(t,e,n,s,r){return void 0===s&&(s=n(t,r)),{instance:s,convertTo:s=>Iu(s,e,n,void 0,t),attachTo:s=>Iu(s,e,n,t.aspect(e)||n(s))}}const Vu=Symbol("in-aspect"),Wu=new We("https://surol.github.io/input-aspects/ns","inasp","input-aspects"),Gu={applyTo:()=>zu(Qe())},Hu={get[Vu](){return Gu},to:t=>({applyAspect:e=>e===Gu?zu(t):void 0})},Ju={applyTo:()=>zu(dr)},Qu={get[Vu](){return Ju},to:t=>({applyAspect:e=>e===Ju?zu(t):void 0})},Zu={applyTo:t=>({instance:new tc(t),convertTo:R})};class Xu{static get[Vu](){return Zu}[Ze](){return this.read}}class Yu{constructor(t){this.roles=t,this._activate=R,this.active={[Symbol.iterator]:()=>t.keys(),has:e=>t.has(e)}}static create(){const t=new Yu(new Map);return t.add("default",!0),t}modify(){const t=new Yu(this.roles);return t._defaultSupply=this._defaultSupply,t}add(t,e){const n=this.roles.get(t);if(n)return void++n.active;const s=new zt;if(this.roles.set(t,{active:1,supply:s}),e)this._defaultSupply=s.whenOff((()=>{--this.roles.get(t).active||this.roles.delete(t)}));else{const t=this._defaultSupply;this.activateBy((()=>t.off()))}return s}remove(t,e){const n=this.roles.get(t);--n.active||(this.roles.delete(t),this.activateBy((()=>n.supply.off(e))))}activateBy(t){const e=this._activate;this._activate=()=>{e(),t()}}activate(){const t=this._activate;this._activate=R,t()}}class tc extends Xu{constructor(t){super(),this._control=t,this._active=_s(Yu.create()),this._activators=new Map,this._active.on((t=>t.activate())),this._active.supply.needs(t),this.read=this._active.read.do(Xn((({active:t})=>t)))}add(t){const e=this._active.it.modify();return this._add(e,t),this._active.it=e,new zt((e=>{const n=this._active.it.modify();n.remove(t,e),n.roles.size||this._add(n,"default",!0),this._active.it=n}))}when(t,e){let n=this._activators.get(t);n||(n=new Map,this._activators.set(t,n));const s=(new zt).needs(this._control);n.set(s,((t,n,r)=>e(t,n,r).supply.needs(s))),s.whenOff((()=>{n.delete(s),n.size||this._activators.delete(t)}));const r=this._active.it.roles.get(t);return r&&r.supply.cuts(e(this._control,t,this._active.it.active)),s}_add(t,e,n=!1){const s=t.add(e,n);if(s){const t=this._activators.get(e);if(t)for(const n of t.values())s.cuts(n(this._control,e,this._active.it.active))}}}function ec(t){return Vu in t}const nc={applyAspect(t){}};function sc(){return nc}function rc(t,...e){if(!t)return sc;const n=uc(t);if(!e.length)return n;const s=e.map(uc);return(t,e)=>{const r=n(t,e),i=at(dt([r],yt(s.map((n=>n(t,e))),E)),((t,e)=>e.applyAspect?n=>t(n)||e.applyAspect(n):t),R);return oc(r)?{applyAspect:i}:{set:r.set.bind(r),get:r.get.bind(r),applyAspect:i}}}function ic(t){return t?rc(...d(t)):rc()}function oc(t){return!t.set}function uc(t){return"function"==typeof t?t:p(t)}const cc=Symbol("InBuilder.impl");class ac{constructor(){this._aspectsByKey=new Map,this._commonAspects=void 0,this._setup=void 0}addAspect(t,e){const n=this._aspectsByKey.get(t);this._aspectsByKey.set(t,n?rc(n,e):rc(e))}addAspects(t){this._commonAspects=this._commonAspects?rc(this._commonAspects,...t):rc(...t)}setup(t){const e=this._setup;this._setup=e?n=>{e(n),t(n)}:t}build(t){const e=t({aspects:this._aspects()});return this._setup&&e.setup(this._setup),e}_aspects(){if(this._aspectsByKey.size){const t=function(t){return(e,n)=>({applyAspect(s){const r=t.get(s);return r&&r(e,n).applyAspect(s)}})}(this._aspectsByKey);return this._commonAspects?rc(t,this._commonAspects):t}return this._commonAspects}}var hc;class lc{constructor(){this[hc]=new ac}addAspect(t,e){return this[cc].addAspect(t[Vu],e),this}addAspects(...t){return t.length&&this[cc].addAspects(t),this}setup(t,e){return ec(t)?this[cc].setup((n=>n.setup(t,e))):this[cc].setup(t),this}build(t){return this[cc].build(t)}}hc=cc;const dc=Symbol("InControl.aspects");class fc{constructor(t,e){this.control=t,this.aspects=e,this._byKey=new Map}aspect(t){const e=this._byKey.get(t);if(e)return e;const n=this.control._applyAspect(t)||t.applyTo(this.control);return this._byKey.set(t,n),n}}class pc extends ys{constructor({aspects:t}={}){super();const e=d(t);this[dc]=new fc(this,e.length?ic(e)(new yc(this),this):nc)}aspect(t){return this[dc].aspect(t[Vu]).instance}setup(t,e){return ec(t)?e(this.aspect(t),this):t(this),this}convert(t,...e){return new gc(this,rc(t,...e))}_applyAspect(t){return this[dc].aspects.applyAspect(t)}}class yc extends pc{constructor(t){super(),this._control=t}get supply(){return this._supply||(this._supply=new zt(R).needs(this._control))}get it(){return this._control.it}set it(t){this._control.it=t}get on(){return this._control.on}}class gc extends pc{constructor(t,e){super(),this._on=new Ln,this.supply=(new zt).needs(t);let n,s=0;const r=e(t,this);let i,o,u;oc(r)?(i=C,o=C,u=e=>{const n=t[dc].aspect(e);return n.attachTo?n.attachTo(this):n.convertTo(this)}):(i=r.set,o=r.get,u=e=>t[dc].aspect(e).convertTo(this)),this._applyAspect=t=>{var e;return(null===(e=r.applyAspect)||void 0===e?void 0:e.call(r,t))||u(t)},this._it=_s([i(t.it),0]),this._it.supply.needs(this.supply),this._it.on((([t],[e])=>{t!==e&&this._on.send(t,e)})).cuts(this._on),t.on((t=>{t!==n&&(this._it.it=[i(t),++s])})).cuts(this),this._it.on((([e,r])=>{if(r!==s){s=r,n=o(e);try{t.it=n}finally{n=void 0}}}))}get it(){return this._it.it[0]}set it(t){const[e,n]=this._it.it;t!==e&&(this._it.it=[t,n+1])}get on(){return this._on.on}}const _c={applyTo:t=>Lu(t,mc)};class mc extends pc{static get[Vu](){return _c}_applyAspect(t){return t===_c?Lu(this,mc,this):super._applyAspect(t)}}const wc={applyTo:t=>zu(new vc(t))};class bc{static get[Vu](){return wc}[rn](){return this.on}[Ze](){return this.read}}class vc extends bc{constructor(t){super(),this._control=t,this._map=new Map,this._on=new Ln,this._on.supply.needs(this._control);const e=()=>({[Symbol.iterator]:()=>this._map.keys()});this.read=this.on.do(Zn(e,e))}add(t){const e=this._map.get(t);if(e)return e;const n=new zt((()=>{this._map.delete(t),this._on.send([],[t])}));return this._map.set(t,n),this._on.send([t],[]),n.needs(this._control).needs(t.parent)}get on(){return this._on.on}}const xc={applyTo:t=>Lu(t,Sc)};class Sc extends pc{static get[Vu](){return xc}_applyAspect(t){return t===xc?Lu(this,Sc,this):super._applyAspect(t)}}const kc={applyTo:t=>qu(t,Ac,(t=>new $c(t)))};class Ac{static get[Vu](){return kc}[rn](){return this.on}[Ze](){return this.read}static hasData(t){return"off"!==t&&"-"!==t[0]}done(t){return this.own.supply.off(t),this}}class Cc extends ys{constructor(t){super(),this._tracker=_s(t?function(t){return null!=t.getAttribute("disabled")?"off":null!=t.getAttribute("readonly")?"ro":"on"}(t.element):"on")}get supply(){return this._tracker.supply}get it(){return this._tracker.it}set it(t){switch(t){case"off":case"ro":case"-on":case"-ro":break;default:t="on"}this._tracker.it=t}get on(){return this._tracker.on}}class Oc{constructor(){this._all=new Set,this._on=new Ln;const t=Cn(this._on.on.do(Yn((()=>this._all))),y(this._all));this.read=t.do(zn((t=>An(...t))),Zn(Dc))}add(t){const e=new zt((()=>{this._all.delete(t),this._on.send()}));return this._all.add(t),this._on.send(),e}}class $c extends Ac{constructor(t){super(),this._control=t,this._derived=new Oc;const e=t.aspect(Sc);this.own=new Cc(e),this.own.supply.needs(t),this.derive(t.aspect(bc).read.do(Un(Rc)));let n="on";this.read=kn({derived:this._derived.read,own:this.own}).do(os(((t,{derived:[e],own:[s]})=>{let r;if("off"===s||"off"===e)r="off";else{let t=!1;"-"===s[0]&&(t=!0,s=s.substring(1)),"-"===e[0]&&(t=!0,e=e.substring(1)),r="ro"===e?"ro":s,t&&(r="-"+r)}n!==r&&t(n=r)}),y(n)));let s="on";this.on=this.read.do(Jn(((t,e)=>{const n=s;n!==e&&t(s=e,n)}))),e&&this.read((t=>function(t,e){switch(e){case"off":t.setAttribute("disabled","");break;case"ro":case"-ro":t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly","");break;default:t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly",""),t.removeAttribute("readonly")}}(e.element,t)))}derive(t){return this._derived.add(On(Xe(t)?t:t(this._control)).do(is(this._control))).needs(this._control)}}function Rc(t){const e=tt(t);if(!e.length)return $n("on");return An(...e.map((({parent:t})=>t.aspect(Ac)))).do(Zn(Dc))}function Dc(...t){return Fc(...dt(...t))}function Fc(...t){let e=!1,n=!1;for(const s of t)switch(s){case"off":return"off";case"ro":e=!0;break;case"-on":n=!0;break;case"-ro":n=!0,e=!0}return n?e?"-ro":"-on":e?"ro":"on"}const Ec={applyTo:t=>qu(t,Tc,(t=>kn({value:t,mode:t.aspect(Ac)}).do(Zn((({value:[t],mode:[e]})=>Ac.hasData(e)?t:void 0)))))},Tc={get[Vu](){return Ec}},Pc={applyTo:t=>Lu(t,Mc)};class Mc extends mc{static get[Vu](){return Pc}_applyAspect(t){return t===Pc?Lu(this,Mc,this):super._applyAspect(t)}}const Bc=$n();function Kc(){return Bc}const Nc={};class jc{constructor(t){const e=new Ln,n=new Map,s=new Map;let r=R,i=R;this._messages=vn((t=>{const o=On(e,y())(t).whenOff((()=>{r=R,i=R}));i=(t,e)=>{const n=t(((...e)=>{if(e.length)s.set(t,e);else if(!s.delete(t))return;r()})).needs(e).whenOff((n=>{n!==Nc&&e.off(n),s.delete(t)&&r()}));o.whenOff((()=>n.off(Nc)))},X(n.entries(),(([t,e])=>i(t,e))),r=()=>{e.send(...bt(s.values()))},s.size&&r()})).do(Fn,is(t)),this.from=e=>{const s=function(t){return Xe(t)?p(On(t)):"function"==typeof t?e=>On(t(e)):e=>e.read.do(os((n=>n(...d(t.validate(e))))))}(e)(t),r=new zt((()=>{n.delete(s)}));return n.set(s,r),i(s,r),r.needs(t)}}[Ze](){return this._messages}}const Uc={applyTo:t=>qu(t,zc,((t,e)=>{const n=new Vc(t);return e&&n.by(e.aspect(zc).read.do(os(((t,e)=>t(...e.messages()))))),n}))};class zc{static get[Vu](){return Uc}[Ze](){return this.read}}const Lc={get ok(){return!0},messages:()=>[],has:()=>!1,hasBut:()=>!1,[Symbol.iterator]:()=>ht(),[P]:t=>ht()};class qc{constructor(t){this._byCode=new Map,this._all=[],this._it=Q(this._all),t.forEach((t=>{let e=!1;X($t(t),(([n,s])=>{if(s){e=!0;const s=this._byCode.get(n);s?s.push(t):this._byCode.set(n,[t])}})),e&&this._all.push(t)}))}get ok(){return!this._all.length}messages(t){return null==t?this._all:this._byCode.get(t)||[]}has(t){return null==t||this._byCode.has(t)}hasBut(...t){return this._all.some((e=>t.every((t=>!e[t]))))}[Symbol.iterator](){return this[P]()}[P](t){return this._it[P](t)}}function Ic(...t){return t.length?new qc(t):Lc}class Vc extends zc{constructor(t){super(),this._messages=new jc(t),this.read=On(this._messages).do(Zn(Ic));const e=t.aspect(mc);e&&this._messages.from(function(t){return t.controls.read.do(zn((t=>An(...kt(t,(t=>t.aspect(zc)))))),os(((t,...e)=>t(...mt(e,(([t])=>t))))))}(e))}by(...t){return this._messages.from(function(...t){const e=t.length;return 1===e?t[0]:e?e=>{const n=new jc(e);return t.forEach((t=>n.from(t))),n}:Kc}(...t))}}function Wc(t){return t?t.read.do(os(((t,e)=>e?t():t({missing:"missing"})))):Wc}const Gc={applyTo:t=>qu(t,Qc,(t=>new Zc(t)))};class Hc extends Error{constructor(...t){super(),this.errors=Ic(...t.map((t=>t.submit?t:c(u({},t),{submit:!0}))))}}class Jc extends Hc{constructor(t){super({submit:"rejected",rejected:t,[t]:!0})}}class Qc{static get[Vu](){return Gc}[Ze](){return this.read}}class Zc extends Qc{constructor(t){super(),this._control=t,this._flags=_s({submitted:!1,busy:!1}),this._errors=_s([]),this.read=kn({flags:this._flags,data:this._control.aspect(Tc),messages:this._control.aspect(zc)}).do(is(this._control),Zn((({flags:[t],data:[e],messages:[n]})=>({ready:void 0!==e&&(n.ok||st(n,(t=>t.submit))),submitted:t.submitted,busy:t.busy}))));t.aspect(zc).by(this._errors.read.do(os(((t,e)=>t(...e)))))}async submit(t){if(this._control.supply.isOff)throw new Jc("noInput");if(this._flags.it.busy)throw new Jc("busy");const e=this,n=this._control;let s;this._flags.it=c(u({},this._flags.it),{submitted:!0,busy:!0});try{return this._errors.it.length&&(this._errors.it=[]),await t(await async function(){const{data:[t],flags:[{ready:s}]}=await kn({data:n.aspect(Tc),flags:e});return s?t:Promise.reject(new Jc("notReady"))}(),n)}catch(r){throw s=function(t){if(t instanceof Hc)return[...t.errors];return[{submit:t}]}(r),r}finally{this._flags.it=c(u({},this._flags.it),{busy:!1}),s&&(this._errors.it=s)}}reset(){const t=this._flags.it;t.submitted&&(this._flags.it=c(u({},t),{submitted:!1})),this._errors.it.length&&(this._errors.it=[])}}class Xc extends Sc{constructor(t,{aspects:e,get:n,set:s}){super({aspects:e}),this.element=t,this._input=new Ln;const r=this;this._get=n,this._set=s,this._value=this.it;const i=this._update=(t,e)=>o({value:t},e);function o(t,e){for(;;){let n;r._value=t.value,r._update=(e,s)=>{n=[c(u({},t),{value:e}),s]};try{r._input.send(t,e)}finally{r._update=i}if(!n)break;[t,e]=n}}this.events=new xs(t),this.events.supply.needs(this),this.listenForInput((t=>o(t,this._value))),this.on=this._input.on.do(Jn(((t,{value:e},n)=>e!==n&&t(e,n)))),this.input=this._input.on.do(Zn(C,(()=>({value:this.it}))))}get supply(){return this._input.supply}get it(){return this._get()}set it(t){const e=this.it;t!==e&&(this._set(t),this._update(this._get(),e))}listenForInput(t){const e=e=>t({value:this.it,event:e});this.events.on("input")(e),this.events.on("change")(e)}}function Yc(t,{aspects:e}={}){return new Xc(t,{get(){return this.element.value},set(t){this.element.value=t},aspects:e})}const ta={applyTo:t=>qu(t,ea,(t=>{const e=t.aspect(Sc);return e&&new na(e)}))};class ea extends ys{static get[Vu](){return ta}}class na extends ea{constructor(t){super();const{element:e,events:n}=t,s=e.getRootNode?e.getRootNode():e.ownerDocument;this._it=_s(s.activeElement===e),this.supply.needs(t),n.on("focus")((()=>this._it.it=!0)),n.on("blur")((()=>this._it.it=!1)),this.on({receive(t,n){t.onRecurrent(R),n?e.focus():e.blur()}})}get supply(){return this._it.supply}get it(){return this._it.it}set it(t){this._it.it=t}get on(){return this._it.on}}const sa={applyTo:t=>qu(t,ra,(t=>{const e=t.aspect(mc);return null!=e?new ua(e):new oa(t)}))};class ra{static get[Vu](){return sa}[Ze](){return this.read}}const ia={hasFocus:!1,touched:!1,edited:!1};class oa extends ra{constructor(t){super(),this._flags=_s(ia),this._flags.supply.needs(t),this._flags.by(function(t,e){const n=e.aspect(Sc);return kn({hasFocus:e.aspect(ea)||$n(!1),edited:n?n.input.do(Zn((({event:t})=>!!t))):$n(!1)}).do(Zn((({hasFocus:[e],edited:[n]})=>function(t,e,n){t=c(u({},t),e?{hasFocus:e,touched:!0}:{hasFocus:e});n&&(t=c(u({},t),{edited:n,touched:!0}));return t}(t.it,e,n))))}(this._flags,t))}get read(){return this._flags.read}markTouched(t=!0){const e=this._flags.it;return t?e.touched||(this._flags.it=c(u({},e),{touched:t})):e.touched&&(this._flags.it=c(u({},e),{touched:e.hasFocus,edited:!1})),this}markEdited(t=!0){const e=this._flags.it;return t?e.edited||(this._flags.it=c(u({},e),{touched:!0,edited:t})):e.edited&&(this._flags.it=c(u({},e),{edited:t})),this}}class ua extends ra{constructor(t){var e;super(),this._container=t,this.read=(e=this._container).controls.read.do(is(e),zn((t=>An(...function(t){return kt(t,(t=>t.aspect(ra)))}(t)))),Zn(ca))}markEdited(t){return this._container.controls.read.do(es)((e=>X(e,(e=>e.aspect(ra).markEdited(t))))),this}markTouched(t){return this._container.controls.read.do(es)((e=>X(e,(e=>e.aspect(ra).markTouched(t))))),this}}function ca(...t){const e={hasFocus:!1,touched:!1,edited:!1};return X(t,(([{hasFocus:t,touched:n,edited:s}])=>{n&&(e.touched=!0),t&&(e.hasFocus=e.touched=!0),s&&(e.edited=e.touched=!0)})),e}function aa(t,e){const{form:n,aspects:s,modes:r}=e,i=new Xc(t,{aspects:[ic(s)],get:R,set:R});return i.supply.needs(n),i.setup(Ac,(t=>t.derive(function(t,{notReady:e="on",invalid:n="on",busy:s="ro"}={}){return t.aspect(Qc).read.do(Zn((t=>Fc(t.busy?s:"on",t.ready?"on":t.submitted?n:e))))}(n,r))))}const ha={applyTo(t){const e=t.aspect(Sc);return e?zu(e.element):Uu()}},la={get[Vu](){return ha},to:(t=null)=>({applyAspect:e=>e===ha?zu(t):void 0})},da={applyTo:t=>({instance:new ga(t),convertTo:R})};class fa{static get[Vu](){return da}[Ze](){return this.read}}const pa=Symbol("reason");function ya(t){return t&&"object"==typeof t&&pa in t}class ga extends fa{constructor(t){super(),this._control=t,this._sources=_s([new Map]),t.supply.whenOff((t=>this.done(t))),this.read=this._sources.read.do(is(this._control),zn((([t])=>An(...t.keys()))),Xn(((...t)=>{const e={};return t.forEach((([t])=>_a(t,e))),e}))),this.track=vn((t=>{t.supply.needs(this._control);const e=new Ku,n=new sn;let s=!1;return n.on(t),this.read((t=>{const r=new Set(e),i=[];X(gt($t(t),(([,t])=>!!t)),(([t])=>{r.delete(t)||i.push(t)})),(!s||i.length||r.size)&&(e.delta(i,r),s=!0,e.redelta(((t,e)=>n.send(t,e))).undelta())}))}));const e=t.aspect(la);e&&this.applyTo(e,this.schedule)}get schedule(){return this._schedule||(this._schedule=ma(this._control,this._control.aspect(la)))}specs(t){return On(Xe(t)?t:t(this._control))}resolve(t){const e=this._control.aspect(Hu);return this.specs(t).do(Zn(((...t)=>{const n={};return t.forEach((t=>{Ge(t)?n[Ve.name(t,e)]=!0:_a(t,n)})),n})))}add(t){const e=this._control.supply;if(e.isOff)return e;const n=new zt,s=vn((e=>{const s=this.resolve(t)({receive(t,...n){e.receive(t,...n)}});e.supply.whenOff((t=>{n.off({[pa]:t})})),n.needs(s).whenOff((t=>{ya(t)&&s.off(t[pa])}))})).do(Fn),[r]=this._sources.it;return r.set(s,n),n.whenOff((t=>{ya(t)||(r.delete(s),this._sources.it=[r])})),this._sources.it=[r],n.needs(e)}applyTo(t,e=ma(this._control,t)){const{classList:n}=t,s=new Ku,r=()=>{s.redelta(((t,e)=>{n.remove(...e),n.add(...t)})).undelta()};return this.track(((t,n)=>{s.delta(t,n),e(r)})).whenOff((()=>{s.size&&(s.clear(),e(r))}))}done(t){return X(this._sources.it[0].values(),(e=>e.off(t))),this._sources.supply.off(t),this}}function _a(t,e){X($t(t),(([t,n])=>{null!=n&&(e[t]=n)}))}function ma(t,e){return t.aspect(Qu)({node:e})}function wa({mark:t,when:e}={}){let n;return n=e?Array.isArray(e)?e.length?t=>e.every((e=>t.has(e))):ba:t=>t.has(e):ba,e=>e.aspect(zc).read.do(os(((e,s)=>n(s)?e(...function(t){if(!t)return va;const e=d(t);return e.length?e:va}(t)):e())))}function ba(t){return!t.ok}const va=[["has-error",Wu]];function xa({ns:t=Wu}={}){return e=>{const n=e=>[e,t];return kn({md:e.aspect(Ac),vl:e.aspect(zc),st:e.aspect(ra)}).do(os(((t,{md:[e],vl:[s],st:[{hasFocus:r,touched:i,edited:o}]})=>{const u=[];Ac.hasData(e)||u.push(n("disabled")),"ro"!==e&&"-ro"!==e||u.push(n("readonly")),s.ok||u.push(n("invalid")),s.has("missing")&&u.push(n("missing")),s.has("incomplete")&&u.push(n("incomplete")),r&&u.push(n("has-focus")),i&&u.push(n("touched")),o&&u.push(n("edited")),t(...u)})))}}const Sa={setupField({sharer:t,control:e}){ka(t,e)},setupForm({sharer:t,control:e,element:n}){ka(t,e),ka(t,n)}};function ka(t,e){const n=t.get(Vi),s=t.get(Wo);e.addAspect(Hu,{applyAspect:t=>zu(n)}).addAspect(Qu,{applyAspect:t=>zu(s)})}class Aa extends Rs{constructor(){super("form-preset")}get upKey(){return this}grow(t){t.insert(new $a(t.seed.do(Zn(((...t)=>$a.combine(...t,Sa))),is(t.context.get(de)))))}}const Ca=new Aa,Oa=Symbol("FormPreset.rules");class $a{constructor(t){this.rules=t,t((t=>{this[Oa]=t}))}static get[Qt](){return Ca}static combine(...t){return{setupField:Ra(t),setupForm:Fa(t)}}[Ze](){return this.rules}setupField(t){this[Oa].setupField(t)}setupForm(t){this[Oa].setupForm(t)}}function Ra(t){return t.reduce(((t,e)=>e.setupField?n=>{t(n),e.setupField(n)}:t),Da)}function Da(t){}function Fa(t){return t.reduce(((t,e)=>e.setupForm?n=>{t(n),e.setupForm(n)}:t),Ea)}function Ea(t){}class Ta extends Tu{constructor(t){super(t)}get control(){var t;return null===(t=this.body)||void 0===t?void 0:t.control}[te](t){return super[te](t),this.read(R).needs(t),this}}class Pa extends Ta{static by(t){return new this(this.providerBy(t))}static providerBy(t){return e=>({control:e.control.build(t)})}constructor(t){var e,n;super((e=()=>this,n=b(t),t=>t.get($a).rules.do(zn((s=>{const r={sharer:t,field:e(),control:new lc};return s.setupField(r),Rn(n(r))})),Bn(Ma,(([t])=>t)),Zn((t=>t&&{field:e(),control:t.control})))))}toString(){return"Field"}}function Ma(t,e){return(null==t?void 0:t.control)===(null==e?void 0:e.control)||(null==t||t.control.supply.off(),!1)}const Ba=new WeakMap;class Ka extends $u{static get[du](){let t=Ba.get(this);return t||(t=new this("field"),Ba.set(this,t)),t}static get[Qt](){return this[du][Qt]}}const Na=new WeakMap;class ja extends $u{static get[du](){let t=Na.get(this);return t||(t=new this("form"),Na.set(this,t)),t}static get[Qt](){return this[du][Qt]}}function Ua(t,e){return new Pa((n=b(t),s=Fu(e,{local:"too"}),t=>s(t.sharer).do(Un(((e,s)=>e?e.read.do(Un((s=>s?Rn(n(c(u({},t),{adjacentTo:e,adjusted:s}))):$n()))):$n())))));var n,s}function za(t,e=Ka){return Ua(t,e)}function La(t){return"string"==typeof t?t:null}function qa(t={}){return function(t={}){return({key:e,share:n,locateForm:s,name:r,amend:i})=>{const{name:o=r}=t;let u;if(o)u=o;else{if(null!=o)return;{const t=La(e);if(!t)return;u=t}}const c=Fu(t.form||s,{share:ja});i({componentDef:{setup(t){t.whenComponent((t=>{kn({unit:t.get(n).do(zn(C,y())),form:c(t).do(zn(((t,e)=>t),y()))}).do(Dn((({unit:[t],form:[e]})=>{if(!e||!t)return;const n=e.control.aspect(Mc);return n?n.controls.set(u,t.control):void 0})))}))}}})}}(t)}const Ia={applyTo:t=>Uu()};class Va extends Ta{static forElement(t,e,n){return{control:t,element:aa(e,c(u({},n),{form:t}))}}static by(t,e){return new this(this.providerBy(t,e))}static providerBy(t,e){return n=>{let s=()=>n.control.build((e=>(s=g((()=>t(e))))())),r=()=>n.element.build((t=>(r=g((()=>e(u({form:s()},t)))))()));return{get control(){return s()},get element(){return r()}}}}static get[Vu](){return Ia}constructor(t){super(function(t,e){const n=e=>({applyAspect:n=>Lu(e,Va,t())});return s=>s.get($a).rules.do(zn((r=>{const i={sharer:s,form:t(),control:(new lc).addAspect(Va,n),element:(new lc).addAspect(Va,n)};return r.setupForm(i),Rn(e(i))})),Bn(Wa,(([t])=>t)),Zn((e=>e&&{get form(){return t()},get control(){return e.control},get element(){return e.element}})))}((()=>this),b(t)))}get element(){var t;return null===(t=this.body)||void 0===t?void 0:t.element}toString(){return"Form"}}function Wa(t,e){let n=!0;return(null==t?void 0:t.control)!==(null==e?void 0:e.control)&&(null==t||t.control.supply.off(),n=!1),(null==t?void 0:t.element)!==(null==e?void 0:e.element)&&(null==t||t.element.supply.off(),n=!1),n}const Ga={createSetup(t,e,n="default"){if(!1===t)return t=>Ht();if(!0===t)return t=>e(t).supply;let s=d(t);return s.length||(s=[n]),1===s.length?t=>t.aspect(Xu).when(s[0],(()=>e(t))):t=>s.reduce(((n,s)=>t.aspect(Xu).when(s,(()=>e(t))).as(n)),new zt)}},Ha=new WeakMap;class Ja{static get[oi](){const t=Ha.get(this);if(t)return t;const e=new this,n={setup:t=>{t.provide(e)}};return Ha.set(this,n),n}[fe](t){return t.provide({a:$a,is:this})}setupField(t){}setupForm(t){}}const Qa={createSetup(t,e,n){let s,r;if(Array.isArray(t)){const[e,...n]=t;Za(e)?(s=n.length>1?n:n[0],r=e):s=t}else Za(t)?r=t:s=t;return Ga.createSetup(s,e(r),n)}};function Za(t){return null!=t&&"string"!=typeof t&&"boolean"!=typeof t}class Xa extends Ja{constructor(t={}){super(),this._info=Qa.createSetup(t.info,(t=>{const e=xa(t);return t=>t.aspect(fa).add(e)})),this._error=Qa.createSetup(t.error,(t=>{const e=wa(t);return t=>t.aspect(fa).add(e)}))}setupField(t){t.control.setup(this._info).setup(this._error)}setupForm(t){t.control.setup(this._info),t.element.setup(fa,((t,e)=>t.add(e.aspect(Va).control.aspect(fa))))}}class Ya extends Ja{constructor(t={}){super(),this._byValidity=Qa.createSetup(t.byValidity,(t=>{const e=function({invalid:t="-on",ignore:e="submit"}={}){return n=>n.aspect(zc).read.do(Zn((n=>n.hasBut(..."string"==typeof e?[e]:e)?t:"on")))}(t);return t=>t.aspect(Ac).derive(e)})),this._byForm=Ga.createSetup(t.byForm,(t=>t.aspect(bc).read.do(Dn((e=>{const n=new zt;return X(e,(({parent:e})=>{const s=e.aspect(Va);s&&t.aspect(Ac).derive(s.element.aspect(Ac)).as(n)})),n})))))}setupField(t){t.control.setup(this._byForm)}setupForm(t){t.control.setup(this._byValidity)}}function th(t={},...e){let n,s,r;"function"==typeof t||ve(t)?(n={},r=Se([t,...e,qa()])):(n=t,s=t.name,r=Se([...e,qa({name:s})]));const{share:i=Ka,form:o}=n,h=Fu(o,{share:ja});return Bu(i,(t=>{var e,n;r(ke({base:c(u({},t),{locateForm:h,name:(e=t.key,n=s,""===n?null:n||La(e))}),amend(e,n={}){const s=n,{locateForm:r=e.locateForm,name:i=e.name}=s,o=a(s,["locateForm","name"]),h=t.amend(o);return()=>c(u({},h()),{locateForm:r,name:i})}}))}))}function eh(t){return Array.isArray(t)}function nh(t){return!!t.length}class sh{constructor(t){this.priority=t&&t.priority||0}important(){return this.prioritize(1)}usual(){return this.prioritize(0)}}function rh(t,e){return t===e||("object"==typeof t?t.is(e):"object"==typeof e&&e.is(t))}class ih extends sh{}class oh extends ih{constructor(t,e){super(e),this.r=ah(t.r,255),this.g=ah(t.g,255),this.b=ah(t.b,255),this.a=null!=t.a?hh(t.a,1):1}get type(){return"rgb"}get rgb(){return this}get hsl(){const{a:t}=this,e=100*this.r/255,n=100*this.g/255,s=100*this.b/255,r=Math.max(e,n,s),i=Math.min(e,n,s),o=Math.round((r+i)/2);if(r===i)return new uh({h:0,s:0,l:o,a:t},this);const u=r-i,c=Math.round(o>50?100*u/(200-r-i):100*u/(r+i));let a;switch(r){case e:a=(n-s)/u+(n<s?6:0);break;case n:a=(s-e)/u+2;break;default:a=(e-n)/u+4}return a*=60,a=Math.round(a),new uh({h:a,s:c,l:o,a:t},this)}by(t){return ch.by(t)||this}is(t){return"object"==typeof t&&t.type===this.type&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a&&t.priority===this.priority}prioritize(t){return this.priority===t?this:new oh(this,{priority:t})}set(t){"function"==typeof t&&(t=t(this));const{r:e=this.r,g:n=this.g,b:s=this.b,a:r=this.a}=t;return new oh({r:e,g:n,b:s,a:r},this)}toString(){const t=`${this.r}, ${this.g}, ${this.b}`;return 1===this.a?`rgb(${t})`:`rgba(${t}, ${this.a})`}}class uh extends ih{constructor(t,e){var n;super(e),this.h=(n=t.h,(n%=360)<0?360+n:n),this.s=hh(t.s,100),this.l=hh(t.l,100),this.a=null!=t.a?hh(t.a,1):1}get type(){return"hsl"}get rgb(){const{a:t}=this,e=this.s/100,n=this.l/100;if(!e){const e=255*n;return new oh({r:e,g:e,b:e,a:t},this)}const s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,i=this.h/360;return new oh({r:lh(r,s,i+1/3),g:lh(r,s,i),b:lh(r,s,i-1/3),a:t},this)}get hsl(){return this}by(t){return ch.by(t)||this}is(t){return"object"==typeof t&&t.type===this.type&&t.h===this.h&&t.s===this.s&&t.l===this.l&&t.a===this.a&&t.priority===this.priority}prioritize(t){return this.priority===t?this:new uh(this,{priority:t})}set(t){"function"==typeof t&&(t=t(this));const{h:e=this.h,s:n=this.s,l:s=this.l,a:r=this.a}=t;return new uh({h:e,s:n,l:s,a:r},this)}toString(){const t=`${this.h}, ${this.s}%, ${this.l}%`;return 1===this.a?`hsl(${t})`:`hsla(${t}, ${this.a})`}}const ch={by(t){if("object"==typeof t&&("rgb"===t.type||"hsl"===t.type))return t}};function ah(t,e){return hh(Math.round(t),e)}function hh(t,e){return Math.max(Math.min(t,e),0)}function lh(t,e,n){let s,r=n;return r<0?r+=1:r>1&&(r-=1),s=r<1/6?t+6*r*(e-t):r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t,255*s}function dh(t,e,n){const s=2*n-1,r=t.rgb,i=e.rgb,o=r.a-i.a,u=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,c=1-u;return new oh({r:r.r*u+i.r*c,g:r.g*u+i.g*c,b:r.b*u+i.b*c,a:r.a*n+i.a*(1-n)},t)}class fh extends sh{constructor(t){super(t),this.dim=t.dim}by(t){return this.dim.by(t)||this}toString(){return this.toFormula()}}const ph={map(t,e){const n={},s={from:e,get(s){if(s in n)return n[s];const r=function(t){switch(typeof t){case"function":return t;case"object":return t.by.bind(t)}const e=typeof t;return n=>typeof n===e?n:t}(t[s])(e[s],this,s);return n[s]=r,r}};return X(pt(t),(t=>s.get(t))),n},by:t=>ph.map.bind(void 0,t)};function yh(t){if(null==t)return[void 0,0];switch(typeof t){case"object":return[t,t.priority];case"string":if(t.endsWith("!important"))return[t.substring(0,t.length-"!important".length).trim(),1]}return[t,0]}class gh extends fh{constructor(t,e,n){super(n),this.val=t,this.unit=e}get type(){return"dimension"}toDim(t){const e=this.dim;if(t===e||t===e.pt||t===("%"===this.unit?t.pt:e.noPt))return this}is(t){return t===this||"object"==typeof t&&t.type===this.type&&this.unit===t.unit&&this.val===t.val&&this.priority===t.priority}prioritize(t){return this.priority===t?this:new gh(this.val,this.unit,{dim:this.dim,priority:t})}add(t,e){return"number"==typeof t&&(t=_h(t,e||this.unit,this)),"dimension"===t.type&&this.unit===t.unit?_h(this.val+t.val,this.unit,this):bh(this,"+",t)}sub(t,e){return"number"==typeof t&&(t=_h(t,e||this.unit,this)),"dimension"===t.type&&this.unit===t.unit?_h(this.val-t.val,this.unit,this):bh(this,"-",t)}mul(t){return 1===t?this:_h(this.val*t,this.unit,this)}div(t){return 1===t?this:_h(this.val/t,this.unit,this)}negate(){return _h(-this.val,this.unit,this)}toFormula(){return`${this.val}${this.unit}`}}function _h(t,e,n){return t?new gh(t,e,n):n.dim.zero.prioritize(n.priority||0)}class mh extends fh{constructor(t,e,n,s){super(s),this.left=t.usual(),this.op=e,this.right=n}get type(){return"calc"}is(t){return this===t||"object"==typeof t&&t.type===this.type&&(this.op===t.op&&this.left.is(t.left)&&rh(this.right,t.right)&&this.priority===t.priority)}add(t,e){return"number"==typeof t&&(t=_h(t,e,this)),bh(this,"+",t)}sub(t,e){return"number"==typeof t&&(t=_h(t,e,this)),bh(this,"-",t)}mul(t){return xh(this,t)}div(t){return Sh(this,t)}toString(){return"calc"+super.toString()}}class wh extends mh{constructor(t,e,n,s){super(t,e,n.usual(),s)}prioritize(t){return this.priority===t?this:new wh(this.left,this.op,this.right,{dim:this.dim,priority:t})}toDim(t){const e=this.left.toDim(t);if(!e)return;const n=this.right.toDim(t);return n?e===this.left&&n===this.right?this:new wh(e,this.op,n,{dim:t,priority:this.priority}):void 0}negate(){return"-"===this.op?new wh(this.right,this.op,this.left,this):new wh(this.left.negate(),"-",this.right,this)}toFormula(){return`(${this.left.toFormula()} ${this.op} ${this.right.toFormula()})`}}function bh(t,e,n){return n.type?new wh(t,e,n,t):t}class vh extends mh{prioritize(t){return this.priority===t?this:new vh(this.left,this.op,this.right,{dim:this.dim,priority:t})}toDim(t){const e=this.left.toDim(t);if(e)return e===this.left?this:new vh(e,this.op,this.right,{dim:t,priority:this.priority})}mul(t){return("*"===this.op?xh(this.left,this.right*t):Sh(this.left,this.right/t)).prioritize(this.priority)}div(t){return("/"===this.op?Sh(this.left,this.right*t):xh(this.left,this.right/t)).prioritize(this.priority)}negate(){return new vh(this.left,this.op,-this.right,this)}toFormula(){return`(${this.left.toFormula()} ${this.op} ${this.right})`}}function xh(t,e){return e?1===e?t.prioritize(t.priority):new vh(t,"*",e,t):t.dim.zero.prioritize(t.priority)}function Sh(t,e){return 1===e?t.prioritize(t.priority):new vh(t,"/",e,t)}class kh extends fh{constructor(t,e){super(e),this._byPriority=t}get type(){return 0}toDim(t){return t.zero.prioritize(this.priority)}is(t){return this===t||("object"==typeof t?t.type===this.type&&t.priority===this.priority:0===t||"0"===t?0===this.priority:"0 !important"===t&&1===this.priority)}add(t,e){return"number"==typeof t&&(t=_h(t,e,this)),t.prioritize(this.priority)}sub(t,e){return"number"==typeof t&&(t=_h(t,e,this)),t.negate().prioritize(this.priority)}mul(){return this}div(){return this}negate(){return this}prioritize(t){return this._byPriority.get(t)}important(){return this._byPriority.important}usual(){return this._byPriority.usual}toFormula(){return"0"}}class Ah{constructor(t){this.dim=t,this.usual=new kh(this,{dim:t}),this.important=new kh(this,{dim:t,priority:1})}get(t){switch(t){case 0:return this.usual;case 1:return this.important}return new kh(this,{dim:this.dim,priority:t})}}function Ch({pt:t,noPt:e}){const n={get zero(){return s},get pt(){return t()},get noPt(){return e()},of(t,e){return t?new gh(t,e,{dim:this}):s},by(t){if(function(t){return"object"==typeof t&&("dimension"===t.type||"calc"===t.type||0===t.type)}(t))return t.toDim(this)}},s=new Ah(n).usual;return n}const Oh=Ch({pt:()=>$h,noPt:()=>Oh}),$h=Ch({pt:()=>$h,noPt:()=>Oh});class Rh extends sh{constructor(t,e){super(e),this.url=t}get type(){return"url"}static by(t){switch(typeof t){case"string":{const[e,n]=yh(t);return new Rh(e,{priority:n})}case"object":if("url"===t.type)return t}}by(t){return Rh.by(t)||this}prioritize(t){return t===this.priority?this:new Rh(this.url,{priority:t})}is(t){return"object"==typeof t&&"url"===t.type&&t.url===this.url&&t.priority===this.priority}toString(){return`url("${Jr(this.url)}")`}}const Dh=$n({});function Fh(){return Dh}function Eh(t,e){if(!e)return Dh;if("string"!=typeof e){if(Xe(e))return Ph(e);if(on(e))return Ph(Th(e));if("function"==typeof e){const n=e(t);if("string"!=typeof n){if(Xe(n))return Ph(n);if(on(n))return Ph(Th(n))}return $n(Mh(n))}}return $n(Mh(e))}function Th(t){return On(t,y({}))}function Ph(t){return On(t).do(Xn(Mh),Pn(Bh,Kh))}function Mh(t){return"string"==typeof t?{$$css:t}:t}function Bh(t,e){const n=ct(Nh(e));for(const[s,r]of Nh(t)){const{value:t}=n.next();if(!t||s!==t[0]||!rh(r,t[1]))return!1}return!n.next().value}function Kh([t]){return u({},t)}function Nh(t){return gt($t(t),(([,t])=>E(t)))}function jh(t,e){return Ph(kn({base:t,addendum:e}).do(Zn((({base:[t],addendum:[e]})=>function(t,e){return at($t(e),((t,[e,n])=>function(t,e,n){Uh(t[e])<=Uh(n)&&(delete t[e],t[e]=n);return t}(t,e,n)),u({},t))}(t,e)))))}function Uh(t){switch(typeof t){case"string":return t.endsWith("!important")?1:0;case"object":return t.priority;default:return 0}}function zh(t){return">"===t||"+"===t||"~"===t}function Lh(t){if(!eh(t))return[qh(t)];const e=[];let n;for(const s of t){const t=n;let r;if(n&&(e.push(n),n=void 0),zh(s)){if(n=s,!t)continue;r={}}else r=qh(s);e.push(r)}return n&&e.push(n,{}),e}function qh(t){return"string"==typeof t?t?{s:t}:{}:Ih(t)}function Ih(t){const e=t.ns||void 0,n=t.i||void 0,s=function(t){if(!t)return;if(Ge(t))return[t];const e=t.filter((t=>!!t));return nh(e)?e.sort(He):void 0}(t.c),r=function(t){if(!t)return;if(function(t){return"string"!=typeof t[0]}(t)){const e=t.map(Vh);return nh(e)?e:void 0}return[Vh(t)]}(t.u);return{ns:e,e:("*"!==t.e||!e&&!n&&!s&&r&&Wh(r[0]))&&t.e||void 0,i:n,c:s,u:r,s:t.s||void 0,$:Gh(t.$)}}function Vh(t){if(!Wh(t))return t;if(t.length<3)return t;const[e,n,...s]=t;return eh(s[0])?[e,n,...s.map(Lh)]:[e,n,Lh(s)]}function Wh(t){return t.length>1&&(":"===t[0]||"::"===t[0])}function Gh(t){if(t)return nh(t=eh(t)?[...new Set(bt(t,Jh))].sort():[...Jh(t)])?t:void 0}const Hh=new Set;function Jh(t){if(!t)return Hh;const e=t.indexOf("="),n=e<0?t:t.substring(0,e),s=new Set;let r;for(const i of n.split(":"))r?r+=":"+i:r=i,s.add(r);return e>=0&&s.add(t),s}const Qh=[[]];function Zh(t){if(!t.length)return Qh;let e,n=0;for(;;){const s=t[n++];if(zh(s)){e=s;continue}return[e?[e,s]:[s],t.slice(n)]}}const Xh=[];function Yh(t,e){return t&&e.every((e=>t.find((t=>function(t,e){if("string"==typeof t)return"string"==typeof e?t===e:!e[1].url&&e[0]===t;const[n,{url:s}]=t;return"string"==typeof e?!s&&n===e:n===e[0]&&s===e[1].url}(e,t)))))}function tl(t){return Lh(t)}const el={qualify:t=>`@${Hr(t)}`};function nl(t){return rl(t,el)}const sl={};function rl(t,{qualify:e,nsAlias:n=Qe()}=sl){const s={qualify:e,nsAlias:n};return t.reduce(((t,e)=>zh(e)?t+e:(t&&!zh(t[t.length-1])&&(t+=" "),t+function(t,{qualify:e,nsAlias:n}){const{ns:s,e:r,i,c:o,s:u,u:c,$:a}=t;let h=!1,l="";i&&(h=!0,l+=`#${Hr(qe.name(i,n))}`);o&&(h=!0,l=o.reduce(((t,e)=>`${t}.${Hr(Ve.name(e,n))}`),l));if(c){h=!0;const t={nsAlias:n};l=c.reduce(((e,n)=>function(t,e,n){if(Wh(e)){t+=e[0]+e[1];if(e.length>2){t+="("+rl(e[2],n);for(let s=3;s<e.length;++s)t+=","+rl(e[s],n);t+=")"}return t}const[s,r,i,o]=e;t+="["+Hr(s),r&&(t+=`${r}"${Jr(i)}"`);o&&(t+=" "+o);return t+"]"}(e,n,t)),l)}u&&(h=!0,l+=u);e&&a&&(l=a.reduce(((t,n)=>t+e(n)),l));if(s){const t=function(t,e){return"string"==typeof t?t:t.url?e(t):void 0}(s,n);l=t?`${t}|${r||"*"}${l}`:d()}else l=d();return l;function d(){return h?`${r?ze.name(r,n):""}${l}`:`${r?ze.name(r,n):"*"}${l}`}}(e,s))),"")}class il{constructor(t){this._rule=t}read(t){let e=this._rule.outer;for(;e;)t=jh(e.read.do(Zn(cl)),t),e=e.outer;return t}render(t,e){const{selector:n}=t;let{writer:s}=t;if(!s.isGroup)return void t.render(e);let r=s;const i=function(t){const e=new Map,n=[];for(const s of t)zh(s)?n.push(s):n.push(hl(s,e));if(!e.size)return;return[e,tl(n)]}(n);if(!i)return void t.render(e);const[o,u]=i;for(const c of o){const[t,n]=ol(e,c);if(!n){s=r.addStyle(t);break}s=r=r.addGroup(t,n)}t.render(e,{writer:s,selector:u})}}function ol(t,[e,[n,s]]){let r="";const i=t=>{t&&(r&&(r+=" and "),r+=t)};for(const o of n){const[e]=yh(t[o]);i(e)}return i(s),r?[e,r]:[e]}const ul={order:-65535,create:t=>new il(t)};function cl(t){return at(gt($t(t),al),((t,[e,n])=>(t[e]=n,t)),{})}function al(t){return"@"===String(t[0])[0]}function hl(t,e){const n=t.$;if(!n)return t;const s=[];for(const r of n)"@"===r[0]?ll(e,r):s.push(r);return s.length===n.length?t:nh(s)?c(u({},t),{$:s}):c(u({},t),{$:void 0})}function ll(t,e){const n=e.indexOf("=");let s,r;n<0?s=e:(s=e.substring(0,n),r=e.substring(n+1));const i=s.indexOf(":"),o=i<0?s:s.substring(0,i),u=t.get(o);if(u){const[t,e]=u;t.add(s),r&&(u[1]=e?`${e} and ${r}`:r)}else t.set(o,[(new Set).add(s),r])}const dl={order:-65534,needs:ul,render(t,e){const n=!t.rule.selector.length,{sheet:s}=t;let r=0,i=0;for(const[o,u]of $t(e)){const t=String(o);if("@"===t[0]){const[e]=yh(u),o=n?fl(s,r,t,e):0;r+=o,i+=o;const c=Rh.by(e);c&&(i+=pl(s,i,t,c),i+=yl(s,i,t,c))}}t.render(e)}};function fl(t,e,n,s){if(!n.startsWith("@import:"))return 0;const r=new Rh(n.substring("@import:".length));let i=String(r);return s&&(i+=` ${s}`),t.addGlobal("@import",i,e),1}function pl(t,e,n,s){return"@namespace"!==n?0:(t.addGlobal("@namespace",String(s),e),1)}function yl(t,e,n,s){if(!n.startsWith("@namespace:"))return 0;const r=n.substring("@namespace:".length);return t.addGlobal("@namespace",`${r} ${s}`,e),1}function gl(t,e){const n=t.addStyle();X(gt($t(e),_l),(([t,e])=>{const[s,r]=yh(e);n.set(function(t){const e=Xr.get(t);if(e)return e;let n=Yr(t);return n.startsWith("ms-")&&(n="-"+n),Xr.set(t,n),n}(t),`${s}`,r)})),t.render(e,{writer:n})}function _l(t){const[e,n]=t;if(null==n)return!1;const s=String(e)[0];return s>="a"&&s<="z"||s>="A"&&s<="Z"}function ml(t,e){const n=e.$$css;if(n){const s=t.addStyle();s.replace(n),t.render(e,{writer:s})}else t.render(e)}const wl={order:-65535,needs:dl,render(t,e){const n=t.selector.map((t=>!zh(t)&&t.ns&&"string"!=typeof t.ns?t.ns:null)).filter(E);if(n.length){const s=(e,n)=>(e[`@namespace:${t.nsAlias(n)}`]=new Rh(n.url),e);t.render(n.reduce(s,u({},e)))}else t.render(e)}};function bl(t){if("function"==typeof t)return{create:()=>({render:t})};if(function(t){return"create"in t}(t))return{order:t.order,needs:t.needs,create:e=>function(t){return"function"==typeof t?{render:t}:t}(t.create(e))};const e=t.render.bind(t);return{order:t.order,needs:t.needs,create:()=>({render:e})}}function vl(t,e){const n=t.order||0,s=e.order||0;return n>s?1:n<s?-1:0}function xl(t,e=dr){return(n={})=>{const{node:s=t,error:r}=n;return e(c(u({},n),{node:s,error:r&&r.bind(n)}))}}function Sl(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}const kl={indent:"  "},Al={nv:"",eol:"",pre:"",indent(){return this}};class Cl{constructor(t,e=""){this._config=t,this.pre=e}get nv(){return" "}get eol(){return"\n"}indent(){return new Cl(this._config,this.pre+this._config.indent)}}class Ol{constructor(t,e){this.f=t,this.selector=e,this.body="",this.nf=t.indent()}get isGroup(){return!1}set(t,e,n){const s=n>=1?" !important":"",{pre:r,nv:i,eol:o}=this.nf;this.body&&(this.body+=`;${o}`),this.body+=`${r}${t}:${i}${e}${s}`}replace(t){this.body=t.trim(),this.body.endsWith(";")&&(this.body=this.body.substr(0,this.body.length-1))}toString(){const{pre:t,nv:e,eol:n}=this.f;if(this.body){const s=n?`;${n}`:"";return`${t}${this.selector}${e}{${n}${this.body}${s}${t}}`}return""}}class $l{constructor(t){this.nf=t,this._nested=[]}get isGroup(){return!0}addGroup(t,e,n){return this._add(new Rl(this.nf,t,e),n)}addStyle(t,e){return this._add(new Ol(this.nf,t),e)}toString(){let t="";for(const e of this._nested){const n=String(e);n&&(t&&(t+=this.nf.eol),t+=n)}return t}_add(t,e=this._nested.length){return this._nested.splice(e,0,t),t}}class Rl extends $l{constructor(t,e,n){super(t.indent()),this.f=t,this.name=e,this.params=n}toString(){const t=super.toString();if(!t)return"";const{pre:e,nv:n,eol:s}=this.f;return`${e}${this.name} ${this.params}${n}{${s}${t}${s}${e}}`}}class Dl extends $l{constructor(t,e,n){super(e),this.id=t,this.f=e,this.sender=n}addGlobal(t,e,n){this._add(`${this.f.pre}${t} ${e};`,n)}clear(){this._nested.length=0}remove(){this.clear(),this.sender.send({id:this.id})}done(){this.sender.send({id:this.id,css:this.toString()})}}function Fl(t={}){var e;const{document:n=(null===(e=t.parent)||void 0===e?void 0:e.ownerDocument)||window.document,parent:s=n.head}=t,r=function(t={}){const e=!0===t.pretty||null==t.pretty?kl:t.pretty||!1,{scheduler:n=cr}=t,s=new Ln,r=e?new Cl(e):Al;let i=0;return c(u({},t),{pretty:e,scheduler:n,onSheet:s.on,addSheet:()=>new Dl(String(++i),r,s)})}(t),i=xl(s,t.scheduler),o=i(),a=new Map,h=r.onSheet((({id:t,css:e})=>{let r=a.get(t);null==e?(a.delete(t),Sl(r)):r?r.textContent=e:(r=n.createElement("style"),r.setAttribute("type","text/css"),r.textContent=e,s.appendChild(r),a.set(t,r),h.whenOff((()=>o((()=>Sl(r))))))}));return c(u({},t),{scheduler:i,addSheet(t){return h.needs(t),this.addSheet=r.addSheet.bind(r),this.addSheet(t)}})}class El{constructor(t){this._target=t}get isGroup(){return!1}set(t,e,n){this._target.style.setProperty(t,e,n>=1?"important":void 0)}replace(t){this._target.style.cssText=t}}class Tl{constructor(t){this._target=t}get isGroup(){return!0}addGroup(t,e,n){return new Tl(this._add(`${t} ${e}{}`,n))}addStyle(t,e){return new El(this._add(`${t}{}`,e))}_add(t,e=this._target.cssRules.length){const n=this._target.insertRule(t,e);return this._target.cssRules[n]}}class Pl extends Tl{constructor(t){super(t.sheet),this._element=t}addGlobal(t,e,n){this._add(`${t} ${e};`,n)}clear(){const{cssRules:t}=this._target;for(;t.length;)this._target.deleteRule(t.length-1)}remove(){Sl(this._element)}done(){}}function Ml(t,e){const{rootSelector:n={e:"body"},scheduler:s=dr,nsAlias:r=Qe()}=e,i=new zt,o={nsAlias:r},u=function(t){const e=new Map;return n(t.renderer),e.delete(gl),[...e.values(),bl(gl)].sort(vl);function n(t){t&&(eh(t)?t.forEach(s):s(t))}function s(t){if(e.has(t))return;const s=bl(t);e.set(t,s),n(s.needs)}}(e),c=at(kt(t,l),((t,e)=>(new zt).cuts(e).cuts(t)),new zt);const a=function(){const e=new zt;return In(t)({supply:e,receive:(t,n)=>{n.forEach((t=>l(t).needs(e)))}})}();return i.as(c).as(a);function h(t,e,n){return new class{get supply(){return i}get rule(){return t}get sheet(){return n.sheet}get writer(){return n.writer}get selector(){return n.selector}nsAlias(t){return r(t)}render(s,r){e(r?h(t,e,{sheet:n.sheet,writer:r.writer||n.writer,selector:r.selector||n.selector}):this,s)}addStyle(t=n.selector){const{writer:e}=n;return e.isGroup?e.addStyle(function(t,e){return rl(tl(t),e)}(t,o)):e}}}function l(t){const[r,i]=function(t){const e=u.map((e=>e.create(t)));return[e.reduce(((t,e)=>e.read?On(e.read(t)):t),t.read),n(0)];function n(t){return(s,r)=>{const i=t+1;let o;o=i===u.length?R:n(i);const c=h(s.rule,o,s);e[t].render(c,r)}}}(t);let o;const c=function(t){const e=t.selector;if(!e.length)return tl(n);if(zh(e[0]))return[...tl(n),...e];return e}(t),a=s();return r((function(n){a((()=>{null==o||o.clear();const s=h(t,i,{get sheet(){return o||(o=e.addSheet(s)),o},get writer(){return this.sheet},selector:c});s.render(n),null==o||o.done()}))})).whenOff((function(){a((()=>{const t=o;if(t)return o=void 0,t.remove()}))}))}}function Bl(t){const e=[ul,wl,dl,ml];return t&&(eh(t)?e.push(...t):e.push(t)),e}function Kl(t,e){return Ml(t,c(u({},e),{renderer:Bl(e.renderer)}))}class Nl{[Ze](){return this.read}add(t){return this.rules.add([],t)}clear(){return this.set()}}class jl{[Ze](){return this.read}[rn](){return this.onUpdate}}class Ul extends jl{}class zl extends jl{constructor(t,e){let n;super(),this._list=t,e?(this._buildList=()=>gt(t,e),n=t=>t.filter(e)):(this._buildList=p(t),n=C),this.onUpdate=bn((t=>{const e=this._ruleSet||(this._ruleSet=new Set(this._buildList()));In(this._list)({supply:t.supply.whenOff((()=>this._ruleSet=void 0)),receive:(s,r,i)=>{r=n(r),((i=n(i)).length||r.length)&&(i.forEach((t=>e.delete(t))),r.forEach((t=>e.add(t))),t.receive(s,r,i))}})})).do(Gn);const s=p(this);this.read=this.onUpdate.do(Zn(s,s))}[Symbol.iterator](){return this._ruleSet?this._ruleSet.values():ct(this._buildList())}grab(t){return Ll(this,t)}}function Ll(t,e){const n=function(t){return Ih(t)}(e);return new zl(t,(t=>function(t,e){if(!t.length)return!1;const n=t[t.length-1];return!(e.ns&&n.ns!==e.ns||e.e&&n.e!==e.e||e.i&&n.i!==e.i||e.c&&!Yh(n.c,e.c)||e.$&&!Yh(n.$,e.$))}(t.selector,n)))}class ql extends Ul{constructor(t,e){super(),this._root=t,this.nested=e,this._updates=new Ln,this.self=function(t,e){const n=new Ln,s=[t];e.onUpdate(((e,r)=>{r[0]===t&&(s.length=0,n.send([],[t]))})).cuts(n);class r{[rn](){return n.on}[Symbol.iterator](){return ct(s)}}return new zl(new r)}(t,this),this._it=g((()=>Il(t)));const n=p(this);this.read=this._updates.on.do(Zn(n,n))}get onUpdate(){return this._updates.on}[Symbol.iterator](){return this[P]()}[P](t){return this._it()[P](t)}grab(t){return Ll(this,t)}add(t,e){return Gl(this._root,tl(t),e,!0)}get(t){return this._get(tl(t))}_get(t){const[e,n]=Zh(t);if(!n)return this._root;const s=this.nested._rule(nl(e));return s?s.rules.get(n):void 0}watch(t){const e=tl(t);return vn((t=>{const n=_s({}),s=this.read.do(Dn((()=>{const t=this._get(e);return t&&t.read((t=>n.it=t)).whenOff((()=>n.it={}))})));return n.read(t).cuts(s)})).do(Fn)}_add(t,e){t.rules.onUpdate(((t,e)=>this._updates.send(t,e))),e&&this._updates.send(tt(t.rules),[])}_remove(t){const e=tt(this);this._updates.send([],e),e.forEach((e=>{e.rules._updates.supply.off(t),e._spec.supply.off(t)}))}}function Il(t){return dt(ft(t),bt(t.rules.nested,(t=>Il(t))))}class Vl extends jl{constructor(t){super(),this._updates=new Ln,this._byKey=new Map,this._all=new ql(t,this);const e=p(this);this.read=this._updates.on.do(Zn(e,e))}get onUpdate(){return this._updates.on}[Symbol.iterator](){return this._byKey.values()}grab(t){return Ll(this,t)}_rule(t){return this._byKey.get(t)}_add(t,e,n){this._byKey.set(t,e),e.rules.onUpdate(((n,s)=>{s[0]===e&&(this._byKey.delete(t),this._updates.send([],[e]))})),n&&this._updates.send([e],[]),this._all._add(e,n)}}class Wl extends Nl{constructor(t,e,n,s=Fh){super(),this._root=t||this,this._selector=e,this._key=n,this._spec=_s(s),this.read=this._spec.read.do(Un((t=>t(this)))),this._nested=new Vl(this)}get root(){return this._root}get outer(){if(void 0!==this._outer)return this._outer;const t=function(t){let e=t.length-1;if(e<=0)return e?void 0:Xh;do{switch(--e,t[e]){case">":return t.slice(0,e);case"+":case"~":--e;continue;default:return t.slice(0,e+1)}}while(e>0)}(this.selector);return this._outer=t&&this.root.rules.get(t)||null}get selector(){return this._selector}get key(){return this._key}get empty(){return this._spec.it===Fh}get rules(){return this._nested._all}set(t){return this._spec.it=t?e=>Eh(e,t):Fh,this}remove(t){return this.rules._remove(t),this}}function Gl(t,e,n,s){const[r,i]=Zh(e);if(!i)return t._spec.it=function(t,e){const n=t._spec.it;if(!e)return n;if(t.empty)return t=>Eh(t,e);return t=>jh(n(t),Eh(t,e))}(t,n),t;const o=nl(r),u=t.rules.nested._rule(o);if(u)return Gl(u,i,n,s);const c=new Wl(t.root,[...t.selector,...r],r),a=Gl(c,i,n,!1);return t.rules.nested._add(o,c,s),a}const Hl=[];class Jl{[Ze](){return this.read}clear(){return this.set()}}class Ql extends Jl{constructor(t,e,n){super(),this._root=t,this._selector=e,this._map=n,this.read=kn({ms:this._map(this._root),ps:this._root.rules.watch(this._selector)}).do(Zn((({ms:[t],ps:[e]})=>ph.map(t,e))))}add(t){return this._root.rules.add(this._selector,t),this}set(t){return this._root.rules.add(this._selector).set(t),this}}const Zl={by(t,e){let n;return n="function"==typeof e?t=>Xl(e(t)):p(Xl(e)),e=>new Ql(e,t,n)}};function Xl(t){return Xe(t)?t:$n(t)}class Yl{constructor(t){this.refs=t;const e=kn(this.refs);this.read=e.do(Zn(td))}static by(t,e){const n={};for(const s of Object.keys(t))n[s]=t[s](e);return new Yl(n)}[Ze](){return this.read}}function td(t){const e={};for(const n of Object.keys(t))e[n]=t[n][0];return e}const ed=new zl({[rn]:()=>qn,[Symbol.iterator]:()=>[][Symbol.iterator]()});function nd(...t){return t.length?od(t.map(sd)):ed}function sd(t){return"function"==typeof t?function(t){let e;const n=()=>e||(e=ud(t()));return{[Symbol.iterator]:()=>n()[Symbol.iterator](),[rn]:()=>n()[rn]()}}(t):ud(t)}function rd(...t){return t.length?od(t.map(id)):ed}function id(t){return"function"==typeof t?function(t){const e=new Set,n=bn((n=>{const s=ud(t());cd(s,e,n),s[rn]()({supply:n.supply.whenOff((()=>e.clear())),receive(t,s,r){r.forEach((t=>e.delete(t))),s.forEach((t=>e.add(t))),n.receive(t,s,r)}})})).do(Gn);return{[rn]:()=>n,[Symbol.iterator]:()=>e.values()}}(t):ud(t)}function od(t){if(1===t.length){const e=t[0];return e instanceof jl?e:new zl(e)}return new zl({*[Symbol.iterator](){for(const e of t)yield*e},[rn]:()=>bn((e=>{t.forEach((t=>In(t)({supply:(new zt).needs(e.supply),receive(t,n,s){e.receive(t,n,s)}})))})).do(Gn)})}function ud(t){return t instanceof Nl?t.rules.self:on(t)?t:function(t){const e=new Set,n=bn((n=>{let s=Ht();const{supply:r}=n;r.cuts(s).whenOff((()=>e.clear())),t.then((t=>{if(!r.isOff){const i=t instanceof Nl?t.rules:t;cd(i,e,n),s=In(i)({receive(t,s,r){r.forEach((t=>e.delete(t))),s.forEach((t=>e.add(t))),n.receive(t,s,r)}}).needs(r)}})).catch((t=>r.off(t)))})).do(Gn);return{[rn]:()=>n,[Symbol.iterator]:()=>e.values()}}(t)}function cd(t,e,n){const s=[];if(X(t,(t=>{s.push(t),e.add(t)})),s.length){const t=new sn;t.on(n),t.send(s,[])}}const ad=new he("component-style-producer",{byDefault:si((()=>Ml))});function hd(t,e={},n){const{context:s}=t;return c(u({},e),{document:e.document||Vs(s.element),parent:e.parent||s.contentRoot,rootSelector:[],scheduler:e.scheduler||ld(s,n),nsAlias:e.nsAlias||s.get(Vi),renderer:t.renderer(e)})}function ld(t,e={}){const n=t.get(Wo);return(t={})=>n(u(u({},t),e))}const dd=new ie("component-styp-renderer"),fd=new We("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),pd=new he("unique-element-class",{byDefault:function(t){const e=t.get(Vi),n=t.get(Di),{tagName:s="component"}=n.get(ro).elementDef,r=`${s}#${++yd}`,i=fd.name(e(fd),r,Ve);return n.element.classList.add(i),i}});let yd=0;const gd=new he("component-styp-format",{byDefault:t=>new bd(t.get(Di))});class _d{static get[Qt](){return gd}produce(t,e){const n=this.newProducer(t,e),s=new zt;return this.context.whenSettled((()=>n().as(s))),s}newProducer(t,e){const n=rd(t);let s;const r=this.context.supply;return s=()=>this.context.get(ad)(n,this.format(e)).needs(r),r.whenOff((()=>{s=p(r)})),()=>s()}renderer(t){const e=this.context.get(Go,{or:null}),{renderer:n}=t,s=k(S(n),this.context.get(dd)),r=t.hostSelector?tl(t.hostSelector)[0]:void 0;return s.add(e?function(t){return{order:-100,render(e,n){let{selector:s}=e;if(s.length){if(t){const[e,n]=md(s);n&&(s=n.length?[{u:[[":","host",wd(n,t)]]},...e]:[{u:[[":","host",[t]]]},...e])}}else s=[t||{u:[[":","host"]]}];e.render(n,{selector:s})}}}(r):function(t){return{order:-100,render(e,n){let{selector:s}=e;if(s.length){const[e,n]=md(s);s=n&&n.length?[...wd(n,t),...e]:[t,...e]}else s=[t];e.render(n,{selector:s})}}}(r||{c:[this.context.get(pd)]})),x(s)}}function md(t){if("string"!=typeof t[0]){const[{ns:e,e:n,i:s,c:r,u:i,s:o,$:u},...c]=t;if(!e&&!n&&!s&&!r&&!o&&i){const[[t,e,...n]]=i;if(":"===t&&"host"===e){let t;return n.length?(t=n[0].slice(),t[0].$=u):t=u?[{$:u}]:[],[c,t]}}}return[t]}function wd(t,{ns:e,e:n,i:s,c:r,u:i,s:o}){const[u,...c]=t;return[{ns:u.e||u.ns?u.ns:e,e:u.e||u.ns?u.e:n,i:u.i||s,c:u.c?r?[...u.c,...r]:u.c:r,u:u.u?i?[...u.u,...i]:u.u:i,s:(u.s||"")+(o||"")||void 0,$:u.$},...c]}class bd extends _d{constructor(t){super(),this.context=t}format(t){return function(t={}){const{parent:e=document.head}=t;return c(u({},t),{scheduler:xl(e,t.scheduler),addSheet(){const t=document.createElement("style");return t.setAttribute("type","text/css"),t.append(document.createTextNode("")),e.appendChild(t),new Pl(t)}})}(this.config(t))}config(t){return hd(this,t,{when:"connected"})}}class vd extends _d{constructor(t,{when:e="settled"}={}){super(),this.context=t,this.when=e}format(t){return Fl(this.config(t))}config(t){return hd(this,t,{when:this.when})}}function xd(t){return Fi((({get:e,amend:n})=>n({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((({component:s})=>{const r=e(s),i="function"==typeof r?r.bind(s):r;n.get(_d).produce(i,t)}))}))}}})))}const Sd={setup(t){t.provide({a:ad,is:Kl})}};class kd{static get[oi](){return Sd}}class Ad extends re{constructor(){super("theme-style")}grow(t){const e=new Map;X(t.seed,(t=>{let n,s,r;"function"==typeof t?(n=s=t,r=!0):(n=t.style,s=t.provide.bind(t),r=!1);const i=e.get(n);if(i){const[t,o]=i;e.set(n,[r?Od(s,t):Od(t,s),r||o])}else e.set(n,[s,r])})),!e.size&&t.hasFallback||t.insert((function(t){const n=e.get(t);if(!n)return t;const[s,r]=n;return r?s:Od(t,s)}))}}const Cd=new Ad;function Od(t,e){return n=>nd(t(n),e(n))}const $d=new he("theme",{byDefault:si((t=>new Dd(t.get(Cd))))});class Rd{static get[Qt](){return $d}ref(t){return t(this.root)}}class Dd extends Rd{constructor(t){var e;super(),this._styles=t,this.root=new Wl(void 0,Hl,[],e?t=>Eh(t,e):void 0),this._rules=new Map}style(...t){const e=this;return rd(...t.reduce((function(t,n){const s=e._rules.get(n);if(s)t.push(s);else{const s=e._styles(n)(e);e._rules.set(n,s),t.push(s)}return t}),[]))}}function Fd({$:t="raw",n:e,t:n,v:s,x:r=[],p:i={},pl:o=[]}){return e&&(i[e]={$:t,n:e,v:s,x:[],p:{},pl:[]}),{$:t,n:e,t:n,v:s,x:r,p:i,pl:o}}function Ed({p:t,pl:e},n){const s=n.n||n.v,r=t[s];(!r||!r.n&&n.n)&&(t[s]=n),e.push(n)}const Td=()=>!1,Pd=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function Md(t,e){return t.s=t.s.substring(t.i),t.i=0,!!Pd.test(t.s)&&(e(t.s.substring(t.i,t.i+=29)),!0)}function Bd({delimiterOf:t}){return e=>{const n=e.s[e.i];return e.d=t(n),n}}function Kd(t,{named:e=!0,tagged:n=!0,extra:s=!0,next:r=Bd(t)}={}){const i=function({delimiterOf:t}){return(e,n)=>{if(!(262144&t(e.s[e.i])))return!1;let s="";for(++e.i;e.i<e.s.length;){const n=e.s[e.i++];if(524288&t(n))break;s+=n}return n(s),!0}}(t),o=function({dateTime:t}){return t?Md:Td}(t),u=function({delimiterOf:t}){return(e,n)=>{let s="";for(++e.i;e.i<e.s.length;++e.i){const r=e.s[e.i];if("\\"===r){s+=e.s[++e.i]||r}else{if(65536&t(r))return++e.i,void n(s);s+=r}}n(s)}}(t),c=s?Kd(t,{next:r,tagged:!1,named:!1,extra:!1}):Td;return(t,s)=>{let a,h,l,d="",f="raw";for(;t.i<t.s.length;){const s=r(t);if(t.d){if(12&t.d)break;if(null==h){if(16&t.d){h=d?"":s,++t.i;continue}if(65536&t.d){!n&&d||u(t,(t=>{d?(f="tagged-string",a=d):f="quoted-string",d="",h=t}));break}if(!d&&i(t,(t=>{f="angle-bracketed-string",h=t})))break;h=d,d=""}else{if(65536&t.d){!n&&h||u(t,(t=>{h?(f="tagged-string",a=h):f="quoted-string",h=t}));break}if(!h&&i(t,(t=>{f="angle-bracketed-string",h=t})))break}}if(null==h){if(!d&&o(t,(t=>h=t))){f="date-time";break}e?d+=s:h=s}else{if(!h&&o(t,(t=>h=t))){f="date-time";break}h+=s}++t.i}if(null==h){if(!d)return!1;l=Fd({$:f,v:d})}else l=Fd({$:f,n:d||void 0,t:a,v:h});for(;c(t,(t=>l.x.push(t))););return s(l),!0}}function Nd({delimiterOf:t}){return e=>{let n=e.s[e.i];return"\\"!==n?(e.d=t(n),n):(++e.i,e.i<e.s.length?(n=e.s[e.i],e.d=t(n)?1:0):e.d=1,n)}}function jd({delimiterOf:t}){return e=>{const n=e.i;do{const n=e.s[e.i];if(!(2&t(n)))break;e.i++}while(e.i<e.s.length);return e.i!==n}}function Ud(t,e={}){const{delimiterOf:n}=t,s=jd(t),r=Kd(t,c(u({},e),{tagged:!1}));return(t,e)=>!!(8&n(t.s[t.i]))&&(++t.i,s(t),r(t,e))}const zd={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function Ld({delimit:t,dateTime:e}={}){const n=t?u(u({},zd),t):zd;return{dateTime:e,delimiterOf:t=>n[t]||(t>="\0"&&t<=" "||"\x7f"===t?1:0)}}const qd=Ld(),Id=Ld({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Vd(t){const e=t?Ld(t):qd,n=function(t){const{delimiterOf:e}=t,n=jd(t);return t=>!!(4&e(t.s[t.i]))&&(t.i++,n(t),!0)}(e),s=Ud(e),r=Kd(e),i=(null==t?void 0:t.comments)?function(t){const{delimiterOf:e}=t,n=jd(t),s={next:Nd(t)},r=Kd(t,s),i=Ud(t,s);return(t,s)=>{if(!(131072&e(t.s[t.i])))return!1;let o;for(++t.i;n(t)||i(t,(t=>{o||(o=Fd({$:"raw",v:""})),Ed(o,t)}))||r(t,(t=>o=t)););return++t.i,s(o||Fd({$:"raw",v:""})),!0}}(Id):Td;return t=>{const e=[],o={i:0,s:t};for(;o.i<o.s.length&&(n(o)||s(o,(t=>{e.length||e.push(Fd({$:"raw",v:""})),Ed(e[e.length-1],t)}))||i(o,(t=>e.push(t)))||r(o,(t=>e.push(t)))););return e}}const Wd=Vd();function Gd(t){if(!t)return'""';const{delimiterOf:e}=qd;let n,s=!1;for(let r=0;r<t.length;++r){const i=t[r],o=e(i);o?(32&o&&(n||(n=t.substring(0,r)),n+="\\"+i),s=!0):n&&(n+=i)}return s?`"${n||t}"`:t}function Hd(t){return new URL(t.hash.substring(1),t.origin)}const Jd=Symbol("PageParam");class Qd{get[Jd](){return this}byDefault(t,e){}}class Zd extends Rs{constructor(t){super(t),this.upKey=this.createUpKey((t=>{const{document:e}=t.context.get(Ii);t.insert(t.seed.do(Un(((...n)=>n.length?$n((function(t,s,r,i){return o(0,i);function o(i,u){const c=n[i];if(!c)return t(u);c((({url:t=u.url,title:n=u.title,data:s=u.data}=u)=>o(i+1,{url:new URL(String(t),e.baseURI),title:n,data:s,get visited(){return u.visited},get current(){return u.current},get:t=>u.get(t),put(t,e){u.put(t,e)}})),s,r,u)}})):t.hasFallback&&t.or?t.or:$n(Xd)))))}))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?$n(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=Ss(t))),t.insert(((t,n,s,r)=>e(t,n,s,r)))}}function Xd(t,e,n,s){t(s)}const Yd=new Zd("navigation-agent");class tf extends Yt{}const ef=new he("nav-history",{byDefault:si((t=>new sf(t)))});function nf(t){return null==t||"object"!=typeof t?{data:t}:t["wesib:navigation:data"]}class sf{constructor(t){this._context=t,this._entries=new Map,this._lastId=0;const e=t.get(Ii);this._document=e.document,this._location=e.location,this._history=e.history,this._uid=btoa(String(Math.random()))}static get[Qt](){return ef}init(){const{data:t}=nf(this._history.state),e=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(e.id,e),e.schedule((()=>{e.enter("init"),this._history.replaceState(this._historyState(e),"")})),e}newEntry(t){return new rf(this._context,++this._lastId,t)}open(t,e){const{page:{title:n="",url:s}}=t;this._history.pushState(this._historyState(t),n,s.href),this._enter("open",t,e)}_enter(t,e,n){const s=n.it;this._entries.set(e.id,e);try{for(let t=s.next;t;t=t.next)this._forget(t)}finally{e.prev=s,s.next=e,e.schedule((()=>{try{s.leave()}finally{e.enter(t)}})),n.it=e}}replace(t,e){const n=e.it,{page:{title:s="",url:r}}=t;this._history.replaceState(this._historyState(t),s,r.href),this._entries.set(t.id,t);const i=n.prev;i&&(t.prev=i,i.next=t),t.schedule((()=>{try{n.leave()}finally{try{this._forget(n)}finally{t.enter("replace")}}})),e.it=t}popState(t,e){const{state:n}=t;if(null==n)return null==this._history.state?this._changeHash(e):void 0;const s=e.it,{uid:r,data:i,id:o}=nf(n);let u;const c=r===this._uid&&null!=o?this._entries.get(o):void 0;return c?u=c:(u=this.newEntry({url:new URL(this._location.href),data:i,title:this._document.title}),s.transfer(u,"return"),this._entries.set(u.id,u),this._history.replaceState(this._historyState(u),"")),u.schedule((()=>{try{s.leave()}finally{u.enter("return")}})),e.it=u,u}hashChange(t){if(null==this._history.state)return this._changeHash(t)}update(t,e){const n=t.it,s=new rf(this._context,++this._lastId,c(u({},n.page),{url:e}),n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",e.href),this._entries.delete(n.id),t.it=s}_changeHash(t){const e=t.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{e.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,t)}return n}_forget(t){this._entries.delete(t.id),t.forget()}_historyState({id:t,page:{data:e}}){return{"wesib:navigation:data":{uid:this._uid,id:t,data:e}}}}class rf{constructor(t,e,n,s){this._bsContext=t,this.id=e,this._status=0,this._update=R,this._params=s?s._params:new Map;const r=this;this.page={get url(){return n.url},get title(){return n.title},get data(){return n.data},get visited(){return!!r._status},get current(){return 2===r._status},get:t=>r.get(t),put(t,e){r.put(t,e)}}}get(t){const e=t[Jd],n=this._params.get(e);if(n)return n.get();const s=e.byDefault(this.page,this._newContext());return s&&this._init(e,s)}put(t,e){const n=t[Jd],s=this._params.get(n);return s?(s.put(e),s.get()):this._init(n,n.create(this.page,e,this._newContext()))}_newContext(){const t=new me(this._bsContext);return new class extends tf{constructor(){super(...arguments),this.get=t.newValues().get}}}_init(t,e){return this._params.set(t,e),this.page.current&&e.enter&&e.enter(this.page,"init"),e.get()}transfer(t,e){X(this._params.entries(),(([n,s])=>{if(s.transfer){const r=s.transfer(t.page,e);r&&t._params.set(n,r)}}))}stay(t){X(this._params.values(),(e=>e.stay&&e.stay(t)))}enter(t){this._status=2,X(this._params.values(),(e=>e.enter&&e.enter(this.page,t)))}leave(){this._status=1,X(this._params.values(),(t=>t.leave&&t.leave()))}forget(){X(this._params.values(),(t=>t.forget&&t.forget())),this._params.clear()}schedule(t){this._update=t}apply(){const t=this._update;this._update=R,t()}}class of extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!1})),this.when=e.when,this.to=e.to}}class uf extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!0})),this.when=e.when,this.from=e.from,this.to=e.to}}class cf extends Event{constructor(t,e){super(t,c(u({},e),{cancelable:!0})),this.from=e.from,this.to=e.to,this.reason=e.reason}get when(){return"stay"}}const af=new he("navigation",{byDefault:si((function(t){const e=t.get(Ii),{document:n,history:s}=e,r=new xs(e),i=t.get(sf),o=t.get(Yd),a=_s(i.init());a.read((t=>t.apply()));let h=Promise.resolve();r.on("popstate")((t=>{const e=i.popState(t,a);e&&r.dispatch(new of("wesib:enterPage",{when:null!=t.state?"return":"enter",to:e.page}))})),r.on("hashchange")((()=>{const t=i.hashChange(a);t&&r.dispatch(new of("wesib:enterPage",{when:"enter",to:t.page}))}));return new class extends hf{constructor(){super(),this.onEnter=r.on("wesib:enterPage"),this.onLeave=r.on("wesib:leavePage"),this.onStay=r.on("wesib:stayOnPage"),this.on=Vn(In(this.onEnter),In(this.onLeave),In(this.onStay)),this.read=a.read.do(Zn((({page:t})=>t)))}get page(){return a.it.page}get length(){return s.length}go(t){s.go(t)}open(t){return p("pre-open","open",t)}replace(t){return p("pre-replace","replace",t)}update(t){return i.update(a,d(t)).page}with(t,e){return l((n=>n.put(t,e)))}};function l(t){return{with:(e,n)=>l($(t,(t=>t.put(e,n)))),open:e=>p("pre-open","open",e,t),replace:e=>p("pre-replace","replace",e,t),pretend(e,n=((t,e)=>e)){let s;"function"==typeof e?(n=e,s=void 0):s=e;const r=f(s),i=a.it,o=y("pretend",i,r,t);try{return g("pretend",i,r,o)?n(i.page,o.page):void 0}finally{o.stay(a.it.page)}}}}function d(t){return"string"==typeof t?new URL(t,n.baseURI):t||a.it.page.url}function f(t){return null==t||"string"==typeof t||t instanceof URL?{url:d(t)}:t.url instanceof URL?t:c(u({},t),{url:d(t.url)})}function p(t,e,n,s=R){const o=f(n),u=h=h.then(c,c);return u;function c(){let n;try{const c=function(){if(h!==u)return l();const e=a.it,n=y(t,e,o,s),i=new uf("wesib:leavePage",{when:t,from:e.page,to:n.page});if(!r.dispatch(i)||h!==u||!g(t,e,o,n))return l(n);return n}();return c?(n=c,i[e](n,a),r.dispatch(new of("wesib:enterPage",{when:e,to:n.page})),n.page):c}catch(c){throw l(n,c),c}}function l(t,e){return t&&t.stay(a.it.page),r.dispatch(new cf("wesib:stayOnPage",{from:a.it.page,to:o,reason:e})),null}}function y(t,e,n,s){const r=i.newEntry(n);try{e.transfer(r,t),s(r.page)}catch(o){throw r.stay(a.it.page),o}return r}function g(t,e,n,s){let r=!1;return o((({url:t,data:e,title:s})=>{r=!0,n.url=t,n.data=e,n.title=s}),t,e.page,s.page),r}}))});class hf{static get[Qt](){return af}[rn](){return this.on}[Ze](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}const lf=["active",Xo];function df(t,e){const n=e.href.bind(e),s=S(e.event||"click"),{active:r=lf}=e;let i;return e=>{const o=w(t,e);if(!o)return;const{context:u,supply:c=u.supply}=e;i=Ve.name(r,u.get(Vi));const a=u.get(hf),h=u.get(Wo)({node:o}),l=(new zt).needs(c),d={supply:l,receive(t,e){const s=n(o),r=a.page.url,i=new URL(s,o.ownerDocument.baseURI);i.origin===r.origin&&(e.preventDefault(),r.href!==i.href&&a.open(s).catch(console.error))}},f=new xs(o);l.cuts(f);for(const t of s)f.on(t)(d);const p=function(t){return t[Or]||(t[Or]=new $r(t))}(o).renderIn(function(t,e={}){const{nsAlias:n=t.nsAlias,scheduler:s=t.scheduler}=e;if(n===t.nsAlias&&s===t.scheduler)return t;const r=new Sr({nsAlias:n,scheduler:s});let i=e=>{const n=t.lift();return n===t?e:(r.set(n),i=t=>n,n)};return new class extends vr{get fragment(){return t.fragment}get window(){return t.window}get document(){return t.document}get nsAlias(){return r.nsAlias}get scheduler(){return r.scheduler}get readStatus(){return t.readStatus}lift(){return i(this)}}}(Cr(o),{scheduler:t=>h}));return{get href(){return n(o)},supply:l,activate:()=>p.add(i)}}}function ff(t,e={}){return df(t,c(u({},e),{href:t=>t.href}))}const pf=Symbol("NavMenu.links");class yf{constructor(t,e){this[pf]=new gf(this,t,e)}get supply(){return this[pf].supply}bindTo(t){return this[pf].bindTo(t),this}[te](t){return this.bindTo(t)}}class gf{constructor(t,e,n={}){this._menu=t,this._navLinks=e,this._links=_s([new Set]),this._active=new Map,this.supply=(new zt).cuts(this._links);const{activate:s=!0,weigh:r}=n;this._activate=s,this._weigh=r?r.bind(n):_f}bindTo(t){this.bindTo=R,t.whenConnected((t=>{let e;if(Sn(this._navLinks))e=this._navLinks;else{const n=w(this._navLinks,t,this._menu);e=Sn(n)?n:$n(n).do(us(((t,e)=>t(...e))))}const n={context:t,supply:this.supply};if(e(((...t)=>{this._replace(n,t)})),this._activate){kn({page:t.get(hf),links:this._links})((({page:[e],links:[[n]]})=>{this._updateActive(t,e,n)}))}}))}_replace(t,e){var n;const s=new Set;for(const o of e){const e=w(o,t);e&&s.add(e)}const[r]=this._links.it,i=[];for(const o of r.keys())s.delete(o)||i.push(o);if(s.size||i.length){for(const t of i)r.delete(t),this._deactivate(t),null===(n=t.supply)||void 0===n||n.off();for(const t of s){const{supply:e}=t;if(e){if(e.isOff)continue;e.needs(this).whenOff((()=>{const[e]=this._links.it;e.delete(t)&&(this._links.it=[e])}))}r.add(t)}this._links.it=[r]}}_updateActive(t,e,n){const s=[],r=this._selectActive(t,e,n);for(const i of this._active.keys())r.delete(i)||s.push(i);for(const i of s)this._deactivate(i);for(const i of r)i.activate&&this._active.set(i,i.activate())}_selectActive(t,e,n){let s=0,r=new Set;for(const i of n){const n=this._weigh({link:i,menu:this._menu,context:t,page:e});n>s?(s=n,r=(new Set).add(i)):n===s&&r.add(i)}return r}_deactivate(t){const e=this._active.get(t);e&&(this._active.delete(t),e.off())}}function _f({link:t,context:e,page:n}){const s=t.href;return mf(new URL(s,e.get(Ii).document.baseURI),n.url)}function mf(t,e){if(t.origin!==e.origin)return-1;const n=wf(t),s=wf(e);if(t.hash){if(n!==s)return-1;const r=bf(t,e);return r<0||bf(e,t)<0?-1:t.pathname.length+r+mf(Hd(t),Hd(e))}const r=bf(t,e);return r?r<0||n!==s?-1:t.pathname.length+r:s.startsWith(n)?t.pathname.length:-1}function wf(t){const e=t.pathname;return e.endsWith("/")?e:e+"/"}function bf({searchParams:t},{searchParams:e}){let n=0;return t.forEach(((t,s)=>{(function(t){return t.startsWith("__")&&t.endsWith("__")})(s)||n>=0&&(e.getAll(s).includes(t)?n+=1:n=-1)})),n}const vf=new Yo("page-load-agent");function xf(t){let e;return n=>{const s=function(t){return new URL("",t.url).href}(n);if(e){if(e.url===s)return e.on;e.sup.off()}let r;const i=new zt((()=>{e=void 0,r=void 0})),o=bn((e=>{if(!r){const e=t(n),s=_s(),o=e((t=>{s.it=t})).whenOff((t=>{null!=t&&i.off(t)}));i.cuts(o).cuts(s),r={on:s.read.do(as(C)),num:0}}const s=r;return++s.num,s.on.do(ss(i))(e).whenOff((t=>{--s.num||Promise.resolve().then((()=>{s.num||s!==r||i.off(t)})).catch(console.error)}))}));return e={url:s,on:o,sup:i},o}}class Sf extends Error{}const kf=new class extends Qd{create(t,e){return{get:()=>e,put:R}}};class Af{constructor(t,e){this._navigation=t,this._loader=e,this._map=new Map,this._requests=bt(lt((()=>this._map.values())))}get fragments(){const t=[];return st(this._requests,(e=>!!e.fragment&&(t.push(e.fragment),!0)))?t:[]}handle(){const t=this,e=new zt(R);let n=Ht();return{get(){},put(e){t._add(e)},transfer(e,n){if("pretend"===n)return;const s=t._transfer();return e.put(kf,s),s.handle()},enter(s,r){if("init"===r)return;n=new zt(R).needs(e);const i=bn((e=>{const r=new Ln,i=r.on(e);return t._loader(s).do(ss(n))((t=>r.send(t))).whenOff((t=>{void 0===t||t instanceof Sf||r.send({ok:!1,page:s,error:t})})),i})).do(Gn);X(t._requests,(({fragment:t,receiver:e})=>function(t,e){return e?t.do(ts((t=>t.ok?c(u({},t),{fragment:(null!=e.tag?t.document.getElementsByTagName(e.tag)[0]:t.document.getElementById(e.id))||void 0}):t))):t}(i,t)({supply:(new zt).needs(e.supply),receive(t,n){e.receive(t,n)}})))},leave(){n.off(new Sf("page left"))},stay(){e.off(new Sf("navigation cancelled"))},forget(){e.off(new Sf("page forgotten"))}}}_add(t){const e=c(u({},t),{receiver:Ye(t.receiver)}),{supply:n}=e.receiver,s=this._map.get(n);s?s.push(e):(this._map.set(n,[e]),n.whenOff((()=>this._map.delete(n))))}_transfer(){const t=new Af(this._navigation,this._loader);for(const[e,n]of this._map.entries())t._map.set(e,n.slice());return t}}const Cf=new Fs("page-load-url",{byDefault:p(R)}),Of=new he("page-loader",{byDefault:si((function(t){const e=t.get(Ii),n=t.get(su),s=t.get(Cf),r=t.get(vf),i=new e.DOMParser;return t=>{const e=new URL(t.url.href);s(e);const o=new Request(e.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return bn((t=>r(u,o)(t)));function u(s){return function(t,e){var n;const s=null===(n=t.get(kf))||void 0===n?void 0:n.fragments;s&&s.length&&e.headers.set("Accept-Fragment",s.reduce(((t,e)=>(t?t+", ":"")+(null!=e.tag?"tag="+Gd(e.tag):"id="+Gd(e.id))),""))}(t,s),bn((r=>{const o=new sn;o.on(r),o.send({page:t}),n(s).do(ts((t=>Promise.all([t,t.text()]))),rs,Hn(((...t)=>$n(...t))),ts((([n,s])=>{if(!n.ok)return{ok:!1,page:t,response:n,error:n.status};try{return{ok:!0,page:t,response:n,document:$f(i,e,n,s)}}catch(r){return{ok:!1,page:t,response:n,error:r}}})))(r)}))}}}))});function $f(t,e,n,s){const r=t.parseFromString(s,Wd(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const t=r.head.querySelector("base");if(t)t.href=new URL(t.getAttribute("href"),e).href;else{const t=r.createElement("base");t.href=e.href,r.head.appendChild(t)}}return r}class Rf extends Qd{create(t,e,n){const s=new Af(n.get(hf),xf(n.get(Of))),r=s.handle();return t.put(kf,s),r.put(e),r}}const Df=new Rf,Ff=new he("page-cache-buster",{byDefault:si((t=>new Ef(t)))});class Ef{constructor(t){const e=Tf(t.get(Ii).document);if(e){const n=t.get(hf);this.urlModifier=$n((t=>t.searchParams.set("__wesib_app_rev__",e))),this.agent=$n(((t,s)=>t(new Request(s.url,s)).do(ts((t=>{if(t.ok){const s=Tf(t.document);if(s&&s!==e){const e=new URL(t.page.url.href);e.searchParams.set("__wesib_app_rev__",s),n.update(e),n.reload()}}return t})))))}else this.urlModifier=$n(),this.agent=$n()}static get[Qt](){return Ff}}function Tf(t){var e;return null===(e=t.querySelector("meta[name=wesib-app-rev]"))||void 0===e?void 0:e.getAttribute("content")}function Pf(t){const e=t.get(Ii).document;return t=>t().do(ts((t=>{if(t.ok){const n=new Set(kt(Mf(e,e.scripts),(([t])=>t)));X(gt(Mf(t.document,t.document.querySelectorAll("script")),(([t])=>!n.has(t))),(([t,s])=>{Gs(s,e.head,((e,n)=>n.src=t)),n.add(t)}))}return t})))}function Mf(t,e){return kt(yt(e,(({src:t})=>!!t)),(e=>[new URL(e.src,t.baseURI).href,e]))}function Bf(t){const e=t.get(Ii).document;return t=>t().do(ts((t=>{if(!t.ok)return t;const n=t.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return t;let s=e.head,r=null;const i=e.querySelectorAll("link[rel=stylesheet]"),o=new Map,u=i.item(0);return u&&(s=u.parentNode,r=u,X(Q(i),(t=>o.set(new URL(t.href,e.baseURI).href,t)))),X(Q(n),(t=>{const n=new URL(t.href,e.baseURI).href,i=o.get(n);i?(function(t){if(M(t))return rt(t);const e=B(t);return M(e)?rt(e):function(t){const e=t.next();return e.done?void 0:e.value}(e)}(o.keys())===n?(s=i.parentNode,r=i.nextSibling):s.insertBefore(i,r),o.delete(n)):Gs(t,s,r,((t,e)=>e.href=n))})),X(o.values(),(t=>t.parentNode.removeChild(t))),t})))}function Kf(t){const e=t.get(Ii).document;return t=>t().do(ts((t=>{if(t.ok){const n=t.document.getElementsByTagName("title").item(0);n&&n.textContent&&(e.title=n.textContent)}return t})))}const Nf={setup(t){t.provide({a:Cf,by:t=>t.urlModifier,with:[Ef]}),t.provide({a:vf,by:t=>t.agent,with:[Ef]}),t.provide({a:vf,by:Pf}),t.provide({a:vf,by:Bf}),t.provide({a:vf,by:Kf})}};class jf{static get[oi](){return Nf}}const Uf=new he("page-render-ctl",{byDefault:t=>new zf(t.get(Di))});class zf{constructor(t){this._context=t}renderPageBy(t,e={}){const n=w(e,this._context),{contentKey:s=Lf}=n,r=function({fragment:t}){if(t)return e=>t;return({element:{id:t,tagName:e}})=>t?{id:t}:{tag:e.toLowerCase()}}(n),i=this._context.get(hf),o=this._context.get(ru);let a;const h=_s(),l=o.renderFragmentBy((e=>{const n=h.it;if(!n)return void e.retainContent();const[s,r]=n,i=c(u({},e),{postpone(t){e.postpone((()=>t(i)))},response:s});if(s.ok){a=r;const{fragment:t}=s;t&&Hs(t,e.content)}t(i)}),c(u({},n),{when:"connected",on:h.on}));return this._context.whenConnected((t=>{a=s(i.page),i.read.do(es)((e=>{e.put(Df,{fragment:r(t),receiver:{supply:(new zt).needs(l),receive:(t,e)=>(t=>{const e=s(t.page);e!==a&&(h.it=[t,e])})(e)}})}))})),l}}function Lf({url:t}){return new URL("",t).href}function qf(t){return Fi((({get:e,amend:n})=>n({componentDef:{feature:{needs:[jf]},define(n){n.whenComponent((n=>{n.whenReady((n=>{const{component:s}=n,r=e(s).bind(s);n.get(Uf).renderPageBy(r,t)}))}))}}})))}export{Eo as A,ni as B,xi as C,vd as D,Ml as E,Ka as F,Fl as G,So as H,Wu as I,dh as J,hu as K,Zo as L,Pa as M,We as N,Yc as O,xd as P,zc as Q,Zl as R,oh as S,Rd as T,Wc as U,Mi as V,Xo as W,ws as X,Ko as Y,h as _,$h as a,Oh as b,Yl as c,th as d,us as e,za as f,Xn as g,la as h,fa as i,xa as j,wa as k,hi as l,Zn as m,Ya as n,Xa as o,qf as p,Vs as q,Br as r,nd as s,_s as t,yf as u,St as v,ff as w,jf as x,kd as y,_d as z};
//# sourceMappingURL=vendor.d0de1fdb.js.map
