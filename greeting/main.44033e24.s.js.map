{"version":3,"file":"main.44033e24.s.js","sources":["../../src/greeting/greeting-out.component.ts","../../src/greeting/greeting.component.ts","../../src/greeting/index.ts"],"sourcesContent":["import { StypProperties, stypRules, StypRules } from '@proc7ts/style-producer';\nimport { ProduceStyle, Theme } from '@wesib/generic/styp';\nimport {\n  AttachShadow,\n  Attribute,\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  ElementRenderer,\n  Render,\n} from '@wesib/wesib';\nimport { DefaultStyle, Examples__NS, FormThemeSettings, inStyle, readonlyInStyle, ThemeSettings } from '../common';\n\n@Component(['greeting-out', Examples__NS])\n@AttachShadow()\nexport class GreetingOutComponent {\n\n  @Attribute()\n  name?: string;\n\n  constructor(private readonly _context: ComponentContext) {\n  }\n\n  @ProduceStyle()\n  style(): StypRules {\n    return this._context.get(Theme).style(GreetingOutStyle);\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const document = this._context.get(BootstrapWindow).document;\n    const content = document.createElement('span');\n    const greetings = (): string => {\n\n      const name = this.name?.trim();\n\n      return name ? `Hello, ${name}!` : 'Hello!';\n    };\n\n    this._context.contentRoot.append(content);\n\n    return () => {\n      content.innerText = greetings();\n    };\n  }\n\n}\n\nconst GreetingOut__qualifier = 'bex:greeting-out';\n\nfunction GreetingOutStyle(theme: Theme): StypRules {\n\n  const settings = theme.ref(ThemeSettings).read();\n  const formSettings = theme.ref(FormThemeSettings).read();\n  const { root: { rules } } = theme;\n\n  return stypRules(\n      rules.add(\n          { u: [':', 'host'], $: GreetingOut__qualifier },\n          formSettings.keepThru(inStyle),\n      )\n          .add(formSettings.keepThru(readonlyInStyle))\n          .add(settings.keepThru(greetFieldStyle)),\n      theme.style(DefaultStyle),\n  );\n}\n\nexport function greetFieldStyle(\n    {\n      $fontSize,\n    }: ThemeSettings,\n): StypProperties {\n  return {\n    display: 'block',\n    margin: `${$fontSize.div(2)} 0 0 0`,\n  };\n}\n","import { afterAll, eventSupplyOf, ValueSync } from '@proc7ts/fun-events';\nimport {\n  InCssClasses,\n  inCssInfo,\n  inGroup,\n  InStyledElement,\n  inText,\n  InValidation,\n  requirePresent,\n} from '@proc7ts/input-aspects';\nimport { StypProperties, stypRules, StypRules } from '@proc7ts/style-producer';\nimport { ComponentNode } from '@wesib/generic';\nimport { DefaultInAspects, inputFromControl } from '@wesib/generic/input';\nimport { ProduceStyle, Theme } from '@wesib/generic/styp';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { AppFeature, Examples__NS, InputStyle, ThemeSettings } from '../common';\nimport { greetFieldStyle, GreetingOutComponent } from './greeting-out.component';\n\n@Component(\n    ['greeting', Examples__NS],\n    {\n      feature: {\n        needs: [\n          GreetingOutComponent,\n          AppFeature,\n        ],\n      },\n    },\n)\nexport class GreetingComponent {\n\n  constructor(private readonly _context: ComponentContext) {\n    _context.whenConnected(() => {\n\n      const node = _context.get(ComponentNode);\n      const group = inGroup<GreetData>({ name: '' });\n\n      afterAll({\n        name: node.select('input', { all: true, deep: true }).first(),\n        aspects: _context.get(DefaultInAspects),\n      }).tillOff(_context).consume(\n          ({ name: [nameNode], aspects: [aspects] }) => {\n\n            const name = nameNode && inText(nameNode.element)\n                .convert(aspects, InStyledElement.to(nameNode.element))\n                .setup(InValidation, validation => validation.by(requirePresent))\n                .setup(InCssClasses, classes => classes.add(inCssInfo()));\n\n            group.controls.set('name', name);\n\n            return name && inputFromControl(_context, name);\n          },\n      );\n\n      const output = node.select(GreetingOutComponent, { deep: true }).first().tillOff(_context);\n      const sync = new ValueSync<string | null>('');\n\n      sync.sync(output, o => o?.attribute('name'));\n      sync.sync(\n          'in',\n          group.controls.read(),\n          controls => controls?.get('name'),\n      );\n\n      eventSupplyOf(_context).cuts(sync).cuts(group);\n    });\n  }\n\n  @ProduceStyle()\n  style(): StypRules {\n    return this._context.get(Theme).style(GreetingStyle);\n  }\n\n}\n\ninterface GreetData {\n  name: string;\n}\n\nconst Greeting__qualifier = 'bex:greeting';\n\nfunction GreetingStyle(theme: Theme): StypRules {\n\n  const settings = theme.ref(ThemeSettings).read();\n  const { root: { rules } } = theme;\n  const label = rules.add(\n      [{ u: [':', 'host'], $: Greeting__qualifier }, { e: 'label', $: Greeting__qualifier }],\n      settings.keepThru(greetLabelStyle),\n  );\n\n  return stypRules(\n      theme.style(InputStyle),\n      label,\n      label.rules.add(\n          { e: 'input', $: Greeting__qualifier },\n          settings.keepThru(greetFieldStyle),\n      ),\n  );\n}\n\nfunction greetLabelStyle(\n    {\n      $fontSize,\n    }: ThemeSettings,\n): StypProperties {\n  return {\n    display: 'block',\n    margin: 0,\n    padding: `${$fontSize.div(2)}`,\n  };\n}\n","import { examplesContext } from '../common';\nimport { GreetingComponent } from './greeting.component';\n\nexamplesContext.load(GreetingComponent);\n"],"names":["GreetingOutStyle","theme","settings","ref","ThemeSettings","read","formSettings","FormThemeSettings","rules","root","stypRules","add","u","$","GreetingOut__qualifier","keepThru","inStyle","readonlyInStyle","greetFieldStyle","style","DefaultStyle","$fontSize","display","margin","div","GreetingStyle","label","Greeting__qualifier","e","greetLabelStyle","InputStyle","padding","GreetingOutComponent","_context","this","get","Theme","content","BootstrapWindow","document","createElement","contentRoot","append","name","innerText","_this","trim","__decorate","Attribute","ProduceStyle","Render","Component","Examples__NS","AttachShadow","GreetingComponent","whenConnected","node","ComponentNode","group","inGroup","afterAll","select","all","deep","first","aspects","DefaultInAspects","tillOff","consume","nameNode","inText","element","convert","InStyledElement","to","setup","InValidation","validation","by","requirePresent","InCssClasses","classes","inCssInfo","controls","set","inputFromControl","output","sync","ValueSync","o","attribute","eventSupplyOf","cuts","feature","needs","AppFeature","examplesContext","load"],"mappings":"47CAmDSA,EAAiBC,OAElBC,EAAWD,EAAME,IAAIC,GAAeC,OACpCC,EAAeL,EAAME,IAAII,GAAmBF,OAClCG,EAAYP,EAApBQ,KAAQD,aAETE,EACHF,EAAMG,IACF,CAAEC,EAAG,CAAC,IAAK,QAASC,EAAGC,GACvBR,EAAaS,SAASC,IAErBL,IAAIL,EAAaS,SAASE,IAC1BN,IAAIT,EAASa,SAASG,IAC3BjB,EAAMkB,MAAMC,aAIFF,SAEVG,IAAAA,gBAGG,CACLC,QAAS,QACTC,iBAAWF,EAAUG,IAAI,uBCMpBC,EAAcxB,OAEfC,EAAWD,EAAME,IAAIC,GAAeC,OAEpCqB,EADsBzB,EAApBQ,KAAQD,MACIG,IAChB,CAAC,CAAEC,EAAG,CAAC,IAAK,QAASC,EAAGc,GAAuB,CAAEC,EAAG,QAASf,EAAGc,IAChEzB,EAASa,SAASc,WAGfnB,EACHT,EAAMkB,MAAMW,GACZJ,EACAA,EAAMlB,MAAMG,IACR,CAAEiB,EAAG,QAASf,EAAGc,GACjBzB,EAASa,SAASG,cAKnBW,SAEHR,IAAAA,gBAGG,CACLC,QAAS,QACTC,OAAQ,EACRQ,kBAAYV,EAAUG,IAAI,6PD7FjBQ,wBAKkBC,2BAAAA,mDAKpBC,KAAKD,SAASE,IAAIC,GAAOjB,MAAMnB,+CAOhCqC,EADWH,KAAKD,SAASE,IAAIG,GAAiBC,SAC3BC,cAAc,oBAQlCP,SAASQ,YAAYC,OAAOL,GAE1B,WATW,MAEVM,EAQNN,EAAQO,WARFD,YAAOE,EAAKF,2BAAMG,yBAEAH,OAAU,mBAnBtCI,GADCC,gCAODD,GADCE,+BAMDF,GADCG,gCAbUlB,KAFZmB,EAAU,CAAC,eAAgBC,IAC3BC,KACYrB,GAkCPlB,EAAyB,mBCpBlBwC,wBAEkBrB,2BAAAA,EAC3BA,EAASsB,eAAc,eAEfC,EAAOvB,EAASE,IAAIsB,GACpBC,EAAQC,EAAmB,CAAEhB,KAAM,KAEzCiB,EAAS,CACPjB,KAAMa,EAAKK,OAAO,QAAS,CAAEC,KAAK,EAAMC,MAAM,IAAQC,QACtDC,QAAShC,EAASE,IAAI+B,KACrBC,QAAQlC,GAAUmC,SACjB,gBAAUC,MAAP1B,WAA4BsB,MAAVA,cAEbtB,EAAO0B,GAAYC,EAAOD,EAASE,SACpCC,QAAQP,EAASQ,EAAgBC,GAAGL,EAASE,UAC7CI,MAAMC,GAAc,SAAAC,UAAcA,EAAWC,GAAGC,MAChDJ,MAAMK,GAAc,SAAAC,UAAWA,EAAQtE,IAAIuE,eAEhDxB,EAAMyB,SAASC,IAAI,OAAQzC,GAEpBA,GAAQ0C,EAAiBpD,EAAUU,UAI1C2C,EAAS9B,EAAKK,OAAO7B,EAAsB,CAAE+B,MAAM,IAAQC,QAAQG,QAAQlC,GAC3EsD,EAAO,IAAIC,EAAyB,IAE1CD,EAAKA,KAAKD,GAAQ,SAAAG,UAAKA,MAAAA,SAAAA,EAAGC,UAAU,WACpCH,EAAKA,KACD,KACA7B,EAAMyB,SAAS9E,QACf,SAAA8E,UAAYA,MAAAA,SAAAA,EAAUhD,IAAI,WAG9BwD,EAAc1D,GAAU2D,KAAKL,GAAMK,KAAKlC,uDAMnCxB,KAAKD,SAASE,IAAIC,GAAOjB,MAAMM,YADxCsB,GADCE,+BAvCUK,KAXZH,EACG,CAAC,WAAYC,GACb,CACEyC,QAAS,CACPC,MAAO,CACL9D,EACA+D,OAKGzC,GAkDP3B,EAAsB,eC5E5BqE,EAAgBC,KAAK3C"}