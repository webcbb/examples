{"version":3,"file":"main.e9c71646.m.js","sources":["../../src/greeting/greeting-out.component.ts","../../src/greeting/greeting.component.ts","../../src/greeting/index.ts"],"sourcesContent":["import { ProduceStyle, Theme } from '@wesib/generic';\nimport { AttachShadow, Attribute, BootstrapWindow, Component, ComponentContext, Render } from '@wesib/wesib';\nimport { StypProperties, stypRules, StypRules } from 'style-producer';\nimport { DefaultStyle, Examples__NS, FormThemeSettings, inStyle, readonlyInStyle, ThemeSettings } from '../common';\n\n@Component(['greeting-out', Examples__NS])\n@AttachShadow()\nexport class GreetingOutComponent {\n\n  @Attribute()\n  name?: string;\n\n  constructor(private readonly _context: ComponentContext) {\n  }\n\n  @ProduceStyle()\n  style(): StypRules {\n    return this._context.get(Theme).style(GreetingOutStyle);\n  }\n\n  @Render()\n  render() {\n\n    const self = this;\n    const document = this._context.get(BootstrapWindow).document;\n    const content = document.createElement('span');\n\n    this._context.contentRoot.append(content);\n\n    return () => content.innerText = greetings();\n\n    function greetings() {\n\n      const name = self.name?.trim();\n\n      return name ? `Hello, ${name}!` : 'Hello!';\n    }\n  }\n\n}\n\nconst GreetingOut__qualifier = 'bex:greeting-out';\n\nfunction GreetingOutStyle(theme: Theme): StypRules {\n\n  const settings = theme.ref(ThemeSettings).read.keep;\n  const formSettings = theme.ref(FormThemeSettings).read.keep;\n  const { root: { rules } } = theme;\n\n  return stypRules(\n      rules.add(\n          { u: [':', 'host'], $: GreetingOut__qualifier },\n          formSettings.thru(inStyle),\n      )\n          .add(formSettings.thru(readonlyInStyle))\n          .add(settings.thru(greetFieldStyle)),\n      theme.style(DefaultStyle),\n  );\n}\n\nexport function greetFieldStyle(\n    {\n      $fontSize,\n    }: ThemeSettings,\n): StypProperties {\n  return {\n    display: 'block',\n    margin: `${$fontSize.div(2)} 0 0 0`,\n  };\n}\n","import { ComponentNode, inputFromControl, ProduceStyle, Theme } from '@wesib/generic';\nimport { Component, ComponentContext, DefaultRenderScheduler } from '@wesib/wesib';\nimport { ValueSync } from 'fun-events';\nimport { InCssClasses, inCssInfo, inGroup, inText, intoWrapper, InValidation, requirePresent } from 'input-aspects';\nimport { StypProperties, stypRules, StypRules } from 'style-producer';\nimport { AppFeature, Examples__NS, InputStyle, ThemeSettings } from '../common';\nimport { greetFieldStyle, GreetingOutComponent } from './greeting-out.component';\n\n@Component(\n    ['greeting', Examples__NS],\n    {\n      feature: {\n        needs: [\n          GreetingOutComponent,\n          AppFeature,\n        ],\n      },\n    },\n)\nexport class GreetingComponent {\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const scheduler = _context.get(DefaultRenderScheduler);\n\n    _context.whenOn(supply => {\n\n      const node = _context.get(ComponentNode);\n      const group = inGroup<GreetData>({ name: '' });\n\n      node.select('input', { all: true, deep: true }).first.tillOff(supply).consume(\n          nameNode => {\n\n            const name = nameNode && inText(nameNode.element)\n                .convert(intoWrapper(nameNode.element, { scheduler }))\n                .setup(InValidation, validation => validation.by(requirePresent))\n                .setup(InCssClasses, classes => classes.add(inCssInfo()));\n\n            group.controls.set('name', name);\n\n            return name && inputFromControl(_context, name);\n          },\n      );\n\n      const output = node.select(GreetingOutComponent, { deep: true }).first.tillOff(supply);\n      const sync = new ValueSync<string | null>('');\n\n      sync.sync(output, o => o?.attribute('name'));\n      sync.sync(\n          'in',\n          group.controls.read,\n          controls => controls?.get('name'),\n      );\n\n      supply.whenOff(reason => {\n        sync.done(reason);\n        group.done(reason);\n        group.controls.clear();\n      });\n    });\n  }\n\n  @ProduceStyle()\n  style(): StypRules {\n    return this._context.get(Theme).style(GreetingStyle);\n  }\n\n}\n\ninterface GreetData {\n  name: string;\n}\n\nconst Greeting__qualifier = 'bex:greeting';\n\nfunction GreetingStyle(theme: Theme): StypRules {\n\n  const settings = theme.ref(ThemeSettings).read.keep;\n  const { root: { rules } } = theme;\n  const label = rules.add(\n      [{ u: [':', 'host'], $: Greeting__qualifier }, { e: 'label', $: Greeting__qualifier }],\n      settings.thru(greetLabelStyle),\n  );\n\n  return stypRules(\n      theme.style(InputStyle),\n      label,\n      label.rules.add(\n          { e: 'input', $: Greeting__qualifier },\n          settings.thru(greetFieldStyle),\n      ),\n  );\n}\n\nfunction greetLabelStyle(\n    {\n      $fontSize,\n    }: ThemeSettings,\n): StypProperties {\n  return {\n    display: 'block',\n    margin: 0,\n    padding: `${$fontSize.div(2)}`,\n  };\n}\n","import { examplesContext } from '../common';\nimport { GreetingComponent } from './greeting.component';\n\nexamplesContext.load(GreetingComponent);\n"],"names":["GreetingOutComponent","[object Object]","_context","this","get","Theme","style","GreetingOutStyle","self","content","BootstrapWindow","document","createElement","contentRoot","append","innerText","name","trim","greetings","__decorate","Attribute","ProduceStyle","Render","Component","Examples__NS","AttachShadow","theme","settings","ref","ThemeSettings","read","keep","formSettings","FormThemeSettings","root","rules","stypRules","add","u","$","thru","inStyle","readonlyInStyle","greetFieldStyle","DefaultStyle","$fontSize","display","margin","div","GreetingComponent","scheduler","DefaultRenderScheduler","whenOn","supply","node","ComponentNode","group","inGroup","select","all","deep","first","tillOff","consume","nameNode","inText","element","convert","intoWrapper","setup","InValidation","validation","by","requirePresent","InCssClasses","classes","inCssInfo","controls","set","inputFromControl","output","sync","ValueSync","o","attribute","whenOff","reason","done","clear","GreetingStyle","feature","needs","AppFeature","label","e","greetLabelStyle","InputStyle","padding","examplesContext","load"],"mappings":"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"}