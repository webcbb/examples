import{g as e,t,C as n,h as r,j as s,A as o,v as i,k as a,l as u,n as c,o as h,q as l,r as d,u as p,w as f,x as g,y as m,z as w,B as y,D as b,E as _,M as v,F as x,G as O,N as k,H as D,J as S,K as C,L as E,O as R,P as T,Q as j,T as A,V as P,U,W as F,X as L,Y as q,Z as N,$ as M,a0 as $,a1 as K,a2 as B,a3 as z,a4 as I,a5 as V,a6 as H,a7 as W,a8 as Q,a9 as G,aa as J,ab as X,ac as Y,ad as Z,ae as ee,af as te,ag as ne,s as re,ah as se,ai as oe,p as ie,aj as ae,ak as ue,al as ce,am as he,an as le,ao as de,ap as pe}from"./lib.43b73b82.m.js";const fe=new s("bootstrap-context");class ge extends n{static get[r](){return fe}}function me(e){return(t,n)=>{const r=t.get(ge);return t===r?e(r,n):r.get(n)}}const we=new s("component-factory");class ye{static get[r](){return we}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const be=new s("window",{byDefault:()=>window}),_e=new s("bootstrap-root",{byDefault:e=>e.get(be).document.body}),ve=new s("default-namespace-aliaser");class xe extends u{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return Oe(e.context,t[t.length-1]);const n=()=>h(Oe(e.context,D));return p(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?h(e.or):e.or}:void 0).to(n=>t=Oe(e.context,n)),(...e)=>t(...e)}}function Oe(e,t){return(n={})=>t(Object.assign(Object.assign({},n),{window:n.window||e.get(be)}))}const ke=new xe;function De(e){return Array.isArray(e)}class Se extends o{constructor(e){super(),this.items=null==e?new Set:De(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:De(e)?this.add(...e):this.add(e)}}function Ce(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const r=n.constructor;return t(r)?r:Ce(r,t)}function Ee(e,t,n,r){const s=!n,o=r(n?function(e){if(function(e){return void 0===e.value&&void 0===e.writable}(e))return e;const t=Symbol("value"),n=e.value,r=Object.assign(Object.assign({},e),{writable:void 0,value:void 0,get(){return t in this?this[t]:n}});return e.writable&&(r.set=function(e){this[t]=e}),delete r.writable,delete r.value,r}(n):function(e,t){const n=Symbol(`${String(t)}:value`),r=e[t];return{configurable:!0,enumerable:!0,get(){return n in this?this[n]:r},set(e){this[n]=e}}}(e,t));if(!s||!o)return o;Object.defineProperty(e,t,o)}function Re(e,t,n=((e,t)=>t)){return e?t?function(...r){return n(e.apply(this,r),t.apply(this,r))}:e:t}function Te(e){return e.nodeType===Node.ELEMENT_NODE}class je{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=Ce(e),r=n&&this.of(n);return t?r?this.merge([r,t]):t:r}define(e,t){const n=this.own(e),r=g(t,t=>this.meta(t,e)),s=this.merge(n?F([[n],r]):r);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}class Ae{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const Pe=Symbol("feature-def");class Ue extends je{constructor(){super(Pe)}merge(t){return e(t,(e,t)=>({needs:new Se(e.needs).merge(t.needs).value,has:new Se(e.has).merge(t.has).value,setup:Re(e.setup,t.setup),init:Re(e.init,t.init)}),{})}meta(e,t){const n=e[Pe];return null==n?e:this.meta("function"==typeof n?e[Pe](t):n,t)}}const Fe=new Ue,Le={[Pe]:()=>({})},qe={of:e=>Fe.of(e)||{},for:(e,t)=>Fe.meta(t,e),merge:(...e)=>Fe.merge(e),all:(...t)=>e(t,(e,t)=>({[Pe]:n=>qe.merge(qe.for(n,e),qe.for(n,t))}),Le),define:(e,...t)=>Fe.define(e,t)};function Ne(...e){return t=>qe.define(t,...e)}const Me=new s("feature-context");class $e extends ge{static get[r](){return Me}whenDefined(e){return this.get(ge).whenDefined(e)}load(e){return this.get(ge).load(e)}}class Ke extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,r])=>(e||t.name)+` ${n} ${r.name}`,"")),this.needs=e}}const Be=Symbol("component-def");class ze extends je{constructor(){super(Be)}merge(t){return e(t,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:Re(e.setup,t.setup),define:Re(e.define,t.define),feature:e.feature?t.feature?qe.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[Be];return null!=n?this.meta("function"==typeof n?e[Be](t):n,t):null!=e[Pe]?{feature:qe.for(t,e)}:q(e)?{name:e}:e}}const Ie=new ze,Ve={[Be]:()=>({})},He={of:e=>Ie.of(e)||{},for:(e,t)=>Ie.meta(t,e),merge:(...e)=>Ie.merge(e),all:(...t)=>e(t,(e,t)=>({[Be]:n=>He.merge(He.for(n,e),He.for(n,t))}),Ve),define:(e,...t)=>Ie.define(e,t)};function We(...e){const t=t=>He.define(t,...e);return t[Be]=()=>He.all(...e),t}const Qe=new s("component-context"),Ge=new s("component-event-dispatcher",{byDefault(e){const t=e.get(Qe),n=new S(t.element);return C(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Je=new s("content-root",{byDefault:e=>e.get(Qe).element}),Xe=new O("state-updater",{byDefault:i(x)}),Ye=Symbol("component-context");class Ze extends n{constructor(){super(...arguments),this.updateState=et.bind(this)}static get[r](){return Qe}static of(e){const t=e[Ye];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(Je)}on(e){return this.get(Ge).on(e)}dispatchEvent(e){this.get(Ge).dispatch(e)}}function et(e,t,n){this.get(Xe)(e,t,n)}class tt extends Event{get context(){return Ze.of(this.target)}}const nt=Symbol("anonymous-component-property");function rt(e){const t=({get:t,set:n},r=nt,s)=>We({[Be](o){const i=e({type:o,key:r,readable:!0,writable:s,enumerable:!1,configurable:!1,get:e=>t(e,r),set:(e,t)=>n(e,t,r)});return i&&i.componentDef||{}}}),n=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),r=(t,n,r)=>Ee(t,n,r,r=>{const{get:s,set:o}=r,i=t.constructor,{get:a,set:u,configurable:c,enumerable:h,componentDef:l={}}=e({type:i,key:n,readable:!!r.get,writable:!!r.set,enumerable:!!r.enumerable,configurable:!!r.configurable,get:s?e=>s.call(e):st(n),set:o?(e,t)=>o.call(e,t):ot(n)})||{};He.define(i,l);const d=Object.assign(Object.assign({},r),{configurable:null!=c?c:r.configurable,enumerable:null!=h?h:r.enumerable});return(a||u)&&(d.get=a&&function(){return a(this,n)},d.set=u&&function(e){u(this,e,n)}),d});return r.With=(e,n)=>t(e,n,!0),r.By=n,r.As=(e,t)=>n(i(e),t),r.Bind=(e,n=nt)=>{const r=Symbol(`${String(n)}:accessor`),s=t=>{const s=t[r];if(s)return s;const o=e(t,n);return t[r]={get:o.get?o.get.bind(o):st(n),set:o.set?o.set.bind(o):ot(n)}};return t({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},n,!0)},r}function st(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function ot(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}class it extends u{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),at),r=()=>h(at);return n!==at?n:p(e.byDefault(r)||r())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?h(e.or):e.or}:void 0).to(e=>t=e),e=>t(e)}}function at(e){return e[Ye]}const ut=new it,ct=new O("element-observer",{byDefault:me(e=>{const t=e.get(ut);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{T(j(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[Ye])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),T(w(j(e.addedNodes),Te),e=>{var n,r;return null===(r=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===r?void 0:r.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const ht=Symbol("component-factory");function lt(e){const t=e[ht];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const dt=new s("custom-elements",{byDefault:function(e){const t=e.get(be).customElements,n=e.get(ve);return new class extends pt{define(e,r){if(q(e))return void t.define(M.name(e,n),r);const s=lt(e),{name:o,extend:i}=s.elementDef;o?i&&i.name?t.define(M.name(o,n),r,{extends:i.name}):t.define(M.name(o,n),r):gt(e).resolve(void 0)}whenDefined(e){if(q(e))return t.whenDefined(M.name(e,n));const r=lt(e),{name:s}=r.elementDef;return s?t.whenDefined(M.name(s,n)):gt(e).promise}}}});class pt{static get[r](){return dt}}const ft=Symbol("component-resolver");function gt(e){return e[ft]||(e[ft]=new Ae)}const mt=new s("definition-context"),wt=new s("element-def",{byDefault(e){const t=e.get(mt).componentType,{name:n,extend:r}=He.of(t),s={get type(){return r&&r.type||e.get(be).HTMLElement},get name(){return r&&r.name}};return{get name(){return n},get extend(){return s}}}});class yt extends n{static get[r](){return mt}get elementDef(){return this.get(wt)}}const bt=new s("bootstrap-context-registry");class _t extends a{constructor(){super(),this.provide({a:_t,is:this}),this.values=this.newValues()}static get[r](){return bt}static create(){return new _t}}const vt=new s("component-context-registry",{byDefault:me(()=>new xt)});class xt extends a{static get[r](){return vt}}const Ot=new s("definition-context-registry",{byDefault:me(e=>new kt(e))});class kt extends a{static get[r](){return Ot}}const Dt=Symbol("post-def-setup");function St(e){if(e.hasOwnProperty(Dt))return e[Dt];const n=t(),r=new $,s=n.read().thru(e=>e?d(e):m()),o=E(s,r),i=Ce(e,e=>Be in e);if(i){const e=St(i);o.to(t=>e.send(t))}const a={on:o,send(e){r.send(e)},setup(e){n.it=e}};return Object.defineProperty(e,Dt,{value:a}),a}class Ct{constructor(){const e=t(0),n=new $;this.onCreated=b(t=>{const r=e.it+1;n.on({supply:t.supply,receive:(e,n,s)=>{s<r&&t.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},n)}}),++e.it}),this.readNotifier=e.read().keepThru_(e=>(t,r)=>(n.send(t,r),e))}}const Et=new s("element-builder",{byDefault:me((function(e){const n=e.get(kt),r=e.get(xt),s=new $,o=new $;return{definitions:s,components:o,buildElement(e){var o;const u=He.of(e),c=new Ct;let h;const l=t(!1),p=l.read().thru(e=>e?d():m());let f;function g(){return r.append(h)}const w=new class extends ye{get componentType(){return f.componentType}get elementType(){return f.elementType}get elementDef(){return f.elementDef}mountTo(e){if(e[Ye])throw new Error(`Element ${e} already bound to component`);const t=a({definitionContext:f,whenComponent:c,registry:g(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends class{get component(){return this.context.component}get element(){return this.context.element}}{get context(){return t}get connected(){return 3===Tt(e).it}set connected(t){Tt(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),jt(t.context),t}};f=new class extends yt{constructor(){var t;super();const r=new kt(n.seedIn(this));r.provide({a:yt,is:this}),r.provide({a:ye,is:w}),this.get=r.newValues().get,h=new xt(r.seedIn(this));const s=this.whenReady().F,o=this.whenComponent().F,i={get componentType(){return e},get whenReady(){return s},get whenComponent(){return o},perDefinition:e=>r.provide(e),perComponent:e=>h.provide(e)};null===(t=u.setup)||void 0===t||t.call(u,i),St(e).setup(i)}get componentType(){return e}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}whenReady(e){return(this.whenReady=p.thru_(i(this)).once().F)(e)}whenComponent(e){return(this.whenComponent=c.onCreated.F)(e)}perComponent(e){return h.provide(e)}},null===(o=u.define)||void 0===o||o.call(u,f),s.send(f);const y=function(e,t,n){const r=e.get(wt);class s extends r.extend.type{constructor(){super(),jt(a({definitionContext:e,whenComponent:t,registry:n(),element:this,createMount:x,elementSuper:e=>super[e]}))}connectedCallback(){Tt(this).it=3}disconnectedCallback(){Tt(this).it=2}}return s}(f,c,g);return Object.defineProperty(f,"elementType",{configurable:!0,enumerable:!0,value:y}),l.it=!0,w}};function a({definitionContext:e,whenComponent:n,registry:r,element:s,createMount:i,elementSuper:a}){const u=t(0),c=t();let h;C(u).whenOff(e=>c.it=[e]);const l=r.newValues();const p=new class extends Ze{constructor(){super(...arguments),this.get=l.get,this.elementSuper=a}get componentType(){return e.componentType}get element(){return s}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return h||(h=i(this))}get connected(){return 3===u.it}get[U](){return C(u)}whenReady(e){return(this.whenReady=u.read().thru(e=>e?d(this):m()).once().F)(e)}whenOn(e){return(this.whenOn=u.read().thru_(e=>{if(3!==e)return m();const t=R();return this.whenOff().once(()=>t.off()).cuts(t),d(t)}).F)(e)}whenOff(e){return(this.whenOff=u.read().thru_(e=>2===e?d():m()).F)(e)}whenDestroyed(e){return(this.whenDestroyed=c.read().thru(e=>e?d(e[0]):m()).once().F)(e)}destroy(e){u.done(e)}};let f=0;p.whenDestroyed(()=>function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const r=t.parentElement;r&&r.removeChild(t)}(p)),r.provide({a:Ze,is:p}),Object.defineProperty(s,Ye,{value:p}),Object.defineProperty(s,Rt,{writable:!0,value:u}),n.readNotifier.once(e=>f=e(p,f)),p.whenOn(e=>{n.readNotifier.to({supply:e,receive(e,t){f=t(p,f)}})}),o.send(p);const g=function(e,t){const n=e.prototype,r=n[Ye];n[Ye]=t;try{const s=new e(t);return Object.defineProperty(s,Ye,{value:t}),s}finally{n[Ye]=r}}(e.componentType,p);return Object.defineProperty(p,"component",{configurable:!0,enumerable:!0,value:g}),u.it=1,p}}))}),Rt=Symbol("component-status");function Tt(e){return e[Rt]}function jt(e){e.whenOn().once(()=>e.dispatchEvent(new tt("wesib:component",{bubbles:!0})))}const At=i(x);class Pt{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(pt)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(Et).buildElement(e);e[ht]=t,this.customElements.define(e,t.elementType)})}}const Ut=Symbol("feature-key");class Ft extends u{static of(e){return e.hasOwnProperty(Ut)?e[Ut]:e[Ut]=new Ft(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){return t=e.context.get(ge),n=e.seed.keepThru(Lt),c(e=>{let r,s=h(),o=Promise.resolve("idle");return l({clause:n,deps:qt(t,n)}).keepThru_(({clause:[e],deps:n})=>{if(!e)return d();const[i,,a]=e;if(i.feature===r)return p(s);if(r=i.feature,a!==r)return p(s=t.get(Ft.of(r)).keepThru_(e=>(e.to(o),o=e.stage,e)));const u=new Mt(t,i,n).to(o),l=h(u);return p(s=c(e=>l.to(e).whenOff(()=>{o=u.unload()})).share())}).to(e)}).keepThru(function(){let e=null;return t=>e===t?m():(e=t,t?d(t):d())}());var t,n}}function Lt(...e){let t,n=!1;for(const r of e)switch(r[1]){case"is":n=!0,t||(t=r);break;case"has":t=r;break;case"needs":n=!0}return n?t:void 0}function qt(e,t){return t.keepThru_(t=>{if(!t)return d();const[{def:n}]=t,r=new Se(n.needs);return r.size?p(f(...g(r,t=>e.get(Ft.of(t)))).keepThru_(Nt)):d()})}function Nt(...e){return d(...w(g(e,e=>e[0]),N))}class Mt{constructor(e,n,r){this.bsContext=e,this.request=n,this.deps=r,this.state=t(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new Kt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class $t{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class Kt extends $t{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:n,request:{def:r}}=this.loader,[s,o]=function(e,n){const r=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:R(()=>{t=At,T(j(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();let s;const o=e.get(kt),i=e.get(xt),u=new a(e),c=e.get(Et);return[new class extends $e{constructor(){super(),this.get=u.newValues().get,u.provide({a:$e,is:this}),s=new Pt(this)}get feature(){return n.request.feature}whenReady(r){return(this.whenReady=l({st:n.state,bs:t().by(e.whenReady())}).thru(({st:[e],bs:[t]})=>t&&e?y(this):m()).once().F)(r)}onDefinition(e){return(this.onDefinition=c.definitions.on().tillOff(r.supply).F)(e)}onComponent(e){return(this.onComponent=c.components.on().tillOff(r.supply).F)(e)}provide(t){return r.add(()=>e.get(_t).provide(t))}perDefinition(e){return r.add(()=>o.provide(e))}perComponent(e){return r.add(()=>i.provide(e))}setupDefinition(e){return function(e,t){const{on:n}=St(e);return b(e=>{n.to({supply:e.supply.needs(t.supply),receive(n,r){const s=r.whenReady().tillOff(t.supply).F,o=r.whenComponent().tillOff(t.supply).F;e.receive(n,{get componentType(){return r.componentType},get whenReady(){return s},get whenComponent(){return o},perDefinition:e=>t.add(()=>r.perDefinition(e)),perComponent:e=>t.add(()=>r.perComponent(e))})}})})}(e,r)}define(e){s.define(e)}},r.supply]}(n,this.loader);return null===(e=r.setup)||void 0===e||e.call(r,s),new Bt(this.loader,s,()=>Promise.resolve(o.off()))}init(){return this.setup().then(e=>e.init())}}class Bt extends $t{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new zt(this)}}class zt extends $t{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class It{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=qe.of(e);if(Be in e){t=qe.merge(t,{init(t){t.define(e)}});const{feature:n}=He.of(e);n&&(t=qe.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,r=[this,"is",this.feature];return this._revokeBy(n.provide({a:Ft.of(this.feature),is:r})),new Se(this.def.has).forEach(r=>{const s=[this,"has",r];this._revokeBy(n.provide({a:Ft.of(r),is:s}));const o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse())}),new Se(this.def.needs).forEach(r=>{const s=[this,"needs",r],o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:Ft.of(r),is:s}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new Ke(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=Re(e,this._revoke)}}const Vt=new s("feature-requester",{byDefault:me(e=>new Ht(e))});class Ht{constructor(e){this._map=new Map,this.registry=e.get(_t)}static get[r](){return Vt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const r=new It(this,e,()=>this._map.delete(e));return this._map.set(e,r),r.request(t)}}function Wt(...e){const n=_t.create(),{bootstrapContext:r,complete:s}=function(e){const n=t(0),r=e.values;const s=new class extends ge{constructor(){super(),this.get=r.get,e.provide({a:ve,by:_}),e.provide({a:ge,is:this})}async whenDefined(e){return await this.whenReady(),await this.get(pt).whenDefined(e),lt(e)}whenReady(e){return(this.whenReady=n.read().thru(e=>e?d(this):m()).once().F)(e)}load(e){const n=c(n=>{const r=s.get(Ht).request(e),o=t({status:{feature:e,ready:!1}});this.get(Ft.of(e)).to({supply:n.supply,receive(e,t){const n=t;o.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{o.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{r.unuse()}),o.read(n)}).share();let r;const o=n.to(({down:e})=>{r=e});return new class extends class{[L](){return this.read()}}{get down(){return r}read(e){return(this.read=n.tillOff(o).keepThru(e=>e.status).F)(e)}dismiss(e){return o.off(e),r}}}};return{bootstrapContext:s,complete(){n.it=1}}}(n),o=1===e.length?e[0]:(i=e,qe.define(class{},{needs:i}));var i;return r.get(Ht).request(o),r.get(Ft.of(o)).to(e=>{e.init().then(s)}),r}const Qt=new v("attribute-descriptor"),Gt=Symbol("attribute");function Jt(e){return[Gt,e]}function Xt(e,t=!0){if(!1===t)return x;if(!0===t||"function"==typeof t){const n=Jt(e),r=!0===t?Yt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>Yt(e,t,n,r)}function Yt(e,t,n,r){Ze.of(e).updateState(t,n,r)}const Zt=new s("attribute-registry");class en{constructor(e){this._context=e}static get[r](){return Zt}get attrs(){if(this._attrs)return this._attrs;const e=new Map;return this._context.get(Qt).forEach(t=>{const{name:n,change:r}=t;e.set(n,Re(e.get(n),r))}),this._attrs=e}define(e){const t=this.attrs,n=Array.from(t.keys());n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,r){t.get(e)(Ze.of(this).component,r,n)}}))}mount(e){const t=e.element,n=this.attrs,r=Array.from(n.keys());r.length&&new(0,this._context.get(be).MutationObserver)(e=>e.forEach(e=>{const r=e.attributeName;return n.get(r)(Ze.of(t).component,t.getAttribute(r),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}const tn={setup(e){e.perDefinition({as:en}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(en).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(en).mount(t)})}};class nn{static get[Pe](){return tn}}function rn(e){return rt(({type:t,key:n})=>{const r=function(e,t,n){let r,s;if("string"==typeof n)r=n,s=Xt(r);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required as property key is not a string: "+`${e.constructor.name}.prototype.${String(t)}`);r=t}s=Xt(r,n&&n.updateState)}return{name:r,change:s}}(t.prototype,n,e),{name:s}=r;return{componentDef:{feature:{needs:nn},setup(e){e.perDefinition({a:Qt,is:r})}},get:e=>Ze.of(e).element.getAttribute(s),set(e,t){const{element:n}=Ze.of(e);null!=t?n.setAttribute(s,t):n.removeAttribute(s)}}})}function sn(e){return We({feature:{needs:nn},setup(t){const n=e=>{"string"==typeof e?t.perDefinition({a:Qt,is:{name:e,change:Xt(e)}}):Object.keys(e).forEach(n=>{t.perDefinition({a:Qt,is:{name:n,change:Xt(n,e[n])}})})};De(e)?e.forEach(n):n(e)}})}const on=new s("component-state");class an extends A{static get[r](){return on}}const un={setup(e){e.perComponent({a:an,by(e){const t=new an;return e.whenDestroyed(e=>t.done(e)),t}}),e.perComponent({a:Xe,by:e=>e.update,with:[an]})}};class cn{static get[Pe](){return un}}var hn;class ln extends P{constructor(e,t,n){super(),this._context=e,this._name=t,this._path=n,this[hn]=R()}get it(){return this._context.element.getAttribute(this._name)}set it(e){C(this).isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}on(e){return(this.on=this._context.get(an).track(this._path).onUpdate().thru((e,t,n)=>d(t,n)).tillOff(this).F)(e)}}function dn(e,t,n=Jt(t)){return new ln(e,t,n)}hn=U;const pn=Symbol("dom-property");const fn={render(e,t,n={}){const{offline:r,path:s=[]}=n,o=e.get(an).track(s),i=e.get(ke)();let a=0;const u=o.onUpdate(()=>{r||e.connected?c():a=0});function c(){a=1,i(l)}function h(){1===a&&(i(x),a=-1)}function l(e){if(!(a<0))for(a=2;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}r?c():e.whenOn(e=>{e.whenOff(h),a<=0&&c()}).whenOff(e=>{h(),u.off(e)})}};function gn(e){return rt(({get:t})=>({componentDef:{feature:{needs:cn},define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:r}=n;fn.render(n,t(r).bind(r),e)})})}}}))}const mn=new s("shadow-content-root");class wn extends Event{get shadowRoot(){return this.target.shadowRoot}}const yn=new O("shadow-root-builder"),bn={setup(e){e.provide({a:yn,is:vn})}};class _n{static get[Pe](){return bn}}function vn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[Ye]=e,e.whenOn().once(()=>e.dispatchEvent(new wn("wesib:shadowAttached",{bubbles:!0})))),n}const xn={mode:"open"};function On(e=xn){return We({setup(t){t.perComponent({a:mn,by:t=>t.get(yn)(t,e)}),t.perComponent({a:Je,by:e=>e.get(mn,{or:null})})},feature:{needs:_n}})}const kn=new k("https://wesib.github.io/ns","b","wesib");class Dn extends u{constructor(e){super(e),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return y(function(e){return(t,n)=>{const r=(n,s)=>{const o=e[n];return o?V(o((e=s)=>r(n+1,e),s)):t(s)};return r(0,n)}}(t));const n=()=>h(Sn);return p(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?h(e.or):e.or}:void 0).to(e=>t=e),(e,n)=>t(e,n)}}function Sn(e,t){return e(t)}const Cn=new Dn("http-fetch-agent"),En={};const Rn=new O("http-fetch",{byDefault:me((function(e){const t=e.get(be),n=e.get(Cn);return(e,t)=>n(r,new Request(e,t));function r(e){return b(n=>{const r=new $;let s;if("AbortController"in t){const o=new t.AbortController,{signal:i}=o;s=R(e=>{e===En&&o.abort()}),n.supply.whenOff(()=>s.off(En)).needs(s),r.on({supply:s,receive(e,t){n.receive(e,t)}});const a=e.signal;a&&(new S(a).on("abort").once(()=>o.abort()),a.aborted&&o.abort()),e=new Request(e,{signal:i})}else s=r.on(n);t.fetch(e).then(e=>{r.send(e),s.off()}).catch(e=>s.off(e))})}}))});const Tn=new s("hierarchy-root",{byDefault:e=>{const n=e.get(_e);return new S(n).on("wesib:component").to(({context:e})=>e.get(An).issue()),t()}}),jn=new s("hierarchy-updates",{byDefault:e=>new An(e.get(Ze))});class An{constructor(e){const t=new $,n=e.get(ge).get(Tn);this.on=t.on(),this.send=()=>t.send(e),this.issue=()=>{const t=Pn(e);t?t[0].get(An).send():n.it=e}}static get[r](){return jn}}function Pn(e){const t=e.get(ge).get(_e);let n=e.element,r=!0;if(n!==t)for(;;){const e=n.parentNode;if(!e)return;const s=e[Ye];if(s)return[s,r];if(e===t)return;r=!1,n=e}}const Un=new s("hierarchy-context",{byDefault:e=>new Ln(e.get(Ze))});class Fn extends n{static get[r](){return Un}}class Ln extends Fn{constructor(e){super(),this.context=e;const t=this._registry=(n=this.up(),new a(e=>n.keepThru(t=>t?p(t.get(e)):d())));var n;this.get=t.newValues().get}provide(e){return this._registry.provide(e)}up(e){return(this.up=c(e=>{const n=t(),r=R().needs(e.supply),s=R().needs(e.supply),o=()=>{const e=Pn(this.context);if(e){const[t,o]=e;n.it=t.get(Fn),r.off(),o&&s.off()}else n.it=void 0};this.context.get(ge).get(Tn).read({supply:r,receive:()=>this.context.connected&&o()}),n.read().tillOff(s).consume(e=>e&&e.context.get(An).on.to(o)),n.read(e),this.context.whenOn({supply:e.supply,receive:(e,t)=>{o(),t.whenOff(()=>{Promise.resolve().then(()=>this.context.connected||(n.it=void 0))})}})}).share().F)(e)}}const qn=new s("component-node");class Nn extends o{[z](){return this.onUpdate()}[L](){return this.read()}}const Mn={subtree:!0};function $n(e,t,n,r,{deep:s,all:i}){const a=new $,u=s?Mn:void 0;let h,l,p=new Set;const f=s?Kn:j;"string"==typeof n?l=n:e.whenDefined(n).then(({elementDef:{name:t}})=>{if(h=void 0,t&&(l=M.name(t,e.get(ve)),a.size)){const e=m();if(e.size){const t=Array.from(w(g(e,e=>r(e)),N));t.length&&a.send(t,[])}}}),i||t.addEventListener("wesib:component",e=>{const t=e.target;if(p.has(t)){const e=r(t);a.send([e],[])}});return new class extends Nn{onUpdate(n){const r=e.get(ct)(_);return(this.onUpdate=b(e=>{const n=!a.size,s=a.on(e);return n&&(m(),r.observe(t,u)),s.whenOff(()=>{a.size||r.disconnect()})}).F)(n)}read(e){return(this.read=Y(this.onUpdate().thru(()=>this),Z(this)).F)(e)}track(e){const t=this.onUpdate().thru((e,t)=>d(o.of(e),o.of(t)));return(this.track=c(e=>{const n=new $;n.on(e),n.send(this,o.of([])),t.to(e)}).F)(e)}first(e){return(this.first=K(this.read()).keepThru(e=>y(I(e))).F)(e)}[Symbol.iterator](){return H(h||(h=w(g(a.size?p:m(),e=>r(e)),N)))}};function m(){return h=void 0,p=function(){const e=l;if(!e)return new Set;if(s)return new Set(j(t.querySelectorAll(e)));return new Set(w(j(t.children),t=>t.matches(e)))}()}function _(e){const t=[],n=[];e.forEach(e=>{T(w(g(f(e.removedNodes),x),N),e=>n.push(e)),T(w(g(f(e.addedNodes),v),N),e=>t.push(e))}),(t.length||n.length)&&a.send(t,n)}function v(e){if(Te(e))return l&&e.matches(l)&&!p.has(e)?(p.add(e),r(e)):void 0}function x(e){if(Te(e)&&p.delete(e))return r(e,!0)}}function Kn(e){return F(j(e),e=>[e,...Kn(e.childNodes)])}class Bn{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(be).MutationObserver;return this._observer=new e(e=>this._update(e))}observe(e,t){const n=this,r=this.observer,s=this._emitter(e),o=W(t),i=s.on({supply:R(()=>{this._emitters.delete(e),r.disconnect(),this._emitters.size?a():this._observer=void 0}).needs(o.supply),receive:(e,t,n)=>o.receive(e,t,n)});return r.disconnect(),a(),i;function a(){n._update(r.takeRecords()),r.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:Array.from(n._emitters.keys())})}}_update(e){e.forEach(e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)})}_emitter(e){const t=new $;return this._emitters.set(e,t),t}}class zn extends P{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new $}get[U](){return C(this._updates)}get it(){return this._observer.element.getAttribute(this._name)}set it(e){null!=e?this._observer.element.setAttribute(this._name,e):this._observer.element.removeAttribute(this._name)}on(e){let t=ee();return(this.on=b(e=>{this._updates.size||(t=this._observer.observe(this._name,(e,t)=>this._updates.send(e,t))),e.supply.needs(t),this._updates.on(e).whenOff(e=>{this._updates.size||t.off(e)})}).F)(e)}}class In{constructor(e,t){this._attrs=new Map,this._observer=new Bn(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new zn(this._observer,e);return this._attrs.set(e,n),n}}class Vn extends P{constructor(e,t){super(),this._element=e,this._key=t,this._updates=new $}get[U](){return C(this._updates)}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}on(e){return(this.on=this._updates.on().F)(e)}bind(e){var t;e.get(an).track((t=this._key,[pn,t])).onUpdate().to({supply:C(this),receive:(e,t,n,r)=>this._updates.send(n,r)})}}class Hn{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach(t=>t.bind(e))}get(e){const t=this._props.get(e);if(t)return t;const n=new Vn(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const Wn=Symbol("element-node");class Qn{constructor(e,t){this._bs=e,this.element=t,this._attrs=new In(e,t),this._props=new Hn(t),t[Wn]=this;const n=t[Ye];n?this._bind(n):t.addEventListener("wesib:component",e=>this._bind(e.context))}get context(){return this.element[Ye]}get parent(){const e=this.element.parentNode;return e&&Gn(this._bs,e)}select(e,t){return function(e,t,n,r={}){if(r.all)return $n(e,t,n,(t,n)=>Gn(e,t,n),r);const s=e.get(ut);return $n(e,t,n,(t,n)=>s(t)&&Gn(e,t,n),r)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function Gn(e,t,n){const r=t[Wn];return r||n?r:new Qn(e,t)}const Jn={needs:cn,setup(e){e.perComponent({a:qn,by:e=>Gn(e.get(ge),e.element)})}};class Xn{static get[Pe](){return Jn}}function Yn(e){return new URL(e.hash.substring(1),e.origin)}const Zn=Symbol("page-param");class er{get[Zn](){return this}byDefault(e,t){}}class tr extends u{constructor(e){super(e),this.upKey=this.createUpKey(e=>{const{document:t}=e.context.get(be);return e.seed.keepThru((...n)=>{if(n.length)return y((function(e,r,s,o){return function o(i,a){const u=n[i];if(!u)return e(a);u(({url:e=a.url,title:n=a.title,data:r=a.data}=a)=>o(i+1,{url:new URL(String(e),t.baseURI),title:n,data:r,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}}),r,s,a)}(0,o)}));const r=()=>h(nr);return p(e.byDefault(r)||r())})})}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?h(e.or):e.or}:void 0).to(e=>t=e),(e,n,r,s)=>t(e,n,r,s)}}function nr(e,t,n,r){e(r)}const rr=new tr("navigation-agent"),sr=new s("navigation");class or{static get[r](){return sr}[z](){return this.on()}[L](){return this.read()}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}class ir extends n{}const ar=new s("nav-history",{byDefault:me(e=>new cr(e))});function ur(e){return null==e||"object"!=typeof e?{data:e}:e["wesib:navigation:data"]}class cr{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(be);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[r](){return ar}init(){const{data:e}=ur(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule(()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")}),t}newEntry(e){return new hr(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:r}}=e;this._history.pushState(this._historyState(e),n,r.href),this._enter("open",e,t)}_enter(e,t,n){const r=n.it;this._entries.set(t.id,t);try{for(let e=r.next;e;e=e.next)this._forget(e)}finally{t.prev=r,r.next=t,t.schedule(()=>{try{r.leave()}finally{t.enter(e)}}),n.it=t}}replace(e,t){const n=t.it,{page:{title:r="",url:s}}=e;this._history.replaceState(this._historyState(e),r,s.href),this._entries.set(e.id,e);const o=n.prev;o&&(e.prev=o,o.next=e),e.schedule(()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}}),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const r=t.it,{uid:s,data:o,id:i}=ur(n);let a;const u=s===this._uid&&null!=i?this._entries.get(i):void 0;return u?a=u:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),r.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule(()=>{try{r.leave()}finally{a.enter("return")}}),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,r=new hr(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"",t.href),this._entries.delete(n.id),e.it=r}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{"wesib:navigation:data":{uid:this._uid,id:e,data:t}}}}class hr{constructor(e,t,n,r){this._bsContext=e,this.id=t,this._status=0,this._update=x,this._params=r?r._params:new Map;const s=this;this.page={get url(){return n.url},get title(){return n.title},get data(){return n.data},get visited(){return!!s._status},get current(){return 2===s._status},get:e=>s.get(e),put(e,t){s.put(e,t)}}}get(e){const t=e[Zn],n=this._params.get(t);if(n)return n.get();const r=t.byDefault(this.page,this._newContext());return r&&this._init(t,r)}put(e,t){const n=e[Zn],r=this._params.get(n);return r?(r.put(t),r.get()):this._init(n,n.create(this.page,t,this._newContext()))}_newContext(){const e=new a(this._bsContext);return new class extends ir{constructor(){super(...arguments),this.get=e.newValues().get}}}_init(e,t){return this._params.set(e,t),this.page.current&&t.enter&&t.enter(this.page,"init"),t.get()}transfer(e,t){T(this._params.entries(),([n,r])=>{if(r.transfer){const s=r.transfer(e.page,t);s&&e._params.set(n,s)}})}stay(e){T(this._params.values(),t=>t.stay&&t.stay(e))}enter(e){this._status=2,T(this._params.values(),t=>t.enter&&t.enter(this.page,e))}leave(){this._status=1,T(this._params.values(),e=>e.leave&&e.leave())}forget(){T(this._params.values(),e=>e.forget&&e.forget()),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=x,e()}}class lr extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!1})),this.when=t.when,this.to=t.to}}class dr extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.when=t.when,this.from=t.from,this.to=t.to}}class pr extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}function fr(e){const n=e.get(be),{document:r,history:s}=n,o=new S(n),i=e.get(cr),a=e.get(rr),u=t(i.init());u.read(e=>e.apply());let c=Promise.resolve();o.on("popstate").to(e=>{const t=i.popState(e,u);t&&o.dispatch(new lr("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),o.on("hashchange").to(()=>{const e=i.hashChange(u);e&&o.dispatch(new lr("wesib:enterPage",{when:"enter",to:e.page}))});return new class extends or{get page(){return u.it.page}get length(){return s.length}onEnter(e){return(this.onEnter=o.on("wesib:enterPage").F)(e)}onLeave(e){return(this.onLeave=o.on("wesib:leavePage").F)(e)}onStay(e){return(this.onStay=o.on("wesib:stayOnPage").F)(e)}on(e){return(this.on=E(this.onEnter(),this.onLeave(),this.onStay()).F)(e)}read(e){return(this.read=u.read().keepThru(e=>e.page).F)(e)}go(e){s.go(e)}open(e){return d("pre-open","open",e)}replace(e){return d("pre-replace","replace",e)}update(e){return i.update(u,h(e)).page}with(e,t){return function e(t){return{with:(n,r)=>e(Re(t,e=>e.put(n,r))),open:e=>d("pre-open","open",e,t),replace:e=>d("pre-replace","replace",e,t),pretend(e,n=((e,t)=>t)){let r;"function"==typeof e?(n=e,r=void 0):r=e;const s=l(r),o=u.it,i=p("pretend",o,s,t);try{return f("pretend",o,s,i)?n(o.page,i.page):void 0}finally{i.stay(u.it.page)}}}}(n=>n.put(e,t))}};function h(e){return"string"==typeof e?new URL(e,r.baseURI):e||u.it.page.url}function l(e){return null==e||"string"==typeof e||e instanceof URL?{url:h(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:h(e.url)})}function d(e,t,n,r=x){const s=l(n),a=c=c.then(h,h);return a;function h(){let n=void 0;try{const h=function(){if(c!==a)return d();const t=u.it,n=p(e,t,s,r),i=new dr("wesib:leavePage",{when:e,from:t.page,to:n.page});if(!o.dispatch(i)||c!==a||!f(e,t,s,n))return d(n);return n}();return h?(n=h,i[t](n,u),o.dispatch(new lr("wesib:enterPage",{when:t,to:n.page})),n.page):h}catch(e){throw d(n,e),e}}function d(e,t){return e&&e.stay(u.it.page),o.dispatch(new pr("wesib:stayOnPage",{from:u.it.page,to:s,reason:t})),null}}function p(e,t,n,r){const s=i.newEntry(n);try{t.transfer(s,e),r(s.page)}catch(e){throw s.stay(u.it.page),e}return s}function f(e,t,n,r){let s=!1;return a(({url:e,data:t,title:r})=>{s=!0,n.url=e,n.data=t,n.title=r},e,t.page,r.page),s}}const gr={setup(e){e.provide({a:or,by:fr})}};class mr{static get[Pe](){return gr}}function wr(e={}){const{select:t="a",pick:n={all:!0,deep:!0}}=e;return We({feature:{needs:[Xn,mr]},define(r){r.whenComponent(r=>{const s=function(e,t){const n=e.get(ke),{active:r=xr}=t,s=B.name(r,e.get(ve)),o=t.activate?t.activate.bind(t):x;return e=>{const{element:t}=e.node,r=t[vr]||(t[vr]=n({node:t})),i=t=>{r(()=>((e,{node:t})=>{const n=t.element,{classList:r}=n;e?r.add(s):r.remove(s)})(t,e)),o(t,e)};let a;return i(!0),{supply(){const e=a=R(()=>{a===e&&i(!1)});return e}}}}(r,e),o=function(e){if(!e.weigh)return yr;return t=>{const n=e.weigh(t);if("number"==typeof n)return h(t.node,n);let r=K(n).keepThru_(e=>d(t.node,e));return c(e=>{r.to({supply:R().needs(e.supply).whenOff(()=>{r=h(t.node,0),r.to(e)}),receive:e.receive.bind(e)})})}}(e),i=r.get(or),a=r.get(qn);r.whenOn(e=>{let u=new Map;i.read().tillOff(e).consume(e=>a.select(t,n).read().keepThru_(t=>p(f(...t.map(t=>o({node:t,context:r,page:e}))))).consume((...t)=>{const n=function(e){let t=0,n=[];return e.forEach(([e,r])=>{r>t?(t=r,n=[e]):r===t&&n.push(e)}),n}(t),o=new Map,i=R();return n.forEach(t=>{let n;const a=u.get(t);a?(o.set(t,a),n=a):(n=s({node:t,context:r,page:e}),o.set(t,n)),n.supply().needs(i)}),u=o,i}))})})}})}function yr({node:e,page:t}){const n=e.element,r=n.getAttribute("href");if(null==r)return h(e,-1);const s=new URL(r,n.ownerDocument.baseURI);return h(e,function e(t,n){if(t.origin!==n.origin)return-1;const r=br(t),s=br(n);if(t.hash){if(r!==s)return-1;const o=_r(t,n);return o<0||_r(n,t)<0?-1:t.pathname.length+o+e(Yn(t),Yn(n))}const o=_r(t,n);if(o)return o<0||r!==s?-1:t.pathname.length+o;if(!s.startsWith(r))return-1;return t.pathname.length}(s,t.url))}function br(e){const t=e.pathname;return t.endsWith("/")?t:t+"/"}function _r({searchParams:e},{searchParams:t}){let n=0;return e.forEach((r,s)=>{if(!function(e){return e.startsWith("__")&&e.endsWith("__")}(s)){const r=new Set(t.getAll(s));n>=0&&(e.getAll(s).every(e=>r.has(e))?n+=1:n=-1)}}),n}const vr=Symbol("nav-link-render-schedule"),xr=["active",kn];function Or(e={}){const t=e.handle?e.handle.bind(e):function(e){const t=e.href?e.href.bind(e):kr;return({event:e,page:n,navigation:r})=>{const s=t(e);if(null==s)return;const o=e.target,i=n.url,a=new URL(s,o.ownerDocument.baseURI);a.origin===i.origin&&(e.preventDefault(),i.href!==a.href&&r.open(s))}}(e),n=new Se(e.event||"click");return We({feature:{needs:mr},define(e){e.whenComponent(e=>{e.whenOn(r=>{const s=e.get(or);n.forEach(n=>{e.on(n).to({supply:r,receive(n,r){s.read().once(n=>t({event:r,page:n,context:e,navigation:s}))}})})})})}})}function kr(e){return e.target.getAttribute("href")}function Dr(e,t,n,r=Sr){let s;"function"==typeof n?(r=n,s=null):s=n||null;const o=t.ownerDocument;if(Te(e)){const n=o.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach(t=>n.setAttribute(t,e.getAttribute(t))),r(e,n),t.insertBefore(n,s),n}const i=o.importNode(e,!1);return t.insertBefore(i,s),i}function Sr(e,t){T(j(e.childNodes),e=>Dr(e,t))}function Cr(e){let n;return r=>{const s=function(e){return new URL("",e.url).href}(r);if(n){if(n.url===s)return n.on;n.sup.off()}let o;const i=R().whenOff(()=>{n=void 0,o=void 0}),a=b(n=>{if(!o){const n=e(r),s=t(),a=n.to(e=>{s.it=e}).whenOff(e=>{null!=e&&i.off(e)});i.cuts(a).cuts(s),o={on:s.read().thru_(e=>e?d(e):m()),num:0}}const s=o;return++s.num,s.on.tillOff(i).to(n).whenOff(e=>{--s.num||Promise.resolve().then(()=>{s.num||s!==o||i.off(e)})})});return n={url:s,on:a,sup:i},a}}class Er extends Error{}const Rr=new class extends er{create(e,t){return{get:()=>t,put:x}}};class Tr{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map}get fragments(){const e=[];for(const t of this){if(!t.fragment)return[];e.push(t.fragment)}return e}[Symbol.iterator](){return H(F(this._map.values()))}handle(){const e=this,t=R();let n=ee();return{get(){},put(t){e._add(t)},transfer(t,n){if("pretend"===n)return;const r=e._transfer();return t.put(Rr,r),r.handle()},enter(r,s){if("init"===s)return;n=R().needs(t);const o=b(t=>{const s=new $,o=s.on(t);return e._loader(r).tillOff(n).to(e=>s.send(e)).whenOff(e=>{void 0===e||e instanceof Er||s.send({ok:!1,page:r,error:e})}),o}).share();T(e,({fragment:e,receiver:t})=>function(e,t){return t?e.thru_(e=>e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e):e}(o,e).to({supply:R().needs(t.supply),receive(e,n){t.receive(e,n)}}))},leave(){n.off(new Er("page left"))},stay(){t.off(new Er("navigation cancelled"))},forget(){t.off(new Er("page forgotten"))}}}_add(e){const t=Object.assign(Object.assign({},e),{receiver:W(e.receiver)}),{supply:n}=t.receiver,r=this._map.get(n);r?r.push(t):(this._map.set(n,[t]),n.whenOff(()=>this._map.delete(n)))}_transfer(){const e=new Tr(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,Array.from(n));return e}}const jr=new Dn("page-load-agent"),Ar=new O("page-load-url",{byDefault:i(x)}),Pr=new s("page-loader",{byDefault:me((function(t){const n=t.get(be),r=t.get(Rn),s=t.get(Ar),o=t.get(jr),i=new n.DOMParser;return t=>{const n=new URL(t.url.href);s(n);const a=new Request(n.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return b(e=>o(u,a).to(e));function u(s){return function(t,n){var r;const s=null===(r=t.get(Rr))||void 0===r?void 0:r.fragments;s&&s.length&&n.headers.set("Accept-Fragment",e(s,(e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+J(t.tag):"id="+J(t.id)),""))}(t,s),b(e=>{const o=new te;o.on(e),o.send({page:t}),Q(r(s).thru_(e=>Promise.all([e,e.text()]))).thru_((...e)=>G(e),([e,r])=>{if(!e.ok)return{ok:!1,page:t,response:e,error:e.status};try{return{ok:!0,page:t,response:e,document:Ur(i,n,e,r)}}catch(n){return{ok:!1,page:t,response:e,error:n}}}).to(e)})}}}))});function Ur(e,t,n,r){const s=e.parseFromString(r,X(n.headers.get("Content-Type")||"text/html")[0].v);if(s.head){const e=s.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=s.createElement("base");e.href=t.href,s.head.appendChild(e)}}return s}class Fr extends er{create(e,t,n){const r=new Tr(n.get(or),Cr(n.get(Pr))),s=r.handle();return e.put(Rr,r),s.put(t),s}}const Lr=new Fr,qr=new s("page-cache-buster",{byDefault:me(e=>new Nr(e))});class Nr{constructor(e){const t=Mr(e.get(be).document);if(t){const n=e.get(or);this.urlModifier=h(e=>e.searchParams.set("__wesib_app_rev__",t)),this.agent=h((e,r)=>e(new Request(r.url,r)).thru_(e=>{if(e.ok){const r=Mr(e.document);if(r&&r!==t){const t=new URL(e.page.url.href);t.searchParams.set("__wesib_app_rev__",r),n.update(t),n.reload()}}return e}))}else this.urlModifier=h(),this.agent=h()}static get[r](){return qr}}function Mr(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function $r(e){const t=e.get(be).document;return e=>e().thru_(e=>{if(e.ok){const n=new Set(g(Kr(t,j(t.scripts)),([e])=>e));T(w(Kr(e.document,j(e.document.querySelectorAll("script"))),([e])=>!n.has(e)),([e,r])=>{Dr(r,t.head,(t,n)=>n.src=e),n.add(e)})}return e})}function Kr(e,t){return g(w(t,e=>!!e.src),t=>[new URL(t.src,e.baseURI).href,t])}function Br(e){const t=e.get(be).document;return e=>e().thru_(e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let r=t.head,s=null;const o=t.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(r=a.parentNode,s=a,T(j(o),e=>i.set(new URL(e.href,t.baseURI).href,e))),T(j(n),e=>{const n=new URL(e.href,t.baseURI).href,o=i.get(n);o?(I(i.keys())===n?(r=o.parentNode,s=o.nextSibling):r.insertBefore(o,s),i.delete(n)):Dr(e,r,s,(e,t)=>t.href=n)}),T(i.values(),e=>e.parentNode.removeChild(e)),e})}function zr(e){const t=e.get(be).document;return e=>e().thru_(e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})}const Ir={needs:mr,setup(e){e.provide({a:Ar,by:e=>e.urlModifier,with:[Nr]}),e.provide({a:jr,by:e=>e.agent,with:[Nr]}),e.provide({a:jr,by:$r}),e.provide({a:jr,by:Br}),e.provide({a:jr,by:zr})}};class Vr{static get[Pe](){return Ir}}function Hr(e={}){const t=e.onResponse?e.onResponse.bind(e):x,n=e.contentKey?e.contentKey.bind(e):Wr;return We({feature:{needs:Vr},define(r){r.whenComponent(r=>{const s=r.get(be).document,o=r.get(ke)(),i=r.get(or);let a=n(i.page);const u=()=>{const{fragment:t}=e;if(t)return t;const{element:{id:n,tagName:s}}=r;return n?{id:n}:{tag:s}};r.whenOn(e=>{const c=s.createRange();c.selectNodeContents(r.contentRoot),i.read().once(i=>{i.put(Lr,{fragment:u(),receiver:{supply:e,receive:(e,i)=>function(e){const i=n(e.page);if(i===a)return;if(!e.ok)return void o(()=>t({context:r,range:c,response:e}));a=i,o(()=>{c.deleteContents();const n=s.createDocumentFragment(),{fragment:o}=e;o&&(Sr(o,n),c.insertNode(n)),t({context:r,range:c,response:e})})}(i)}})})})})}})}function Wr({url:e}){return new URL("",e).href}const Qr=new s("component-style-producer"),Gr=new v("component-styp-renderer"),Jr=new k("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Xr=new s("unique-element-class",{byDefault:function(e){const t=e.get(ve),n=e.get(Ze),r=n.get(wt),s=`${r.name?M.name(r.name,t):"component"}#${++Yr}`,o=Jr.name(t(Jr),s,B);return n.element.classList.add(o),o}});let Yr=0;const Zr=new s("component-style-producer:impl");class es{constructor(e,t=ie){this._context=e,this._produce=t}static get[r](){return Zr}produce(e,t={}){const n=this._context,r=n.get(mn,{or:null});return this._produce(e,Object.assign(Object.assign({},t),{document:t.document||n.get(be).document,parent:t.parent||n.contentRoot,rootSelector:[],scheduler:t.scheduler||n.get(ke),nsAlias:t.nsAlias||n.get(ve),renderer:function(){const{renderer:e}=t,s=new Se(e).add(...n.get(Gr)),o=t.hostSelector?ae(t.hostSelector)[0]:void 0;return s.add(r?ts(o):ns(o||{c:[n.get(Xr)]})),s.value}()}))}}function ts(e){return{order:-100,render(t,n){let{selector:r}=t;if(r.length){if(e){const[t,n]=rs(r);n&&(r=n.length?[{u:[[":","host",ss(n,e)]]},...t]:[{u:[[":","host",[e]]]},...t])}}else r=[e||{u:[[":","host"]]}];t.render(n,{selector:r})}}}function ns(e){return{order:-100,render(t,n){let{selector:r}=t;if(r.length){const[t,n]=rs(r);r=n&&n.length?[...ss(n,e),...t]:[e,...t]}else r=[e];t.render(n,{selector:r})}}}function rs(e){if("string"!=typeof e[0]){const[{ns:t,e:n,i:r,c:s,u:o,s:i,$:a},...u]=e;if(!t&&!n&&!r&&!s&&!i&&o){const[[e,t,...n]]=o;if(":"===e&&"host"===t){let e;return n.length?(e=Array.from(n[0]),e[0].$=a):e=a?[{$:a}]:[],[u,e]}}}return[e]}function ss(e,{ns:t,e:n,i:r,c:s,u:o,s:i}){const[a,...u]=e;return[{ns:a.e||a.ns?a.ns:t,e:a.e||a.ns?a.e:n,i:a.i||r,c:a.c?s?[...a.c,...s]:a.c:s,u:a.u?o?[...a.u,...o]:a.u:o,s:(a.s||"")+(i||"")||void 0,$:a.$},...u]}const os={setup(e){e.perComponent({as:es}),e.perComponent({a:Qr,by:e=>(t,n)=>e.produce(t,n),with:[es]})}};class is{static get[Pe](){return os}}const as={produce(e,t,n){const r=se(t),s=n&&n.offline,o=e.get(Qr);let i,a=ee();const u=R(()=>{i=x}).cuts(a);switch(i=()=>{a=o(r,n).needs(u)},s){case"always":e.whenReady(i);break;case!1:e.whenOn(e=>{i(),a.needs(e)});break;default:e.whenOn().once(i)}return e.whenDestroyed(e=>u.off(e)),u}};function us(e){return rt(({get:t})=>({componentDef:{feature:{needs:is},define(n){n.whenComponent(n=>{n.whenReady(({component:r})=>{const s=t(r),o="function"==typeof s?s.bind(r):s;as.produce(n,o,e)})})}}}))}const cs={has:is,setup(e){e.perComponent({a:es,by:e=>new es(e,oe)}),e.perComponent({a:Qr,by:e=>(t,n)=>e.produce(t,n),with:[es]})}};class hs{static get[Pe](){return cs}}const ls=new s("theme");class ds{static get[r](){return ls}ref(e){return e(this.root)}}const ps=new s("theme-factory");class fs{static get[r](){return ps}}const gs=new class extends ne{constructor(){super("theme-style")}grow(e){const t=new Map;return e.seed.forEach(e=>{let n,r,s;"function"==typeof e?(n=r=e,s=!0):(n=e.style,r=e.provide.bind(e),s=!1);const o=t.get(n);if(o){const[e,i]=o;t.set(n,[s?ms(r,e):ms(e,r),s||i])}else t.set(n,[r,s])}),t.size?n:e.byDefault(()=>n);function n(e){const n=t.get(e);if(!n)return e;const[r,s]=n;return s?r:ms(e,r)}}};function ms(e,t){return n=>re(e(n),t(n))}class ws extends ds{constructor(e){super(),this._styles=e,this.root=ue(),this._rules=new Map}style(...e){const t=this;return se(...e.reduce((function(e,n){const r=t._rules.get(n);if(r)e.push(r);else{const r=t._styles(n)(t);t._rules.set(n,r),e.push(r)}return e}),[]))}}class ys extends fs{constructor(e){super(),this._styles=e}newTheme(){return new ws(this._styles)}}const bs={needs:is,setup(e){e.provide({a:fs,as:ys,with:[gs]}),e.provide({a:ds,by:e=>e.newTheme(),with:[fs]})}};class _s{static get[Pe](){return bs}}class vs extends u{get upKey(){return this}constructor(){super("default-in-aspects")}grow(e){const t=e.context.get(ve);return l({scheduler:e.context.get(ke[r].upKey),fns:e.seed}).keepThru(({scheduler:[e],fns:n})=>le(...n,pe.to(e),de.to(t)))}}const xs=new vs,Os=new he("input-from-control",{byDefault:()=>({})});function ks(e,t){const n=e.get(Fn).provide({a:Os,by:()=>({root:e,control:t})});return R(n).needs(t)}function Ds(e){return We({define(t){t.whenComponent(t=>{const{up:n}=t.get(Fn);l({parent:n().keepThru_(e=>e?p(e.get(Os)):y({})),aspects:t.get(xs)}).keepThru_(({parent:[n],aspects:[r]})=>{if(n.control){const s=e({control:n,context:t,aspects:r});if(s)return s instanceof ce?d(s):p(s)}return d()}).consume((e,n)=>{if(!e)return;const r=ks(t,e);return(n||C(e)).needs(r),r})})}})}export{sn as A,ge as B,We as C,xs as D,Ne as F,Or as H,Hr as I,us as P,gn as R,hs as S,ds as T,kn as W,Ds as a,Xn as b,_s as c,wr as d,Vr as e,Wt as f,rn as g,On as h,be as i,qn as j,ks as k,dn as t};//# sourceMappingURL=wesib.45ff9dcd.m.js.map
