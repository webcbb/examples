import{S as e,C as t,a as n,b as s,i as r,t as o,F as i,n as a,A as u,c,d as h,e as l,f as d,g as p,h as f,j as g,m,k as w,l as y,o as b,p as _,q as v,r as x,N as O,s as k,D as S,u as C,v as D,E as R,w as E,x as P,y as j,z as A,V as T,B as U,G as q,H as N,I as L,J as M,K as $,L as I,O as z,M as B,P as K,Q as V,R as F,T as H,U as Q,W,X as G,Y as J,Z as X,_ as Y,$ as Z,a0 as ee,a1 as te,a2 as ne,a3 as se,a4 as re,a5 as oe,a6 as ie,a7 as ae,a8 as ue,a9 as ce,aa as he,ab as le}from"./lib.4fbb81b4.m.js";const de=new e("bootstrap-context");class pe extends s{static get[n](){return de}}function fe(e){return(t,n)=>{const s=t.get(pe);return t===s?e(s,n):s.get(n)}}const ge=new e("component-factory");class me{static get[n](){return ge}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const we=new e("window",{byDefault:()=>window}),ye=new e("bootstrap-root",{byDefault:e=>e.get(we).document.body}),be=new e("default-namespace-aliaser"),_e=new i("default-render-scheduler",{byDefault:fe(e=>(t={})=>a(Object.assign(Object.assign({},t),{window:t.window||e.get(we)})))});function ve(e){return Array.isArray(e)}class xe extends u{constructor(e){super(),this.items=null==e?new Set:ve(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:ve(e)?this.add(...e):this.add(e)}}function Oe(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const s=n.constructor;return t(s)?s:Oe(s,t)}function ke(e,t,n=((e,t)=>t)){return e?t?function(...s){return n(e.apply(this,s),t.apply(this,s))}:e:t}function Se(e){return e.nodeType===Node.ELEMENT_NODE}class Ce{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=Oe(e),s=n&&this.of(n);return t?s?this.merge([s,t]):t:s}define(e,t){const n=this.own(e),s=m(t,t=>this.meta(t,e)),r=this.merge(n?q([[n],s]):s);return Object.defineProperty(e,this.symbol,{configurable:!0,value:r}),e}}class De{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const Re=Symbol("feature-def");class Ee extends Ce{constructor(){super(Re)}merge(e){return r(e,(e,t)=>({needs:new xe(e.needs).merge(t.needs).value,has:new xe(e.has).merge(t.has).value,setup:ke(e.setup,t.setup),init:ke(e.init,t.init)}),{})}meta(e,t){const n=e[Re];return null==n?e:this.meta("function"==typeof n?e[Re](t):n,t)}}const Pe=new Ee,je={[Re]:()=>({})},Ae={of:e=>Pe.of(e)||{},for:(e,t)=>Pe.meta(t,e),merge:(...e)=>Pe.merge(e),all:(...e)=>r(e,(e,t)=>({[Re]:n=>Ae.merge(Ae.for(n,e),Ae.for(n,t))}),je),define:(e,...t)=>Pe.define(e,t)};function Te(...e){return t=>Ae.define(t,...e)}const Ue=new e("feature-context");class qe extends pe{static get[n](){return Ue}whenDefined(e){return this.get(pe).whenDefined(e)}load(e){return this.get(pe).load(e)}}class Ne extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,s])=>(e||t.name)+` ${n} ${s.name}`,"")),this.needs=e}}const Le=Symbol("component-def");class Me extends Ce{constructor(){super(Le)}merge(e){return r(e,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:ke(e.setup,t.setup),define:ke(e.define,t.define),feature:e.feature?t.feature?Ae.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[Le];return null!=n?this.meta("function"==typeof n?e[Le](t):n,t):null!=e[Re]?{feature:Ae.for(t,e)}:k(e)?{name:e}:e}}const $e=new Me,Ie={[Le]:()=>({})},ze={of:e=>$e.of(e)||{},for:(e,t)=>$e.meta(t,e),merge:(...e)=>$e.merge(e),all:(...e)=>r(e,(e,t)=>({[Le]:n=>ze.merge(ze.for(n,e),ze.for(n,t))}),Ie),define:(e,...t)=>$e.define(e,t)};function Be(...e){const t=t=>ze.define(t,...e);return t[Le]=()=>ze.all(...e),t}const Ke=new e("component-context"),Ve=new e("component-event-dispatcher",{byDefault(e){const t=e.get(Ke),n=new S(t.element);return C(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Fe=new e("content-root",{byDefault:e=>e.get(Ke).element}),He=new i("state-updater",{byDefault:D(v)}),Qe=Symbol("component-context");class We extends s{constructor(){super(...arguments),this.updateState=Ge.bind(this)}static get[n](){return Ke}static of(e){const t=e[Qe];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(Fe)}on(e){return this.get(Ve).on(e)}dispatchEvent(e){this.get(Ve).dispatch(e)}}function Ge(e,t,n){this.get(He)(e,t,n)}class Je extends Event{get context(){return We.of(this.target)}}class Xe extends c{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keep.thru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),Ye),s=()=>l(Ye);return n!==Ye?n:f(e.byDefault(s)||s())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?l(e.or):e.or}:void 0)(e=>t=e),e=>t(e)}}function Ye(e){return e[Qe]}const Ze=new Xe,et=new i("element-observer",{byDefault:fe(e=>{const t=e.get(Ze);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{j(A(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[Qe])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),j(y(A(e.addedNodes),Se),e=>{var n,s;return null===(s=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===s?void 0:s.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const tt=Symbol("component-factory");function nt(e){const t=e[tt];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const st=new e("custom-elements",{byDefault:function(e){const t=e.get(we).customElements,n=e.get(be);return new class extends rt{define(e,s){if(k(e))return void t.define(M.name(e,n),s);const r=nt(e),{name:o,extend:i}=r.elementDef;o?i&&i.name?t.define(M.name(o,n),s,{extends:i.name}):t.define(M.name(o,n),s):it(e).resolve(void 0)}whenDefined(e){if(k(e))return t.whenDefined(M.name(e,n));const s=nt(e),{name:r}=s.elementDef;return r?t.whenDefined(M.name(r,n)):it(e).promise}}}});class rt{static get[n](){return st}}const ot=Symbol("component-resolver");function it(e){return e[ot]||(e[ot]=new De)}const at=new e("definition-context"),ut=new e("element-def",{byDefault(e){const t=e.get(at).componentType,{name:n,extend:s}=ze.of(t),r={get type(){return s&&s.type||e.get(we).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return r}}}});class ct extends s{static get[n](){return at}get elementDef(){return this.get(ut)}}const ht=new e("bootstrap-context-registry");class lt extends t{constructor(){super(),this.provide({a:lt,is:this}),this.values=this.newValues()}static get[n](){return ht}static create(){return new lt}}const dt=new e("component-context-registry",{byDefault:fe(()=>new pt)});class pt extends t{static get[n](){return dt}}const ft=new e("definition-context-registry",{byDefault:fe(e=>new gt(e))});class gt extends t{static get[n](){return ft}}const mt=Symbol("post-def-setup");function wt(e){if(e.hasOwnProperty(mt))return e[mt];const t=o(),n=new R,s=t.read.thru(e=>e?p(e):w()),r=E(s,n),i=Oe(e,e=>Le in e);if(i){const e=wt(i);r(t=>e.send(t))}const a={on:r,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,mt,{value:a}),a}class yt{constructor(){const e=o(0),t=new R;this.onCreated=b(n=>{const s=e.it+1;t.on({supply:n.supply,receive:(e,t,r)=>{r<s&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read.keep.thru_(e=>(n,s)=>(t.send(n,s),e))}}const bt=new e("element-builder",{byDefault:fe((function(e){const t=e.get(gt),n=e.get(pt),s=new R,r=new R;return{definitions:s,components:r,buildElement(e){var r,a;const u=ze.of(e),c=new yt;let h;const l=o(!1),d=l.read.thru(e=>e?p():w());let f;function g(){return n.append(h)}const m=new class extends me{get componentType(){return f.componentType}get elementType(){return f.elementType}get elementDef(){return f.elementDef}mountTo(e){if(e[Qe])throw new Error(`Element ${e} already bound to component`);const t=i({definitionContext:f,whenComponent:c,registry:g(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends class{get component(){return this.context.component}get element(){return this.context.element}}{get context(){return t}get connected(){return 3===vt(e).it}set connected(t){vt(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),xt(t.context),t}};f=new class extends ct{constructor(){var n,s;super();const r=this;this.whenReady=d.thru_(D(this)).once;const o=new gt(t.seedIn(this));o.provide({a:ct,is:this}),o.provide({a:me,is:m}),this.get=o.newValues().get,h=new pt(o.seedIn(this));const i={get componentType(){return e},get whenReady(){return r.whenReady},get whenComponent(){return r.whenComponent},perDefinition:e=>o.provide(e),perComponent:e=>h.provide(e)};null===(s=(n=u).setup)||void 0===s||s.call(n,i),wt(e).setup(i)}get componentType(){return e}get whenComponent(){return c.onCreated}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}perComponent(e){return h.provide(e)}},null===(a=(r=u).define)||void 0===a||a.call(r,f),s.send(f);const y=function(e,t,n){const s=e.get(ut);class r extends s.extend.type{constructor(){super(),xt(i({definitionContext:e,whenComponent:t,registry:n,element:this,createMount:v,elementSuper:e=>super[e]}))}connectedCallback(){vt(this).it=3}disconnectedCallback(){vt(this).it=2}}return r}(f,c,g());return Object.defineProperty(f,"elementType",{configurable:!0,enumerable:!0,value:y}),l.it=!0,m}};function i({definitionContext:e,whenComponent:t,registry:n,element:s,createMount:i,elementSuper:a}){const u=o(0),c=o();u.on(v).whenOff(e=>c.it=[e]);const h=c.read.thru(e=>e?p(e[0]):w()).once,l=u.read.thru_(e=>2===e?p():w()),d=u.read.thru_(e=>{if(3!==e)return w();const t=P();return l.once(()=>t.off()),p(t)});let f;const g=n.newValues();const m=new class extends We{constructor(){super(),this.get=g.get,this.elementSuper=a;const e=u.read.thru(e=>e?p(this):w());this.whenReady=e.once}get componentType(){return e.componentType}get element(){return s}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return f||(f=i(this))}get connected(){return 3===u.it}get[U](){return C(u)}get whenOn(){return d}get whenOff(){return l}get whenDestroyed(){return h}destroy(e){u.done(e)}};let y=0;m.whenDestroyed(()=>function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const s=t.parentElement;s&&s.removeChild(t)}(m)),n.provide({a:We,is:m}),Object.defineProperty(s,Qe,{value:m}),Object.defineProperty(s,_t,{writable:!0,value:u}),t.readNotifier.once(e=>y=e(m,y)),m.whenOn(e=>{t.readNotifier({supply:e,receive(e,t){y=t(m,y)}})}),r.send(m);const b=function(e,t){const n=e.prototype,s=n[Qe];n[Qe]=t;try{const r=new e(t);return Object.defineProperty(r,Qe,{value:t}),r}finally{n[Qe]=s}}(e.componentType,m);return Object.defineProperty(m,"component",{configurable:!0,enumerable:!0,value:b}),u.it=1,m}}))}),_t=Symbol("component-status");function vt(e){return e[_t]}function xt(e){e.whenOn.once(()=>e.dispatchEvent(new Je("wesib:component",{bubbles:!0})))}const Ot=D(v);class kt{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(rt)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(bt).buildElement(e);e[tt]=t,this.customElements.define(e,t.elementType)})}}const St=Symbol("feature-key");class Ct extends c{static of(e){return e.hasOwnProperty(St)?e[St]:e[St]=new Ct(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){return t=e.context.get(pe),n=e.seed.keep.thru(Dt),h(e=>{let s,r=l(),o=Promise.resolve("idle");return d({clause:n,deps:Rt(t,n)}).keep.thru_(({clause:[e],deps:n})=>{if(!e)return p();const[i,,a]=e;if(i.feature===s)return f(r);if(s=i.feature,a!==s)return f(r=t.get(Ct.of(s)).keep.thru_(e=>(e.to(o),o=e.stage,e)));const u=new Pt(t,i,n).to(o),c=l(u);return f(r=h(e=>c(e).whenOff(()=>{o=u.unload()})).share())})(e)}).keep.thru(function(){let e=null;return t=>e===t?w():(e=t,t?p(t):p())}());var t,n}}function Dt(...e){let t,n=!1;for(const s of e)switch(s[1]){case"is":n=!0,t||(t=s);break;case"has":t=s;break;case"needs":n=!0}return n?t:void 0}function Rt(e,t){return t.keep.thru_(t=>{if(!t)return p();const[{def:n}]=t,s=new xe(n.needs);return s.size?f(g(...m(s,t=>e.get(Ct.of(t)))).keep.thru_(Et)):p()})}function Et(...e){return p(...y(m(e,e=>e[0]),L))}class Pt{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=o(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new At(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class jt{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class At extends jt{get after(){return"idle"}async setup(){var e,n;await this.perDep(e=>e.setup());const{bsContext:s,request:{def:r}}=this.loader,[i,a]=function(e,n){const s=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:P(()=>{t=Ot,j(A(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();let r;const i=e.get(gt),a=e.get(pt),u=new t(e),c=e.get(bt),h=c.definitions.on.tillOff(s.supply),l=c.components.on.tillOff(s.supply);return[new class extends qe{constructor(){super(),this.get=u.newValues().get;const t=d({st:n.state,bs:o().by(e.whenReady)}).thru(({st:[e],bs:[t]})=>t&&e?p(this):w());this.whenReady=t.once,u.provide({a:qe,is:this}),r=new kt(this)}get feature(){return n.request.feature}get onDefinition(){return h}get onComponent(){return l}provide(t){return s.add(()=>e.get(lt).provide(t))}perDefinition(e){return s.add(()=>i.provide(e))}perComponent(e){return s.add(()=>a.provide(e))}setupDefinition(e){return function(e,t){const{on:n}=wt(e);return b(e=>{n({supply:e.supply.needs(t.supply),receive(n,s){const r=s.whenReady.tillOff(t.supply),o=s.whenComponent.tillOff(t.supply);e.receive(n,{get componentType(){return s.componentType},get whenReady(){return r},get whenComponent(){return o},perDefinition:e=>t.add(()=>s.perDefinition(e)),perComponent:e=>t.add(()=>s.perComponent(e))})}})})}(e,s)}define(e){r.define(e)}},s.supply]}(s,this.loader);return null===(n=(e=r).setup)||void 0===n||n.call(e,i),new Tt(this.loader,i,()=>Promise.resolve(a.off()))}init(){return this.setup().then(e=>e.init())}}class Tt extends jt{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e,t;await this.perDep(e=>e.init());const{request:{def:n}}=this.loader;return null===(t=(e=n).init)||void 0===t||t.call(e,this._context),new Ut(this)}}class Ut extends jt{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class qt{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=Ae.of(e);if(Le in e){t=Ae.merge(t,{init(t){t.define(e)}});const{feature:n}=ze.of(e);n&&(t=Ae.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,s=[this,"is",this.feature];return this._revokeBy(n.provide({a:Ct.of(this.feature),is:s})),new xe(this.def.has).forEach(s=>{const r=[this,"has",s];this._revokeBy(n.provide({a:Ct.of(s),is:r}));const o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse())}),new xe(this.def.needs).forEach(s=>{const r=[this,"needs",s],o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:Ct.of(s),is:r}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new Ne(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=ke(e,this._revoke)}}const Nt=new e("feature-requester",{byDefault:fe(e=>new Lt(e))});class Lt{constructor(e){this._map=new Map,this.registry=e.get(lt)}static get[n](){return Nt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const s=new qt(this,e,()=>this._map.delete(e));return this._map.set(e,s),s.request(t)}}function Mt(...e){const t=lt.create(),{bootstrapContext:n,complete:s}=function(e){const t=o(0),n=e.values;const s=new class extends pe{constructor(){super(),this.get=n.get;const s=t.read.thru(e=>e?p(this):w());this.whenReady=s.once,e.provide({a:be,by:_}),e.provide({a:pe,is:this})}async whenDefined(e){return await new Promise(e=>this.whenReady(e)),await this.get(rt).whenDefined(e),nt(e)}load(e){const t=h(t=>{const n=s.get(Lt).request(e),r=o({status:{feature:e,ready:!1}});this.get(Ct.of(e))({supply:t.supply,receive(e,t){const n=t;r.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{r.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{n.unuse()}),r.read(t)}).share();let n;const r=t(({down:e})=>{n=e}),i=t.keep.thru(e=>e.status).tillOff(r);return new class extends class{get[N](){return this.read}}{get read(){return i}get down(){return n}dismiss(e){return r.off(e),n}}}};return{bootstrapContext:s,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(i=e,Ae.define(class{},{needs:i}));var i;return n.get(Lt).request(r),n.get(Ct.of(r))(e=>{e.init().then(s)}),n}const $t=Symbol("attribute");function It(e){return[$t,e]}function zt(e,t=!0){if(!1===t)return v;if(!0===t||"function"==typeof t){const n=It(e),s=!0===t?Bt:t;return function(e,t){s.call(this,n,e,t)}}return function(e,n){We.of(this).updateState(t,e,n)}}function Bt(e,t,n){We.of(this).updateState(e,t,n)}const Kt=new e("attribute-registrar"),Vt=new e("attribute-registry");class Ft{constructor(e){this._attrs={},this._MutationObserver=e.get(we).MutationObserver}static get[n](){return Vt}add(e,t){this._attrs[e]=ke(this._attrs[e],t)}define(e){const t=this._attrs,n=Object.keys(t);n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,s){t[e].call(We.of(this).component,s,n)}}))}mount(e){const t=e.element,n=this._attrs,s=Object.keys(n);s.length&&new this._MutationObserver(e=>e.forEach(e=>{const s=e.attributeName;return n[s].call(We.of(t).component,t.getAttribute(s),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}const Ht={setup(e){e.perDefinition({as:Ft}),e.perDefinition({a:Kt,by:e=>(t,n)=>e.add(t,n),with:[Ft]}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Ft).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Ft).mount(t)})}};class Qt{static get[Re](){return Ht}}function Wt(e){return(t,n,s)=>{const{name:r,updateState:o}=function(e,t,n){let s,r;if("string"==typeof n)s=n,r=zt(s);else{if(n&&n.name)s=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required, as property key is not a string: "+`${e.constructor.name}.${t.toString()}`);s=t}r=zt(s,n&&n.updateState)}return{name:s,updateState:r}}(t,n,e),i=t.constructor;Ae.define(i,{needs:Qt}),ze.define(i,{define(e){e.get(Kt)(r,o)}});const a={get(){return We.of(this).element.getAttribute(r)},set(e){We.of(this).element.setAttribute(r,e)}};if(null!=s)return a;Object.defineProperty(t,n,a)}}function Gt(e){return Be({feature:{needs:Qt},define(t){const n=t.get(Kt),s=e=>{"string"==typeof e?n(e,zt(e)):Object.keys(e).forEach(t=>{n(t,zt(t,e[t]))})};ve(e)?e.forEach(s):s(e)}})}const Jt=new e("component-state");class Xt extends x{static get[n](){return Jt}}const Yt={setup(e){e.perComponent({a:Xt,by(e){const t=new Xt;return e.whenDestroyed(e=>t.done(e)),t}}),e.perComponent({a:He,by:e=>e.update,with:[Xt]})}};class Zt{static get[Re](){return Yt}}function en(e,t,n=It(t)){const{element:s}=e,r=e.get(Xt).track(n),o=P(),i=r.onUpdate.thru((e,t,n)=>p(t,n)).tillOff(o);return new class extends T{get on(){return i}get[U](){return o}get it(){return s.getAttribute(t)}set it(e){o.isOff||(null==e?s.removeAttribute(t):s.setAttribute(t,e))}}}const tn=Symbol("dom-property");const nn={render(e,t,n={}){const{offline:s,path:r=[]}=n,o=e.get(Xt).track(r),i=e.get(_e)();let a=!1;const u=o.onUpdate(()=>{s||e.connected?c():a=!1});function c(){a=!0,i(h)}function h(){for(;;){const e=t();if(e===t||"function"!=typeof e)break;t=e}}s?c():e.whenOn(()=>{a||c()}).whenOff(e=>{u.off(e),a=!0})}};function sn(e){return(t,n)=>{const s=t.constructor;ze.define(s,{feature:{needs:Zt},define(t){t.whenComponent(t=>{t.whenReady(()=>{const s=t.component,r=s[n].bind(s);nn.render(t,r,e)})})}})}}const rn=new e("shadow-content-root");class on extends Event{get shadowRoot(){return this.target.shadowRoot}}const an=new i("shadow-root-builder"),un={setup(e){e.provide({a:an,is:hn})}};class cn{static get[Re](){return un}}function hn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[Qe]=e,e.whenOn.once(()=>e.dispatchEvent(new on("wesib:shadowAttached",{bubbles:!0})))),n}const ln={mode:"open"};function dn(e=ln){return Be({setup(t){t.perComponent({a:rn,by:t=>t.get(an)(t,e)}),t.perComponent({a:Fe,by:e=>e.get(rn,{or:null})})},feature:{needs:cn}})}const pn=new O("https://wesib.github.io/ns","b","wesib");class fn extends c{constructor(e){super(e),this.upKey=this.createUpKey(e=>e.seed.keep.thru((...t)=>{if(t.length)return K(function(e){return(t,n)=>{const s=(n,r)=>{const o=e[n];return o?V(o((e=r)=>s(n+1,e),r)):t(r)};return s(0,n)}}(t));const n=()=>l(gn);return f(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?l(e.or):e.or}:void 0)(e=>t=e),(e,n)=>t(e,n)}}function gn(e,t){return e(t)}const mn=new fn("http-fetch-agent"),wn={};const yn=new i("http-fetch",{byDefault:fe((function(e){const t=e.get(we),n=e.get(mn);return(e,t)=>n(s,new Request(e,t));function s(e){return b(n=>{const s=new R;let r;if("AbortController"in t){const o=new t.AbortController,{signal:i}=o;r=P(e=>{e===wn&&o.abort()}),n.supply.whenOff(()=>r.off(wn)).needs(r),s.on({supply:r,receive(e,t){n.receive(e,t)}});const a=e.signal;a&&(new S(a).on("abort").once(()=>o.abort()),a.aborted&&o.abort()),e=new Request(e,{signal:i})}else r=s.on(n);t.fetch(e).then(e=>{s.send(e),r.off()}).catch(e=>r.off(e))})}}))});const bn=new e("hierarchy-root",{byDefault:e=>{const t=e.get(ye);return new S(t).on("wesib:component")(({context:e})=>e.get(vn).issue()),o()}}),_n=new e("hierarchy-updates",{byDefault:e=>new vn(e.get(We))});class vn{constructor(e){const t=new R,n=e.get(pe).get(bn);this.on=t.on,this.send=()=>t.send(e),this.issue=()=>{const t=xn(e);t?t[0].get(vn).send():n.it=e}}static get[n](){return _n}}function xn(e){const t=e.get(pe).get(ye);let n=e.element,s=!0;if(n!==t)for(;;){const e=n.parentNode;if(!e)return;const r=e[Qe];if(r)return[r,s];if(e===t)return;s=!1,n=e}}const On=new e("hierarchy-context",{byDefault:e=>function(e){const n=e.get(pe).get(bn),s=h(t=>{const s=o(),r=P().needs(t.supply),i=P().needs(t.supply),a=()=>{const t=xn(e);if(t){const[e,n]=t;s.it=e.get(kn),r.off(),n&&i.off()}else s.it=void 0};n.read({supply:r,receive:()=>e.connected&&a()}),s.read.consume(e=>e&&e.context.get(vn).on(a)).needs(i),s.read(t),e.whenOn({supply:t.supply,receive:(t,n)=>{a(),n.whenOff(()=>{Promise.resolve().then(()=>e.connected||(s.it=void 0))})}})}).share(),r=function(e){return new t(t=>e.keep.thru(e=>e?f(e.get(t)):p()))}(s),i=r.newValues();return new class extends kn{constructor(){super(...arguments),this.get=i.get}get context(){return e}get up(){return s}provide(e){return r.provide(e)}}}(e.get(We))});class kn extends s{static get[n](){return On}}const Sn=new e("component-node");class Cn extends u{get[z](){return this.onUpdate}get[N](){return this.read}}const Dn={subtree:!0};function Rn(e,t,n,s,{deep:r,all:o}){const i=new R,a=r?Dn:void 0;let c,l,d=new Set;"string"==typeof n?l=n:e.whenDefined(n).then(({elementDef:{name:t}})=>{if(c=void 0,t&&(l=M.name(t,e.get(be)),i.size)){const e=k();if(e.size){const t=Array.from(y(m(e,e=>s(e)),L));t.length&&i.send(t,[])}}});const f=e.get(et)((function(e){const t=[],n=[];e.forEach(e=>{j(y(m(A(e.removedNodes),C),L),e=>n.push(e)),j(y(m(A(e.addedNodes),S),L),e=>t.push(e))}),(t.length||n.length)&&i.send(t,n)}));let g;const w=b(e=>{const n=!i.size,s=i.on(e);return n&&(k(),f.observe(t,a)),P(e=>{s.off(e),i.size||f.disconnect()}).needs(s)}),_=h(w.thru(()=>g),()=>[g]),v=w.thru((e,t)=>p(u.of(e),u.of(t))),x=h(e=>{const t=new R;t.on(e),t.send(g,u.of([])),v(e)}),O=$(_).keep.thru(e=>K(B(e)));o||t.addEventListener("wesib:component",e=>{const t=e.target;if(d.has(t)){const e=s(t);i.send([e],[])}});return g=new class extends Cn{get onUpdate(){return w}get read(){return _}get track(){return x}get first(){return O}[Symbol.iterator](){return F(c||(c=y(m(i.size?d:k(),e=>s(e)),L)))}};function k(){return c=void 0,d=function(){const e=l;if(!e)return new Set;if(r)return new Set(A(t.querySelectorAll(e)));return new Set(y(A(t.children),t=>t.matches(e)))}()}function S(e){if(Se(e))return l&&e.matches(l)&&!d.has(e)?(d.add(e),s(e)):void 0}function C(e){if(Se(e)&&d.delete(e))return s(e,!0)}}class En{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(we).MutationObserver;return this._observer=new e(e=>this._update(e))}observe(e,t){const n=this,s=this.observer,r=this._emitter(e),o=H(t),i=r.on({supply:P(()=>{this._emitters.delete(e),s.disconnect(),this._emitters.size?a():this._observer=void 0}).needs(o.supply),receive:(e,t,n)=>o.receive(e,t,n)});return s.disconnect(),a(),i;function a(){n._update(s.takeRecords()),s.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:Array.from(n._emitters.keys())})}}_update(e){e.forEach(e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)})}_emitter(e){const t=new R;return this._emitters.set(e,t),t}}class Pn extends T{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new R;let n=Y();this.on=b(e=>{this._updates.size||(n=this._observer.observe(t,(e,t)=>this._updates.send(e,t))),e.supply.needs(n),this._updates.on(e).whenOff(e=>{this._updates.size||n.off(e)})})}get[U](){return C(this._updates)}get it(){return this._observer.element.getAttribute(this._name)}set it(e){this._observer.element.setAttribute(this._name,e)}}class jn{constructor(e,t){this._attrs=new Map,this._observer=new En(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new Pn(this._observer,e);return this._attrs.set(e,n),n}}class An extends T{constructor(e,t){super(),this._element=e,this._key=t,this._updates=new R,this._supply=P()}get on(){return this._updates.on}get[U](){return this._supply}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}done(e){return this._supply.off(e),this}bind(e){const t=C(this),n=e.get(Xt).track((s=this._key,[tn,s]));var s;t.needs(n.onUpdate({supply:P().whenOff(e=>this._updates.done(e)),receive:(e,t,n,s)=>this._updates.send(n,s)}).needs(t))}}class Tn{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach(t=>t.bind(e))}get(e){const t=this._props.get(e);if(t)return t;const n=new An(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const Un=Symbol("element-node");class qn{constructor(e,t){this._bs=e,this.element=t,this._attrs=new jn(e,t),this._props=new Tn(t),t[Un]=this;const n=t[Qe];n?this._bind(n):t.addEventListener("wesib:component",e=>this._bind(e.context))}get context(){return this.element[Qe]}get parent(){const e=this.element.parentNode;return e&&Nn(this._bs,e)}select(e,t){return function(e,t,n,s={}){if(s.all)return Rn(e,t,n,(t,n)=>Nn(e,t,n),s);const r=e.get(Ze);return Rn(e,t,n,(t,n)=>r(t)&&Nn(e,t,n),s)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function Nn(e,t,n){const s=t[Un];return s||n?s:new qn(e,t)}const Ln={needs:Zt,setup(e){e.perComponent({a:Sn,by:e=>Nn(e.get(pe),e.element)})}};class Mn{static get[Re](){return Ln}}const $n=new e("navigation");class In{static get[n](){return $n}get[z](){return this.on}get[N](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}const zn=Symbol("page-param");class Bn{get[zn](){return this}}class Kn extends s{}const Vn=new e("nav-history",{byDefault:fe(e=>new Hn(e))});function Fn(e){return null==e||"object"!=typeof e?{data:e}:e["wesib:navigation:data"]}class Hn{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(we);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[n](){return Vn}init(){const{data:e}=Fn(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule(()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")}),t}newEntry(e){return new Qn(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:s}}=e;this._history.pushState(this._historyState(e),n,s.href),this._enter("open",e,t)}_enter(e,t,n){const s=n.it;this._entries.set(t.id,t);try{for(let e=s.next;e;e=e.next)this._forget(e)}finally{t.prev=s,s.next=t,t.schedule(()=>{try{s.leave()}finally{t.enter(e)}}),n.it=t}}replace(e,t){const n=t.it,{page:{title:s="",url:r}}=e;this._history.replaceState(this._historyState(e),s,r.href),this._entries.set(e.id,e);const o=n.prev;o&&(e.prev=o,o.next=e),e.schedule(()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}}),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const s=t.it,{uid:r,data:o,id:i}=Fn(n);let a;const u=r===this._uid&&null!=i?this._entries.get(i):void 0;return u?a=u:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule(()=>{try{s.leave()}finally{a.enter("return")}}),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,s=new Qn(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",t.href),this._entries.delete(n.id),e.it=s}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{"wesib:navigation:data":{uid:this._uid,id:e,data:t}}}}class Qn{constructor(e,t,n,s){this._context=e,this.id=t,this._status=0,this._update=v,this._params=s?s._params:new Map;const r=this;this.page={url:n.url,title:n.title,data:n.data,get visited(){return!!r._status},get current(){return 2===r._status},get:e=>r.get(e),put(e,t){r.put(e,t)}}}get(e){const t=this._params.get(e[zn]);return t&&t.get()}put(e,n){const s=e[zn],r=this._params.get(s);if(r)return r.put(n),r.get();const o=new t(this._context);const i=s.create(this.page,n,new class extends Kn{constructor(){super(...arguments),this.get=o.newValues().get}});return this._params.set(s,i),this.page.current&&i.enter&&i.enter(this.page,"init"),i.get()}transfer(e,t){j(this._params.entries(),([n,s])=>{if(s.transfer){const r=s.transfer(e.page,t);r&&e._params.set(n,r)}})}stay(e){j(this._params.values(),t=>t.stay&&t.stay(e))}enter(e){this._status=2,j(this._params.values(),t=>t.enter&&t.enter(this.page,e))}leave(){this._status=1,j(this._params.values(),e=>e.leave&&e.leave())}forget(){j(this._params.values(),e=>e.forget&&e.forget()),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=v,e()}}class Wn extends c{constructor(e){super(e),this.upKey=this.createUpKey(e=>{const{document:t}=e.context.get(we);return e.seed.keep.thru((...n)=>{if(n.length)return K((function(e,s,r,o){return function o(i,a){const u=n[i];if(!u)return e(a);u(({url:e=a.url,title:n=a.title,data:s=a.data}=a)=>o(i+1,{url:new URL(String(e),t.baseURI),title:n,data:s,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}}),s,r,a)}(0,o)}));const s=()=>l(Gn);return f(e.byDefault(s)||s())})})}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?l(e.or):e.or}:void 0)(e=>t=e),(e,n,s,r)=>t(e,n,s,r)}}function Gn(e,t,n,s){e(s)}const Jn=new Wn("navigation-agent");class Xn extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!1})),this.when=t.when,this.to=t.to}}class Yn extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.when=t.when,this.from=t.from,this.to=t.to}}class Zn extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}function es(e){const t=e.get(we),{document:n,history:s}=t,r=new S(t),i=e.get(Hn),a=e.get(Jn),u=r.on("wesib:enterPage"),c=r.on("wesib:leavePage"),h=r.on("wesib:stayOnPage"),l=E(u,c,h),d=o(i.init());d.read(e=>e.apply());const p=d.read.keep.thru(e=>e.page);let f=Promise.resolve();r.on("popstate")(e=>{const t=i.popState(e,d);t&&r.dispatch(new Xn("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),r.on("hashchange")(()=>{const e=i.hashChange(d);e&&r.dispatch(new Xn("wesib:enterPage",{when:"enter",to:e.page}))});return new class extends In{get length(){return s.length}get onEnter(){return u}get onLeave(){return c}get onStay(){return h}get on(){return l}get read(){return p}go(e){s.go(e)}open(e){return m("pre-open","open",e)}replace(e){return m("pre-replace","replace",e)}update(e){return i.update(d,g(e)).page}with(e,t){return function e(t){return{with:(n,s)=>e(ke(t,e=>e.put(n,s))),open:e=>m("pre-open","open",e,t),replace:e=>m("pre-replace","replace",e,t)}}(n=>n.put(e,t))}};function g(e){return"string"==typeof e?new URL(e,n.baseURI):e||d.it.page.url}function m(e,t,n,s=v){const o=function(e){return"string"==typeof e||e instanceof URL?{url:g(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:g(e.url)})}(n),u=f=f.then(c,c);return u;function c(){let n=void 0;try{const c=function(){if(f!==u)return h();const t=d.it,n=i.newEntry(o);t.transfer(n,e);const c=new Yn("wesib:leavePage",{when:e,from:t.page,to:n.page});if(s(n.page),!r.dispatch(c)||f!==u)return h(n);let l;if(a(e=>l=e,e,c.from,c.to),!l)return h(n);return n}();return c?(n=c,i[t](n,d),r.dispatch(new Xn("wesib:enterPage",{when:t,to:n.page})),n.page):c}catch(e){throw h(n,e),e}}function h(e,t){return e&&e.stay(d.it.page),r.dispatch(new Zn("wesib:stayOnPage",{from:d.it.page,to:o,reason:t})),null}}}const ts={setup(e){e.provide({a:In,by:es})}};class ns{static get[Re](){return ts}}const ss={supply:v};function rs(e={}){const{select:t="a",pick:n={all:!0,deep:!0}}=e;return Be({feature:{needs:[Mn,ns]},define(s){s.whenComponent(s=>{const r=function(e,t){const n=e.get(_e),{active:s=hs}=t,r=I.name(s,e.get(be)),o=t.activate?t.activate.bind(t):v;return e=>{const{element:t}=e.node,s=t[cs]||(t[cs]=n({node:t})),i=t=>{s(()=>((e,{node:t})=>{const n=t.element,{classList:s}=n;e?s.add(r):s.remove(r)})(t,e)),o(t,e)};let a;return i(!0),{node:e.node,supply(){const e=a=P(()=>{a===e&&i(!1)});return e}}}}(s,e),o=function(e){if(!e.weigh)return os;return t=>{const n=e.weigh(t);if("number"==typeof n)return l(t.node,n);let s=$(n).keep.thru_(e=>p(t.node,e));return h(e=>{s({supply:P().needs(e.supply).whenOff(()=>{s=l(t.node,0),s(e)}),receive:e.receive.bind(e)})})}}(e),i=s.get(In),a=s.get(Sn);s.whenOn(e=>{let u=ss;i.read.consume(e=>a.select(t,n).read.keep.thru_(t=>f(g(...t.map(t=>o({node:t,context:s,page:e}))))).consume((...t)=>{const n=function(e){let t,n=0;return e.forEach(([e,s])=>{s>n&&(n=s,t=e)}),t}(t);return n?n!==u.node&&(u=r({node:n,context:s,page:e})):u=ss,u.supply()})).needs(e)})})}})}function os({node:e,page:t}){const n=e.element,s=n.getAttribute("href");if(null==s)return l(e,-1);const r=new URL(s,n.ownerDocument.baseURI);return l(e,function e(t,n){if(t.origin!==n.origin)return-1;const s=is(t),r=is(n);if(t.hash)return s!==r?-1:us(t,n)<0||us(n,t)<0?-1:e(as(t),as(n));const o=us(t,n);if(o)return o<0?-1:s!==r?-1:o;if(!r.startsWith(s))return-1;return t.pathname.length}(r,t.url))}function is(e){const t=e.pathname;return t.endsWith("/")?t:t+"/"}function as(e){let{hash:t}=e;return t=t.substring(1),"/"!==t[0]&&(t="/"+t),new URL(t,e)}function us({searchParams:e},{searchParams:t}){let n=0;return e.forEach((s,r)=>{const o=new Set(t.getAll(r));n>=0&&(e.getAll(r).every(e=>o.has(e))?n+=1:n=-1)}),n}const cs=Symbol("nav-link-render-schedule"),hs=["active",pn];function ls(e={}){const t=e.handle?e.handle.bind(e):ds,n=new xe(e.event||"click");return Be({feature:{needs:ns},define(e){e.whenComponent(e=>{e.whenOn(s=>{const r=e.get(In);n.forEach(n=>{e.on(n)(n=>r.read.once(s=>t({event:n,page:s,context:e,navigation:r}))).needs(s)})})})}})}function ds({event:e,page:t,navigation:n}){const s=e.target,r=s.getAttribute("href");if(null==r)return;const o=t.url,i=new URL(r,s.ownerDocument.baseURI);i.origin===o.origin&&(e.preventDefault(),o.href!==i.href&&n.open(r))}function ps(e,t,n,s=fs){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=t.ownerDocument;if(Se(e)){const n=o.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach(t=>n.setAttribute(t,e.getAttribute(t))),s(e,n),t.insertBefore(n,r),n}const i=o.importNode(e,!1);return t.insertBefore(i,r),i}function fs(e,t){j(A(e.childNodes),e=>ps(e,t))}function gs(e){let t;return n=>{const s=function(e){return new URL("",e.url).href}(n);if(t){if(t.url===s)return t.on;t.sup.off()}let r;const i=P().whenOff(()=>{t=void 0,r=void 0}),a=b(t=>{if(!r){const t=e(n),s=o(),a=t(e=>{s.it=e}).whenOff(e=>{null!=e&&i.off(e)});i.whenOff(e=>{a.off(e),s.done(e)}),r={on:s.read.thru_(e=>e?p(e):w()),num:0}}const s=r;return++s.num,s.on(t).needs(i).whenOff(e=>{--s.num||Promise.resolve().then(()=>{s.num||s!==r||i.off(e)})})});return t={url:s,on:a,sup:i},a}}class ms extends Error{}const ws=new class extends Bn{create(e,t){return{get:()=>t,put:v}}};class ys{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map}get fragments(){const e=[];for(const t of this){if(!t.fragment)return[];e.push(t.fragment)}return e}[Symbol.iterator](){return F(q(this._map.values()))}handle(){const e=this,t=P();let n=Y();return{get(){},put(t){e._add(t)},transfer(t){const n=e._transfer();return t.put(ws,n),n.handle()},enter(s,r){if("init"===r)return;n=P().needs(t);const o=b(t=>{const r=new R,o=r.on(t);return e._loader(s)(e=>r.send(e)).whenOff(e=>{void 0===e||e instanceof ms||r.send({ok:!1,page:s,error:e})}).needs(n),o}).share();j(e,({fragment:e,receiver:t})=>function(e,t){return t?e.thru_(e=>e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e):e}(o,e)({supply:P().needs(t.supply),receive(e,n){t.receive(e,n)}}))},leave(){n.off(new ms("page left"))},stay(){t.off(new ms("navigation cancelled"))},forget(){t.off(new ms("page forgotten"))}}}_add(e){const t=Object.assign(Object.assign({},e),{receiver:H(e.receiver)}),{supply:n}=t.receiver,s=this._map.get(n);s?s.push(t):(this._map.set(n,[t]),n.whenOff(()=>this._map.delete(n)))}_transfer(){const e=new ys(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,Array.from(n));return e}}const bs=new fn("page-load-agent"),_s=new i("page-load-url",{byDefault:D(v)}),vs=new e("page-loader",{byDefault:fe((function(e){const t=e.get(we),n=e.get(yn),s=e.get(_s),o=e.get(bs),i=new t.DOMParser;return e=>{const t=new URL(e.url.href);s(t);const a=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return b(e=>o(u,a)(e));function u(s){return function(e,t){var n;const s=null===(n=e.get(ws))||void 0===n?void 0:n.fragments;s&&s.length&&t.headers.set("Accept-Fragment",r(s,(e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+J(t.tag):"id="+J(t.id)),""))}(e,s),b(r=>{const o=new Q;o.on(r),o.send({page:e}),W(n(s).thru_(e=>Promise.all([e,e.text()]))).thru_((...e)=>G(e),([n,s])=>{if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:xs(i,t,n,s)}}catch(t){return{ok:!1,page:e,response:n,error:t}}})(r)})}}}))});function xs(e,t,n,s){const r=e.parseFromString(s,X(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const e=r.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=r.createElement("base");e.href=t.href,r.head.appendChild(e)}}return r}class Os extends Bn{create(e,t,n){const s=new ys(n.get(In),gs(n.get(vs))),r=s.handle();return e.put(ws,s),r.put(t),r}}const ks=new Os,Ss=new e("page-cache-buster",{byDefault:fe(e=>new Cs(e))});class Cs{constructor(e){const t=Ds(e.get(we).document);if(t){const n=e.get(In);this.urlModifier=l(e=>e.searchParams.set("__wesib_app_rev__",t)),this.agent=l((e,s)=>e(new Request(s.url,s)).thru_(e=>{if(e.ok){const s=Ds(e.document);if(s&&s!==t){const t=new URL(e.page.url.href);t.searchParams.set("__wesib_app_rev__",s),n.update(t),n.reload()}}return e}))}else this.urlModifier=l(),this.agent=l()}static get[n](){return Ss}}function Ds(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function Rs(e){const t=e.get(we).document;return e=>e().thru_(e=>{if(e.ok){const n=new Set(m(Es(t,A(t.scripts)),([e])=>e));j(y(Es(e.document,A(e.document.querySelectorAll("script"))),([e])=>!n.has(e)),([e,s])=>{ps(s,t.head,(t,n)=>n.src=e),n.add(e)})}return e})}function Es(e,t){return m(y(t,e=>!!e.src),t=>[new URL(t.src,e.baseURI).href,t])}function Ps(e){const t=e.get(we).document;return e=>e().thru_(e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let s=t.head,r=null;const o=t.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(s=a.parentNode,r=a,j(A(o),e=>i.set(new URL(e.href,t.baseURI).href,e))),j(A(n),e=>{const n=new URL(e.href,t.baseURI).href,o=i.get(n);o?(B(i.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),i.delete(n)):ps(e,s,r,(e,t)=>t.href=n)}),j(i.values(),e=>e.parentNode.removeChild(e)),e})}function js(e){const t=e.get(we).document;return e=>e().thru_(e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})}const As={needs:ns,setup(e){e.provide({a:_s,by:e=>e.urlModifier,with:[Cs]}),e.provide({a:bs,by:e=>e.agent,with:[Cs]}),e.provide({a:bs,by:Rs}),e.provide({a:bs,by:Ps}),e.provide({a:bs,by:js})}};class Ts{static get[Re](){return As}}function Us(e={}){const t=e.onResponse?e.onResponse.bind(e):v;return Be({feature:{needs:Ts},define(n){n.whenComponent(n=>{const s=n.get(we).document,r=n.get(_e)(),o=n.get(In),i=()=>{const{fragment:t}=e;if(t)return t;const{element:{id:s,tagName:r}}=n;return s?{id:s}:{tag:r}};n.whenOn(e=>{const a=s.createRange();a.selectNodeContents(n.contentRoot),o.read.once(o=>{o.put(ks,{fragment:i(),receiver:{supply:e,receive:(e,o)=>function(e){e.ok?r(()=>{a.deleteContents();const r=s.createDocumentFragment(),{fragment:o}=e;o&&(fs(o,r),a.insertNode(r)),t({context:n,range:a,response:e})}):r(()=>t({context:n,range:a,response:e}))}(o)}})})})})}})}const qs=new e("component-style-producer"),Ns=new oe("component-styp-render"),Ls=new O("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Ms=new e("unique-element-class",{byDefault:function(e){const t=e.get(be),n=e.get(We),s=n.get(ut),r=`${s.name?M.name(s.name,t):"component"}#${++$s}`,o=Ls.name(t(Ls),r,I);return n.element.classList.add(o),o}});let $s=0;const Is=new e("component-style-producer:impl");class zs{constructor(e,t=se){this._context=e,this._produce=t}static get[n](){return Is}produce(e,t={}){const n=this._context,s=n.get(rn,{or:null});return this._produce(e,Object.assign(Object.assign({},t),{document:t.document||n.get(we).document,parent:t.parent||n.contentRoot,rootSelector:[],scheduler:t.scheduler||n.get(_e),nsAlias:t.nsAlias||n.get(be),render:function(){const{render:e}=t,r=new xe(e).add(...n.get(Ns)),o=t.hostSelector?re(t.hostSelector)[0]:void 0;return r.add(s?Bs(o):Ks(o||{c:[n.get(Ms)]})),r.value}()}))}}function Bs(e){return{order:-100,render(t,n){let{selector:s}=t;if(s.length){if(e){const[t,n]=Vs(s);n&&(s=n.length?[{u:[[":","host",Fs(n,e)]]},...t]:[{u:[[":","host",[e]]]},...t])}}else s=[e||{u:[[":","host"]]}];t.render(n,{selector:s})}}}function Ks(e){return{order:-100,render(t,n){let{selector:s}=t;if(s.length){const[t,n]=Vs(s);s=n&&n.length?[...Fs(n,e),...t]:[e,...t]}else s=[e];t.render(n,{selector:s})}}}function Vs(e){if("string"!=typeof e[0]){const[{ns:t,e:n,i:s,c:r,u:o,s:i,$:a},...u]=e;if(!t&&!n&&!s&&!r&&!i&&o){const[[e,t,...n]]=o;if(":"===e&&"host"===t){let e;return n.length?(e=Array.from(n[0]),e[0].$=a):e=a?[{$:a}]:[],[u,e]}}}return[e]}function Fs(e,{ns:t,e:n,i:s,c:r,u:o,s:i}){const[a,...u]=e;return[{ns:a.e||a.ns?a.ns:t,e:a.e||a.ns?a.e:n,i:a.i||s,c:a.c?r?[...a.c,...r]:a.c:r,u:a.u?o?[...a.u,...o]:a.u:o,s:(a.s||"")+(i||"")||void 0,$:a.$},...u]}const Hs={setup(e){e.perComponent({as:zs}),e.perComponent({a:qs,by:e=>(t,n)=>e.produce(t,n),with:[zs]})}};class Qs{static get[Re](){return Hs}}const Ws={produce(e,t,n){const s=Z(t),r=n&&n.offline,o=e.get(qs);let i,a=Y();const u=P(e=>{i=v,a.off(e)});switch(i=()=>{a=o(s,n).needs(u)},r){case"always":e.whenReady(i);break;case!1:e.whenOn(e=>{i(),a.needs(e)});break;default:e.whenOn.once(i)}return e.whenDestroyed(e=>u.off(e)),u}};function Gs(e){return(t,n)=>{const s=t.constructor;ze.define(s,{setup(t){t.whenComponent(t=>{t.whenReady(({component:s})=>{const r=s[n];Ws.produce(t,"function"==typeof r?r.bind(s):r,e)})})},feature:{needs:[Qs]}})}}const Js={has:Qs,setup(e){e.perComponent({a:zs,by:e=>new zs(e,ne)}),e.perComponent({a:qs,by:e=>(t,n)=>e.produce(t,n),with:[zs]})}};class Xs{static get[Re](){return Js}}const Ys=new e("theme");class Zs{static get[n](){return Ys}ref(e){return e(this.root)}}const er=new e("theme-factory");class tr{static get[n](){return er}}const nr=new class extends ee{constructor(){super("theme-style")}grow(e){const t=new Map;return e.seed.forEach(e=>{let n,s,r;"function"==typeof e?(n=s=e,r=!0):(n=e.style,s=e.provide.bind(e),r=!1);const o=t.get(n);if(o){const[e,i]=o;t.set(n,[r?sr(s,e):sr(e,s),r||i])}else t.set(n,[s,r])}),t.size?n:e.byDefault(()=>n);function n(e){const n=t.get(e);if(!n)return e;const[s,r]=n;return r?s:sr(e,s)}}};function sr(e,t){return n=>te(e(n),t(n))}class rr extends Zs{constructor(e){super(),this._styles=e,this.root=ie(),this._rules=new Map}style(...e){const t=this;return Z(...e.reduce((function(e,n){const s=t._rules.get(n);if(s)e.push(s);else{const s=t._styles(n)(t);t._rules.set(n,s),e.push(s)}return e}),[]))}}class or extends tr{constructor(e){super(),this._styles=e}newTheme(){return new rr(this._styles)}}const ir={needs:Qs,setup(e){e.provide({a:tr,as:or,with:[nr]}),e.provide({a:Zs,by:e=>e.newTheme(),with:[tr]})}};class ar{static get[Re](){return ir}}class ur extends c{get upKey(){return this}constructor(){super("default-in-aspects")}grow(e){const t=e.context.get(be);return d({scheduler:e.context.get(_e[n].upKey),fns:e.seed}).keep.thru(({scheduler:[e],fns:n})=>ce(...n,le.to(e),he.to(t)))}}const cr=new ur,hr=new ue("input-receiver",{byDefault:()=>({})});function lr(e,t){const n=e.get(kn).provide({a:hr,by:()=>({root:e,control:t})});return P(n).needs(t)}function dr(e){return Be({define(t){t.whenComponent(t=>{const{up:n}=t.get(kn);d({parent:n.keep.thru_(e=>e?f(e.get(hr)):K({})),aspects:t.get(cr)}).keep.thru_(({parent:[n],aspects:[s]})=>{if(n.control){const r=e({control:n,context:t,aspects:s});if(r)return r instanceof ae?p(r):f(r)}return p()}).consume((e,n)=>{if(!e)return;const s=lr(t,e);return(n||C(e)).needs(s),s})})}})}export{Gt as A,pe as B,Be as C,cr as D,Te as F,ls as H,Us as I,Gs as P,sn as R,Xs as S,Zs as T,pn as W,dr as a,Mn as b,ar as c,rs as d,Ts as e,Mt as f,Wt as g,dn as h,we as i,Sn as j,lr as k,en as t};//# sourceMappingURL=wesib.96e3baef.m.js.map
