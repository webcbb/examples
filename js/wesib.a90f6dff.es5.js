System.register(["./lib.0eac229e.es5.js"],function(ln){"use strict";var hn,pn,vn,dn,yn,gn,mn,wn,kn,bn,_n,xn,Sn,On,Rn,Dn,En,Cn,An,jn,Pn,Tn,qn,Mn,Ln,Un,Nn,zn,Bn,In,Vn,Fn,Hn,Qn,Gn,Jn,Kn,Wn,Xn,Yn,Zn,$n,er,tr,nr,rr,ur,ir,or,ar,sr,cr,fr,lr,hr,pr,vr,dr,yr,gr,mr,wr,kr,br,_r;return{setters:[function(e){hn=e.S,pn=e._,vn=e.a,dn=e.F,yn=e.v,gn=e.b,mn=e.c,wn=e.d,kn=e.e,bn=e.E,_n=e.t,xn=e.n,Sn=e.f,On=e.C,Rn=e.g,Dn=e.h,En=e.i,Cn=e.j,An=e.k,jn=e.l,Pn=e.m,Tn=e.o,qn=e.p,Mn=e.q,Ln=e.r,Un=e.s,Nn=e.u,zn=e.w,Bn=e.x,In=e.y,Vn=e.z,Fn=e.A,Hn=e.B,Qn=e.D,Gn=e.G,Jn=e.H,Kn=e.I,Wn=e.J,Xn=e.K,Yn=e.L,Zn=e.N,$n=e.M,er=e.O,tr=e.P,nr=e.Q,rr=e.R,ur=e.T,ir=e.U,or=e.V,ar=e.W,sr=e.X,cr=e.Y,fr=e.Z,lr=e.$,hr=e.a0,pr=e.a1,vr=e.a2,dr=e.a3,yr=e.a4,gr=e.a5,mr=e.a6,wr=e.a7,kr=e.a8,br=e.a9,_r=e.aa}],execute:function(){ln({A:function(s){return function(e,t,n){var r=function(e,t,n){var r,u;if("string"==typeof n)u=ve(r=n);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required, as property key is not a string: "+"".concat(e.constructor.name,".").concat(t.toString()));r=t}u=ve(r,n&&n.updateState)}return{name:r,updateState:u}}(e,t,s),u=r.name,i=r.updateState,o=e.constructor;c.define(o,{needs:ke}),w.define(o,{define:function(e){e.get(ye)(u,i)}});var a={get:function(){return D.of(this).element.getAttribute(u)},set:function(e){D.of(this).element.setAttribute(u,e)}};if(null!=n)return a;Object.defineProperty(e,t,a)}},C:function(t){return function(e){return w.define(e,"string"==typeof t?{name:t}:t)}},F:function(t){return function(e){return c.define(e,t)}},P:function(i){return function(e,u){var t=e.constructor;w.define(t,{define:function(e){e.onComponent(function(r){r.whenReady(function(e){var t=e.component,n=t[u];Lt.produce(r,"function"==typeof n?n.bind(t):n,i)})})},feature:{needs:[Mt]}})}},f:function(){for(var e=function(r){var u=_n(0),i=r.values,o=new(function(){function n(){var t;mn(this,n),(t=wn(this,kn(n).call(this))).get=i.get;var e=u.read.thru(function(e){return e?xn(jn(t)):Sn()});return t.whenReady=e.once,r.provide({a:x,by:Vn}),r.provide({a:a,is:jn(t)}),t}return pn(n,a),gn(n,[{key:"whenDefined",value:function(t){var n=this;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(new Promise(function(e){return n.whenReady(e)}));case 2:return e.next=4,regeneratorRuntime.awrap(this.get(q).whenDefined(t));case 4:return e.abrupt("return",P(t));case 5:case"end":return e.stop()}},null,this)}},{key:"load",value:function(n){var r,u=this,e=qn(function(e){var t=o.get(he).request(n),r=_n({status:{feature:n,ready:!1}});u.get(te.of(n))({supply:e.supply,receive:function(e,t){var n=t;r.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(function(){r.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(function(){t.unuse()}),r.read(e)}).share(),t=e(function(e){var t=e.down;return r=t}),i=e.keep.thru(function(e){return e.status}).tillOff(t);return new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,v),gn(e,[{key:"dismiss",value:function(e){return t.off(e),r}},{key:"read",get:function(){return i}},{key:"down",get:function(){return r}}]),e}())}}]),n}());return{bootstrapContext:o,complete:function(){u.it=1}}}(I.create()),t=e.bootstrapContext,n=e.complete,r=arguments.length,u=new Array(r),i=0;i<r;i++)u[i]=arguments[i];var o=1===u.length?u[0]:function(e){return c.define(function e(){mn(this,e)},{needs:e})}(u);return t.get(he).request(o),t.get(te.of(o))(function(e){e.init().then(n)}),t},g:function(u){return function(e,r){var t=e.constructor;w.define(t,{define:function(e){e.onComponent(function(n){n.whenReady(function(){var e=n.component,t=e[r].bind(e);Ee.render(n,t,u)})})},feature:{needs:[Oe,Ae]}})}},h:function(t){return function(e){w.define(e,ze.componentDef(t))}},i:kt});var n=new hn("bootstrap-context"),a=ln("b",function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Rn),gn(e,null,[{key:On,get:function(){return n}}]),e}());function e(r){return function(e,t){var n=e.get(a);return e===n?r(n,t):n.get(t)}}var t=new hn("component-factory"),m=function(){function e(){mn(this,e)}return gn(e,[{key:"connectTo",value:function(e){var t=this.mountTo(e);return t.connected=!0,t}}],[{key:On,get:function(){return t}}]),e}(),_=ln("B",new hn("window",{byDefault:function(){return window}})),x=(new hn("bootstrap-root",{byDefault:function(e){return e.get(_).document.body}}),ln("D",new hn("default-namespace-aliaser")));function r(e){return Array.isArray(e)}var h=function(){function n(e){var t;return mn(this,n),(t=wn(this,kn(n).call(this))).items=null==e?new Set:r(e)?new Set(e):new Set([e]),t}return pn(n,Hn),gn(n,[{key:Symbol.iterator,value:function(){return this.items[Symbol.iterator]()}},{key:"add",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach(function(e){return t.items.add(e)}),this}},{key:"merge",value:function(e){return null==e?this:r(e)?this.add.apply(this,Nn(e)):this.add(e)}},{key:"value",get:function(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return Nn(this.items)}}},{key:"size",get:function(){return this.items.size}}]),n}();function y(r,u,e){var i=2<arguments.length&&void 0!==e?e:function(e,t){return t};return r?u?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i(r.apply(this,t),u.apply(this,t))}:r:u}var u=function(){function t(e){mn(this,t),this.symbol=e}return gn(t,[{key:"of",value:function(e){var t=e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0,n=function e(t,n){var r=1<arguments.length&&void 0!==n?n:function(){return!0},u=Object.getPrototypeOf(t.prototype);if(null!=u){var i=u.constructor;return r(i)?i:e(i,r)}}(e),r=n&&this.of(n);return t?r?this.merge(r,t):t:r}},{key:"define",value:function(e){for(var t,n=e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0,r=arguments.length,u=new Array(1<r?r-1:0),i=1;i<r;i++)u[i-1]=arguments[i];return t=n?this.merge.apply(this,[n].concat(u)):this.merge.apply(this,u),Object.defineProperty(e,this.symbol,{configurable:!0,value:t}),e}}]),t}(),i=function(){function e(){var n=this;mn(this,e),this.promise=new Promise(function(e,t){n._resolve=e,n._reject=t})}return gn(e,[{key:"resolve",value:function(e){this._resolve(e)}},{key:"reject",value:function(e){this._reject(e)}}]),e}(),o=Symbol("feature-def"),s=new(function(){function e(){return mn(this,e),wn(this,kn(e).call(this,o))}return pn(e,u),gn(e,[{key:"merge",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return{needs:new h(e.needs).merge(t.needs).value,has:new h(e.has).merge(t.has).value,setup:y(e.setup,t.setup),init:y(e.init,t.init)}},{})}}]),e}()),c={of:function(e){return s.of(e)||{}},merge:function(){return s.merge.apply(s,arguments)},define:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.define.apply(s,[e].concat(n))}};var f=new hn("feature-context"),p=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,a),gn(e,[{key:"whenDefined",value:function(e){return this.get(a).whenDefined(e)}},{key:"load",value:function(e){return this.get(a).load(e)}}],[{key:On,get:function(){return f}}]),e}(),l=function(e){function n(e){var t;return mn(this,n),(t=wn(this,kn(n).call(this,"Circular feature needs: "+e.reduce(function(e,t){var n=Dn(t,3),r=n[0],u=n[1],i=n[2];return(e||r.name)+" ".concat(u," ").concat(i.name)},"")))).needs=e,t}return pn(n,e),n}(vn(Error)),v=function(){function e(){mn(this,e)}return gn(e,[{key:Jn,get:function(){return this.read}}]),e}(),d=Symbol("component-def"),g=new(function(){function e(){return mn(this,e),wn(this,kn(e).call(this,d))}return pn(e,u),gn(e,[{key:"merge",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return Object.assign(Object.assign(Object.assign({},e),t),{setup:y(e.setup,t.setup),define:y(e.define,t.define),feature:e.feature?t.feature?c.merge(e.feature,t.feature):e.feature:t.feature})},{})}}]),e}()),w={of:function(e){return g.of(e)||{}},merge:function(){return g.merge.apply(g,arguments)},define:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var u=this.merge.apply(this,n),i=g.of(e);g.define(e,u);var o=u.feature;return o&&c.define(e,o),i?e:c.define(e,{init:function(e){e.define(this)}})}};var k=new hn("component-context"),b=new hn("component-event-dispatcher",{byDefault:function(){return{dispatch:function(e,t){return e.element.dispatchEvent(t)},on:function(e,t){return new Qn(e.element).on(t)}}}}),S=new hn("content-root",{byDefault:function(e){return e.get(k).element}}),O=new dn("state-updater",{byDefault:yn(En)}),R=Symbol("component-context"),D=function(){function t(){var e;return mn(this,t),(e=wn(this,kn(t).apply(this,arguments))).updateState=function(e,t,n){this.get(O)(e,t,n)}.bind(jn(e)),e}return pn(t,Rn),gn(t,[{key:"on",value:function(e){return this.get(b).on(this,e)}},{key:"dispatchEvent",value:function(e){this.get(n).get(b).dispatch(this,e)}},{key:"contentRoot",get:function(){return this.get(S)}}],[{key:"of",value:function(e){var t=e[R];if(!t)throw TypeError("No component context found in ".concat(e));return t}},{key:On,get:function(){return k}}]),t}();var E=function(e){function n(e,t){return mn(this,n),wn(this,kn(n).call(this,e,t))}return pn(n,e),gn(n,[{key:"context",get:function(){return D.of(this.target)}}]),n}(vn(Event)),C=function(){function e(){mn(this,e)}return gn(e,[{key:"component",get:function(){return this.context.component}},{key:"element",get:function(){return this.context.element}}]),e}(),A=new(function(){function e(){return mn(this,e),wn(this,kn(e).call(this,"element-adapter"))}return pn(e,Cn),gn(e,[{key:"grow",value:function(u){function i(e){return e[R]}var o;return u.seed(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(t,n){return function(e){return t(e)||n(e)}},i);o=r!==i?r:u.byDefault(function(){return i})||i}),function(e){return o(e)}}}]),e}()),j=Symbol("component-factory");function P(e){var t=e[j];if(!t)throw new TypeError("Component is not defined: ".concat(e));return t}var T=new hn("custom-elements",{byDefault:function(e){var i=e.get(_).customElements,o=e.get(x);return new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,q),gn(e,[{key:"define",value:function(e,t){if(Xn(e))i.define(Yn.name(e,o),t);else{var n=P(e).elementDef,r=n.name,u=n.extend;r?u&&u.name?i.define(Yn.name(r,o),t,{extends:u.name}):i.define(Yn.name(r,o),t):L(e).resolve(void 0)}}},{key:"whenDefined",value:function(e){if(Xn(e))return i.whenDefined(Yn.name(e,o));var t=P(e).elementDef.name;return t?i.whenDefined(Yn.name(t,o)):L(e).promise}}]),e}())}}),q=function(){function e(){mn(this,e)}return gn(e,null,[{key:On,get:function(){return T}}]),e}();var M=Symbol("component-resolver");function L(e){return e[M]||(e[M]=new i)}var U=new hn("definition-context"),N=new hn("element-def",{byDefault:function(e){var t=e.get(U).componentType,n=w.of(t),r=n.name,u=n.extend,i={get type(){return u&&u.type||e.get(_).HTMLElement},get name(){return u&&u.name}};return{get name(){return r},get extend(){return i}}}}),z=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Rn),gn(e,[{key:"elementDef",get:function(){return this.get(N)}}],[{key:On,get:function(){return U}}]),e}(),B=new hn("bootstrap-context-registry"),I=function(){function t(){var e;return mn(this,t),(e=wn(this,kn(t).call(this))).provide({a:t,is:jn(e)}),e.values=e.newValues(),e}return pn(t,An),gn(t,null,[{key:"create",value:function(){return new t}},{key:On,get:function(){return B}}]),t}(),V=new hn("component-context-registry",{byDefault:e(function(){return new F})}),F=function(){function t(e){return mn(this,t),wn(this,kn(t).call(this,e))}return pn(t,An),gn(t,null,[{key:On,get:function(){return V}}]),t}(),H=new hn("definition-context-registry",{byDefault:e(function(e){return new Q(e)})}),Q=function(){function t(e){return mn(this,t),wn(this,kn(t).call(this,e))}return pn(t,An),gn(t,null,[{key:On,get:function(){return H}}]),t}(),G=new hn("element-builder",{byDefault:e(function(e){var p=e.get(Q),v=e.get(F),d=new bn,y=new bn;return{definitions:d,components:y,buildElement:function(u){var i,t,o=w.of(u),a=new bn,e=_n(!1),s=e.read.thru(function(e){return e?xn():Sn()});function r(){return v.append(i)}var c=new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,m),gn(e,[{key:"mountTo",value:function(n){if(n[R])throw new Error("Element ".concat(n," already bound to component"));var e=g({definitionContext:t,onComponent:a,registry:r(),element:n,elementSuper:function(e){return n[e]},createMount:function(t){return new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,C),gn(e,[{key:"checkConnected",value:function(){var e=n.ownerDocument;return this.connected=null!=e&&e.contains(n)}},{key:"context",get:function(){return t}},{key:"connected",get:function(){return 3===K(n).it},set:function(e){K(n).it=e?3:2}}]),e}())}}).mount;return e.checkConnected(),W(e.context),e}},{key:"componentType",get:function(){return t.componentType}},{key:"elementType",get:function(){return t.elementType}},{key:"elementDef",get:function(){return t.elementDef}}]),e}());t=new(function(){function r(){var e;mn(this,r),(e=wn(this,kn(r).call(this))).whenReady=s.thru(function(){return jn(e)}).once;var t=new Q(p.seedIn(jn(e)));if(t.provide({a:z,is:jn(e)}),t.provide({a:m,is:c}),e.get=t.newValues().get,i=new F(t.seedIn(jn(e))),o.setup){var n=jn(e);o.setup({get componentType(){return u},get whenReady(){return n.whenReady},perDefinition:function(e){return t.provide(e)},perComponent:function(e){return i.provide(e)}})}return e}return pn(r,z),gn(r,[{key:"perComponent",value:function(e){return i.provide(e)}},{key:"componentType",get:function(){return u}},{key:"onComponent",get:function(){return a.on}},{key:"elementType",get:function(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}}]),r}()),o.define&&o.define.call(u,t),d.send(t);var f,l,h,n=(f=t,l=a,h=r(),function(e){function n(){var t;return mn(this,n),t=wn(this,kn(n).call(this)),W(g({definitionContext:f,onComponent:l,registry:h,element:jn(t),createMount:En,elementSuper:function(e){return Pn(kn(n.prototype),e,jn(t))}})),t}return pn(n,e),gn(n,[{key:"connectedCallback",value:function(){K(this).it=3}},{key:"disconnectedCallback",value:function(){K(this).it=2}}]),n}(f.get(N).extend.type));return Object.defineProperty(t,"elementType",{configurable:!0,enumerable:!0,value:n}),e.it=!0,c}};function g(e){var t=e.definitionContext,n=e.onComponent,r=e.registry,u=e.element,i=e.createMount,o=e.elementSuper,a=_n(0),s=_n();a.on(En).whenOff(function(e){return s.it=[e]});var c,f=s.read.thru(function(e){return e?xn(e[0]):Sn()}).once,l=a.read.thru(function(e){return 2===e?xn():Sn()}),h=a.read.thru(function(e){if(3!==e)return Sn();var t=Tn();return l.once(function(){return t.off()}),xn(t)}),p=r.newValues(),v=new(function(){function n(){var t;mn(this,n),(t=wn(this,kn(n).call(this))).get=p.get,t.elementSuper=o;var e=a.read.thru(function(e){return e?xn(jn(t)):Sn()});return t.whenReady=e.once,t}return pn(n,D),gn(n,[{key:"destroy",value:function(e){a.done(e)}},{key:"componentType",get:function(){return t.componentType}},{key:"element",get:function(){return u}},{key:"component",get:function(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}},{key:"mount",get:function(){return c=c||i(this)}},{key:"connected",get:function(){return 3===a.it}},{key:"whenOn",get:function(){return h}},{key:"whenOff",get:function(){return l}},{key:"whenDestroyed",get:function(){return f}}]),n}());v.whenDestroyed(function(){return function(e){var t=e.element,n=e.mount;n&&(n.connected=!1);var r=t.parentElement;r&&r.removeChild(t)}(v)}),r.provide({a:D,is:v}),Object.defineProperty(u,R,{value:v}),Object.defineProperty(u,J,{writable:!0,value:a}),y.send(v),n.send(v);var d=function(e,t){var n=e.prototype,r=n[R];n[R]=t;try{var u=new e(t);return Object.defineProperty(u,R,{value:t}),u}finally{n[R]=r}}(t.componentType,v);return Object.defineProperty(v,"component",{configurable:!0,enumerable:!0,value:d}),a.it=1,v}})});var J=Symbol("component-status");function K(e){return e[J]}function W(e){e.dispatchEvent(new E("wesib:component",{bubbles:!0}))}var X=yn(En);var Y=function(){function n(e){var t=this;mn(this,n),this._context=e,this._definitionQueue=[],e.whenReady(function(){t._definitionQueue.forEach(function(e){return e()}),delete t._definitionQueue})}return gn(n,[{key:"define",value:function(t){var n=this;this._definitionQueue.push(function(){var e=n._context.get(G).buildElement(t);t[j]=e,n.customElements.define(t,e.elementType)})}},{key:"customElements",get:function(){return this._context.get(q)}}]),n}();function Z(e,u){var t=function(e){if(e.hasOwnProperty($))return e[$];var t=_n(),n=t.read.thru(function(e){return e?xn(e):Sn()});return Object.defineProperty(e,$,{value:n}),w.define(e,{setup:function(e){t.it=e}}),n}(e);return Gn(function(r){t({supply:r.supply.needs(u.supply),receive:function(e,t){var n=t.whenReady.tillOff(u.supply);r.receive(e,{get componentType(){return t.componentType},get whenReady(){return n},perDefinition:function(e){return u.add(function(){return t.perDefinition(e)})},perComponent:function(e){return u.add(function(){return t.perComponent(e)})}})}})})}var $=Symbol("featured-def-setup");var ee=Symbol("feature-key"),te=function(){function t(e){return mn(this,t),wn(this,kn(t).call(this,"feature:".concat(e.name)))}return pn(t,Cn),gn(t,null,[{key:"of",value:function(e){return e[ee]||(e[ee]=new t(e))}}]),gn(t,[{key:"grow",value:function(e){return l=e.context.get(a),t=e.seed.keep.thru(ne),qn(function(e){var s,r,c=Mn(),f=Promise.resolve("idle");return Ln({clause:t,deps:(r=l,t.keep.dig_(function(e){if(!e)return Mn();var t=Dn(e,1)[0].def,n=new h(t.needs);return n.size?Un.apply(void 0,Nn(n.map(function(e){return r.get(te.of(e))}))).keep.thru_(re):Mn()}))}).dig_(function(e){var t=Dn(e.clause,1)[0],n=e.deps;if(!t)return Mn();var r=Dn(t,3),u=r[0],i=r[2];if(u.feature===s)return c;if(i!==(s=u.feature))return c=l.get(te.of(s)).thru_(function(e){return e.to(f),f=e.stage,e});var o=new ue(l,u,n).to(f),a=Mn(o);return c=qn(function(e){return a(e).whenOff(function(){f=o.unload()})}).share()})(e)}).keep.thru(function(){var t=null;return function(e){return t===e?Sn():(t=e)?xn(e):xn()}}());var l,t}}]),t}();function ne(){for(var e,t=!1,n=arguments.length,r=new Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var i=0,o=r;i<o.length;i++){var a=o[i];switch(a[1]){case"is":t=!0,e=e||a;break;case"has":e=a;break;case"needs":t=!0}}return t?e:void 0}function re(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return xn.apply(void 0,Nn(zn(In(t,function(e){return e[0]}),Bn)))}var ue=function(){function u(e,t,n){var r=this;mn(this,u),this.bsContext=e,this.request=t,this.deps=n,this.state=_n(!1),this.down=new Promise(function(e){return r._down=e}),this._stage=Promise.resolve(new oe(this))}return gn(u,[{key:"to",value:function(e){var n=this._stage;return this._stage=e.then(function(t){return n.then(function(e){return e[t]()})}),this}},{key:"setup",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._stage=this._stage.then(function(e){return e.setup()}));case 2:case"end":return e.stop()}},null,this)}},{key:"init",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._stage=this._stage.then(function(e){return e.init()}));case 2:case"end":return e.stop()}},null,this)}},{key:"unload",value:function(){var t,n,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._stage,delete this._stage,e.next=4,regeneratorRuntime.awrap(t);case 4:return n=e.sent,e.next=7,regeneratorRuntime.awrap(n.stop());case 7:return r=e.sent,this._down(),e.abrupt("return",r);case 10:case"end":return e.stop()}},null,this)}},{key:"stage",get:function(){return this._stage.then(function(e){return e.after})}},{key:"ready",get:function(){return this.state.it}}]),u}(),ie=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return Promise.resolve()};mn(this,n),this.loader=e,this._stop=t}return gn(n,[{key:"idle",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)}},{key:"stop",value:function(){var e=this;return this._stop().then(function(){return e.after})}},{key:"perDep",value:function(t){var e=this.loader.deps;return Promise.all(e.map(function(e){return t(e)}))}}]),n}(),oe=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,ie),gn(e,[{key:"setup",value:function(){var t,n,r,u,i,o,a,s,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.perDep(function(e){return e.setup()}));case 2:return t=this.loader,n=t.bsContext,r=t.request,u=r.feature,i=r.def.setup,o=ce(n,this.loader),a=Dn(o,2),s=a[0],c=a[1],i&&i.call(u,s),e.abrupt("return",new ae(this.loader,s,function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.off());case 1:case"end":return e.stop()}})}));case 6:case"end":return e.stop()}},null,this)}},{key:"init",value:function(){return this.setup().then(function(e){return e.init()})}},{key:"after",get:function(){return"idle"}}]),e}(),ae=function(){function u(e,t,n){var r;return mn(this,u),(r=wn(this,kn(u).call(this,e,n)))._context=t,r}return pn(u,ie),gn(u,[{key:"setup",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)}},{key:"init",value:function(){var t,n,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.perDep(function(e){return e.init()}));case 2:return t=this.loader.request,n=t.feature,r=t.def.init,r&&r.call(n,this._context),e.abrupt("return",new se(this));case 5:case"end":return e.stop()}},null,this)}},{key:"after",get:function(){return"setup"}}]),u}(),se=function(){function n(e){var t;return mn(this,n),t=wn(this,kn(n).call(this,e.loader,function(){return e.stop()})),e.loader.state.it=!0,t}return pn(n,ie),gn(n,[{key:"after",get:function(){return"init"}}]),gn(n,[{key:"setup",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)}},{key:"init",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}},null,this)}}]),n}();function ce(r,u){var n,t,i,o=(n=[],t=function(e){var t=e();return n.push(t),t},{supply:Tn(function(){t=X,Kn(Wn(n).reverse(),function(e){return e()}),n.length=0}),add:function(e){return t(e)}}),a=r.get(Q),s=r.get(F),c=new An(r),e=r.get(G),f=e.definitions.on.tillOff(o.supply),l=e.components.on.tillOff(o.supply);return[new(function(){function t(){var n;mn(this,t),(n=wn(this,kn(t).call(this))).get=c.newValues().get;var e=Ln({st:u.state,bs:_n().by(r.whenReady)}).thru(function(e){var t=Dn(e.st,1)[0];return Dn(e.bs,1)[0]&&t?xn(jn(n)):Sn()});return n.whenReady=e.once,c.provide({a:p,is:jn(n)}),i=new Y(jn(n)),n}return pn(t,p),gn(t,[{key:"provide",value:function(e){return o.add(function(){return r.get(I).provide(e)})}},{key:"perDefinition",value:function(e){return o.add(function(){return a.provide(e)})}},{key:"perComponent",value:function(e){return o.add(function(){return s.provide(e)})}},{key:"setupDefinition",value:function(e){return Z(e,o)}},{key:"define",value:function(e){i.define(e)}},{key:"onDefinition",get:function(){return f}},{key:"onComponent",get:function(){return l}}]),t}()),o.supply]}var fe=function(){function r(e,t,n){mn(this,r),this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=c.of(t)}return gn(r,[{key:"request",value:function(r){var u=this,i=this._requester,o=i.registry,e=[this,"is",this.feature];return this._revokeBy(o.provide({a:te.of(this.feature),is:e})),new h(this.def.has).forEach(function(e){var t=[u,"has",e];u._revokeBy(o.provide({a:te.of(e),is:t}));var n=i.request(e,[].concat(Nn(r),[t]));u._revokeBy(function(){return n.unuse()})}),new h(this.def.needs).forEach(function(e){var t=[u,"needs",e],n=i.request(e,[].concat(Nn(r),[t]));u._revokeBy(function(){return n.unuse()}),u._revokeBy(o.provide({a:te.of(e),is:t}))}),this._uses=1,this}},{key:"reuse",value:function(e){if(!this._uses)throw new l(e.map(function(e){var t=Dn(e,3);return[t[0].feature,t[1],t[2]]}));return++this._uses,this}},{key:"unuse",value:function(){--this._uses||this._revoke()}},{key:"_revokeBy",value:function(e){this._revoke=y(e,this._revoke)}}]),r}(),le=new hn("feature-requester",{byDefault:e(function(e){return new he(e)})}),he=function(){function t(e){mn(this,t),this._map=new Map,this.registry=e.get(I)}return gn(t,[{key:"request",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=this._map.get(e);if(r)return r.reuse(n);var u=new fe(this,e,function(){return t._map.delete(e)});return this._map.set(e,u),u.request(n)}}],[{key:On,get:function(){return le}}]),t}();var pe=Symbol("attribute");function ve(e,t){var n=!(1<arguments.length&&void 0!==t)||t;if(!1===n)return En;if(!0!==n&&"function"!=typeof n)return function(e,t){D.of(this).updateState(n,e,t)};var r=[pe,e],u=!0===n?de:n;return function(e,t){u.call(this,r,e,t)}}function de(e,t,n){D.of(this).updateState(e,t,n)}var ye=new hn("attribute-registrar"),ge=new hn("attribute-registry"),me=function(){function t(e){mn(this,t),this._attrs={},this._MutationObserver=e.get(_).MutationObserver}return gn(t,[{key:"add",value:function(e,t){this._attrs[e]=y(this._attrs[e],t)}},{key:"define",value:function(e){var r=this._attrs,t=Object.keys(r);t.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:t}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,t,n){r[e].call(D.of(this).component,n,t)}}))}},{key:"mount",value:function(e){var n=e.element,r=this._attrs,t=Object.keys(r);t.length&&new this._MutationObserver(function(e){return e.forEach(function(e){var t=e.attributeName;return r[t].call(D.of(n).component,n.getAttribute(t),e.oldValue)})}).observe(n,{attributes:!0,attributeFilter:t,attributeOldValue:!0})}}],[{key:On,get:function(){return ge}}]),t}(),we={setup:function(e){e.perDefinition({as:me}),e.perDefinition({a:ye,by:function(n){return function(e,t){return n.add(e,t)}},with:[me]}),e.onDefinition(function(n){n.whenReady(function(e){var t=e.elementType;return n.get(me).define(t)})}),e.onComponent(function(e){var t=e.mount;t&&e.get(me).mount(t)})}},ke=function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return we}}]),e}();var be=Symbol("dom-property");var _e=new hn("component-state"),xe=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Fn),gn(e,null,[{key:On,get:function(){return _e}}]),e}(),Se={setup:function(e){e.perComponent({a:xe,by:function(e){var t=new xe;return e.whenDestroyed(function(e){return t.done(e)}),t}}),e.perComponent({a:O,by:function(e){return e.update},with:[xe]})}},Oe=function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Se}}]),e}(),Re=new hn("render-scheduler"),De=function(){function e(){mn(this,e)}return gn(e,null,[{key:On,get:function(){return Re}}]),e}(),Ee={render:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:{},u=e.get(xe),i=e.get(De).newSchedule(),o=r.offline,a=!1,s=u.onUpdate(function(){o||e.connected?c():a=!1});function c(){a=!0,i.schedule(f)}function f(){for(;;){var e=t();if(e===t||"function"!=typeof e)break;t=e}}o?c():e.whenOn(function(){a||c()}).whenOff(function(e){s.off(e),a=!0})}},Ce={setup:function(e){e.provide({a:De,by:je,with:[_]})}},Ae=ln("R",function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Ce}}]),e}());function je(r){return new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,De),gn(e,[{key:"newSchedule",value:function(){var n=En;return new(function(){function e(){mn(this,e)}return gn(e,[{key:"schedule",value:function(e){var t=n;n=e,t===En&&r.requestAnimationFrame(function(){n(),n=En})}}]),e}())}}]),e}())}var Pe=new hn("shadow-content-root"),Te=function(e){function n(e,t){return mn(this,n),wn(this,kn(n).call(this,e,t))}return pn(n,e),gn(n,[{key:"shadowRoot",get:function(){return this.target.shadowRoot}}]),n}(vn(Event)),qe=new dn("shadow-root-builder"),Me={setup:function(e){e.provide({a:qe,is:Ue})}},Le=function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Me}}]),e}();function Ue(e,t){var n=function(e,t){var n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);if(n)return(n[R]=e).dispatchEvent(new Te("wesib:shadowAttached",{bubbles:!0})),n}var Ne={mode:"open"},ze={componentDef:function(e){var t=0<arguments.length&&void 0!==e?e:Ne;return{setup:function(e){e.perComponent({a:Pe,by:function(e){return e.get(qe)(e,t)}}),e.perComponent({a:S,by:function(e){return e.get(Pe,{or:null})}})},feature:{needs:Le}}}};var Be=function(){function t(e){return mn(this,t),wn(this,kn(t).call(this,e))}return pn(t,Cn),gn(t,[{key:"grow",value:function(e){var r;return e.seed(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=t,r=function(u,e){return function e(t,n){var r=i[t];return r?hr(r(function(){return e(t+1,0<arguments.length&&void 0!==arguments[0]?arguments[0]:n)},n)):u(n)}(0,e)};var i}),e.byDefault(function(){return function(e,t){return r(e,t)}})||Ie}}]),t}();function Ie(e,t){return e(t)}var Ve=new Be("http-fetch-agent"),Fe={};var He=new dn("http-fetch",{byDefault:e(function(e){var a=e.get(_),n=e.get(Ve);return function(e,t){return n(r,new Request(e,t))};function r(o){return Gn(function(n){var t,r=new bn;if("AbortController"in a){var u=new a.AbortController,e=u.signal;t=Tn(function(e){e===Fe&&u.abort()}),n.supply.whenOff(function(){return t.off(Fe)}).needs(t),r.on({supply:t,receive:function(e,t){n.receive(e,t)}});var i=o.signal;i&&(new Qn(i).on("abort").once(function(){return u.abort()}),i.aborted&&u.abort()),o=new Request(o,{signal:e})}else t=r.on(n);a.fetch(o).then(function(e){r.send(e),t.off()}).catch(function(e){return t.off(e)})})}})}),Qe=function(e){function r(e,t){var n;return mn(this,r),(n=wn(this,kn(r).call(this,e,Object.assign(Object.assign({},t),{cancelable:!1})))).when=t.when,n.to=t.to,n}return pn(r,e),r}(vn(Event)),Ge=function(e){function r(e,t){var n;return mn(this,r),(n=wn(this,kn(r).call(this,e,Object.assign(Object.assign({},t),{cancelable:!0})))).when=t.when,n.from=t.from,n.to=t.to,n}return pn(r,e),r}(vn(Event)),Je=function(e){function r(e,t){var n;return mn(this,r),(n=wn(this,kn(r).call(this,e,Object.assign(Object.assign({},t),{cancelable:!0})))).from=t.from,n.to=t.to,n.reason=t.reason,n}return pn(r,e),gn(r,[{key:"when",get:function(){return"stay"}}]),r}(vn(Event)),Ke=new hn("navigation"),We=ln("N",function(){function e(){mn(this,e)}return gn(e,[{key:"back",value:function(){this.go(-1)}},{key:"forward",value:function(){this.go(1)}},{key:"reload",value:function(){this.go()}},{key:nr,get:function(){return this.on}},{key:Jn,get:function(){return this.read}}],[{key:On,get:function(){return Ke}}]),e}()),Xe=new(function(){function t(e){return mn(this,t),wn(this,kn(t).call(this,e))}return pn(t,Cn),gn(t,[{key:"grow",value:function(i){var f=i.context.get(_).document;return function(e,t,n,r){var u=i.byDefault(function(){return o});return u?u(e,t,n,r):e(r)};function o(t,n,r,e){var u;return i.seed.once(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u=t}),function a(s,c){var e=u[s];if(!e)return t(c);e(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:c,t=e.url,n=void 0===t?c.url:t,r=e.title,u=void 0===r?c.title:r,i=e.data,o=void 0===i?c.data:i;return a(s+1,{url:new URL(String(n),f.baseURI),title:u,data:o,get visited(){return c.visited},get current(){return c.current},get:function(e){return c.get(e)},put:function(e,t){c.put(e,t)}})},n,r,c)}(0,e)}}}]),t}())("navigation-agent"),Ye=Symbol("page-param"),Ze=function(){function e(){mn(this,e)}return gn(e,[{key:Ye,get:function(){return this}}]),e}(),$e=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Rn),e}(),et=new hn("navigation-history",{byDefault:e(function(e){return new tt(e)})}),tt=function(){function n(e){mn(this,n),this._context=e,this._entries=new Map,this._lastId=0;var t=e.get(_);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}return gn(n,[{key:"init",value:function(){var e=this,t=rt(this._history.state).data,n=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(n.id,n),n.schedule(function(){n.enter("init"),e._history.replaceState(e._historyState(n),"")}),n}},{key:"newEntry",value:function(e){return new ut(this._context,++this._lastId,e)}},{key:"open",value:function(e,t){var n=e.page,r=n.title,u=void 0===r?"":r,i=n.url;this._history.pushState(this._historyState(e),u,i.href),this._enter("open",e,t)}},{key:"_enter",value:function(e,t,n){var r=n.it;this._entries.set(t.id,t);try{for(var u=r.next;u;u=u.next)this._forget(u)}finally{((t.prev=r).next=t).schedule(function(){try{r.leave()}finally{t.enter(e)}}),n.it=t}}},{key:"replace",value:function(e,t){var n=this,r=t.it,u=e.page,i=u.title,o=void 0===i?"":i,a=u.url;this._history.replaceState(this._historyState(e),o,a.href),this._entries.set(e.id,e);var s=r.prev;s&&((e.prev=s).next=e),e.schedule(function(){try{r.leave()}finally{try{n._forget(r)}finally{e.enter("replace")}}}),t.it=e}},{key:"popState",value:function(e,t){var n=e.state;if(null==n)return null==this._history.state?this._changeHash(t):void 0;var r,u=t.it,i=rt(n),o=i.uid,a=i.data,s=i.id,c=o===this._uid&&null!=s?this._entries.get(s):void 0;return c?r=c:(r=this.newEntry({url:new URL(this._location.href),data:a,title:this._document.title}),u.transfer(r,"return"),this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"")),r.schedule(function(){try{u.leave()}finally{r.enter("return")}}),t.it=r}},{key:"hashChange",value:function(e){if(null==this._history.state)return this._changeHash(e)}},{key:"update",value:function(e,t){var n=e.it,r=new ut(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"",t.href),this._entries.delete(n.id),e.it=r}},{key:"_changeHash",value:function(e){var t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}},{key:"_forget",value:function(e){this._entries.delete(e.id),e.forget()}},{key:"_historyState",value:function(e){var t=e.id,n=e.page.data;return _r({},nt,{uid:this._uid,id:t,data:n})}}],[{key:On,get:function(){return et}}]),n}(),nt="wesib:navigation:data";function rt(e){return null==e||"object"!==br(e)?{data:e}:e[nt]}var ut=function(){function i(e,t,n,r){mn(this,i),this._context=e,this.id=t,this._status=0,this._update=En,this._params=r?r._params:new Map;var u=this;this.page={url:n.url,title:n.title,data:n.data,get visited(){return!!u._status},get current(){return 2===u._status},get:function(e){return u.get(e)},put:function(e,t){u.put(e,t)}}}return gn(i,[{key:"get",value:function(e){var t=this._params.get(e[Ye]);return t&&t.get()}},{key:"put",value:function(e,t){var n=e[Ye],r=this._params.get(n);if(r)return r.put(t),r.get();var u=new An(this._context),i=function(){function t(){var e;return mn(this,t),(e=wn(this,kn(t).apply(this,arguments))).get=u.newValues().get,e}return pn(t,$e),t}(),o=n.create(this.page,t,new i);return this._params.set(n,o),this.page.current&&o.enter&&o.enter(this.page,"init"),o.get()}},{key:"transfer",value:function(i,o){Kn(this._params.entries(),function(e){var t=Dn(e,2),n=t[0],r=t[1];if(r.transfer){var u=r.transfer(i.page,o);u&&i._params.set(n,u)}})}},{key:"stay",value:function(t){Kn(this._params.values(),function(e){return e.stay&&e.stay(t)})}},{key:"enter",value:function(t){var n=this;this._status=2,Kn(this._params.values(),function(e){return e.enter&&e.enter(n.page,t)})}},{key:"leave",value:function(){this._status=1,Kn(this._params.values(),function(e){return e.leave&&e.leave()})}},{key:"forget",value:function(){Kn(this._params.values(),function(e){return e.forget&&e.forget()}),this._params.clear()}},{key:"schedule",value:function(e){this._update=e}},{key:"apply",value:function(){var e=this._update;this._update=En,e()}}]),i}();function it(e){var t=e.get(_),n=t.document,r=t.history,f=new Qn(t),l=e.get(tt),h=e.get(Xe),u=f.on("wesib:enterPage"),i=f.on("wesib:leavePage"),o=f.on("wesib:stayOnPage"),a=wr(u,i,o),p=_n(l.init());p.read(function(e){return e.apply()});var s=p.read.keep.thru(function(e){return e.page}),v=Promise.resolve();return f.on("popstate")(function(e){var t=l.popState(e,p);t&&f.dispatch(new Qe("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),f.on("hashchange")(function(){var e=l.hashChange(p);e&&f.dispatch(new Qe("wesib:enterPage",{when:"enter",to:e.page}))}),new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,We),gn(e,[{key:"go",value:function(e){r.go(e)}},{key:"open",value:function(e){return c("pre-open","open",e)}},{key:"replace",value:function(e){return c("pre-replace","replace",e)}},{key:"update",value:function(e){return l.update(p,d(e)).page}},{key:"with",value:function(t,n){return function e(r){return{with:function(t,n){return e(y(r,function(e){return e.put(t,n)}))},open:function(e){return c("pre-open","open",e,r)},replace:function(e){return c("pre-replace","replace",e,r)}}}(function(e){return e.put(t,n)})}},{key:"length",get:function(){return r.length}},{key:"onEnter",get:function(){return u}},{key:"onLeave",get:function(){return i}},{key:"onStay",get:function(){return o}},{key:"on",get:function(){return a}},{key:"read",get:function(){return s}}]),e}());function d(e){return"string"==typeof e?new URL(e,n.baseURI):e||p.it.page.url}function c(u,n,e,t){var r,i=3<arguments.length&&void 0!==t?t:En,o="string"==typeof(r=e)||r instanceof URL?{url:d(r)}:r.url instanceof URL?r:Object.assign(Object.assign({},r),{url:d(r.url)}),a=v=v.then(s,s);return a;function s(){var t;try{var e=function(){if(v!==a)return c();var e=p.it,t=l.newEntry(o);e.transfer(t,u);var n,r=new Ge("wesib:leavePage",{when:u,from:e.page,to:t.page});return i(t.page),f.dispatch(r)&&v===a?(h(function(e){return n=e},u,r.from,r.to),n?t:c(t)):c(t)}();return e?(t=e,l[n](t,p),f.dispatch(new Qe("wesib:enterPage",{when:n,to:t.page})),t.page):e}catch(e){throw c(t,e),e}}function c(e,t){return e&&e.stay(p.it.page),f.dispatch(new Je("wesib:stayOnPage",{from:p.it.page,to:o,reason:t})),null}}}var ot={setup:function(e){e.provide({a:We,by:it})}},at=function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return ot}}]),e}();function st(s){var n;return function(i){var o,e=new URL("",i.url).href;if(n){if(n.url===e)return n.on;n.sup.off()}var a=Tn().whenOff(function(){o=n=void 0}),t=Gn(function(e){if(!o){var t=s(i),n=_n(),r=t(function(e){n.it=e}).whenOff(function(e){null!=e&&a.off(e)});a.whenOff(function(e){r.off(e),n.done(e)}),o={on:n.read.thru_(function(e){return e?xn(e):Sn()}),num:0}}var u=o;return++u.num,u.on(e).needs(a).whenOff(function(e){--u.num||Promise.resolve().then(function(){u.num||u!==o||a.off(e)})})});return n={url:e,on:t,sup:a},t}}var ct=function(e){function t(){return mn(this,t),wn(this,kn(t).apply(this,arguments))}return pn(t,e),t}(vn(Error)),ft=function(){function c(e,t){mn(this,c),this._navigation=e,this._loader=t,this._map=new Map}return gn(c,[{key:Symbol.iterator,value:function(){return rr(ur(this._map.values(),ir))}},{key:"handle",value:function(){var u=this,t=Tn(),o=fr();return{get:function(){},put:function(e){u._add(e)},transfer:function(e){var t=u._transfer();return e.put(lt,t),t.handle()},enter:function(r,e){if("init"!==e){o=Tn().needs(t);var i=Gn(function(e){var t=new bn,n=t.on(e);return u._loader(r)(function(e){return t.send(e)}).whenOff(function(e){void 0===e||e instanceof ct||t.send({ok:!1,page:r,error:e})}).needs(o),n}).share();Kn(u,function(e){var t,n,r=e.fragment,u=e.receiver;return t=i,((n=r)?t.thru_(function(e){return e.ok?Object.assign(Object.assign({},e),{fragment:(null!=n.tag?e.document.getElementsByTagName(n.tag)[0]:e.document.getElementById(n.id))||void 0}):e}):t)({supply:Tn().needs(u.supply),receive:function(e,t){u.receive(e,t)}})})}},leave:function(){o.off(new ct("page left"))},stay:function(){t.off(new ct("navigation cancelled"))},forget:function(){t.off(new ct("page forgotten"))}}}},{key:"_add",value:function(e){var t=this,n=Object.assign(Object.assign({},e),{receiver:or(e.receiver)}),r=n.receiver.supply,u=this._map.get(r);u?u.push(n):(this._map.set(r,[n]),r.whenOff(function(){return t._map.delete(r)}))}},{key:"_transfer",value:function(){var e=new c(this._navigation,this._loader),t=!0,n=!1,r=void 0;try{for(var u,i=this._map.entries()[Symbol.iterator]();!(t=(u=i.next()).done);t=!0){var o=Dn(u.value,2),a=o[0],s=o[1];e._map.set(a,Nn(s))}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"fragments",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var u,i=this[Symbol.iterator]();!(t=(u=i.next()).done);t=!0){var o=u.value;if(!o.fragment)return[];e.push(o.fragment)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}}]),c}();var lt=new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Ze),gn(e,[{key:"create",value:function(e,t){return{get:function(){return t},put:En}}}]),e}()),ht=new Be("page-load-agent"),pt=new dn("page-load-url",{byDefault:yn(En)}),vt=new hn("page-loader",{byDefault:e(function(e){var t=e.get(_),s=e.get(He),r=e.get(pt),i=e.get(ht),c=new t.DOMParser;return function(a){var u=new URL(a.url.href);r(u);var t=new Request(u.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return Gn(function(e){return i(n,t)(e)});function n(e){var t,n,r;t=e,r=null===(n=a.get(lt))||void 0===n?void 0:n.fragments,e=r&&r.length?new Request(t,{headers:{"Accept-Fragment":ar(r,function(e,t){return(e?e+", ":"")+(null!=t.tag?"tag="+sr(t.tag):"id="+sr(t.id))},"")}}):t;var i=new bn,o=i.on.thru_(function(t,e){if(!t.ok)return{ok:!1,page:a,response:t,error:t.status};try{return{ok:!0,page:a,response:t,document:function(e,t,n,r){var u=e.parseFromString(r,cr(n.headers.get("Content-Type")||"text/html")[0].v);if(u.head){var i=u.head.querySelector("base");if(i)i.href=new URL(i.getAttribute("href"),t).href;else{var o=u.createElement("base");o.href=t.href,u.head.appendChild(o)}}return u}(c,u,t,e)}}catch(e){return{ok:!1,page:a,response:t,error:e}}});return Gn(function(n){var r=n.supply;Mn({page:a}).once({supply:Tn().needs(r),receive:function(e,t){n.receive(e,t)}});var u=s(e)(function(t){o(n),t.text().then(function(e){i.send(t,e),r.needs(u)}).catch(function(e){return r.off(e)})})})}}})});ln("p",new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Ze),gn(e,[{key:"create",value:function(e,t,n){var r=new ft(n.get(We),st(n.get(vt))),u=r.handle();return e.put(lt,r),u.put(t),u}}]),e}()));var dt=new hn("page-cache-buster",{byDefault:e(function(e){return new gt(e)})}),yt="__wesib_app_rev__",gt=function(){function t(e){mn(this,t);var r=mt(e.get(_).document);if(r){var u=e.get(We);this.urlModifier=Mn(function(e){return e.searchParams.set(yt,r)}),this.agent=Mn(function(e,t){return e(new Request(t.url,t)).thru_(function(e){if(e.ok){var t=mt(e.document);if(t&&t!==r){var n=new URL(e.page.url.href);n.searchParams.set(yt,t),u.update(n),u.reload()}}return e})})}else this.urlModifier=Mn(),this.agent=Mn()}return gn(t,null,[{key:On,get:function(){return dt}}]),t}();function mt(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function wt(e,t,n,r){var u,i=3<arguments.length&&void 0!==r?r:kt;u="function"==typeof n?(i=n,null):n||null;var o=t.ownerDocument;if(e.nodeType!==Node.ELEMENT_NODE){var a=o.importNode(e,!1);return t.insertBefore(a,u),a}var s=e,c=o.createElement(s.tagName.toLowerCase());return s.getAttributeNames().forEach(function(e){return c.setAttribute(e,s.getAttribute(e))}),i(e,c),t.insertBefore(c,u),c}function kt(e,t){Kn(Wn(e.childNodes),function(e){return wt(e,t)})}function bt(e){var u=e.get(_).document;return function(e){return e().thru_(function(e){if(e.ok){var r=new Set(In(_t(u,Wn(u.scripts)),function(e){return Dn(e,1)[0]}));Kn(zn(_t(e.document,Wn(e.document.querySelectorAll("script"))),function(e){var t=Dn(e,1)[0];return!r.has(t)}),function(e){var t=Dn(e,2),n=t[0];wt(t[1],u.head,function(e,t){return t.src=n}),r.add(n)})}return e})}}function _t(t,e){return In(zn(e,function(e){return!!e.src}),function(e){return[new URL(e.src,t.baseURI).href,e]})}function xt(e){var a=e.get(_).document;return function(e){return e().thru_(function(e){if(!e.ok)return e;var t=e.document.querySelectorAll("link[rel=stylesheet]");if(!t.length)return e;var r=a.head,u=null,n=a.querySelectorAll("link[rel=stylesheet]"),i=new Map,o=n.item(0);return o&&(r=o.parentNode,u=o,Kn(Wn(n),function(e){return i.set(new URL(e.href,a.baseURI).href,e)})),Kn(Wn(t),function(e){var n=new URL(e.href,a.baseURI).href,t=i.get(n);t?(pr(i.keys())===n?(r=t.parentNode,u=t.nextSibling):r.insertBefore(t,u),i.delete(n)):wt(e,r,u,function(e,t){return t.href=n})}),Kn(i.values(),function(e){return e.parentNode.removeChild(e)}),e})}}function St(e){var n=e.get(_).document;return function(e){return e().thru_(function(e){if(e.ok){var t=e.document.getElementsByTagName("title").item(0);t&&t.textContent&&(n.title=t.textContent)}return e})}}var Ot={needs:at,setup:function(e){e.provide({a:pt,by:function(e){return e.urlModifier},with:[gt]}),e.provide({a:ht,by:function(e){return e.agent},with:[gt]}),e.provide({a:ht,by:bt}),e.provide({a:ht,by:xt}),e.provide({a:ht,by:St})}},Rt=(ln("d",function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Ot}}]),e}()),new hn("component-style-producer")),Dt=new vr("component-styp-render"),Et=new Zn("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Ct=new hn("unique-element-class",{byDefault:function(e){var t=e.get(x),n=e.get(D),r=n.get(N),u=r.name?Yn.name(r.name,t):"component",i="".concat(u,"#").concat(++At),o=Et.name(t(Et),i,dr);return n.element.classList.add(o),o}}),At=0;var jt=new hn("component-style-producer:impl"),Pt=[{e:":host"}],Tt=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:gr;mn(this,n),this._context=e,this._produce=t}return gn(n,[{key:"produce",value:function(e,t){var n,r=1<arguments.length&&void 0!==t?t:{},u=this._context,i=u.get(Pe,{or:null});return this._produce(e,Object.assign(Object.assign({},r),{document:r.document||u.get(_).document,parent:r.parent||u.get(S),rootSelector:r.rootSelector||(i?Pt:[]),schedule:r.schedule||(n=u.get(De),function(e){return n.newSchedule().schedule(e)}),nsAlias:r.nsAlias||u.get(x),render:function(){var e,t=r.render,n=(e=new h(t)).add.apply(e,Nn(u.get(Dt)));i||n.add(function(n){return{order:-100,render:function(e,t){e.render(t,{selector:[{c:[n]}].concat(Nn(e.selector))})}}}(u.get(Ct)));return n.value}()}))}}],[{key:On,get:function(){return jt}}]),n}();var qt={needs:Ae,setup:function(e){e.perComponent({as:Tt}),e.perComponent({a:Rt,by:function(n){return function(e,t){return n.produce(e,t)}},with:[Tt]})}},Mt=function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return qt}}]),e}(),Lt={produce:function(e,t,n){var r,u=$n(t),i=n&&n.offline,o=e.get(Rt),a=fr(),s=Tn(function(e){r=En,a.off(e)});switch(r=function(){a=o(u,n).needs(s)},i){case"always":e.whenReady(r);break;case!1:e.whenOn(function(e){r(),a.needs(e)});break;default:e.whenOn.once(r)}return e.whenDestroyed(function(e){return s.off(e)}),s}};var Ut={has:Mt,setup:function(e){e.perComponent({a:Tt,by:function(e){return new Tt(e,lr)}}),e.perComponent({a:Rt,by:function(n){return function(e,t){return n.produce(e,t)}},with:[Tt]})}},Nt=(ln("S",function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Ut}}]),e}()),new hn("theme")),zt=ln("T",function(){function e(){mn(this,e)}return gn(e,[{key:"ref",value:function(e){return e(this.root)}}],[{key:On,get:function(){return Nt}}]),e}()),Bt=new hn("theme-factory"),It=function(){function e(){mn(this,e)}return gn(e,null,[{key:On,get:function(){return Bt}}]),e}(),Vt=new(function(){function e(){return mn(this,e),wn(this,kn(e).call(this,"theme-style"))}return pn(e,tr),gn(e,[{key:"grow",value:function(e){var s=new Map;return e.seed.forEach(function(e){var t,n,r;r="function"==typeof e?(t=n=e,!0):(t=e.style,n=e.provide.bind(e),!1);var u=s.get(t);if(u){var i=Dn(u,2),o=i[0],a=i[1];s.set(t,[r?Ft(n,o):Ft(o,n),r||a])}else s.set(t,[n,r])}),s.size?t:e.byDefault(function(){return t});function t(e){var t=s.get(e);if(!t)return e;var n=Dn(t,2),r=n[0];return n[1]?r:Ft(e,r)}}}]),e}());function Ft(t,n){return function(e){return er(t(e),n(e))}}function Ht(){mn(this,Ht)}var Qt=function(){function n(e){var t;return mn(this,n),(t=wn(this,kn(n).call(this)))._styles=e,t.root=yr(),t._rules=new Map,t}return pn(n,zt),gn(n,[{key:"style",value:function(){for(var u=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return $n.apply(void 0,Nn(t.reduce(function(e,t){var n=u._rules.get(t);if(n)e.push(n);else{var r=u._styles(t)(u);u._rules.set(t,r),e.push(r)}return e},[])))}}]),n}(),Gt=function(){function n(e){var t;return mn(this,n),(t=wn(this,kn(n).call(this)))._styles=e,t}return pn(n,It),gn(n,[{key:"newTheme",value:function(){return new Qt(this._styles)}}]),n}(),Jt={needs:Mt,setup:function(e){e.provide({a:It,as:Gt,with:[Vt]}),e.provide({a:zt,by:function(e){return e.newTheme()},with:[It]})}},Kt=(ln("e",function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return Jt}}]),e}()),ln("a",new hn("component-node"))),Wt=function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Hn),gn(e,[{key:nr,get:function(){return this.onUpdate}},{key:Jn,get:function(){return this.read}}]),e}(),Xt={childList:!0},Yt={childList:!0,subtree:!0};function Zt(u,r,e,i,t){var n,o,a=t.deep,s=t.all,c=new bn,f=a?Yt:Xt,l=new Set;"string"==typeof e?o=e:u.whenDefined(e).then(function(e){var t=e.elementDef.name;if(t&&(o=Yn.name(t,u.get(x)),c.size)){var n=w();if(n.size){var r=Nn(zn(In(n,function(e){return i(e)}),en));r.length&&c.send(r,[])}}});var h,p=new(u.get(_).MutationObserver)(function(e){var t=[],n=[];e.forEach(function(e){Kn(zn(In(Wn(e.removedNodes),b),en),function(e){return n.push(e)}),Kn(zn(In(Wn(e.addedNodes),k),en),function(e){return t.push(e)})}),(t.length||n.length)&&c.send(t,n)}),v=Gn(function(e){var t=!c.size,n=c.on(e);return t&&(w(),p.observe(r,f)),Tn(function(e){n.off(e),c.size||p.disconnect()}).needs(n)}),d=qn(v.thru(function(){return h}),function(){return[h]}),y=v.thru(function(e,t){return xn(Hn.of(e),Hn.of(t))}),g=qn(function(e){var t=new bn;t.on(e),t.send(h,Hn.of([])),y(e)}),m=mr(d).keep.thru(pr);return s||r.addEventListener("wesib:component",function(e){var t=e.target;if(l.has(t)){var n=i(t);c.send([n],[n])}}),h=new(function(){function e(){return mn(this,e),wn(this,kn(e).apply(this,arguments))}return pn(e,Wt),gn(e,[{key:Symbol.iterator,value:function(){return rr(n=n||zn(In(c.size?l:w(),function(e){return i(e)}),en))}},{key:"onUpdate",get:function(){return v}},{key:"read",get:function(){return d}},{key:"track",get:function(){return g}},{key:"first",get:function(){return m}}]),e}());function w(){return n=void 0,l=function(){var t=o;if(!t)return new Set;if(a)return new Set(Wn(r.querySelectorAll(t)));return new Set(zn(Wn(r.children),function(e){return e.matches(t)}))}()}function k(e){if($t(e))return o&&e.matches(o)&&!l.has(e)?(l.add(e),i(e)):void 0}function b(e){if($t(e)&&l.delete(e))return i(e,!0)}}function $t(e){return e.nodeType===Node.ELEMENT_NODE}function en(e){return null!=e}var tn=function(){function n(e,t){mn(this,n),this._bs=e,this.element=t,this._emitters=new Map}return gn(n,[{key:"observe",value:function(e,t){var n=this,r=this,u=this.observer,i=this._emitter(e),o=or(t),a=i.on({supply:Tn(function(){n._emitters.delete(e),u.disconnect(),n._emitters.size?s():n._observer=void 0}).needs(o.supply),receive:function(e,t,n){return o.receive(e,t,n)}});return u.disconnect(),s(),a;function s(){r._update(u.takeRecords()),u.observe(r.element,{attributes:!0,attributeOldValue:!0,attributeFilter:Nn(r._emitters.keys())})}}},{key:"_update",value:function(e){var r=this;e.forEach(function(e){var t=e.attributeName,n=r._emitters.get(t);n&&n.send(r.element.getAttribute(t),e.oldValue)})}},{key:"_emitter",value:function(e){var t=new bn;return this._emitters.set(e,t),t}},{key:"observer",get:function(){var t=this;if(this._observer)return this._observer;var e=this._bs.get(_).MutationObserver;return this._observer=new e(function(e){return t._update(e)})}}]),n}(),nn=function(){function u(e,t){var n;mn(this,u),(n=wn(this,kn(u).call(this)))._observer=e,n._name=t,n._updates=new bn;var r=fr();return n.on=Gn(function(e){n._updates.size||(r=n._observer.observe(t,function(e,t){return n._updates.send(e,t)})),e.supply.needs(r),n._updates.on(e).whenOff(function(e){n._updates.size||r.off(e)})}),n}return pn(u,kr),gn(u,[{key:"done",value:function(e){return this._updates.done(e),this}},{key:"it",get:function(){return this._observer.element.getAttribute(this._name)},set:function(e){this._observer.element.setAttribute(this._name,e)}}]),u}(),rn=function(){function n(e,t){mn(this,n),this._attrs=new Map,this._observer=new tn(e,t)}return gn(n,[{key:"get",value:function(e){var t=this._attrs.get(e);if(t)return t;var n=new nn(this._observer,e);return this._attrs.set(e,n),n}}]),n}(),un=function(){function r(e,t){var n;return mn(this,r),(n=wn(this,kn(r).call(this)))._element=e,n._key=t,n._updates=new bn,n._supply=fr(),n}return pn(r,kr),gn(r,[{key:"bind",value:function(e){var t,u=this,n=e.get(xe).track((t=this._key,[be,t]));this._supply=n.onUpdate({supply:Tn().whenOff(function(e){return u._updates.done(e)}),receive:function(e,t,n,r){return u._updates.send(n,r)}})}},{key:"done",value:function(e){return this._supply.off(e),this}},{key:"on",get:function(){return this._updates.on}},{key:"it",get:function(){return this._element[this._key]},set:function(e){this._element[this._key]=e}}]),r}(),on=function(){function t(e){mn(this,t),this._element=e,this._props=new Map}return gn(t,[{key:"bind",value:function(t){this._context=t,this._props.forEach(function(e){return e.bind(t)})}},{key:"get",value:function(e){var t=this._props.get(e);if(t)return t;var n=new un(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}]),t}(),an=Symbol("element-node"),sn=function(){function u(e,t){var n;mn(this,u),(n=wn(this,kn(u).call(this)))._bs=e,n.element=t,n._attrs=new rn(e,t),n._props=new on(t),t[an]=jn(n);var r=t[R];return r?n._bind(r):t.addEventListener("wesib:component",function(e){return n._bind(e.context)}),n}return pn(u,Ht),gn(u,[{key:"select",value:function(e,t){return function(n,e,t){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},u=n.get(A);if(r.all)return Zt(n,e,t,function(e,t){return cn(n,e,t)},r);return Zt(n,e,t,function(e,t){if(u(e))return cn(n,e,t)},r)}(this._bs,this.element,e,t)}},{key:"attribute",value:function(e){return this._attrs.get(e)}},{key:"property",value:function(e){return this._props.get(e)}},{key:"_bind",value:function(e){this._props.bind(e)}},{key:"context",get:function(){return this.element[R]}},{key:"parent",get:function(){var e=this.element.parentElement;return null!=e?cn(this._bs,e):null}}]),u}();function cn(e,t,n){var r=t[an];return n||r?r:new sn(e,t)}var fn={needs:Oe,setup:function(e){e.perComponent({a:Kt,by:function(e){return cn(e.get(a),e.element)}})}};ln("c",function(){function e(){mn(this,e)}return gn(e,null,[{key:o,get:function(){return fn}}]),e}())}}});
//# sourceMappingURL=wesib.a90f6dff.es5.js.map
